import React,{useState,useCallback,useEffect,useRef,useLayoutEffect,useContext,useDebugValue,useReducer,useMemo}from"react";import{unstable_batchedUpdates}from"react-dom";import require$$0 from"events";var FeedbackType,QuickFeedbackType,ContentType;!function(e){e[e.END_CLASS=0]="END_CLASS",e[e.LEAVE_CLASS=1]="LEAVE_CLASS"}(FeedbackType||(FeedbackType={})),function(e){e[e.VIDEO=0]="VIDEO",e[e.AUDIO=1]="AUDIO",e[e.PRESENTATION=2]="PRESENTATION",e[e.OTHER=3]="OTHER"}(QuickFeedbackType||(QuickFeedbackType={})),function(e){e.Blank="Blank",e.Stream="Stream",e.Activity="Activity",e.Video="Video",e.Audio="Audio",e.Image="Image",e.Camera="Camera",e.Screen="Screen"}(ContentType||(ContentType={}));const newUserId=e=>e,newDeviceId=e=>e,newActivityStreamId=e=>e,newWebRtcStreamId=e=>e,newTimestamp=e=>e,newTrophyType=e=>e,newUserRole=e=>e.toLowerCase();function n$2(e){for(var t=arguments.length,r=Array(t>1?t-1:0),n=1;n<t;n++)r[n-1]=arguments[n];if("production"!==process.env.NODE_ENV){var o=Y[e],i=o?"function"==typeof o?o.apply(null,r):o:"unknown error nr: "+e;throw Error("[Immer] "+i)}throw Error("[Immer] minified error nr: "+e+(r.length?" "+r.map((function(e){return"'"+e+"'"})).join(","):"")+". Find the full error at: https://bit.ly/3cXEKWf")}function t$1(e){return!!e&&!!e[Q]}function r$2(e){return!!e&&(function(e){if(!e||"object"!=typeof e)return!1;var t=Object.getPrototypeOf(e);if(null===t)return!0;var r=Object.hasOwnProperty.call(t,"constructor")&&t.constructor;return r===Object||"function"==typeof r&&Function.toString.call(r)===Z}(e)||Array.isArray(e)||!!e[L]||!!e.constructor[L]||s$1(e)||v$2(e))}function i(e,t,r){void 0===r&&(r=!1),0===o(e)?(r?Object.keys:nn)(e).forEach((function(n){r&&"symbol"==typeof n||t(n,e[n],e)})):e.forEach((function(r,n){return t(n,r,e)}))}function o(e){var t=e[Q];return t?t.i>3?t.i-4:t.i:Array.isArray(e)?1:s$1(e)?2:v$2(e)?3:0}function u$1(e,t){return 2===o(e)?e.has(t):Object.prototype.hasOwnProperty.call(e,t)}function a(e,t){return 2===o(e)?e.get(t):e[t]}function f$2(e,t,r){var n=o(e);2===n?e.set(t,r):3===n?(e.delete(t),e.add(r)):e[t]=r}function c$2(e,t){return e===t?0!==e||1/e==1/t:e!=e&&t!=t}function s$1(e){return X&&e instanceof Map}function v$2(e){return q$2&&e instanceof Set}function p$2(e){return e.o||e.t}function l$2(e){if(Array.isArray(e))return Array.prototype.slice.call(e);var t=tn(e);delete t[Q];for(var r=nn(t),n=0;n<r.length;n++){var o=r[n],i=t[o];!1===i.writable&&(i.writable=!0,i.configurable=!0),(i.get||i.set)&&(t[o]={configurable:!0,writable:!0,enumerable:i.enumerable,value:e[o]})}return Object.create(Object.getPrototypeOf(e),t)}function d$3(e,t){return void 0===t&&(t=!1),y$3(e)||t$1(e)||!r$2(e)||(o(e)>1&&(e.set=e.add=e.clear=e.delete=h$3),Object.freeze(e),t&&i(e,(function(e,t){return d$3(t,!0)}),!0)),e}function h$3(){n$2(2)}function y$3(e){return null==e||"object"!=typeof e||Object.isFrozen(e)}function b$2(e){var t=rn[e];return t||n$2(18,e),t}function m$3(e,t){rn[e]||(rn[e]=t)}function _(){return"production"===process.env.NODE_ENV||U||n$2(0),U}function j(e,t){t&&(b$2("Patches"),e.u=[],e.s=[],e.v=t)}function O(e){g$2(e),e.p.forEach(S),e.p=null}function g$2(e){e===U&&(U=e.l)}function w$3(e){return U={p:[],l:U,h:e,m:!0,_:0}}function S(e){var t=e[Q];0===t.i||1===t.i?t.j():t.O=!0}function P(e,t){t._=t.p.length;var r=t.p[0],n=void 0!==e&&e!==r;return t.h.g||b$2("ES5").S(t,e,n),n?(r[Q].P&&(O(t),n$2(4)),r$2(e)&&(e=M(t,e),t.l||x$2(t,e)),t.u&&b$2("Patches").M(r[Q],e,t.u,t.s)):e=M(t,r,[]),O(t),t.u&&t.v(t.u,t.s),e!==H$1?e:void 0}function M(e,t,r){if(y$3(t))return t;var n=t[Q];if(!n)return i(t,(function(o,i){return A$2(e,n,t,o,i,r)}),!0),t;if(n.A!==e)return t;if(!n.P)return x$2(e,n.t,!0),n.t;if(!n.I){n.I=!0,n.A._--;var o=4===n.i||5===n.i?n.o=l$2(n.k):n.o;i(3===n.i?new Set(o):o,(function(t,i){return A$2(e,n,o,t,i,r)})),x$2(e,o,!1),r&&e.u&&b$2("Patches").R(n,r,e.u,e.s)}return n.o}function A$2(e,t,r,n,o,i){if("production"!==process.env.NODE_ENV&&o===r&&n$2(5),t$1(o)){var s=M(e,o,i&&t&&3!==t.i&&!u$1(t.D,n)?i.concat(n):void 0);if(f$2(r,n,s),!t$1(s))return;e.m=!1}if(r$2(o)&&!y$3(o)){if(!e.h.F&&e._<1)return;M(e,o),t&&t.A.l||x$2(e,o)}}function x$2(e,t,r){void 0===r&&(r=!1),e.h.F&&e.m&&d$3(t,r)}function z$2(e,t){var r=e[Q];return(r?p$2(r):e)[t]}function I$1(e,t){if(t in e)for(var r=Object.getPrototypeOf(e);r;){var n=Object.getOwnPropertyDescriptor(r,t);if(n)return n;r=Object.getPrototypeOf(r)}}function k$2(e){e.P||(e.P=!0,e.l&&k$2(e.l))}function E$1(e){e.o||(e.o=l$2(e.t))}function R(e,t,r){var n=s$1(t)?b$2("MapSet").N(t,r):v$2(t)?b$2("MapSet").T(t,r):e.g?function(e,t){var r=Array.isArray(e),n={i:r?1:0,A:t?t.A:_(),P:!1,I:!1,D:{},l:t,t:e,k:null,o:null,j:null,C:!1},o=n,i=en;r&&(o=[n],i=on);var s=Proxy.revocable(o,i),a=s.revoke,c=s.proxy;return n.k=c,n.j=a,c}(t,r):b$2("ES5").J(t,r);return(r?r.A:_()).p.push(n),n}function D$1(e){return t$1(e)||n$2(22,e),function e(t){if(!r$2(t))return t;var r,n=t[Q],s=o(t);if(n){if(!n.P&&(n.i<4||!b$2("ES5").K(n)))return n.t;n.I=!0,r=F$1(t,s),n.I=!1}else r=F$1(t,s);return i(r,(function(t,o){n&&a(n.t,t)===o||f$2(r,t,e(o))})),3===s?new Set(r):r}(e)}function F$1(e,t){switch(t){case 2:return new Map(e);case 3:return Array.from(e)}return l$2(e)}function N(){function e(e,t){var r=s[e];return r?r.enumerable=t:s[e]=r={configurable:!0,enumerable:t,get:function(){var t=this[Q];return"production"!==process.env.NODE_ENV&&o(t),en.get(t,e)},set:function(t){var r=this[Q];"production"!==process.env.NODE_ENV&&o(r),en.set(r,e,t)}},r}function t(e){for(var t=e.length-1;t>=0;t--){var o=e[t][Q];if(!o.P)switch(o.i){case 5:n(o)&&k$2(o);break;case 4:r(o)&&k$2(o)}}}function r(e){for(var t=e.t,r=e.k,n=nn(r),o=n.length-1;o>=0;o--){var i=n[o];if(i!==Q){var s=t[i];if(void 0===s&&!u$1(t,i))return!0;var a=r[i],c=a&&a[Q];if(c?c.t!==s:!c$2(a,s))return!0}}var d=!!t[Q];return n.length!==nn(t).length+(d?0:1)}function n(e){var t=e.k;if(t.length!==e.t.length)return!0;var r=Object.getOwnPropertyDescriptor(t,t.length-1);return!(!r||r.get)}function o(e){e.O&&n$2(3,JSON.stringify(p$2(e)))}var s={};m$3("ES5",{J:function(t,r){var n=Array.isArray(t),o=function(t,r){if(t){for(var n=Array(r.length),o=0;o<r.length;o++)Object.defineProperty(n,""+o,e(o,!0));return n}var i=tn(r);delete i[Q];for(var s=nn(i),a=0;a<s.length;a++){var c=s[a];i[c]=e(c,t||!!i[c].enumerable)}return Object.create(Object.getPrototypeOf(r),i)}(n,t),i={i:n?5:4,A:r?r.A:_(),P:!1,I:!1,D:{},l:r,t:t,k:o,o:null,O:!1,C:!1};return Object.defineProperty(o,Q,{value:i,writable:!0}),o},S:function(e,r,o){o?t$1(r)&&r[Q].A===e&&t(e.p):(e.u&&function e(t){if(t&&"object"==typeof t){var r=t[Q];if(r){var o=r.t,s=r.k,a=r.D,c=r.i;if(4===c)i(s,(function(t){t!==Q&&(void 0!==o[t]||u$1(o,t)?a[t]||e(s[t]):(a[t]=!0,k$2(r)))})),i(o,(function(e){void 0!==s[e]||u$1(s,e)||(a[e]=!1,k$2(r))}));else if(5===c){if(n(r)&&(k$2(r),a.length=!0),s.length<o.length)for(var d=s.length;d<o.length;d++)a[d]=!1;else for(var l=o.length;l<s.length;l++)a[l]=!0;for(var p=Math.min(s.length,o.length),u=0;u<p;u++)void 0===a[u]&&e(s[u])}}}}(e.p[0]),t(e.p))},K:function(e){return 4===e.i?r(e):n(e)}})}var G$1,U,W="undefined"!=typeof Symbol&&"symbol"==typeof Symbol("x"),X="undefined"!=typeof Map,q$2="undefined"!=typeof Set,B$1="undefined"!=typeof Proxy&&void 0!==Proxy.revocable&&"undefined"!=typeof Reflect,H$1=W?Symbol.for("immer-nothing"):((G$1={})["immer-nothing"]=!0,G$1),L=W?Symbol.for("immer-draftable"):"__$immer_draftable",Q=W?Symbol.for("immer-state"):"__$immer_state",Y={0:"Illegal state",1:"Immer drafts cannot have computed properties",2:"This object has been frozen and should not be mutated",3:function(e){return"Cannot use a proxy that has been revoked. Did you pass an object from inside an immer function to an async process? "+e},4:"An immer producer returned a new value *and* modified its draft. Either return a new value *or* modify the draft.",5:"Immer forbids circular references",6:"The first or second argument to `produce` must be a function",7:"The third argument to `produce` must be a function or undefined",8:"First argument to `createDraft` must be a plain object, an array, or an immerable object",9:"First argument to `finishDraft` must be a draft returned by `createDraft`",10:"The given draft is already finalized",11:"Object.defineProperty() cannot be used on an Immer draft",12:"Object.setPrototypeOf() cannot be used on an Immer draft",13:"Immer only supports deleting array indices",14:"Immer only supports setting array indices and the 'length' property",15:function(e){return"Cannot apply patch, path doesn't resolve: "+e},16:'Sets cannot have "replace" patches.',17:function(e){return"Unsupported patch operation: "+e},18:function(e){return"The plugin for '"+e+"' has not been loaded into Immer. To enable the plugin, import and call `enable"+e+"()` when initializing your application."},20:"Cannot use proxies if Proxy, Proxy.revocable or Reflect are not available",21:function(e){return"produce can only be called on things that are draftable: plain objects, arrays, Map, Set or classes that are marked with '[immerable]: true'. Got '"+e+"'"},22:function(e){return"'current' expects a draft, got: "+e},23:function(e){return"'original' expects a draft, got: "+e},24:"Patching reserved attributes like __proto__, prototype and constructor is not allowed"},Z=""+Object.prototype.constructor,nn="undefined"!=typeof Reflect&&Reflect.ownKeys?Reflect.ownKeys:void 0!==Object.getOwnPropertySymbols?function(e){return Object.getOwnPropertyNames(e).concat(Object.getOwnPropertySymbols(e))}:Object.getOwnPropertyNames,tn=Object.getOwnPropertyDescriptors||function(e){var t={};return nn(e).forEach((function(r){t[r]=Object.getOwnPropertyDescriptor(e,r)})),t},rn={},en={get:function(e,t){if(t===Q)return e;var r=p$2(e);if(!u$1(r,t))return function(e,t,r){var n,o=I$1(t,r);return o?"value"in o?o.value:null===(n=o.get)||void 0===n?void 0:n.call(e.k):void 0}(e,r,t);var n=r[t];return e.I||!r$2(n)?n:n===z$2(e.t,t)?(E$1(e),e.o[t]=R(e.A.h,n,e)):n},has:function(e,t){return t in p$2(e)},ownKeys:function(e){return Reflect.ownKeys(p$2(e))},set:function(e,t,r){var n=I$1(p$2(e),t);if(null==n?void 0:n.set)return n.set.call(e.k,r),!0;if(!e.P){var o=z$2(p$2(e),t),i=null==o?void 0:o[Q];if(i&&i.t===r)return e.o[t]=r,e.D[t]=!1,!0;if(c$2(r,o)&&(void 0!==r||u$1(e.t,t)))return!0;E$1(e),k$2(e)}return e.o[t]===r&&"number"!=typeof r&&(void 0!==r||t in e.o)||(e.o[t]=r,e.D[t]=!0,!0)},deleteProperty:function(e,t){return void 0!==z$2(e.t,t)||t in e.t?(e.D[t]=!1,E$1(e),k$2(e)):delete e.D[t],e.o&&delete e.o[t],!0},getOwnPropertyDescriptor:function(e,t){var r=p$2(e),n=Reflect.getOwnPropertyDescriptor(r,t);return n?{writable:!0,configurable:1!==e.i||"length"!==t,enumerable:n.enumerable,value:r[t]}:n},defineProperty:function(){n$2(11)},getPrototypeOf:function(e){return Object.getPrototypeOf(e.t)},setPrototypeOf:function(){n$2(12)}},on={};i(en,(function(e,t){on[e]=function(){return arguments[0]=arguments[0][0],t.apply(this,arguments)}})),on.deleteProperty=function(e,t){return"production"!==process.env.NODE_ENV&&isNaN(parseInt(t))&&n$2(13),en.deleteProperty.call(this,e[0],t)},on.set=function(e,t,r){return"production"!==process.env.NODE_ENV&&"length"!==t&&isNaN(parseInt(t))&&n$2(14),en.set.call(this,e[0],t,r,e[0])};var un=function(){function e(e){var t=this;this.g=B$1,this.F=!0,this.produce=function(e,r,n){if("function"==typeof e&&"function"!=typeof r){var o=r;r=e;var i=t;return function(e){var t=this;void 0===e&&(e=o);for(var n=arguments.length,s=Array(n>1?n-1:0),a=1;a<n;a++)s[a-1]=arguments[a];return i.produce(e,(function(e){var n;return(n=r).call.apply(n,[t,e].concat(s))}))}}var s;if("function"!=typeof r&&n$2(6),void 0!==n&&"function"!=typeof n&&n$2(7),r$2(e)){var a=w$3(t),c=R(t,e,void 0),d=!0;try{s=r(c),d=!1}finally{d?O(a):g$2(a)}return"undefined"!=typeof Promise&&s instanceof Promise?s.then((function(e){return j(a,n),P(e,a)}),(function(e){throw O(a),e})):(j(a,n),P(s,a))}if(!e||"object"!=typeof e){if((s=r(e))===H$1)return;return void 0===s&&(s=e),t.F&&d$3(s,!0),s}n$2(21,e)},this.produceWithPatches=function(e,r){return"function"==typeof e?function(r){for(var n=arguments.length,o=Array(n>1?n-1:0),i=1;i<n;i++)o[i-1]=arguments[i];return t.produceWithPatches(r,(function(t){return e.apply(void 0,[t].concat(o))}))}:[t.produce(e,r,(function(e,t){n=e,o=t})),n,o];var n,o},"boolean"==typeof(null==e?void 0:e.useProxies)&&this.setUseProxies(e.useProxies),"boolean"==typeof(null==e?void 0:e.autoFreeze)&&this.setAutoFreeze(e.autoFreeze)}var t=e.prototype;return t.createDraft=function(e){r$2(e)||n$2(8),t$1(e)&&(e=D$1(e));var t=w$3(this),r=R(this,e,void 0);return r[Q].C=!0,g$2(t),r},t.finishDraft=function(e,t){var r=e&&e[Q];"production"!==process.env.NODE_ENV&&(r&&r.C||n$2(9),r.I&&n$2(10));var n=r.A;return j(n,t),P(void 0,n)},t.setAutoFreeze=function(e){this.F=e},t.setUseProxies=function(e){e&&!B$1&&n$2(20),this.g=e},t.applyPatches=function(e,t){var r;for(r=t.length-1;r>=0;r--){var n=t[r];if(0===n.path.length&&"replace"===n.op){e=n.value;break}}var o=b$2("Patches").$;return t$1(e)?o(e,t):this.produce(e,(function(e){return o(e,t.slice(r+1))}))},e}(),an=new un,fn=an.produce;an.produceWithPatches.bind(an),an.setAutoFreeze.bind(an),an.setUseProxies.bind(an),an.applyPatches.bind(an),an.createDraft.bind(an),an.finishDraft.bind(an);var createNextState2=fn;function formatProdErrorMessage(e){return"Minified Redux error #"+e+"; visit https://redux.js.org/Errors?code="+e+" for the full message or use the non-minified dev environment for full errors. "}var randomString=function(){return Math.random().toString(36).substring(7).split("").join(".")},ActionTypes={INIT:"@@redux/INIT"+randomString(),REPLACE:"@@redux/REPLACE"+randomString(),PROBE_UNKNOWN_ACTION:function(){return"@@redux/PROBE_UNKNOWN_ACTION"+randomString()}};function isPlainObject(e){if("object"!=typeof e||null===e)return!1;for(var t=e;null!==Object.getPrototypeOf(t);)t=Object.getPrototypeOf(t);return Object.getPrototypeOf(e)===t}function miniKindOf(e){if(void 0===e)return"undefined";if(null===e)return"null";var t=typeof e;switch(t){case"boolean":case"string":case"number":case"symbol":case"function":return t}if(Array.isArray(e))return"array";if(isDate(e))return"date";if(isError(e))return"error";var r=ctorName(e);switch(r){case"Symbol":case"Promise":case"WeakMap":case"WeakSet":case"Map":case"Set":return r}return t.slice(8,-1).toLowerCase().replace(/\s/g,"")}function ctorName(e){return"function"==typeof e.constructor?e.constructor.name:null}function isError(e){return e instanceof Error||"string"==typeof e.message&&e.constructor&&"number"==typeof e.constructor.stackTraceLimit}function isDate(e){return e instanceof Date||"function"==typeof e.toDateString&&"function"==typeof e.getDate&&"function"==typeof e.setDate}function kindOf(e){var t=typeof e;return"production"!==process.env.NODE_ENV&&(t=miniKindOf(e)),t}function warning(e){"undefined"!=typeof console&&"function"==typeof console.error&&console.error(e);try{throw new Error(e)}catch(e){}}function getUnexpectedStateShapeWarningMessage(e,t,r,n){var o=Object.keys(t),i=r&&r.type===ActionTypes.INIT?"preloadedState argument passed to createStore":"previous state received by the reducer";if(0===o.length)return"Store does not have a valid reducer. Make sure the argument passed to combineReducers is an object whose values are reducers.";if(!isPlainObject(e))return"The "+i+' has unexpected type of "'+kindOf(e)+'". Expected argument to be an object with the following keys: "'+o.join('", "')+'"';var s=Object.keys(e).filter((function(e){return!t.hasOwnProperty(e)&&!n[e]}));return s.forEach((function(e){n[e]=!0})),r&&r.type===ActionTypes.REPLACE?void 0:s.length>0?"Unexpected "+(s.length>1?"keys":"key")+' "'+s.join('", "')+'" found in '+i+'. Expected to find one of the known reducer keys instead: "'+o.join('", "')+'". Unexpected keys will be ignored.':void 0}function assertReducerShape(e){Object.keys(e).forEach((function(t){var r=e[t];if(void 0===r(void 0,{type:ActionTypes.INIT}))throw new Error("production"===process.env.NODE_ENV?formatProdErrorMessage(12):'The slice reducer for key "'+t+"\" returned undefined during initialization. If the state passed to the reducer is undefined, you must explicitly return the initial state. The initial state may not be undefined. If you don't want to set a value for this reducer, you can use null instead of undefined.");if(void 0===r(void 0,{type:ActionTypes.PROBE_UNKNOWN_ACTION()}))throw new Error("production"===process.env.NODE_ENV?formatProdErrorMessage(13):'The slice reducer for key "'+t+"\" returned undefined when probed with a random type. Don't try to handle '"+ActionTypes.INIT+'\' or other actions in "redux/*" namespace. They are considered private. Instead, you must return the current state for any unknown actions, unless it is undefined, in which case you must return the initial state, regardless of the action type. The initial state may not be undefined, but can be null.')}))}function combineReducers(e){for(var t=Object.keys(e),r={},n=0;n<t.length;n++){var o=t[n];"production"!==process.env.NODE_ENV&&void 0===e[o]&&warning('No reducer provided for key "'+o+'"'),"function"==typeof e[o]&&(r[o]=e[o])}var i,s,a=Object.keys(r);"production"!==process.env.NODE_ENV&&(i={});try{assertReducerShape(r)}catch(e){s=e}return function(e,t){if(void 0===e&&(e={}),s)throw s;if("production"!==process.env.NODE_ENV){var n=getUnexpectedStateShapeWarningMessage(e,r,t,i);n&&warning(n)}for(var o=!1,c={},d=0;d<a.length;d++){var l=a[d],p=r[l],u=e[l],f=p(u,t);if(void 0===f){var m=t&&t.type;throw new Error("production"===process.env.NODE_ENV?formatProdErrorMessage(14):"When called with an action of type "+(m?'"'+String(m)+'"':"(unknown type)")+', the slice reducer for key "'+l+'" returned undefined. To ignore an action, you must explicitly return the previous state. If you want this reducer to hold no value, you can return null instead of undefined.')}c[l]=f,o=o||f!==u}return(o=o||a.length!==Object.keys(e).length)?c:e}}function isCrushed(){}function defaultEqualityCheck(e,t){return e===t}function areArgumentsShallowlyEqual(e,t,r){if(null===t||null===r||t.length!==r.length)return!1;for(var n=t.length,o=0;o<n;o++)if(!e(t[o],r[o]))return!1;return!0}function defaultMemoize(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:defaultEqualityCheck,r=null,n=null;return function(){return areArgumentsShallowlyEqual(t,r,arguments)||(n=e.apply(null,arguments)),r=arguments,n}}function getDependencies(e){var t=Array.isArray(e[0])?e[0]:e;if(!t.every((function(e){return"function"==typeof e}))){var r=t.map((function(e){return typeof e})).join(", ");throw new Error("Selector creators expect all input-selectors to be functions, instead received the following types: ["+r+"]")}return t}function createSelectorCreator(e){for(var t=arguments.length,r=Array(t>1?t-1:0),n=1;n<t;n++)r[n-1]=arguments[n];return function(){for(var t=arguments.length,n=Array(t),o=0;o<t;o++)n[o]=arguments[o];var i=0,s=n.pop(),a=getDependencies(n),c=e.apply(void 0,[function(){return i++,s.apply(null,arguments)}].concat(r)),d=e((function(){for(var e=[],t=a.length,r=0;r<t;r++)e.push(a[r].apply(null,arguments));return c.apply(null,e)}));return d.resultFunc=s,d.dependencies=a,d.recomputations=function(){return i},d.resetRecomputations=function(){return i=0},d}}"production"!==process.env.NODE_ENV&&"string"==typeof isCrushed.name&&"isCrushed"!==isCrushed.name&&warning('You are currently using minified code outside of NODE_ENV === "production". This means that you are running a slower development build of Redux. You can use loose-envify (https://github.com/zertosh/loose-envify) for browserify or setting mode to production in webpack (https://webpack.js.org/concepts/mode/) to ensure you have the correct code for your production build.'),createSelectorCreator(defaultMemoize);var __extends=(extendStatics=function(e,t){return extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])},extendStatics(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}extendStatics(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),extendStatics,__spreadArray=function(e,t){for(var r=0,n=t.length,o=e.length;r<n;r++,o++)e[o]=t[r];return e},__defProp=Object.defineProperty,__getOwnPropSymbols=Object.getOwnPropertySymbols,__hasOwnProp=Object.prototype.hasOwnProperty,__propIsEnum=Object.prototype.propertyIsEnumerable,__defNormalProp=function(e,t,r){return t in e?__defProp(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r},__spreadValues=function(e,t){for(var r in t||(t={}))__hasOwnProp.call(t,r)&&__defNormalProp(e,r,t[r]);if(__getOwnPropSymbols)for(var n=0,o=__getOwnPropSymbols(t);n<o.length;n++){r=o[n];__propIsEnum.call(t,r)&&__defNormalProp(e,r,t[r])}return e};function createAction(e,t){function r(){for(var r=[],n=0;n<arguments.length;n++)r[n]=arguments[n];if(t){var o=t.apply(void 0,r);if(!o)throw new Error("prepareAction did not return an object");return __spreadValues(__spreadValues({type:e,payload:o.payload},"meta"in o&&{meta:o.meta}),"error"in o&&{error:o.error})}return{type:e,payload:r[0]}}return r.toString=function(){return""+e},r.type=e,r.match=function(t){return t.type===e},r}function executeReducerBuilderCallback(e){var t,r={},n=[],o={addCase:function(e,i){if("production"!==process.env.NODE_ENV){if(n.length>0)throw new Error("`builder.addCase` should only be called before calling `builder.addMatcher`");if(t)throw new Error("`builder.addCase` should only be called before calling `builder.addDefaultCase`")}var s="string"==typeof e?e:e.type;if(s in r)throw new Error("addCase cannot be called with two reducers for the same action type");return r[s]=i,o},addMatcher:function(e,r){if("production"!==process.env.NODE_ENV&&t)throw new Error("`builder.addMatcher` should only be called before calling `builder.addDefaultCase`");return n.push({matcher:e,reducer:r}),o},addDefaultCase:function(e){if("production"!==process.env.NODE_ENV&&t)throw new Error("`builder.addDefaultCase` can only be called once");return t=e,o}};return e(o),[r,n,t]}function createReducer(e,t,r,n){void 0===r&&(r=[]);var o="function"==typeof t?executeReducerBuilderCallback(t):[t,r,n],i=o[0],s=o[1],a=o[2],c=createNextState2(e,(function(){}));return function(e,t){void 0===e&&(e=c);var r=__spreadArray([i[t.type]],s.filter((function(e){return(0,e.matcher)(t)})).map((function(e){return e.reducer})));return 0===r.filter((function(e){return!!e})).length&&(r=[a]),r.reduce((function(e,r){if(r){var n;if(t$1(e))return void 0===(n=r(e,t))?e:n;if(r$2(e))return createNextState2(e,(function(e){return r(e,t)}));if(void 0===(n=r(e,t))){if(null===e)return e;throw Error("A case reducer on a non-draftable value must not return undefined")}return n}return e}),e)}}function getType2(e,t){return e+"/"+t}function createSlice(e){var t=e.name,r=e.initialState;if(!t)throw new Error("`name` is a required option for createSlice");var n=e.reducers||{},o="function"==typeof e.extraReducers?executeReducerBuilderCallback(e.extraReducers):[e.extraReducers],i=o[0],s=void 0===i?{}:i,a=o[1],c=void 0===a?[]:a,d=o[2],l=void 0===d?void 0:d,p=Object.keys(n),u={},f={},m={};p.forEach((function(e){var r,o,i=n[e],s=getType2(t,e);"reducer"in i?(r=i.reducer,o=i.prepare):r=i,u[e]=r,f[s]=r,m[e]=o?createAction(s,o):createAction(s)}));var h=createReducer(r,__spreadValues(__spreadValues({},s),f),c,l);return{name:t,reducer:h,actions:m,caseReducers:u}}!function(e){function t(){for(var r=[],n=0;n<arguments.length;n++)r[n]=arguments[n];var o=e.apply(this,r)||this;return Object.setPrototypeOf(o,t.prototype),o}__extends(t,e),Object.defineProperty(t,Symbol.species,{get:function(){return t},enumerable:!1,configurable:!0}),t.prototype.concat=function(){for(var t=[],r=0;r<arguments.length;r++)t[r]=arguments[r];return e.prototype.concat.apply(this,t)},t.prototype.prepend=function(){for(var e=[],r=0;r<arguments.length;r++)e[r]=arguments[r];return 1===e.length&&Array.isArray(e[0])?new(t.bind.apply(t,__spreadArray([void 0],e[0].concat(this)))):new(t.bind.apply(t,__spreadArray([void 0],e.concat(this))))}}(Array),process.env.NODE_ENV,process.env.NODE_ENV,N();const values=e=>Object.values(e);function isAllowedToBecomeHost(e){return"teacher"===e.toLowerCase()}const INITIAL_ROOM_STATE={users:{},devices:{},chatMessages:[],content:{type:ContentType.Blank,contentLocation:""},hostDeviceId:void 0,classEndTime:void 0},join=(e,t)=>t.payload.state,endClass=(e,t)=>{e.classEndTime=t.payload.timestamp},deviceConnect=(e,t)=>{const{name:r,device:n,role:o}=t.payload;e.devices[n.id]=n;const i=n.userId,s=e.users[i];s?s.deviceIds.push(n.id):e.users[i]={id:i,name:r,role:o,deviceIds:[n.id],trophies:[]},!e.hostDeviceId&&isAllowedToBecomeHost(o)&&(e.hostDeviceId=n.id)},deviceDisconnect=(e,t)=>{const{deviceId:r}=t.payload,n=e.devices[r];if(delete e.devices[r],n&&e.hostDeviceId===n.id){e.hostDeviceId=void 0;const t=Object.keys(e.users);t.sort();for(const r of t){const t=e.users[r];if(!t)continue;const n=t.deviceIds[0];if(n&&isAllowedToBecomeHost(t.role)){e.hostDeviceId=n;break}}}},setHost=(e,t)=>{e.hostDeviceId=t.payload},setContent=(e,t)=>{e.content=t.payload},addChatMessage=(e,t)=>{const r=t.payload;e.chatMessages.push(r)},setActivityStreamId=(e,t)=>{const{deviceId:r,activityStreamId:n}=t.payload,o=e.devices[r];o&&(o.activityStreamID=n)},rewardTrophyToUser=(e,t)=>{const{to:r,trophy:n}=t.payload;e.users[r]?.trophies.push(n)},rewardTrophyToAll=(e,t)=>{const{trophy:r}=t.payload;values(e.users).forEach((e=>e.trophies.push(r)))},classSliceActionPrefix="class",classSlice=createSlice({name:classSliceActionPrefix,initialState:INITIAL_ROOM_STATE,reducers:{join:join,endClass:endClass,deviceConnect:deviceConnect,deviceDisconnect:deviceDisconnect,setHost:setHost,setContent:setContent,addChatMessage:addChatMessage,setActivityStreamId:setActivityStreamId,rewardTrophyToUser:rewardTrophyToUser,rewardTrophyToAll:rewardTrophyToAll}}),classReducer=classSlice.reducer,classActions=classSlice.actions;function validateChatMessage({text:e,timestamp:t,userId:r}){if(e)if(t){if(r)return{userId:newUserId(r),timestamp:newTimestamp(t),text:e};console.error("IChatMessage is missing userId")}else console.error("IChatMessage is missing timestamp");else console.error("IChatMessage is missing text")}function validateContentType(e){return ContentType[e]}function validateContent(e){if(!e.type)return void console.error("IContent is missing type");if(!e.contentLocation)return void console.error("IContent is missing type");const t=validateContentType(e.type);if(!t)return void console.error(`IContent has an invalid type '${e.type}'`);return{type:t,contentLocation:e.contentLocation}}function validateState(e){const t=[];e.chatMessages?e.chatMessages.forEach((e=>{const r=validateChatMessage(e);r?t.push(r):console.error("IClassState has an invalid chatMessage")})):console.error("IClassState is missing chatMessages");let r={type:ContentType.Blank,contentLocation:""};if(e.content){const t=validateContent(e.content);t?r=t:console.error("IClassState has an invalid content")}else console.error("IClassState is missing content");const n={};e.devices?Object.values(e.devices).forEach((e=>{const t=validateDevice(e);t?n[t.id]=t:console.error("IClassState has invalid device")})):console.error("IClassState is missing devices");const o={};e.users?Object.values(e.users).forEach((e=>{const t=validateUser(e);if(!t)return void console.error("IClassState has invalid user");const r=t.deviceIds.length;t.deviceIds=t.deviceIds.filter((e=>e in n)),t.deviceIds.length!==r&&console.error("Removed unknown DeviceID from IUser"),o[t.id]=t})):console.error("IClassState is missing users");for(const e of values(n))o.hasOwnProperty(e.userId)||console.error(`Device(${e.id}) references unknown User(${e.userId})`);return{chatMessages:t,content:r,devices:n,users:o,classEndTime:e.classEndedTime?newTimestamp(e.classEndedTime):void 0,hostDeviceId:e.hostDeviceId?newDeviceId(e.hostDeviceId):void 0}}function validateUser(e){if(!e.id)return void console.error("IUser is missing id");if(!e.deviceIds)return void console.error("IUser is missing deviceIds");if(!e.name)return void console.error("IUser is missing name");if(!e.role)return void console.error("IUser is missing role");const t=[];for(const e of t){const r=validateTrophy(e);r&&t.push(r)}return{id:newUserId(e.id),deviceIds:e.deviceIds.map((e=>newDeviceId(e))),name:e.name,role:newUserRole(e.role),trophies:t}}function validateDevice({id:e,activityStreamId:t,userId:r,webRtcStreamIds:n}){if(e){if(r)return{id:newDeviceId(e),userId:newUserId(r),activityStreamID:t?newActivityStreamId(t):void 0,webRTCStreamIDs:n?.map((e=>newWebRtcStreamId(e)))||[]};console.error("IDevice is missing userId")}else console.error("IDevice is missing id")}function validateTrophy(e){if(!e.timestamp)return void console.error("ITrophy is missing trophy.timestamp");if(!e.type)return void console.error("ITrophy is missing trophy.type");if(!e.fromUserId)return void console.error("ITrophy is missing trophy.fromUserId");return{timestamp:e.timestamp,type:newTrophyType(e.type),from:newUserId(e.fromUserId)}}function messageToClassAction(e){return e.activityStreamIdChanged?activityStreamIdChangedAction(e.activityStreamIdChanged):e.classEnded?classEndedAction(e.classEnded):e.contentChanged?contentChangedAction(e.contentChanged):e.deviceConnected?deviceConnectedAction(e.deviceConnected):e.deviceDisconnected?deviceDisconnectedAction(e.deviceDisconnected):e.hostChanged?hostChangedAction(e.hostChanged):e.newChatMessage?newChatMessageAction(e.newChatMessage):e.joinEvent?joinAction(e.joinEvent):e.trophyRewardedToAll?trophyRewardedToAllAction(e.trophyRewardedToAll):e.trophyRewardedToUser?trophyRewardedToUserAction(e.trophyRewardedToUser):void 0}function activityStreamIdChangedAction(e){if(e.deviceId)return classActions.setActivityStreamId({deviceId:newDeviceId(e.deviceId),activityStreamId:e.activityStreamId?newActivityStreamId(e.activityStreamId):void 0});console.error("IActivityStreamIdChangedEvent missing deviceId")}function classEndedAction(e){if(!e.timestamp)return void console.error("IClassEndedEvent is missing timestamp");const t=newTimestamp(e.timestamp);return classActions.endClass({timestamp:t})}function contentChangedAction(e){if(!e.content)return void console.error("IContentChangedEvent is missing content");const t=validateContent(e.content);return t?classActions.setContent(t):void 0}function deviceConnectedAction(e){if(!e.name)return void console.error("IDeviceConnectedEvent is missing name");if(!e.role)return void console.error("IDeviceConnectedEvent is missing role");if(!e.device)return void console.error("IDeviceConnectedEvent is missing device");const t=validateDevice(e.device);return t?classActions.deviceConnect({name:e.name,role:newUserRole(e.role),device:t}):void 0}function deviceDisconnectedAction({deviceId:e}){if(e)return classActions.deviceDisconnect({deviceId:newDeviceId(e)});console.error("IDeviceDisconnectedEvent is missing deviceId")}function hostChangedAction(e){if(!e.hostDeviceId)return void console.error("IHostChangedEvent is missing hostDeviceId");const t=newDeviceId(e.hostDeviceId);return classActions.setHost(t)}function newChatMessageAction(e){if(!e.chatMessage)return void console.error("INewChatMessageEvent is missing chatMessage");const t=validateChatMessage(e.chatMessage);return t?classActions.addChatMessage(t):void 0}function joinAction(e){if(!e.state)return void console.error("ISetClassStateEvent is missing state");if(!e.deviceId)return void console.error("ISetClassStateEvent is missing deviceId");const t=validateState(e.state);return t?classActions.join({state:t,deviceId:newDeviceId(e.deviceId)}):void 0}function trophyRewardedToAllAction(e){if(!e.trophy)return void console.error("ITrophyRewardedToAllEvent is missing trophy");const t=validateTrophy(e.trophy);return t?classActions.rewardTrophyToAll({trophy:t}):void 0}function trophyRewardedToUserAction(e){if(!e.toUserId)return void console.error("ITrophyRewardedToAllEvent is missing toUserId");if(!e.trophy)return void console.error("ITrophyRewardedToAllEvent is missing trophy");const t=validateTrophy(e.trophy);return t?classActions.rewardTrophyToUser({to:newUserId(e.toUserId),trophy:t}):void 0}function _extends(){return _extends=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},_extends.apply(this,arguments)}"undefined"==typeof Symbol||(Symbol.iterator||(Symbol.iterator=Symbol("Symbol.iterator"))),"undefined"==typeof Symbol||(Symbol.asyncIterator||(Symbol.asyncIterator=Symbol("Symbol.asyncIterator")));var useIsomorphicLayoutEffect$1="undefined"!=typeof window&&void 0!==window.document&&void 0!==window.document.createElement?useLayoutEffect:useEffect,useGetter=function(e){var t=useRef(e);return useIsomorphicLayoutEffect$1((function(){t.current=e})),useCallback((function(){return t.current}),[t])},InitialAsyncState={status:"not-requested",loading:!1,result:void 0,error:void 0},InitialAsyncLoadingState={status:"loading",loading:!0,result:void 0,error:void 0},defaultSetLoading=function(e){return InitialAsyncLoadingState},defaultSetResult=function(e,t){return{status:"success",loading:!1,result:e,error:void 0}},defaultSetError=function(e,t){return{status:"error",loading:!1,result:void 0,error:e}},noop$1=function(){},DefaultOptions={initialState:function(e){return e&&e.executeOnMount?InitialAsyncLoadingState:InitialAsyncState},executeOnMount:!0,executeOnUpdate:!0,setLoading:defaultSetLoading,setResult:defaultSetResult,setError:defaultSetError,onSuccess:noop$1,onError:noop$1},normalizeOptions=function(e){return _extends({},DefaultOptions,{},e)},useAsyncState=function(e){var t=useState((function(){return e.initialState(e)})),r=t[0],n=t[1],o=useCallback((function(){return n(e.initialState(e))}),[n,e]),i=useCallback((function(){return n(e.setLoading(r))}),[r,n]),s=useCallback((function(t){return n(e.setResult(t,r))}),[r,n]),a=useCallback((function(t){return n(e.setError(t,r))}),[r,n]),c=useCallback((function(e){return n(_extends({},r,{},e))}),[r,n]);return{value:r,set:n,merge:c,reset:o,setLoading:i,setResult:s,setError:a}},useIsMounted=function(){var e=useRef(!1);return useEffect((function(){return e.current=!0,function(){e.current=!1}}),[]),function(){return e.current}},useCurrentPromise=function(){var e=useRef(null);return{set:function(t){return e.current=t},get:function(){return e.current},is:function(t){return e.current===t}}},useAsyncInternal=function(e,t,r){!t&&(t=[]);var n=normalizeOptions(r),o=useState(null),i=o[0],s=o[1],a=useAsyncState(n),c=useIsMounted(),d=useCurrentPromise(),l=function(e){return c()&&d.is(e)},p=useGetter((function(){for(var t=arguments.length,r=new Array(t),o=0;o<t;o++)r[o]=arguments[o];var i=function(){try{return Promise.resolve(e.apply(void 0,r))}catch(e){return Promise.reject(e)}}();return s(r),d.set(i),a.setLoading(),i.then((function(e){l(i)&&a.setResult(e),n.onSuccess(e,{isCurrent:function(){return d.is(i)}})}),(function(e){l(i)&&a.setError(e),n.onError(e,{isCurrent:function(){return d.is(i)}})})),i})),u=useCallback((function(){return p().apply(void 0,arguments)}),[p]),f=!c();return useEffect((function(){var e=function(){return p().apply(void 0,t)};f&&n.executeOnMount&&e(),!f&&n.executeOnUpdate&&e()}),t),_extends({},a.value,{set:a.set,merge:a.merge,reset:a.reset,execute:u,currentPromise:d.get(),currentParams:i})};function useAsync(e,t,r){return useAsyncInternal(e,t,r)}var useAsyncCallback=function(e,t){return useAsyncInternal(e,[],_extends({},t,{executeOnMount:!1,executeOnUpdate:!1}))};const NetworkContext=React.createContext(null);function useJoinClass(){const e=useContext(NetworkContext),{execute:t,status:r}=useAsyncCallback((t=>e.connect(t)),{onError:e=>console.error(e)});return{joinClass:t,status:r}}function useLeaveClass(){const e=useContext(NetworkContext),{execute:t,status:r}=useAsyncCallback((t=>e.disconnect(4200,t)));return{leaveClass:t,status:r}}function useEndClass(){const{execute:e,status:t}=useNetworkAction((()=>({endClass:{}})));return{endClass:e,status:t}}function useRewardTrophyToAll(){const{execute:e,status:t}=useNetworkAction((e=>({rewardTrophyToAll:{trophyType:e}})));return{rewardTrophyToAll:e,status:t}}function useRewardTrophyToUser(){const{execute:e,status:t}=useNetworkAction(((e,t)=>({rewardTrophyToUser:{trophyType:e,toUserId:t}})));return{rewardTrophyToUser:e,status:t}}function useSendChatMessage(){const{execute:e,status:t}=useNetworkAction((e=>({sendChatMessage:{text:e}})));return{sendChatMessage:e,status:t}}function useSetActivityStreamId(){const{execute:e,status:t}=useNetworkAction((e=>({setActivityStreamId:{activityStreamId:e}})));return{setActivityStreamId:e,status:t}}function useSetContent(){const{execute:e,status:t}=useNetworkAction((e=>({setContent:{content:e}})));return{setContent:e,status:t}}function useSetHost(){const{execute:e,status:t}=useNetworkAction((e=>({setHost:{hostDeviceId:e}})));return{setHost:e,status:t}}function useNetworkAction(e){const t=useContext(NetworkContext);return useAsyncCallback((async(...r)=>{const n=e(...r);await t.send(n)}))}function useNetworkHandler(e,t){const r=useContext(NetworkContext);useEffect((()=>r.onClassAction(e,t)),[r])}NetworkContext.displayName="KidsloopLiveNetwork";var commonjsGlobal="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},propTypes={exports:{}},reactIs$1={exports:{}},reactIs_production_min$1={},b$1="function"==typeof Symbol&&Symbol.for,c$1=b$1?Symbol.for("react.element"):60103,d$2=b$1?Symbol.for("react.portal"):60106,e$1=b$1?Symbol.for("react.fragment"):60107,f$1=b$1?Symbol.for("react.strict_mode"):60108,g$1=b$1?Symbol.for("react.profiler"):60114,h$2=b$1?Symbol.for("react.provider"):60109,k$1=b$1?Symbol.for("react.context"):60110,l$1=b$1?Symbol.for("react.async_mode"):60111,m$2=b$1?Symbol.for("react.concurrent_mode"):60111,n$1=b$1?Symbol.for("react.forward_ref"):60112,p$1=b$1?Symbol.for("react.suspense"):60113,q$1=b$1?Symbol.for("react.suspense_list"):60120,r$1=b$1?Symbol.for("react.memo"):60115,t=b$1?Symbol.for("react.lazy"):60116,v$1=b$1?Symbol.for("react.block"):60121,w$2=b$1?Symbol.for("react.fundamental"):60117,x$1=b$1?Symbol.for("react.responder"):60118,y$2=b$1?Symbol.for("react.scope"):60119;function z$1(e){if("object"==typeof e&&null!==e){var r=e.$$typeof;switch(r){case c$1:switch(e=e.type){case l$1:case m$2:case e$1:case g$1:case f$1:case p$1:return e;default:switch(e=e&&e.$$typeof){case k$1:case n$1:case t:case r$1:case h$2:return e;default:return r}}case d$2:return r}}}function A$1(e){return z$1(e)===m$2}reactIs_production_min$1.AsyncMode=l$1,reactIs_production_min$1.ConcurrentMode=m$2,reactIs_production_min$1.ContextConsumer=k$1,reactIs_production_min$1.ContextProvider=h$2,reactIs_production_min$1.Element=c$1,reactIs_production_min$1.ForwardRef=n$1,reactIs_production_min$1.Fragment=e$1,reactIs_production_min$1.Lazy=t,reactIs_production_min$1.Memo=r$1,reactIs_production_min$1.Portal=d$2,reactIs_production_min$1.Profiler=g$1,reactIs_production_min$1.StrictMode=f$1,reactIs_production_min$1.Suspense=p$1,reactIs_production_min$1.isAsyncMode=function(e){return A$1(e)||z$1(e)===l$1},reactIs_production_min$1.isConcurrentMode=A$1,reactIs_production_min$1.isContextConsumer=function(e){return z$1(e)===k$1},reactIs_production_min$1.isContextProvider=function(e){return z$1(e)===h$2},reactIs_production_min$1.isElement=function(e){return"object"==typeof e&&null!==e&&e.$$typeof===c$1},reactIs_production_min$1.isForwardRef=function(e){return z$1(e)===n$1},reactIs_production_min$1.isFragment=function(e){return z$1(e)===e$1},reactIs_production_min$1.isLazy=function(e){return z$1(e)===t},reactIs_production_min$1.isMemo=function(e){return z$1(e)===r$1},reactIs_production_min$1.isPortal=function(e){return z$1(e)===d$2},reactIs_production_min$1.isProfiler=function(e){return z$1(e)===g$1},reactIs_production_min$1.isStrictMode=function(e){return z$1(e)===f$1},reactIs_production_min$1.isSuspense=function(e){return z$1(e)===p$1},reactIs_production_min$1.isValidElementType=function(e){return"string"==typeof e||"function"==typeof e||e===e$1||e===m$2||e===g$1||e===f$1||e===p$1||e===q$1||"object"==typeof e&&null!==e&&(e.$$typeof===t||e.$$typeof===r$1||e.$$typeof===h$2||e.$$typeof===k$1||e.$$typeof===n$1||e.$$typeof===w$2||e.$$typeof===x$1||e.$$typeof===y$2||e.$$typeof===v$1)},reactIs_production_min$1.typeOf=z$1;var reactIs_development$1={};
/** @license React v16.13.1
 * react-is.development.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */"production"!==process.env.NODE_ENV&&function(){var e="function"==typeof Symbol&&Symbol.for,t=e?Symbol.for("react.element"):60103,r=e?Symbol.for("react.portal"):60106,n=e?Symbol.for("react.fragment"):60107,o=e?Symbol.for("react.strict_mode"):60108,i=e?Symbol.for("react.profiler"):60114,s=e?Symbol.for("react.provider"):60109,a=e?Symbol.for("react.context"):60110,c=e?Symbol.for("react.async_mode"):60111,d=e?Symbol.for("react.concurrent_mode"):60111,l=e?Symbol.for("react.forward_ref"):60112,p=e?Symbol.for("react.suspense"):60113,u=e?Symbol.for("react.suspense_list"):60120,f=e?Symbol.for("react.memo"):60115,m=e?Symbol.for("react.lazy"):60116,h=e?Symbol.for("react.block"):60121,g=e?Symbol.for("react.fundamental"):60117,y=e?Symbol.for("react.responder"):60118,v=e?Symbol.for("react.scope"):60119;function b(e){if("object"==typeof e&&null!==e){var u=e.$$typeof;switch(u){case t:var h=e.type;switch(h){case c:case d:case n:case i:case o:case p:return h;default:var g=h&&h.$$typeof;switch(g){case a:case l:case m:case f:case s:return g;default:return u}}case r:return u}}}var _=c,w=d,S=a,$=s,R=t,C=l,T=n,P=m,O=f,I=r,E=i,k=o,D=p,j=!1;function x(e){return b(e)===d}reactIs_development$1.AsyncMode=_,reactIs_development$1.ConcurrentMode=w,reactIs_development$1.ContextConsumer=S,reactIs_development$1.ContextProvider=$,reactIs_development$1.Element=R,reactIs_development$1.ForwardRef=C,reactIs_development$1.Fragment=T,reactIs_development$1.Lazy=P,reactIs_development$1.Memo=O,reactIs_development$1.Portal=I,reactIs_development$1.Profiler=E,reactIs_development$1.StrictMode=k,reactIs_development$1.Suspense=D,reactIs_development$1.isAsyncMode=function(e){return j||(j=!0,console.warn("The ReactIs.isAsyncMode() alias has been deprecated, and will be removed in React 17+. Update your code to use ReactIs.isConcurrentMode() instead. It has the exact same API.")),x(e)||b(e)===c},reactIs_development$1.isConcurrentMode=x,reactIs_development$1.isContextConsumer=function(e){return b(e)===a},reactIs_development$1.isContextProvider=function(e){return b(e)===s},reactIs_development$1.isElement=function(e){return"object"==typeof e&&null!==e&&e.$$typeof===t},reactIs_development$1.isForwardRef=function(e){return b(e)===l},reactIs_development$1.isFragment=function(e){return b(e)===n},reactIs_development$1.isLazy=function(e){return b(e)===m},reactIs_development$1.isMemo=function(e){return b(e)===f},reactIs_development$1.isPortal=function(e){return b(e)===r},reactIs_development$1.isProfiler=function(e){return b(e)===i},reactIs_development$1.isStrictMode=function(e){return b(e)===o},reactIs_development$1.isSuspense=function(e){return b(e)===p},reactIs_development$1.isValidElementType=function(e){return"string"==typeof e||"function"==typeof e||e===n||e===d||e===i||e===o||e===p||e===u||"object"==typeof e&&null!==e&&(e.$$typeof===m||e.$$typeof===f||e.$$typeof===s||e.$$typeof===a||e.$$typeof===l||e.$$typeof===g||e.$$typeof===y||e.$$typeof===v||e.$$typeof===h)},reactIs_development$1.typeOf=b}(),"production"===process.env.NODE_ENV?reactIs$1.exports=reactIs_production_min$1:reactIs$1.exports=reactIs_development$1
/*
object-assign
(c) Sindre Sorhus
@license MIT
*/;var getOwnPropertySymbols=Object.getOwnPropertySymbols,hasOwnProperty=Object.prototype.hasOwnProperty,propIsEnumerable=Object.prototype.propertyIsEnumerable;function toObject(e){if(null==e)throw new TypeError("Object.assign cannot be called with null or undefined");return Object(e)}function shouldUseNative(){try{if(!Object.assign)return!1;var e=new String("abc");if(e[5]="de","5"===Object.getOwnPropertyNames(e)[0])return!1;for(var t={},r=0;r<10;r++)t["_"+String.fromCharCode(r)]=r;var n=Object.getOwnPropertyNames(t).map((function(e){return t[e]}));if("0123456789"!==n.join(""))return!1;var o={};return"abcdefghijklmnopqrst".split("").forEach((function(e){o[e]=e})),"abcdefghijklmnopqrst"===Object.keys(Object.assign({},o)).join("")}catch(e){return!1}}var objectAssign=shouldUseNative()?Object.assign:function(e,t){for(var r,n,o=toObject(e),i=1;i<arguments.length;i++){for(var s in r=Object(arguments[i]))hasOwnProperty.call(r,s)&&(o[s]=r[s]);if(getOwnPropertySymbols){n=getOwnPropertySymbols(r);for(var a=0;a<n.length;a++)propIsEnumerable.call(r,n[a])&&(o[n[a]]=r[n[a]])}}return o},ReactPropTypesSecret$3="SECRET_DO_NOT_PASS_THIS_OR_YOU_WILL_BE_FIRED",ReactPropTypesSecret_1=ReactPropTypesSecret$3,printWarning$1=function(){};if("production"!==process.env.NODE_ENV){var ReactPropTypesSecret$2=ReactPropTypesSecret_1,loggedTypeFailures={},has$1=Function.call.bind(Object.prototype.hasOwnProperty);printWarning$1=function(e){var t="Warning: "+e;"undefined"!=typeof console&&console.error(t);try{throw new Error(t)}catch(e){}}}function checkPropTypes$1(e,t,r,n,o){if("production"!==process.env.NODE_ENV)for(var i in e)if(has$1(e,i)){var s;try{if("function"!=typeof e[i]){var a=Error((n||"React class")+": "+r+" type `"+i+"` is invalid; it must be a function, usually from the `prop-types` package, but received `"+typeof e[i]+"`.");throw a.name="Invariant Violation",a}s=e[i](t,i,n,r,null,ReactPropTypesSecret$2)}catch(e){s=e}if(!s||s instanceof Error||printWarning$1((n||"React class")+": type specification of "+r+" `"+i+"` is invalid; the type checker function must return `null` or an `Error` but returned a "+typeof s+". You may have forgotten to pass an argument to the type checker creator (arrayOf, instanceOf, objectOf, oneOf, oneOfType, and shape all require an argument)."),s instanceof Error&&!(s.message in loggedTypeFailures)){loggedTypeFailures[s.message]=!0;var c=o?o():"";printWarning$1("Failed "+r+" type: "+s.message+(null!=c?c:""))}}}checkPropTypes$1.resetWarningCache=function(){"production"!==process.env.NODE_ENV&&(loggedTypeFailures={})};var checkPropTypes_1=checkPropTypes$1,ReactIs$1=reactIs$1.exports,assign=objectAssign,ReactPropTypesSecret$1=ReactPropTypesSecret_1,checkPropTypes=checkPropTypes_1,has=Function.call.bind(Object.prototype.hasOwnProperty),printWarning=function(){};function emptyFunctionThatReturnsNull(){return null}"production"!==process.env.NODE_ENV&&(printWarning=function(e){var t="Warning: "+e;"undefined"!=typeof console&&console.error(t);try{throw new Error(t)}catch(e){}});var factoryWithTypeCheckers=function(e,t){var r="function"==typeof Symbol&&Symbol.iterator;var n="<<anonymous>>",o={array:c("array"),bool:c("boolean"),func:c("function"),number:c("number"),object:c("object"),string:c("string"),symbol:c("symbol"),any:a(emptyFunctionThatReturnsNull),arrayOf:function(e){return a((function(t,r,n,o,i){if("function"!=typeof e)return new s("Property `"+i+"` of component `"+n+"` has invalid PropType notation inside arrayOf.");var a=t[r];if(!Array.isArray(a))return new s("Invalid "+o+" `"+i+"` of type `"+l(a)+"` supplied to `"+n+"`, expected an array.");for(var c=0;c<a.length;c++){var d=e(a,c,n,o,i+"["+c+"]",ReactPropTypesSecret$1);if(d instanceof Error)return d}return null}))},element:a((function(t,r,n,o,i){var a=t[r];return e(a)?null:new s("Invalid "+o+" `"+i+"` of type `"+l(a)+"` supplied to `"+n+"`, expected a single ReactElement.")})),elementType:a((function(e,t,r,n,o){var i=e[t];return ReactIs$1.isValidElementType(i)?null:new s("Invalid "+n+" `"+o+"` of type `"+l(i)+"` supplied to `"+r+"`, expected a single ReactElement type.")})),instanceOf:function(e){return a((function(t,r,o,i,a){if(!(t[r]instanceof e)){var c=e.name||n;return new s("Invalid "+i+" `"+a+"` of type `"+(((d=t[r]).constructor&&d.constructor.name?d.constructor.name:n)+"` supplied to `")+o+"`, expected instance of `"+c+"`.")}var d;return null}))},node:a((function(e,t,r,n,o){return d(e[t])?null:new s("Invalid "+n+" `"+o+"` supplied to `"+r+"`, expected a ReactNode.")})),objectOf:function(e){return a((function(t,r,n,o,i){if("function"!=typeof e)return new s("Property `"+i+"` of component `"+n+"` has invalid PropType notation inside objectOf.");var a=t[r],c=l(a);if("object"!==c)return new s("Invalid "+o+" `"+i+"` of type `"+c+"` supplied to `"+n+"`, expected an object.");for(var d in a)if(has(a,d)){var p=e(a,d,n,o,i+"."+d,ReactPropTypesSecret$1);if(p instanceof Error)return p}return null}))},oneOf:function(e){if(!Array.isArray(e))return"production"!==process.env.NODE_ENV&&printWarning(arguments.length>1?"Invalid arguments supplied to oneOf, expected an array, got "+arguments.length+" arguments. A common mistake is to write oneOf(x, y, z) instead of oneOf([x, y, z]).":"Invalid argument supplied to oneOf, expected an array."),emptyFunctionThatReturnsNull;function t(t,r,n,o,a){for(var c=t[r],d=0;d<e.length;d++)if(i(c,e[d]))return null;var l=JSON.stringify(e,(function(e,t){return"symbol"===p(t)?String(t):t}));return new s("Invalid "+o+" `"+a+"` of value `"+String(c)+"` supplied to `"+n+"`, expected one of "+l+".")}return a(t)},oneOfType:function(e){if(!Array.isArray(e))return"production"!==process.env.NODE_ENV&&printWarning("Invalid argument supplied to oneOfType, expected an instance of array."),emptyFunctionThatReturnsNull;for(var t=0;t<e.length;t++){var r=e[t];if("function"!=typeof r)return printWarning("Invalid argument supplied to oneOfType. Expected an array of check functions, but received "+u(r)+" at index "+t+"."),emptyFunctionThatReturnsNull}return a((function(t,r,n,o,i){for(var a=0;a<e.length;a++)if(null==(0,e[a])(t,r,n,o,i,ReactPropTypesSecret$1))return null;return new s("Invalid "+o+" `"+i+"` supplied to `"+n+"`.")}))},shape:function(e){return a((function(t,r,n,o,i){var a=t[r],c=l(a);if("object"!==c)return new s("Invalid "+o+" `"+i+"` of type `"+c+"` supplied to `"+n+"`, expected `object`.");for(var d in e){var p=e[d];if(p){var u=p(a,d,n,o,i+"."+d,ReactPropTypesSecret$1);if(u)return u}}return null}))},exact:function(e){return a((function(t,r,n,o,i){var a=t[r],c=l(a);if("object"!==c)return new s("Invalid "+o+" `"+i+"` of type `"+c+"` supplied to `"+n+"`, expected `object`.");var d=assign({},t[r],e);for(var p in d){var u=e[p];if(!u)return new s("Invalid "+o+" `"+i+"` key `"+p+"` supplied to `"+n+"`.\nBad object: "+JSON.stringify(t[r],null,"  ")+"\nValid keys: "+JSON.stringify(Object.keys(e),null,"  "));var f=u(a,p,n,o,i+"."+p,ReactPropTypesSecret$1);if(f)return f}return null}))}};function i(e,t){return e===t?0!==e||1/e==1/t:e!=e&&t!=t}function s(e){this.message=e,this.stack=""}function a(e){if("production"!==process.env.NODE_ENV)var r={},o=0;function i(i,a,c,d,l,p,u){if(d=d||n,p=p||c,u!==ReactPropTypesSecret$1){if(t){var f=new Error("Calling PropTypes validators directly is not supported by the `prop-types` package. Use `PropTypes.checkPropTypes()` to call them. Read more at http://fb.me/use-check-prop-types");throw f.name="Invariant Violation",f}if("production"!==process.env.NODE_ENV&&"undefined"!=typeof console){var m=d+":"+c;!r[m]&&o<3&&(printWarning("You are manually calling a React.PropTypes validation function for the `"+p+"` prop on `"+d+"`. This is deprecated and will throw in the standalone `prop-types` package. You may be seeing this warning due to a third-party PropTypes library. See https://fb.me/react-warning-dont-call-proptypes for details."),r[m]=!0,o++)}}return null==a[c]?i?null===a[c]?new s("The "+l+" `"+p+"` is marked as required in `"+d+"`, but its value is `null`."):new s("The "+l+" `"+p+"` is marked as required in `"+d+"`, but its value is `undefined`."):null:e(a,c,d,l,p)}var a=i.bind(null,!1);return a.isRequired=i.bind(null,!0),a}function c(e){return a((function(t,r,n,o,i,a){var c=t[r];return l(c)!==e?new s("Invalid "+o+" `"+i+"` of type `"+p(c)+"` supplied to `"+n+"`, expected `"+e+"`."):null}))}function d(t){switch(typeof t){case"number":case"string":case"undefined":return!0;case"boolean":return!t;case"object":if(Array.isArray(t))return t.every(d);if(null===t||e(t))return!0;var n=function(e){var t=e&&(r&&e[r]||e["@@iterator"]);if("function"==typeof t)return t}(t);if(!n)return!1;var o,i=n.call(t);if(n!==t.entries){for(;!(o=i.next()).done;)if(!d(o.value))return!1}else for(;!(o=i.next()).done;){var s=o.value;if(s&&!d(s[1]))return!1}return!0;default:return!1}}function l(e){var t=typeof e;return Array.isArray(e)?"array":e instanceof RegExp?"object":function(e,t){return"symbol"===e||!!t&&("Symbol"===t["@@toStringTag"]||"function"==typeof Symbol&&t instanceof Symbol)}(t,e)?"symbol":t}function p(e){if(null==e)return""+e;var t=l(e);if("object"===t){if(e instanceof Date)return"date";if(e instanceof RegExp)return"regexp"}return t}function u(e){var t=p(e);switch(t){case"array":case"object":return"an "+t;case"boolean":case"date":case"regexp":return"a "+t;default:return t}}return s.prototype=Error.prototype,o.checkPropTypes=checkPropTypes,o.resetWarningCache=checkPropTypes.resetWarningCache,o.PropTypes=o,o},ReactPropTypesSecret=ReactPropTypesSecret_1;function emptyFunction(){}function emptyFunctionWithReset(){}emptyFunctionWithReset.resetWarningCache=emptyFunction;var factoryWithThrowingShims=function(){function e(e,t,r,n,o,i){if(i!==ReactPropTypesSecret){var s=new Error("Calling PropTypes validators directly is not supported by the `prop-types` package. Use PropTypes.checkPropTypes() to call them. Read more at http://fb.me/use-check-prop-types");throw s.name="Invariant Violation",s}}function t(){return e}e.isRequired=e;var r={array:e,bool:e,func:e,number:e,object:e,string:e,symbol:e,any:e,arrayOf:t,element:e,elementType:e,instanceOf:t,node:e,objectOf:t,oneOf:t,oneOfType:t,shape:t,exact:t,checkPropTypes:emptyFunctionWithReset,resetWarningCache:emptyFunction};return r.PropTypes=r,r};if("production"!==process.env.NODE_ENV){var ReactIs=reactIs$1.exports,throwOnDirectAccess=!0;propTypes.exports=factoryWithTypeCheckers(ReactIs.isElement,throwOnDirectAccess)}else propTypes.exports=factoryWithThrowingShims();var PropTypes=propTypes.exports,ReactReduxContext=React.createContext(null);function defaultNoopBatch(e){e()}"production"!==process.env.NODE_ENV&&(ReactReduxContext.displayName="ReactRedux");var batch=defaultNoopBatch,setBatch=function(e){return batch=e},getBatch=function(){return batch};function createListenerCollection(){var e=getBatch(),t=null,r=null;return{clear:function(){t=null,r=null},notify:function(){e((function(){for(var e=t;e;)e.callback(),e=e.next}))},get:function(){for(var e=[],r=t;r;)e.push(r),r=r.next;return e},subscribe:function(e){var n=!0,o=r={callback:e,next:null,prev:r};return o.prev?o.prev.next=o:t=o,function(){n&&null!==t&&(n=!1,o.next?o.next.prev=o.prev:r=o.prev,o.prev?o.prev.next=o.next:t=o.next)}}}}var nullListeners={notify:function(){},get:function(){return[]}};function createSubscription(e,t){var r,n=nullListeners;function o(){s.onStateChange&&s.onStateChange()}function i(){r||(r=t?t.addNestedSub(o):e.subscribe(o),n=createListenerCollection())}var s={addNestedSub:function(e){return i(),n.subscribe(e)},notifyNestedSubs:function(){n.notify()},handleChangeWrapper:o,isSubscribed:function(){return Boolean(r)},trySubscribe:i,tryUnsubscribe:function(){r&&(r(),r=void 0,n.clear(),n=nullListeners)},getListeners:function(){return n}};return s}var useIsomorphicLayoutEffect="undefined"!=typeof window&&void 0!==window.document&&void 0!==window.document.createElement?useLayoutEffect:useEffect;"production"!==process.env.NODE_ENV&&(PropTypes.shape({subscribe:PropTypes.func.isRequired,dispatch:PropTypes.func.isRequired,getState:PropTypes.func.isRequired}),PropTypes.object,PropTypes.any);var reactIs=reactIs$1.exports,FORWARD_REF_STATICS={$$typeof:!0,render:!0,defaultProps:!0,displayName:!0,propTypes:!0},MEMO_STATICS={$$typeof:!0,compare:!0,defaultProps:!0,displayName:!0,propTypes:!0,type:!0},TYPE_STATICS={};TYPE_STATICS[reactIs.ForwardRef]=FORWARD_REF_STATICS,TYPE_STATICS[reactIs.Memo]=MEMO_STATICS;var reactIs_production_min={},b=60103,c=60106,d$1=60107,e=60108,f=60114,g=60109,h$1=60110,k=60112,l=60113,m$1=60120,n=60115,p=60116,q=60121,r=60122,u=60117,v=60129,w$1=60131;
/** @license React v17.0.2
 * react-is.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */if("function"==typeof Symbol&&Symbol.for){var x=Symbol.for;b=x("react.element"),c=x("react.portal"),d$1=x("react.fragment"),e=x("react.strict_mode"),f=x("react.profiler"),g=x("react.provider"),h$1=x("react.context"),k=x("react.forward_ref"),l=x("react.suspense"),m$1=x("react.suspense_list"),n=x("react.memo"),p=x("react.lazy"),q=x("react.block"),r=x("react.server.block"),u=x("react.fundamental"),v=x("react.debug_trace_mode"),w$1=x("react.legacy_hidden")}function y$1(t){if("object"==typeof t&&null!==t){var r=t.$$typeof;switch(r){case b:switch(t=t.type){case d$1:case f:case e:case l:case m$1:return t;default:switch(t=t&&t.$$typeof){case h$1:case k:case p:case n:case g:return t;default:return r}}case c:return r}}}var z=g,A=b,B=k,C=d$1,D=p,E=n,F=c,G=f,H=e,I=l;reactIs_production_min.ContextConsumer=h$1,reactIs_production_min.ContextProvider=z,reactIs_production_min.Element=A,reactIs_production_min.ForwardRef=B,reactIs_production_min.Fragment=C,reactIs_production_min.Lazy=D,reactIs_production_min.Memo=E,reactIs_production_min.Portal=F,reactIs_production_min.Profiler=G,reactIs_production_min.StrictMode=H,reactIs_production_min.Suspense=I,reactIs_production_min.isAsyncMode=function(){return!1},reactIs_production_min.isConcurrentMode=function(){return!1},reactIs_production_min.isContextConsumer=function(e){return y$1(e)===h$1},reactIs_production_min.isContextProvider=function(e){return y$1(e)===g},reactIs_production_min.isElement=function(e){return"object"==typeof e&&null!==e&&e.$$typeof===b},reactIs_production_min.isForwardRef=function(e){return y$1(e)===k},reactIs_production_min.isFragment=function(e){return y$1(e)===d$1},reactIs_production_min.isLazy=function(e){return y$1(e)===p},reactIs_production_min.isMemo=function(e){return y$1(e)===n},reactIs_production_min.isPortal=function(e){return y$1(e)===c},reactIs_production_min.isProfiler=function(e){return y$1(e)===f},reactIs_production_min.isStrictMode=function(t){return y$1(t)===e},reactIs_production_min.isSuspense=function(e){return y$1(e)===l},reactIs_production_min.isValidElementType=function(t){return"string"==typeof t||"function"==typeof t||t===d$1||t===f||t===v||t===e||t===l||t===m$1||t===w$1||"object"==typeof t&&null!==t&&(t.$$typeof===p||t.$$typeof===n||t.$$typeof===g||t.$$typeof===h$1||t.$$typeof===k||t.$$typeof===u||t.$$typeof===q||t[0]===r)},reactIs_production_min.typeOf=y$1;var reactIs_development={};
/** @license React v17.0.2
 * react-is.development.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */function useReduxContext(){var e=useContext(ReactReduxContext);if("production"!==process.env.NODE_ENV&&!e)throw new Error("could not find react-redux context value; please ensure the component is wrapped in a <Provider>");return e}function createStoreHook(e){void 0===e&&(e=ReactReduxContext);var t=e===ReactReduxContext?useReduxContext:function(){return useContext(e)};return function(){return t().store}}"production"!==process.env.NODE_ENV&&function(){var e=60103,t=60106,r=60107,n=60108,o=60114,i=60109,s=60110,a=60112,c=60113,d=60120,l=60115,p=60116,u=60121,f=60122,m=60117,h=60129,g=60131;if("function"==typeof Symbol&&Symbol.for){var y=Symbol.for;e=y("react.element"),t=y("react.portal"),r=y("react.fragment"),n=y("react.strict_mode"),o=y("react.profiler"),i=y("react.provider"),s=y("react.context"),a=y("react.forward_ref"),c=y("react.suspense"),d=y("react.suspense_list"),l=y("react.memo"),p=y("react.lazy"),u=y("react.block"),f=y("react.server.block"),m=y("react.fundamental"),y("react.scope"),y("react.opaque.id"),h=y("react.debug_trace_mode"),y("react.offscreen"),g=y("react.legacy_hidden")}function v(u){if("object"==typeof u&&null!==u){var f=u.$$typeof;switch(f){case e:var m=u.type;switch(m){case r:case o:case n:case c:case d:return m;default:var h=m&&m.$$typeof;switch(h){case s:case a:case p:case l:case i:return h;default:return f}}case t:return f}}}var b=s,_=i,w=e,S=a,$=r,R=p,C=l,T=t,P=o,O=n,I=c,E=!1,k=!1;reactIs_development.ContextConsumer=b,reactIs_development.ContextProvider=_,reactIs_development.Element=w,reactIs_development.ForwardRef=S,reactIs_development.Fragment=$,reactIs_development.Lazy=R,reactIs_development.Memo=C,reactIs_development.Portal=T,reactIs_development.Profiler=P,reactIs_development.StrictMode=O,reactIs_development.Suspense=I,reactIs_development.isAsyncMode=function(e){return E||(E=!0,console.warn("The ReactIs.isAsyncMode() alias has been deprecated, and will be removed in React 18+.")),!1},reactIs_development.isConcurrentMode=function(e){return k||(k=!0,console.warn("The ReactIs.isConcurrentMode() alias has been deprecated, and will be removed in React 18+.")),!1},reactIs_development.isContextConsumer=function(e){return v(e)===s},reactIs_development.isContextProvider=function(e){return v(e)===i},reactIs_development.isElement=function(t){return"object"==typeof t&&null!==t&&t.$$typeof===e},reactIs_development.isForwardRef=function(e){return v(e)===a},reactIs_development.isFragment=function(e){return v(e)===r},reactIs_development.isLazy=function(e){return v(e)===p},reactIs_development.isMemo=function(e){return v(e)===l},reactIs_development.isPortal=function(e){return v(e)===t},reactIs_development.isProfiler=function(e){return v(e)===o},reactIs_development.isStrictMode=function(e){return v(e)===n},reactIs_development.isSuspense=function(e){return v(e)===c},reactIs_development.isValidElementType=function(e){return"string"==typeof e||"function"==typeof e||(e===r||e===o||e===h||e===n||e===c||e===d||e===g||"object"==typeof e&&null!==e&&(e.$$typeof===p||e.$$typeof===l||e.$$typeof===i||e.$$typeof===s||e.$$typeof===a||e.$$typeof===m||e.$$typeof===u||e[0]===f))},reactIs_development.typeOf=v}(),process.env.NODE_ENV;var useStore=createStoreHook(),refEquality=function(e,t){return e===t};function useSelectorWithStoreAndSubscription(e,t,r,n){var o,i=useReducer((function(e){return e+1}),0),s=i[1],a=useMemo((function(){return createSubscription(r,n)}),[r,n]),c=useRef(),d=useRef(),l=useRef(),p=useRef(),u=r.getState();try{if(e!==d.current||u!==l.current||c.current){var f=e(u);o=void 0!==p.current&&t(f,p.current)?p.current:f}else o=p.current}catch(e){throw c.current&&(e.message+="\nThe error may be correlated with this previous error:\n"+c.current.stack+"\n\n"),e}return useIsomorphicLayoutEffect((function(){d.current=e,l.current=u,p.current=o,c.current=void 0})),useIsomorphicLayoutEffect((function(){function e(){try{var e=r.getState();if(e===l.current)return;var n=d.current(e);if(t(n,p.current))return;p.current=n,l.current=e}catch(e){c.current=e}s()}return a.onStateChange=e,a.trySubscribe(),e(),function(){return a.tryUnsubscribe()}}),[r,a]),o}function createSelectorHook(e){void 0===e&&(e=ReactReduxContext);var t=e===ReactReduxContext?useReduxContext:function(){return useContext(e)};return function(e,r){if(void 0===r&&(r=refEquality),"production"!==process.env.NODE_ENV){if(!e)throw new Error("You must pass a selector to useSelector");if("function"!=typeof e)throw new Error("You must pass a function as a selector to useSelector");if("function"!=typeof r)throw new Error("You must pass a function as an equality function to useSelector")}var n=t(),o=useSelectorWithStoreAndSubscription(e,r,n.store,n.subscription);return useDebugValue(o),o}}var useSelector=createSelectorHook();function useNetworkState(e,t){const r=useContext(NetworkContext);return useSelector((t=>e(r.selector(t))),t)}setBatch(unstable_batchedUpdates);const newUserDeviceId=(e,t)=>JSON.stringify([e,t]),useUserDevices=e=>useNetworkState((t=>{const r=[];for(const n of Object.values(t.class.users))if(void 0===e||n.role===e)for(const e of n.deviceIds){const o=t.class.devices[e];if(!o)continue;const i=newUserDeviceId(n.id,o.id);r.push({id:i,user:n,device:o})}return r})),resolveUserDevice=(e,t)=>{const r=e.class.devices[t];if(!r)return;const n=e.class.users[r.userId];return n?{id:newUserDeviceId(n.id,r.id),device:r,user:n}:void 0},useHostUserDevice=()=>useNetworkState((e=>{if(e.class.hostDeviceId)return resolveUserDevice(e,e.class.hostDeviceId)})),useLocalUserDevice=()=>useNetworkState((e=>{if(e.network.myDeviceId)return resolveUserDevice(e,e.network.myDeviceId)}));var lib$2={},browser={exports:{}},s=1e3,m=60*s,h=60*m,d=24*h,w=7*d,y=365.25*d,ms=function(e,t){t=t||{};var r=typeof e;if("string"===r&&e.length>0)return parse$1(e);if("number"===r&&isFinite(e))return t.long?fmtLong(e):fmtShort(e);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(e))};function parse$1(e){if(!((e=String(e)).length>100)){var t=/^(-?(?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)?$/i.exec(e);if(t){var r=parseFloat(t[1]);switch((t[2]||"ms").toLowerCase()){case"years":case"year":case"yrs":case"yr":case"y":return r*y;case"weeks":case"week":case"w":return r*w;case"days":case"day":case"d":return r*d;case"hours":case"hour":case"hrs":case"hr":case"h":return r*h;case"minutes":case"minute":case"mins":case"min":case"m":return r*m;case"seconds":case"second":case"secs":case"sec":case"s":return r*s;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return r;default:return}}}}function fmtShort(e){var t=Math.abs(e);return t>=d?Math.round(e/d)+"d":t>=h?Math.round(e/h)+"h":t>=m?Math.round(e/m)+"m":t>=s?Math.round(e/s)+"s":e+"ms"}function fmtLong(e){var t=Math.abs(e);return t>=d?plural(e,t,d,"day"):t>=h?plural(e,t,h,"hour"):t>=m?plural(e,t,m,"minute"):t>=s?plural(e,t,s,"second"):e+" ms"}function plural(e,t,r,n){var o=t>=1.5*r;return Math.round(e/r)+" "+n+(o?"s":"")}function setup(e){function t(e){let n,o,i,s=null;function a(...e){if(!a.enabled)return;const r=a,o=Number(new Date),i=o-(n||o);r.diff=i,r.prev=n,r.curr=o,n=o,e[0]=t.coerce(e[0]),"string"!=typeof e[0]&&e.unshift("%O");let s=0;e[0]=e[0].replace(/%([a-zA-Z%])/g,((n,o)=>{if("%%"===n)return"%";s++;const i=t.formatters[o];if("function"==typeof i){const t=e[s];n=i.call(r,t),e.splice(s,1),s--}return n})),t.formatArgs.call(r,e);(r.log||t.log).apply(r,e)}return a.namespace=e,a.useColors=t.useColors(),a.color=t.selectColor(e),a.extend=r,a.destroy=t.destroy,Object.defineProperty(a,"enabled",{enumerable:!0,configurable:!1,get:()=>null!==s?s:(o!==t.namespaces&&(o=t.namespaces,i=t.enabled(e)),i),set:e=>{s=e}}),"function"==typeof t.init&&t.init(a),a}function r(e,r){const n=t(this.namespace+(void 0===r?":":r)+e);return n.log=this.log,n}function n(e){return e.toString().substring(2,e.toString().length-2).replace(/\.\*\?$/,"*")}return t.debug=t,t.default=t,t.coerce=function(e){if(e instanceof Error)return e.stack||e.message;return e},t.disable=function(){const e=[...t.names.map(n),...t.skips.map(n).map((e=>"-"+e))].join(",");return t.enable(""),e},t.enable=function(e){let r;t.save(e),t.namespaces=e,t.names=[],t.skips=[];const n=("string"==typeof e?e:"").split(/[\s,]+/),o=n.length;for(r=0;r<o;r++)n[r]&&("-"===(e=n[r].replace(/\*/g,".*?"))[0]?t.skips.push(new RegExp("^"+e.substr(1)+"$")):t.names.push(new RegExp("^"+e+"$")))},t.enabled=function(e){if("*"===e[e.length-1])return!0;let r,n;for(r=0,n=t.skips.length;r<n;r++)if(t.skips[r].test(e))return!1;for(r=0,n=t.names.length;r<n;r++)if(t.names[r].test(e))return!0;return!1},t.humanize=ms,t.destroy=function(){console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`.")},Object.keys(e).forEach((r=>{t[r]=e[r]})),t.names=[],t.skips=[],t.formatters={},t.selectColor=function(e){let r=0;for(let t=0;t<e.length;t++)r=(r<<5)-r+e.charCodeAt(t),r|=0;return t.colors[Math.abs(r)%t.colors.length]},t.enable(t.load()),t}var common=setup;!function(e,t){t.formatArgs=function(t){if(t[0]=(this.useColors?"%c":"")+this.namespace+(this.useColors?" %c":" ")+t[0]+(this.useColors?"%c ":" ")+"+"+e.exports.humanize(this.diff),!this.useColors)return;const r="color: "+this.color;t.splice(1,0,r,"color: inherit");let n=0,o=0;t[0].replace(/%[a-zA-Z%]/g,(e=>{"%%"!==e&&(n++,"%c"===e&&(o=n))})),t.splice(o,0,r)},t.save=function(e){try{e?t.storage.setItem("debug",e):t.storage.removeItem("debug")}catch(e){}},t.load=function(){let e;try{e=t.storage.getItem("debug")}catch(e){}!e&&"undefined"!=typeof process&&"env"in process&&(e=process.env.DEBUG);return e},t.useColors=function(){if("undefined"!=typeof window&&window.process&&("renderer"===window.process.type||window.process.__nwjs))return!0;if("undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/))return!1;return"undefined"!=typeof document&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||"undefined"!=typeof window&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&parseInt(RegExp.$1,10)>=31||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/)},t.storage=function(){try{return localStorage}catch(e){}}(),t.destroy=(()=>{let e=!1;return()=>{e||(e=!0,console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`."))}})(),t.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"],t.log=console.debug||console.log||(()=>{}),e.exports=common(t);const{formatters:r}=e.exports;r.j=function(e){try{return JSON.stringify(e)}catch(e){return"[UnexpectedJSONParseError]: "+e.message}}}(browser,browser.exports);var Device$1={},es5={exports:{}};es5.exports=function(e){var t={};function r(n){if(t[n])return t[n].exports;var o=t[n]={i:n,l:!1,exports:{}};return e[n].call(o.exports,o,o.exports,r),o.l=!0,o.exports}return r.m=e,r.c=t,r.d=function(e,t,n){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)r.d(n,o,function(t){return e[t]}.bind(null,o));return n},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="",r(r.s=90)}({17:function(e,t,r){t.__esModule=!0,t.default=void 0;var n=r(18),o=function(){function e(){}return e.getFirstMatch=function(e,t){var r=t.match(e);return r&&r.length>0&&r[1]||""},e.getSecondMatch=function(e,t){var r=t.match(e);return r&&r.length>1&&r[2]||""},e.matchAndReturnConst=function(e,t,r){if(e.test(t))return r},e.getWindowsVersionName=function(e){switch(e){case"NT":return"NT";case"XP":case"NT 5.1":return"XP";case"NT 5.0":return"2000";case"NT 5.2":return"2003";case"NT 6.0":return"Vista";case"NT 6.1":return"7";case"NT 6.2":return"8";case"NT 6.3":return"8.1";case"NT 10.0":return"10";default:return}},e.getMacOSVersionName=function(e){var t=e.split(".").splice(0,2).map((function(e){return parseInt(e,10)||0}));if(t.push(0),10===t[0])switch(t[1]){case 5:return"Leopard";case 6:return"Snow Leopard";case 7:return"Lion";case 8:return"Mountain Lion";case 9:return"Mavericks";case 10:return"Yosemite";case 11:return"El Capitan";case 12:return"Sierra";case 13:return"High Sierra";case 14:return"Mojave";case 15:return"Catalina";default:return}},e.getAndroidVersionName=function(e){var t=e.split(".").splice(0,2).map((function(e){return parseInt(e,10)||0}));if(t.push(0),!(1===t[0]&&t[1]<5))return 1===t[0]&&t[1]<6?"Cupcake":1===t[0]&&t[1]>=6?"Donut":2===t[0]&&t[1]<2?"Eclair":2===t[0]&&2===t[1]?"Froyo":2===t[0]&&t[1]>2?"Gingerbread":3===t[0]?"Honeycomb":4===t[0]&&t[1]<1?"Ice Cream Sandwich":4===t[0]&&t[1]<4?"Jelly Bean":4===t[0]&&t[1]>=4?"KitKat":5===t[0]?"Lollipop":6===t[0]?"Marshmallow":7===t[0]?"Nougat":8===t[0]?"Oreo":9===t[0]?"Pie":void 0},e.getVersionPrecision=function(e){return e.split(".").length},e.compareVersions=function(t,r,n){void 0===n&&(n=!1);var o=e.getVersionPrecision(t),i=e.getVersionPrecision(r),s=Math.max(o,i),a=0,c=e.map([t,r],(function(t){var r=s-e.getVersionPrecision(t),n=t+new Array(r+1).join(".0");return e.map(n.split("."),(function(e){return new Array(20-e.length).join("0")+e})).reverse()}));for(n&&(a=s-Math.min(o,i)),s-=1;s>=a;){if(c[0][s]>c[1][s])return 1;if(c[0][s]===c[1][s]){if(s===a)return 0;s-=1}else if(c[0][s]<c[1][s])return-1}},e.map=function(e,t){var r,n=[];if(Array.prototype.map)return Array.prototype.map.call(e,t);for(r=0;r<e.length;r+=1)n.push(t(e[r]));return n},e.find=function(e,t){var r,n;if(Array.prototype.find)return Array.prototype.find.call(e,t);for(r=0,n=e.length;r<n;r+=1){var o=e[r];if(t(o,r))return o}},e.assign=function(e){for(var t,r,n=e,o=arguments.length,i=new Array(o>1?o-1:0),s=1;s<o;s++)i[s-1]=arguments[s];if(Object.assign)return Object.assign.apply(Object,[e].concat(i));var a=function(){var e=i[t];"object"==typeof e&&null!==e&&Object.keys(e).forEach((function(t){n[t]=e[t]}))};for(t=0,r=i.length;t<r;t+=1)a();return e},e.getBrowserAlias=function(e){return n.BROWSER_ALIASES_MAP[e]},e.getBrowserTypeByAlias=function(e){return n.BROWSER_MAP[e]||""},e}();t.default=o,e.exports=t.default},18:function(e,t,r){t.__esModule=!0,t.ENGINE_MAP=t.OS_MAP=t.PLATFORMS_MAP=t.BROWSER_MAP=t.BROWSER_ALIASES_MAP=void 0,t.BROWSER_ALIASES_MAP={"Amazon Silk":"amazon_silk","Android Browser":"android",Bada:"bada",BlackBerry:"blackberry",Chrome:"chrome",Chromium:"chromium",Electron:"electron",Epiphany:"epiphany",Firefox:"firefox",Focus:"focus",Generic:"generic","Google Search":"google_search",Googlebot:"googlebot","Internet Explorer":"ie","K-Meleon":"k_meleon",Maxthon:"maxthon","Microsoft Edge":"edge","MZ Browser":"mz","NAVER Whale Browser":"naver",Opera:"opera","Opera Coast":"opera_coast",PhantomJS:"phantomjs",Puffin:"puffin",QupZilla:"qupzilla",QQ:"qq",QQLite:"qqlite",Safari:"safari",Sailfish:"sailfish","Samsung Internet for Android":"samsung_internet",SeaMonkey:"seamonkey",Sleipnir:"sleipnir",Swing:"swing",Tizen:"tizen","UC Browser":"uc",Vivaldi:"vivaldi","WebOS Browser":"webos",WeChat:"wechat","Yandex Browser":"yandex",Roku:"roku"},t.BROWSER_MAP={amazon_silk:"Amazon Silk",android:"Android Browser",bada:"Bada",blackberry:"BlackBerry",chrome:"Chrome",chromium:"Chromium",electron:"Electron",epiphany:"Epiphany",firefox:"Firefox",focus:"Focus",generic:"Generic",googlebot:"Googlebot",google_search:"Google Search",ie:"Internet Explorer",k_meleon:"K-Meleon",maxthon:"Maxthon",edge:"Microsoft Edge",mz:"MZ Browser",naver:"NAVER Whale Browser",opera:"Opera",opera_coast:"Opera Coast",phantomjs:"PhantomJS",puffin:"Puffin",qupzilla:"QupZilla",qq:"QQ Browser",qqlite:"QQ Browser Lite",safari:"Safari",sailfish:"Sailfish",samsung_internet:"Samsung Internet for Android",seamonkey:"SeaMonkey",sleipnir:"Sleipnir",swing:"Swing",tizen:"Tizen",uc:"UC Browser",vivaldi:"Vivaldi",webos:"WebOS Browser",wechat:"WeChat",yandex:"Yandex Browser"},t.PLATFORMS_MAP={tablet:"tablet",mobile:"mobile",desktop:"desktop",tv:"tv"},t.OS_MAP={WindowsPhone:"Windows Phone",Windows:"Windows",MacOS:"macOS",iOS:"iOS",Android:"Android",WebOS:"WebOS",BlackBerry:"BlackBerry",Bada:"Bada",Tizen:"Tizen",Linux:"Linux",ChromeOS:"Chrome OS",PlayStation4:"PlayStation 4",Roku:"Roku"},t.ENGINE_MAP={EdgeHTML:"EdgeHTML",Blink:"Blink",Trident:"Trident",Presto:"Presto",Gecko:"Gecko",WebKit:"WebKit"}},90:function(e,t,r){t.__esModule=!0,t.default=void 0;var n,o=(n=r(91))&&n.__esModule?n:{default:n},i=r(18);function s(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var a=function(){function e(){}var t,r,n;return e.getParser=function(e,t){if(void 0===t&&(t=!1),"string"!=typeof e)throw new Error("UserAgent should be a string");return new o.default(e,t)},e.parse=function(e){return new o.default(e).getResult()},t=e,n=[{key:"BROWSER_MAP",get:function(){return i.BROWSER_MAP}},{key:"ENGINE_MAP",get:function(){return i.ENGINE_MAP}},{key:"OS_MAP",get:function(){return i.OS_MAP}},{key:"PLATFORMS_MAP",get:function(){return i.PLATFORMS_MAP}}],(r=null)&&s(t.prototype,r),n&&s(t,n),e}();t.default=a,e.exports=t.default},91:function(e,t,r){t.__esModule=!0,t.default=void 0;var n=c(r(92)),o=c(r(93)),i=c(r(94)),s=c(r(95)),a=c(r(17));function c(e){return e&&e.__esModule?e:{default:e}}var d=function(){function e(e,t){if(void 0===t&&(t=!1),null==e||""===e)throw new Error("UserAgent parameter can't be empty");this._ua=e,this.parsedResult={},!0!==t&&this.parse()}var t=e.prototype;return t.getUA=function(){return this._ua},t.test=function(e){return e.test(this._ua)},t.parseBrowser=function(){var e=this;this.parsedResult.browser={};var t=a.default.find(n.default,(function(t){if("function"==typeof t.test)return t.test(e);if(t.test instanceof Array)return t.test.some((function(t){return e.test(t)}));throw new Error("Browser's test function is not valid")}));return t&&(this.parsedResult.browser=t.describe(this.getUA())),this.parsedResult.browser},t.getBrowser=function(){return this.parsedResult.browser?this.parsedResult.browser:this.parseBrowser()},t.getBrowserName=function(e){return e?String(this.getBrowser().name).toLowerCase()||"":this.getBrowser().name||""},t.getBrowserVersion=function(){return this.getBrowser().version},t.getOS=function(){return this.parsedResult.os?this.parsedResult.os:this.parseOS()},t.parseOS=function(){var e=this;this.parsedResult.os={};var t=a.default.find(o.default,(function(t){if("function"==typeof t.test)return t.test(e);if(t.test instanceof Array)return t.test.some((function(t){return e.test(t)}));throw new Error("Browser's test function is not valid")}));return t&&(this.parsedResult.os=t.describe(this.getUA())),this.parsedResult.os},t.getOSName=function(e){var t=this.getOS().name;return e?String(t).toLowerCase()||"":t||""},t.getOSVersion=function(){return this.getOS().version},t.getPlatform=function(){return this.parsedResult.platform?this.parsedResult.platform:this.parsePlatform()},t.getPlatformType=function(e){void 0===e&&(e=!1);var t=this.getPlatform().type;return e?String(t).toLowerCase()||"":t||""},t.parsePlatform=function(){var e=this;this.parsedResult.platform={};var t=a.default.find(i.default,(function(t){if("function"==typeof t.test)return t.test(e);if(t.test instanceof Array)return t.test.some((function(t){return e.test(t)}));throw new Error("Browser's test function is not valid")}));return t&&(this.parsedResult.platform=t.describe(this.getUA())),this.parsedResult.platform},t.getEngine=function(){return this.parsedResult.engine?this.parsedResult.engine:this.parseEngine()},t.getEngineName=function(e){return e?String(this.getEngine().name).toLowerCase()||"":this.getEngine().name||""},t.parseEngine=function(){var e=this;this.parsedResult.engine={};var t=a.default.find(s.default,(function(t){if("function"==typeof t.test)return t.test(e);if(t.test instanceof Array)return t.test.some((function(t){return e.test(t)}));throw new Error("Browser's test function is not valid")}));return t&&(this.parsedResult.engine=t.describe(this.getUA())),this.parsedResult.engine},t.parse=function(){return this.parseBrowser(),this.parseOS(),this.parsePlatform(),this.parseEngine(),this},t.getResult=function(){return a.default.assign({},this.parsedResult)},t.satisfies=function(e){var t=this,r={},n=0,o={},i=0;if(Object.keys(e).forEach((function(t){var s=e[t];"string"==typeof s?(o[t]=s,i+=1):"object"==typeof s&&(r[t]=s,n+=1)})),n>0){var s=Object.keys(r),c=a.default.find(s,(function(e){return t.isOS(e)}));if(c){var d=this.satisfies(r[c]);if(void 0!==d)return d}var l=a.default.find(s,(function(e){return t.isPlatform(e)}));if(l){var p=this.satisfies(r[l]);if(void 0!==p)return p}}if(i>0){var u=Object.keys(o),f=a.default.find(u,(function(e){return t.isBrowser(e,!0)}));if(void 0!==f)return this.compareVersion(o[f])}},t.isBrowser=function(e,t){void 0===t&&(t=!1);var r=this.getBrowserName().toLowerCase(),n=e.toLowerCase(),o=a.default.getBrowserTypeByAlias(n);return t&&o&&(n=o.toLowerCase()),n===r},t.compareVersion=function(e){var t=[0],r=e,n=!1,o=this.getBrowserVersion();if("string"==typeof o)return">"===e[0]||"<"===e[0]?(r=e.substr(1),"="===e[1]?(n=!0,r=e.substr(2)):t=[],">"===e[0]?t.push(1):t.push(-1)):"="===e[0]?r=e.substr(1):"~"===e[0]&&(n=!0,r=e.substr(1)),t.indexOf(a.default.compareVersions(o,r,n))>-1},t.isOS=function(e){return this.getOSName(!0)===String(e).toLowerCase()},t.isPlatform=function(e){return this.getPlatformType(!0)===String(e).toLowerCase()},t.isEngine=function(e){return this.getEngineName(!0)===String(e).toLowerCase()},t.is=function(e,t){return void 0===t&&(t=!1),this.isBrowser(e,t)||this.isOS(e)||this.isPlatform(e)},t.some=function(e){var t=this;return void 0===e&&(e=[]),e.some((function(e){return t.is(e)}))},e}();t.default=d,e.exports=t.default},92:function(e,t,r){t.__esModule=!0,t.default=void 0;var n,o=(n=r(17))&&n.__esModule?n:{default:n},i=/version\/(\d+(\.?_?\d+)+)/i,s=[{test:[/googlebot/i],describe:function(e){var t={name:"Googlebot"},r=o.default.getFirstMatch(/googlebot\/(\d+(\.\d+))/i,e)||o.default.getFirstMatch(i,e);return r&&(t.version=r),t}},{test:[/opera/i],describe:function(e){var t={name:"Opera"},r=o.default.getFirstMatch(i,e)||o.default.getFirstMatch(/(?:opera)[\s/](\d+(\.?_?\d+)+)/i,e);return r&&(t.version=r),t}},{test:[/opr\/|opios/i],describe:function(e){var t={name:"Opera"},r=o.default.getFirstMatch(/(?:opr|opios)[\s/](\S+)/i,e)||o.default.getFirstMatch(i,e);return r&&(t.version=r),t}},{test:[/SamsungBrowser/i],describe:function(e){var t={name:"Samsung Internet for Android"},r=o.default.getFirstMatch(i,e)||o.default.getFirstMatch(/(?:SamsungBrowser)[\s/](\d+(\.?_?\d+)+)/i,e);return r&&(t.version=r),t}},{test:[/Whale/i],describe:function(e){var t={name:"NAVER Whale Browser"},r=o.default.getFirstMatch(i,e)||o.default.getFirstMatch(/(?:whale)[\s/](\d+(?:\.\d+)+)/i,e);return r&&(t.version=r),t}},{test:[/MZBrowser/i],describe:function(e){var t={name:"MZ Browser"},r=o.default.getFirstMatch(/(?:MZBrowser)[\s/](\d+(?:\.\d+)+)/i,e)||o.default.getFirstMatch(i,e);return r&&(t.version=r),t}},{test:[/focus/i],describe:function(e){var t={name:"Focus"},r=o.default.getFirstMatch(/(?:focus)[\s/](\d+(?:\.\d+)+)/i,e)||o.default.getFirstMatch(i,e);return r&&(t.version=r),t}},{test:[/swing/i],describe:function(e){var t={name:"Swing"},r=o.default.getFirstMatch(/(?:swing)[\s/](\d+(?:\.\d+)+)/i,e)||o.default.getFirstMatch(i,e);return r&&(t.version=r),t}},{test:[/coast/i],describe:function(e){var t={name:"Opera Coast"},r=o.default.getFirstMatch(i,e)||o.default.getFirstMatch(/(?:coast)[\s/](\d+(\.?_?\d+)+)/i,e);return r&&(t.version=r),t}},{test:[/opt\/\d+(?:.?_?\d+)+/i],describe:function(e){var t={name:"Opera Touch"},r=o.default.getFirstMatch(/(?:opt)[\s/](\d+(\.?_?\d+)+)/i,e)||o.default.getFirstMatch(i,e);return r&&(t.version=r),t}},{test:[/yabrowser/i],describe:function(e){var t={name:"Yandex Browser"},r=o.default.getFirstMatch(/(?:yabrowser)[\s/](\d+(\.?_?\d+)+)/i,e)||o.default.getFirstMatch(i,e);return r&&(t.version=r),t}},{test:[/ucbrowser/i],describe:function(e){var t={name:"UC Browser"},r=o.default.getFirstMatch(i,e)||o.default.getFirstMatch(/(?:ucbrowser)[\s/](\d+(\.?_?\d+)+)/i,e);return r&&(t.version=r),t}},{test:[/Maxthon|mxios/i],describe:function(e){var t={name:"Maxthon"},r=o.default.getFirstMatch(i,e)||o.default.getFirstMatch(/(?:Maxthon|mxios)[\s/](\d+(\.?_?\d+)+)/i,e);return r&&(t.version=r),t}},{test:[/epiphany/i],describe:function(e){var t={name:"Epiphany"},r=o.default.getFirstMatch(i,e)||o.default.getFirstMatch(/(?:epiphany)[\s/](\d+(\.?_?\d+)+)/i,e);return r&&(t.version=r),t}},{test:[/puffin/i],describe:function(e){var t={name:"Puffin"},r=o.default.getFirstMatch(i,e)||o.default.getFirstMatch(/(?:puffin)[\s/](\d+(\.?_?\d+)+)/i,e);return r&&(t.version=r),t}},{test:[/sleipnir/i],describe:function(e){var t={name:"Sleipnir"},r=o.default.getFirstMatch(i,e)||o.default.getFirstMatch(/(?:sleipnir)[\s/](\d+(\.?_?\d+)+)/i,e);return r&&(t.version=r),t}},{test:[/k-meleon/i],describe:function(e){var t={name:"K-Meleon"},r=o.default.getFirstMatch(i,e)||o.default.getFirstMatch(/(?:k-meleon)[\s/](\d+(\.?_?\d+)+)/i,e);return r&&(t.version=r),t}},{test:[/micromessenger/i],describe:function(e){var t={name:"WeChat"},r=o.default.getFirstMatch(/(?:micromessenger)[\s/](\d+(\.?_?\d+)+)/i,e)||o.default.getFirstMatch(i,e);return r&&(t.version=r),t}},{test:[/qqbrowser/i],describe:function(e){var t={name:/qqbrowserlite/i.test(e)?"QQ Browser Lite":"QQ Browser"},r=o.default.getFirstMatch(/(?:qqbrowserlite|qqbrowser)[/](\d+(\.?_?\d+)+)/i,e)||o.default.getFirstMatch(i,e);return r&&(t.version=r),t}},{test:[/msie|trident/i],describe:function(e){var t={name:"Internet Explorer"},r=o.default.getFirstMatch(/(?:msie |rv:)(\d+(\.?_?\d+)+)/i,e);return r&&(t.version=r),t}},{test:[/\sedg\//i],describe:function(e){var t={name:"Microsoft Edge"},r=o.default.getFirstMatch(/\sedg\/(\d+(\.?_?\d+)+)/i,e);return r&&(t.version=r),t}},{test:[/edg([ea]|ios)/i],describe:function(e){var t={name:"Microsoft Edge"},r=o.default.getSecondMatch(/edg([ea]|ios)\/(\d+(\.?_?\d+)+)/i,e);return r&&(t.version=r),t}},{test:[/vivaldi/i],describe:function(e){var t={name:"Vivaldi"},r=o.default.getFirstMatch(/vivaldi\/(\d+(\.?_?\d+)+)/i,e);return r&&(t.version=r),t}},{test:[/seamonkey/i],describe:function(e){var t={name:"SeaMonkey"},r=o.default.getFirstMatch(/seamonkey\/(\d+(\.?_?\d+)+)/i,e);return r&&(t.version=r),t}},{test:[/sailfish/i],describe:function(e){var t={name:"Sailfish"},r=o.default.getFirstMatch(/sailfish\s?browser\/(\d+(\.\d+)?)/i,e);return r&&(t.version=r),t}},{test:[/silk/i],describe:function(e){var t={name:"Amazon Silk"},r=o.default.getFirstMatch(/silk\/(\d+(\.?_?\d+)+)/i,e);return r&&(t.version=r),t}},{test:[/phantom/i],describe:function(e){var t={name:"PhantomJS"},r=o.default.getFirstMatch(/phantomjs\/(\d+(\.?_?\d+)+)/i,e);return r&&(t.version=r),t}},{test:[/slimerjs/i],describe:function(e){var t={name:"SlimerJS"},r=o.default.getFirstMatch(/slimerjs\/(\d+(\.?_?\d+)+)/i,e);return r&&(t.version=r),t}},{test:[/blackberry|\bbb\d+/i,/rim\stablet/i],describe:function(e){var t={name:"BlackBerry"},r=o.default.getFirstMatch(i,e)||o.default.getFirstMatch(/blackberry[\d]+\/(\d+(\.?_?\d+)+)/i,e);return r&&(t.version=r),t}},{test:[/(web|hpw)[o0]s/i],describe:function(e){var t={name:"WebOS Browser"},r=o.default.getFirstMatch(i,e)||o.default.getFirstMatch(/w(?:eb)?[o0]sbrowser\/(\d+(\.?_?\d+)+)/i,e);return r&&(t.version=r),t}},{test:[/bada/i],describe:function(e){var t={name:"Bada"},r=o.default.getFirstMatch(/dolfin\/(\d+(\.?_?\d+)+)/i,e);return r&&(t.version=r),t}},{test:[/tizen/i],describe:function(e){var t={name:"Tizen"},r=o.default.getFirstMatch(/(?:tizen\s?)?browser\/(\d+(\.?_?\d+)+)/i,e)||o.default.getFirstMatch(i,e);return r&&(t.version=r),t}},{test:[/qupzilla/i],describe:function(e){var t={name:"QupZilla"},r=o.default.getFirstMatch(/(?:qupzilla)[\s/](\d+(\.?_?\d+)+)/i,e)||o.default.getFirstMatch(i,e);return r&&(t.version=r),t}},{test:[/firefox|iceweasel|fxios/i],describe:function(e){var t={name:"Firefox"},r=o.default.getFirstMatch(/(?:firefox|iceweasel|fxios)[\s/](\d+(\.?_?\d+)+)/i,e);return r&&(t.version=r),t}},{test:[/electron/i],describe:function(e){var t={name:"Electron"},r=o.default.getFirstMatch(/(?:electron)\/(\d+(\.?_?\d+)+)/i,e);return r&&(t.version=r),t}},{test:[/MiuiBrowser/i],describe:function(e){var t={name:"Miui"},r=o.default.getFirstMatch(/(?:MiuiBrowser)[\s/](\d+(\.?_?\d+)+)/i,e);return r&&(t.version=r),t}},{test:[/chromium/i],describe:function(e){var t={name:"Chromium"},r=o.default.getFirstMatch(/(?:chromium)[\s/](\d+(\.?_?\d+)+)/i,e)||o.default.getFirstMatch(i,e);return r&&(t.version=r),t}},{test:[/chrome|crios|crmo/i],describe:function(e){var t={name:"Chrome"},r=o.default.getFirstMatch(/(?:chrome|crios|crmo)\/(\d+(\.?_?\d+)+)/i,e);return r&&(t.version=r),t}},{test:[/GSA/i],describe:function(e){var t={name:"Google Search"},r=o.default.getFirstMatch(/(?:GSA)\/(\d+(\.?_?\d+)+)/i,e);return r&&(t.version=r),t}},{test:function(e){var t=!e.test(/like android/i),r=e.test(/android/i);return t&&r},describe:function(e){var t={name:"Android Browser"},r=o.default.getFirstMatch(i,e);return r&&(t.version=r),t}},{test:[/playstation 4/i],describe:function(e){var t={name:"PlayStation 4"},r=o.default.getFirstMatch(i,e);return r&&(t.version=r),t}},{test:[/safari|applewebkit/i],describe:function(e){var t={name:"Safari"},r=o.default.getFirstMatch(i,e);return r&&(t.version=r),t}},{test:[/.*/i],describe:function(e){var t=-1!==e.search("\\(")?/^(.*)\/(.*)[ \t]\((.*)/:/^(.*)\/(.*) /;return{name:o.default.getFirstMatch(t,e),version:o.default.getSecondMatch(t,e)}}}];t.default=s,e.exports=t.default},93:function(e,t,r){t.__esModule=!0,t.default=void 0;var n,o=(n=r(17))&&n.__esModule?n:{default:n},i=r(18),s=[{test:[/Roku\/DVP/],describe:function(e){var t=o.default.getFirstMatch(/Roku\/DVP-(\d+\.\d+)/i,e);return{name:i.OS_MAP.Roku,version:t}}},{test:[/windows phone/i],describe:function(e){var t=o.default.getFirstMatch(/windows phone (?:os)?\s?(\d+(\.\d+)*)/i,e);return{name:i.OS_MAP.WindowsPhone,version:t}}},{test:[/windows /i],describe:function(e){var t=o.default.getFirstMatch(/Windows ((NT|XP)( \d\d?.\d)?)/i,e),r=o.default.getWindowsVersionName(t);return{name:i.OS_MAP.Windows,version:t,versionName:r}}},{test:[/Macintosh(.*?) FxiOS(.*?)\//],describe:function(e){var t={name:i.OS_MAP.iOS},r=o.default.getSecondMatch(/(Version\/)(\d[\d.]+)/,e);return r&&(t.version=r),t}},{test:[/macintosh/i],describe:function(e){var t=o.default.getFirstMatch(/mac os x (\d+(\.?_?\d+)+)/i,e).replace(/[_\s]/g,"."),r=o.default.getMacOSVersionName(t),n={name:i.OS_MAP.MacOS,version:t};return r&&(n.versionName=r),n}},{test:[/(ipod|iphone|ipad)/i],describe:function(e){var t=o.default.getFirstMatch(/os (\d+([_\s]\d+)*) like mac os x/i,e).replace(/[_\s]/g,".");return{name:i.OS_MAP.iOS,version:t}}},{test:function(e){var t=!e.test(/like android/i),r=e.test(/android/i);return t&&r},describe:function(e){var t=o.default.getFirstMatch(/android[\s/-](\d+(\.\d+)*)/i,e),r=o.default.getAndroidVersionName(t),n={name:i.OS_MAP.Android,version:t};return r&&(n.versionName=r),n}},{test:[/(web|hpw)[o0]s/i],describe:function(e){var t=o.default.getFirstMatch(/(?:web|hpw)[o0]s\/(\d+(\.\d+)*)/i,e),r={name:i.OS_MAP.WebOS};return t&&t.length&&(r.version=t),r}},{test:[/blackberry|\bbb\d+/i,/rim\stablet/i],describe:function(e){var t=o.default.getFirstMatch(/rim\stablet\sos\s(\d+(\.\d+)*)/i,e)||o.default.getFirstMatch(/blackberry\d+\/(\d+([_\s]\d+)*)/i,e)||o.default.getFirstMatch(/\bbb(\d+)/i,e);return{name:i.OS_MAP.BlackBerry,version:t}}},{test:[/bada/i],describe:function(e){var t=o.default.getFirstMatch(/bada\/(\d+(\.\d+)*)/i,e);return{name:i.OS_MAP.Bada,version:t}}},{test:[/tizen/i],describe:function(e){var t=o.default.getFirstMatch(/tizen[/\s](\d+(\.\d+)*)/i,e);return{name:i.OS_MAP.Tizen,version:t}}},{test:[/linux/i],describe:function(){return{name:i.OS_MAP.Linux}}},{test:[/CrOS/],describe:function(){return{name:i.OS_MAP.ChromeOS}}},{test:[/PlayStation 4/],describe:function(e){var t=o.default.getFirstMatch(/PlayStation 4[/\s](\d+(\.\d+)*)/i,e);return{name:i.OS_MAP.PlayStation4,version:t}}}];t.default=s,e.exports=t.default},94:function(e,t,r){t.__esModule=!0,t.default=void 0;var n,o=(n=r(17))&&n.__esModule?n:{default:n},i=r(18),s=[{test:[/googlebot/i],describe:function(){return{type:"bot",vendor:"Google"}}},{test:[/huawei/i],describe:function(e){var t=o.default.getFirstMatch(/(can-l01)/i,e)&&"Nova",r={type:i.PLATFORMS_MAP.mobile,vendor:"Huawei"};return t&&(r.model=t),r}},{test:[/nexus\s*(?:7|8|9|10).*/i],describe:function(){return{type:i.PLATFORMS_MAP.tablet,vendor:"Nexus"}}},{test:[/ipad/i],describe:function(){return{type:i.PLATFORMS_MAP.tablet,vendor:"Apple",model:"iPad"}}},{test:[/Macintosh(.*?) FxiOS(.*?)\//],describe:function(){return{type:i.PLATFORMS_MAP.tablet,vendor:"Apple",model:"iPad"}}},{test:[/kftt build/i],describe:function(){return{type:i.PLATFORMS_MAP.tablet,vendor:"Amazon",model:"Kindle Fire HD 7"}}},{test:[/silk/i],describe:function(){return{type:i.PLATFORMS_MAP.tablet,vendor:"Amazon"}}},{test:[/tablet(?! pc)/i],describe:function(){return{type:i.PLATFORMS_MAP.tablet}}},{test:function(e){var t=e.test(/ipod|iphone/i),r=e.test(/like (ipod|iphone)/i);return t&&!r},describe:function(e){var t=o.default.getFirstMatch(/(ipod|iphone)/i,e);return{type:i.PLATFORMS_MAP.mobile,vendor:"Apple",model:t}}},{test:[/nexus\s*[0-6].*/i,/galaxy nexus/i],describe:function(){return{type:i.PLATFORMS_MAP.mobile,vendor:"Nexus"}}},{test:[/[^-]mobi/i],describe:function(){return{type:i.PLATFORMS_MAP.mobile}}},{test:function(e){return"blackberry"===e.getBrowserName(!0)},describe:function(){return{type:i.PLATFORMS_MAP.mobile,vendor:"BlackBerry"}}},{test:function(e){return"bada"===e.getBrowserName(!0)},describe:function(){return{type:i.PLATFORMS_MAP.mobile}}},{test:function(e){return"windows phone"===e.getBrowserName()},describe:function(){return{type:i.PLATFORMS_MAP.mobile,vendor:"Microsoft"}}},{test:function(e){var t=Number(String(e.getOSVersion()).split(".")[0]);return"android"===e.getOSName(!0)&&t>=3},describe:function(){return{type:i.PLATFORMS_MAP.tablet}}},{test:function(e){return"android"===e.getOSName(!0)},describe:function(){return{type:i.PLATFORMS_MAP.mobile}}},{test:function(e){return"macos"===e.getOSName(!0)},describe:function(){return{type:i.PLATFORMS_MAP.desktop,vendor:"Apple"}}},{test:function(e){return"windows"===e.getOSName(!0)},describe:function(){return{type:i.PLATFORMS_MAP.desktop}}},{test:function(e){return"linux"===e.getOSName(!0)},describe:function(){return{type:i.PLATFORMS_MAP.desktop}}},{test:function(e){return"playstation 4"===e.getOSName(!0)},describe:function(){return{type:i.PLATFORMS_MAP.tv}}},{test:function(e){return"roku"===e.getOSName(!0)},describe:function(){return{type:i.PLATFORMS_MAP.tv}}}];t.default=s,e.exports=t.default},95:function(e,t,r){t.__esModule=!0,t.default=void 0;var n,o=(n=r(17))&&n.__esModule?n:{default:n},i=r(18),s=[{test:function(e){return"microsoft edge"===e.getBrowserName(!0)},describe:function(e){if(/\sedg\//i.test(e))return{name:i.ENGINE_MAP.Blink};var t=o.default.getFirstMatch(/edge\/(\d+(\.?_?\d+)+)/i,e);return{name:i.ENGINE_MAP.EdgeHTML,version:t}}},{test:[/trident/i],describe:function(e){var t={name:i.ENGINE_MAP.Trident},r=o.default.getFirstMatch(/trident\/(\d+(\.?_?\d+)+)/i,e);return r&&(t.version=r),t}},{test:function(e){return e.test(/presto/i)},describe:function(e){var t={name:i.ENGINE_MAP.Presto},r=o.default.getFirstMatch(/presto\/(\d+(\.?_?\d+)+)/i,e);return r&&(t.version=r),t}},{test:function(e){var t=e.test(/gecko/i),r=e.test(/like gecko/i);return t&&!r},describe:function(e){var t={name:i.ENGINE_MAP.Gecko},r=o.default.getFirstMatch(/gecko\/(\d+(\.?_?\d+)+)/i,e);return r&&(t.version=r),t}},{test:[/(apple)?webkit\/537\.36/i],describe:function(){return{name:i.ENGINE_MAP.Blink}}},{test:[/(apple)?webkit/i],describe:function(e){var t={name:i.ENGINE_MAP.WebKit},r=o.default.getFirstMatch(/webkit\/(\d+(\.?_?\d+)+)/i,e);return r&&(t.version=r),t}}];t.default=s,e.exports=t.default}});var Logger$1={},__importDefault$1=commonjsGlobal&&commonjsGlobal.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(Logger$1,"__esModule",{value:!0}),Logger$1.Logger=void 0;const debug_1=__importDefault$1(browser.exports),APP_NAME="mediasoup-client";class Logger{constructor(e){e?(this._debug=(0,debug_1.default)(`${APP_NAME}:${e}`),this._warn=(0,debug_1.default)(`${APP_NAME}:WARN:${e}`),this._error=(0,debug_1.default)(`${APP_NAME}:ERROR:${e}`)):(this._debug=(0,debug_1.default)(APP_NAME),this._warn=(0,debug_1.default)(`${APP_NAME}:WARN`),this._error=(0,debug_1.default)(`${APP_NAME}:ERROR`)),this._debug.log=console.info.bind(console),this._warn.log=console.warn.bind(console),this._error.log=console.error.bind(console)}get debug(){return this._debug}get warn(){return this._warn}get error(){return this._error}}Logger$1.Logger=Logger;var EnhancedEventEmitter$1={};Object.defineProperty(EnhancedEventEmitter$1,"__esModule",{value:!0}),EnhancedEventEmitter$1.EnhancedEventEmitter=void 0;const events_1=require$$0,Logger_1$g=Logger$1,logger$g=new Logger_1$g.Logger("EnhancedEventEmitter");class EnhancedEventEmitter extends events_1.EventEmitter{constructor(){super(),this.setMaxListeners(1/0)}safeEmit(e,...t){const r=this.listenerCount(e);try{return this.emit(e,...t)}catch(t){return logger$g.error("safeEmit() | event listener threw an error [event:%s]:%o",e,t),Boolean(r)}}async safeEmitAsPromise(e,...t){return new Promise(((r,n)=>{try{this.emit(e,...t,r,n)}catch(t){logger$g.error("safeEmitAsPromise() | event listener threw an error [event:%s]:%o",e,t),n(t)}}))}}EnhancedEventEmitter$1.EnhancedEventEmitter=EnhancedEventEmitter;var errors={};Object.defineProperty(errors,"__esModule",{value:!0}),errors.InvalidStateError=errors.UnsupportedError=void 0;class UnsupportedError extends Error{constructor(e){super(e),this.name="UnsupportedError",Error.hasOwnProperty("captureStackTrace")?Error.captureStackTrace(this,UnsupportedError):this.stack=new Error(e).stack}}errors.UnsupportedError=UnsupportedError;class InvalidStateError extends Error{constructor(e){super(e),this.name="InvalidStateError",Error.hasOwnProperty("captureStackTrace")?Error.captureStackTrace(this,InvalidStateError):this.stack=new Error(e).stack}}errors.InvalidStateError=InvalidStateError;var utils$e={};function clone(e,t){return void 0===e?t:JSON.parse(JSON.stringify(e))}function generateRandomNumber(){return Math.round(1e7*Math.random())}Object.defineProperty(utils$e,"__esModule",{value:!0}),utils$e.generateRandomNumber=utils$e.clone=void 0,utils$e.clone=clone,utils$e.generateRandomNumber=generateRandomNumber;var ortc$b={},h264ProfileLevelId={};!function(e){const t=browser.exports("h264-profile-level-id");t.log=console.info.bind(console);e.ProfileConstrainedBaseline=1,e.ProfileBaseline=2,e.ProfileMain=3,e.ProfileConstrainedHigh=4,e.ProfileHigh=5;const r=10;e.Level1_b=0,e.Level1=10,e.Level1_1=11,e.Level1_2=12,e.Level1_3=13,e.Level2=20,e.Level2_1=21,e.Level2_2=22,e.Level3=30,e.Level3_1=31,e.Level3_2=32,e.Level4=40,e.Level4_1=41,e.Level4_2=42,e.Level5=50,e.Level5_1=51,e.Level5_2=52;class n{constructor(e,t){this.profile=e,this.level=t}}e.ProfileLevelId=n;const o=new n(1,31);class i{constructor(e){this._mask=~c("x",e),this._maskedValue=c("1",e)}isMatch(e){return this._maskedValue===(e&this._mask)}}class s{constructor(e,t,r){this.profile_idc=e,this.profile_iop=t,this.profile=r}}const a=[new s(66,new i("x1xx0000"),1),new s(77,new i("1xxx0000"),1),new s(88,new i("11xx0000"),1),new s(66,new i("x0xx0000"),2),new s(88,new i("10xx0000"),2),new s(77,new i("0x0x0000"),3),new s(100,new i("00000000"),5),new s(100,new i("00001100"),4)];function c(e,t){return(t[0]===e)<<7|(t[1]===e)<<6|(t[2]===e)<<5|(t[3]===e)<<4|(t[4]===e)<<3|(t[5]===e)<<2|(t[6]===e)<<1|(t[7]===e)<<0}function d(e={}){const t=e["level-asymmetry-allowed"];return 1===t||"1"===t}e.parseProfileLevelId=function(e){if("string"!=typeof e||6!==e.length)return null;const r=parseInt(e,16);if(0===r)return null;const o=255&r,i=r>>8&255,s=r>>16&255;let c;switch(o){case 11:c=0!=(16&i)?0:11;break;case 10:case 12:case 13:case 20:case 21:case 22:case 30:case 31:case 32:case 40:case 41:case 42:case 50:case 51:case 52:c=o;break;default:return t("parseProfileLevelId() | unrecognized level_idc:%s",o),null}for(const e of a)if(s===e.profile_idc&&e.profile_iop.isMatch(i))return new n(e.profile,c);return t("parseProfileLevelId() | unrecognized profile_idc/profile_iop combination"),null},e.profileLevelIdToString=function(e){if(0==e.level)switch(e.profile){case 1:return"42f00b";case 2:return"42100b";case 3:return"4d100b";default:return t("profileLevelIdToString() | Level 1_b not is allowed for profile:%s",e.profile),null}let r;switch(e.profile){case 1:r="42e0";break;case 2:r="4200";break;case 3:r="4d00";break;case 4:r="640c";break;case 5:r="6400";break;default:return t("profileLevelIdToString() | unrecognized profile:%s",e.profile),null}let n=e.level.toString(16);return 1===n.length&&(n=`0${n}`),`${r}${n}`},e.parseSdpProfileLevelId=function(t={}){const r=t["profile-level-id"];return r?e.parseProfileLevelId(r):o},e.isSameProfile=function(t={},r={}){const n=e.parseSdpProfileLevelId(t),o=e.parseSdpProfileLevelId(r);return Boolean(n&&o&&n.profile===o.profile)},e.generateProfileLevelIdForAnswer=function(o={},i={}){if(!o["profile-level-id"]&&!i["profile-level-id"])return t("generateProfileLevelIdForAnswer() | no profile-level-id in local and remote params"),null;const s=e.parseSdpProfileLevelId(o),a=e.parseSdpProfileLevelId(i);if(!s)throw new TypeError("invalid local_profile_level_id");if(!a)throw new TypeError("invalid remote_profile_level_id");if(s.profile!==a.profile)throw new TypeError("H264 Profile mismatch");const c=d(o)&&d(i),l=s.level,p=function(e,t){return function(e,t){return 0===e?t!==r&&0!==t:0===t?e!==r:e<t}(e,t)?e:t}(l,a.level),u=c?l:p;return t("generateProfileLevelIdForAnswer() | result: [profile:%s, level:%s]",s.profile,u),e.profileLevelIdToString(new n(s.profile,u))}}(h264ProfileLevelId);var __createBinding$f=commonjsGlobal&&commonjsGlobal.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r),Object.defineProperty(e,n,{enumerable:!0,get:function(){return t[r]}})}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),__setModuleDefault$f=commonjsGlobal&&commonjsGlobal.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),__importStar$f=commonjsGlobal&&commonjsGlobal.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)"default"!==r&&Object.prototype.hasOwnProperty.call(e,r)&&__createBinding$f(t,e,r);return __setModuleDefault$f(t,e),t};Object.defineProperty(ortc$b,"__esModule",{value:!0}),ortc$b.canReceive=ortc$b.canSend=ortc$b.generateProbatorRtpParameters=ortc$b.reduceCodecs=ortc$b.getSendingRemoteRtpParameters=ortc$b.getSendingRtpParameters=ortc$b.getRecvRtpCapabilities=ortc$b.getExtendedRtpCapabilities=ortc$b.validateSctpStreamParameters=ortc$b.validateSctpParameters=ortc$b.validateNumSctpStreams=ortc$b.validateSctpCapabilities=ortc$b.validateRtcpParameters=ortc$b.validateRtpEncodingParameters=ortc$b.validateRtpHeaderExtensionParameters=ortc$b.validateRtpCodecParameters=ortc$b.validateRtpParameters=ortc$b.validateRtpHeaderExtension=ortc$b.validateRtcpFeedback=ortc$b.validateRtpCodecCapability=ortc$b.validateRtpCapabilities=void 0;const h264=__importStar$f(h264ProfileLevelId),utils$d=__importStar$f(utils$e),RTP_PROBATOR_MID="probator",RTP_PROBATOR_SSRC=1234,RTP_PROBATOR_CODEC_PAYLOAD_TYPE=127;function validateRtpCapabilities(e){if("object"!=typeof e)throw new TypeError("caps is not an object");if(e.codecs&&!Array.isArray(e.codecs))throw new TypeError("caps.codecs is not an array");e.codecs||(e.codecs=[]);for(const t of e.codecs)validateRtpCodecCapability(t);if(e.headerExtensions&&!Array.isArray(e.headerExtensions))throw new TypeError("caps.headerExtensions is not an array");e.headerExtensions||(e.headerExtensions=[]);for(const t of e.headerExtensions)validateRtpHeaderExtension(t)}function validateRtpCodecCapability(e){const t=new RegExp("^(audio|video)/(.+)","i");if("object"!=typeof e)throw new TypeError("codec is not an object");if(!e.mimeType||"string"!=typeof e.mimeType)throw new TypeError("missing codec.mimeType");const r=t.exec(e.mimeType);if(!r)throw new TypeError("invalid codec.mimeType");if(e.kind=r[1].toLowerCase(),e.preferredPayloadType&&"number"!=typeof e.preferredPayloadType)throw new TypeError("invalid codec.preferredPayloadType");if("number"!=typeof e.clockRate)throw new TypeError("missing codec.clockRate");"audio"===e.kind?"number"!=typeof e.channels&&(e.channels=1):delete e.channels,e.parameters&&"object"==typeof e.parameters||(e.parameters={});for(const t of Object.keys(e.parameters)){let r=e.parameters[t];if(void 0===r&&(e.parameters[t]="",r=""),"string"!=typeof r&&"number"!=typeof r)throw new TypeError(`invalid codec parameter [key:${t}s, value:${r}]`);if("apt"===t&&"number"!=typeof r)throw new TypeError("invalid codec apt parameter")}e.rtcpFeedback&&Array.isArray(e.rtcpFeedback)||(e.rtcpFeedback=[]);for(const t of e.rtcpFeedback)validateRtcpFeedback(t)}function validateRtcpFeedback(e){if("object"!=typeof e)throw new TypeError("fb is not an object");if(!e.type||"string"!=typeof e.type)throw new TypeError("missing fb.type");e.parameter&&"string"==typeof e.parameter||(e.parameter="")}function validateRtpHeaderExtension(e){if("object"!=typeof e)throw new TypeError("ext is not an object");if("audio"!==e.kind&&"video"!==e.kind)throw new TypeError("invalid ext.kind");if(!e.uri||"string"!=typeof e.uri)throw new TypeError("missing ext.uri");if("number"!=typeof e.preferredId)throw new TypeError("missing ext.preferredId");if(e.preferredEncrypt&&"boolean"!=typeof e.preferredEncrypt)throw new TypeError("invalid ext.preferredEncrypt");if(e.preferredEncrypt||(e.preferredEncrypt=!1),e.direction&&"string"!=typeof e.direction)throw new TypeError("invalid ext.direction");e.direction||(e.direction="sendrecv")}function validateRtpParameters(e){if("object"!=typeof e)throw new TypeError("params is not an object");if(e.mid&&"string"!=typeof e.mid)throw new TypeError("params.mid is not a string");if(!Array.isArray(e.codecs))throw new TypeError("missing params.codecs");for(const t of e.codecs)validateRtpCodecParameters(t);if(e.headerExtensions&&!Array.isArray(e.headerExtensions))throw new TypeError("params.headerExtensions is not an array");e.headerExtensions||(e.headerExtensions=[]);for(const t of e.headerExtensions)validateRtpHeaderExtensionParameters(t);if(e.encodings&&!Array.isArray(e.encodings))throw new TypeError("params.encodings is not an array");e.encodings||(e.encodings=[]);for(const t of e.encodings)validateRtpEncodingParameters(t);if(e.rtcp&&"object"!=typeof e.rtcp)throw new TypeError("params.rtcp is not an object");e.rtcp||(e.rtcp={}),validateRtcpParameters(e.rtcp)}function validateRtpCodecParameters(e){const t=new RegExp("^(audio|video)/(.+)","i");if("object"!=typeof e)throw new TypeError("codec is not an object");if(!e.mimeType||"string"!=typeof e.mimeType)throw new TypeError("missing codec.mimeType");const r=t.exec(e.mimeType);if(!r)throw new TypeError("invalid codec.mimeType");if("number"!=typeof e.payloadType)throw new TypeError("missing codec.payloadType");if("number"!=typeof e.clockRate)throw new TypeError("missing codec.clockRate");"audio"===r[1].toLowerCase()?"number"!=typeof e.channels&&(e.channels=1):delete e.channels,e.parameters&&"object"==typeof e.parameters||(e.parameters={});for(const t of Object.keys(e.parameters)){let r=e.parameters[t];if(void 0===r&&(e.parameters[t]="",r=""),"string"!=typeof r&&"number"!=typeof r)throw new TypeError(`invalid codec parameter [key:${t}s, value:${r}]`);if("apt"===t&&"number"!=typeof r)throw new TypeError("invalid codec apt parameter")}e.rtcpFeedback&&Array.isArray(e.rtcpFeedback)||(e.rtcpFeedback=[]);for(const t of e.rtcpFeedback)validateRtcpFeedback(t)}function validateRtpHeaderExtensionParameters(e){if("object"!=typeof e)throw new TypeError("ext is not an object");if(!e.uri||"string"!=typeof e.uri)throw new TypeError("missing ext.uri");if("number"!=typeof e.id)throw new TypeError("missing ext.id");if(e.encrypt&&"boolean"!=typeof e.encrypt)throw new TypeError("invalid ext.encrypt");e.encrypt||(e.encrypt=!1),e.parameters&&"object"==typeof e.parameters||(e.parameters={});for(const t of Object.keys(e.parameters)){let r=e.parameters[t];if(void 0===r&&(e.parameters[t]="",r=""),"string"!=typeof r&&"number"!=typeof r)throw new TypeError("invalid header extension parameter")}}function validateRtpEncodingParameters(e){if("object"!=typeof e)throw new TypeError("encoding is not an object");if(e.ssrc&&"number"!=typeof e.ssrc)throw new TypeError("invalid encoding.ssrc");if(e.rid&&"string"!=typeof e.rid)throw new TypeError("invalid encoding.rid");if(e.rtx&&"object"!=typeof e.rtx)throw new TypeError("invalid encoding.rtx");if(e.rtx&&"number"!=typeof e.rtx.ssrc)throw new TypeError("missing encoding.rtx.ssrc");if(e.dtx&&"boolean"==typeof e.dtx||(e.dtx=!1),e.scalabilityMode&&"string"!=typeof e.scalabilityMode)throw new TypeError("invalid encoding.scalabilityMode")}function validateRtcpParameters(e){if("object"!=typeof e)throw new TypeError("rtcp is not an object");if(e.cname&&"string"!=typeof e.cname)throw new TypeError("invalid rtcp.cname");e.reducedSize&&"boolean"==typeof e.reducedSize||(e.reducedSize=!0)}function validateSctpCapabilities(e){if("object"!=typeof e)throw new TypeError("caps is not an object");if(!e.numStreams||"object"!=typeof e.numStreams)throw new TypeError("missing caps.numStreams");validateNumSctpStreams(e.numStreams)}function validateNumSctpStreams(e){if("object"!=typeof e)throw new TypeError("numStreams is not an object");if("number"!=typeof e.OS)throw new TypeError("missing numStreams.OS");if("number"!=typeof e.MIS)throw new TypeError("missing numStreams.MIS")}function validateSctpParameters(e){if("object"!=typeof e)throw new TypeError("params is not an object");if("number"!=typeof e.port)throw new TypeError("missing params.port");if("number"!=typeof e.OS)throw new TypeError("missing params.OS");if("number"!=typeof e.MIS)throw new TypeError("missing params.MIS");if("number"!=typeof e.maxMessageSize)throw new TypeError("missing params.maxMessageSize")}function validateSctpStreamParameters(e){if("object"!=typeof e)throw new TypeError("params is not an object");if("number"!=typeof e.streamId)throw new TypeError("missing params.streamId");let t=!1;if("boolean"==typeof e.ordered?t=!0:e.ordered=!0,e.maxPacketLifeTime&&"number"!=typeof e.maxPacketLifeTime)throw new TypeError("invalid params.maxPacketLifeTime");if(e.maxRetransmits&&"number"!=typeof e.maxRetransmits)throw new TypeError("invalid params.maxRetransmits");if(e.maxPacketLifeTime&&e.maxRetransmits)throw new TypeError("cannot provide both maxPacketLifeTime and maxRetransmits");if(t&&e.ordered&&(e.maxPacketLifeTime||e.maxRetransmits))throw new TypeError("cannot be ordered with maxPacketLifeTime or maxRetransmits");if(t||!e.maxPacketLifeTime&&!e.maxRetransmits||(e.ordered=!1),e.label&&"string"!=typeof e.label)throw new TypeError("invalid params.label");if(e.protocol&&"string"!=typeof e.protocol)throw new TypeError("invalid params.protocol")}function getExtendedRtpCapabilities(e,t){const r={codecs:[],headerExtensions:[]};for(const n of t.codecs||[]){if(isRtxCodec(n))continue;const t=(e.codecs||[]).find((e=>matchCodecs(e,n,{strict:!0,modify:!0})));if(!t)continue;const o={mimeType:t.mimeType,kind:t.kind,clockRate:t.clockRate,channels:t.channels,localPayloadType:t.preferredPayloadType,localRtxPayloadType:void 0,remotePayloadType:n.preferredPayloadType,remoteRtxPayloadType:void 0,localParameters:t.parameters,remoteParameters:n.parameters,rtcpFeedback:reduceRtcpFeedback(t,n)};r.codecs.push(o)}for(const n of r.codecs){const r=e.codecs.find((e=>isRtxCodec(e)&&e.parameters.apt===n.localPayloadType)),o=t.codecs.find((e=>isRtxCodec(e)&&e.parameters.apt===n.remotePayloadType));r&&o&&(n.localRtxPayloadType=r.preferredPayloadType,n.remoteRtxPayloadType=o.preferredPayloadType)}for(const n of t.headerExtensions){const t=e.headerExtensions.find((e=>matchHeaderExtensions(e,n)));if(!t)continue;const o={kind:n.kind,uri:n.uri,sendId:t.preferredId,recvId:n.preferredId,encrypt:t.preferredEncrypt,direction:"sendrecv"};switch(n.direction){case"sendrecv":o.direction="sendrecv";break;case"recvonly":o.direction="sendonly";break;case"sendonly":o.direction="recvonly";break;case"inactive":o.direction="inactive"}r.headerExtensions.push(o)}return r}function getRecvRtpCapabilities(e){const t={codecs:[],headerExtensions:[]};for(const r of e.codecs){const e={mimeType:r.mimeType,kind:r.kind,preferredPayloadType:r.remotePayloadType,clockRate:r.clockRate,channels:r.channels,parameters:r.localParameters,rtcpFeedback:r.rtcpFeedback};if(t.codecs.push(e),!r.remoteRtxPayloadType)continue;const n={mimeType:`${r.kind}/rtx`,kind:r.kind,preferredPayloadType:r.remoteRtxPayloadType,clockRate:r.clockRate,parameters:{apt:r.remotePayloadType},rtcpFeedback:[]};t.codecs.push(n)}for(const r of e.headerExtensions){if("sendrecv"!==r.direction&&"recvonly"!==r.direction)continue;const e={kind:r.kind,uri:r.uri,preferredId:r.recvId,preferredEncrypt:r.encrypt,direction:r.direction};t.headerExtensions.push(e)}return t}function getSendingRtpParameters(e,t){const r={mid:void 0,codecs:[],headerExtensions:[],encodings:[],rtcp:{}};for(const n of t.codecs){if(n.kind!==e)continue;const t={mimeType:n.mimeType,payloadType:n.localPayloadType,clockRate:n.clockRate,channels:n.channels,parameters:n.localParameters,rtcpFeedback:n.rtcpFeedback};if(r.codecs.push(t),n.localRtxPayloadType){const e={mimeType:`${n.kind}/rtx`,payloadType:n.localRtxPayloadType,clockRate:n.clockRate,parameters:{apt:n.localPayloadType},rtcpFeedback:[]};r.codecs.push(e)}}for(const n of t.headerExtensions){if(n.kind&&n.kind!==e||"sendrecv"!==n.direction&&"sendonly"!==n.direction)continue;const t={uri:n.uri,id:n.sendId,encrypt:n.encrypt,parameters:{}};r.headerExtensions.push(t)}return r}function getSendingRemoteRtpParameters(e,t){const r={mid:void 0,codecs:[],headerExtensions:[],encodings:[],rtcp:{}};for(const n of t.codecs){if(n.kind!==e)continue;const t={mimeType:n.mimeType,payloadType:n.localPayloadType,clockRate:n.clockRate,channels:n.channels,parameters:n.remoteParameters,rtcpFeedback:n.rtcpFeedback};if(r.codecs.push(t),n.localRtxPayloadType){const e={mimeType:`${n.kind}/rtx`,payloadType:n.localRtxPayloadType,clockRate:n.clockRate,parameters:{apt:n.localPayloadType},rtcpFeedback:[]};r.codecs.push(e)}}for(const n of t.headerExtensions){if(n.kind&&n.kind!==e||"sendrecv"!==n.direction&&"sendonly"!==n.direction)continue;const t={uri:n.uri,id:n.sendId,encrypt:n.encrypt,parameters:{}};r.headerExtensions.push(t)}if(r.headerExtensions.some((e=>"http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01"===e.uri)))for(const e of r.codecs)e.rtcpFeedback=(e.rtcpFeedback||[]).filter((e=>"goog-remb"!==e.type));else if(r.headerExtensions.some((e=>"http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time"===e.uri)))for(const e of r.codecs)e.rtcpFeedback=(e.rtcpFeedback||[]).filter((e=>"transport-cc"!==e.type));else for(const e of r.codecs)e.rtcpFeedback=(e.rtcpFeedback||[]).filter((e=>"transport-cc"!==e.type&&"goog-remb"!==e.type));return r}function reduceCodecs(e,t){const r=[];if(t){for(let n=0;n<e.length;++n)if(matchCodecs(e[n],t)){r.push(e[n]),isRtxCodec(e[n+1])&&r.push(e[n+1]);break}if(0===r.length)throw new TypeError("no matching codec found")}else r.push(e[0]),isRtxCodec(e[1])&&r.push(e[1]);return r}function generateProbatorRtpParameters(e){validateRtpParameters(e=utils$d.clone(e,{}));const t={mid:RTP_PROBATOR_MID,codecs:[],headerExtensions:[],encodings:[{ssrc:RTP_PROBATOR_SSRC}],rtcp:{cname:"probator"}};return t.codecs.push(e.codecs[0]),t.codecs[0].payloadType=RTP_PROBATOR_CODEC_PAYLOAD_TYPE,t.headerExtensions=e.headerExtensions,t}function canSend(e,t){return t.codecs.some((t=>t.kind===e))}function canReceive(e,t){if(validateRtpParameters(e),0===e.codecs.length)return!1;const r=e.codecs[0];return t.codecs.some((e=>e.remotePayloadType===r.payloadType))}function isRtxCodec(e){return!!e&&/.+\/rtx$/i.test(e.mimeType)}function matchCodecs(e,t,{strict:r=!1,modify:n=!1}={}){const o=e.mimeType.toLowerCase();if(o!==t.mimeType.toLowerCase())return!1;if(e.clockRate!==t.clockRate)return!1;if(e.channels!==t.channels)return!1;switch(o){case"video/h264":if(r){if((e.parameters["packetization-mode"]||0)!==(t.parameters["packetization-mode"]||0))return!1;if(!h264.isSameProfile(e.parameters,t.parameters))return!1;let r;try{r=h264.generateProfileLevelIdForAnswer(e.parameters,t.parameters)}catch(e){return!1}n&&(r?(e.parameters["profile-level-id"]=r,t.parameters["profile-level-id"]=r):(delete e.parameters["profile-level-id"],delete t.parameters["profile-level-id"]))}break;case"video/vp9":if(r){if((e.parameters["profile-id"]||0)!==(t.parameters["profile-id"]||0))return!1}}return!0}function matchHeaderExtensions(e,t){return(!e.kind||!t.kind||e.kind===t.kind)&&e.uri===t.uri}function reduceRtcpFeedback(e,t){const r=[];for(const n of e.rtcpFeedback||[]){const e=(t.rtcpFeedback||[]).find((e=>e.type===n.type&&(e.parameter===n.parameter||!e.parameter&&!n.parameter)));e&&r.push(e)}return r}ortc$b.validateRtpCapabilities=validateRtpCapabilities,ortc$b.validateRtpCodecCapability=validateRtpCodecCapability,ortc$b.validateRtcpFeedback=validateRtcpFeedback,ortc$b.validateRtpHeaderExtension=validateRtpHeaderExtension,ortc$b.validateRtpParameters=validateRtpParameters,ortc$b.validateRtpCodecParameters=validateRtpCodecParameters,ortc$b.validateRtpHeaderExtensionParameters=validateRtpHeaderExtensionParameters,ortc$b.validateRtpEncodingParameters=validateRtpEncodingParameters,ortc$b.validateRtcpParameters=validateRtcpParameters,ortc$b.validateSctpCapabilities=validateSctpCapabilities,ortc$b.validateNumSctpStreams=validateNumSctpStreams,ortc$b.validateSctpParameters=validateSctpParameters,ortc$b.validateSctpStreamParameters=validateSctpStreamParameters,ortc$b.getExtendedRtpCapabilities=getExtendedRtpCapabilities,ortc$b.getRecvRtpCapabilities=getRecvRtpCapabilities,ortc$b.getSendingRtpParameters=getSendingRtpParameters,ortc$b.getSendingRemoteRtpParameters=getSendingRemoteRtpParameters,ortc$b.reduceCodecs=reduceCodecs,ortc$b.generateProbatorRtpParameters=generateProbatorRtpParameters,ortc$b.canSend=canSend,ortc$b.canReceive=canReceive;var Transport$1={},lib$1={},__awaiter=commonjsGlobal&&commonjsGlobal.__awaiter||function(e,t,r,n){return new(r||(r=Promise))((function(o,i){function s(e){try{c(n.next(e))}catch(e){i(e)}}function a(e){try{c(n.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?o(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(s,a)}c((n=n.apply(e,t||[])).next())}))};Object.defineProperty(lib$1,"__esModule",{value:!0});class AwaitQueue{constructor({ClosedErrorClass:e=Error,StoppedErrorClass:t=Error}={ClosedErrorClass:Error,StoppedErrorClass:Error}){this.closed=!1,this.pendingTasks=[],this.ClosedErrorClass=Error,this.StoppedErrorClass=Error,this.ClosedErrorClass=e,this.StoppedErrorClass=t}get size(){return this.pendingTasks.length}close(){if(!this.closed){this.closed=!0;for(const e of this.pendingTasks)e.stopped=!0,e.reject(new this.ClosedErrorClass("AwaitQueue closed"));this.pendingTasks.length=0}}push(e,t){return __awaiter(this,void 0,void 0,(function*(){if(this.closed)throw new this.ClosedErrorClass("AwaitQueue closed");if("function"!=typeof e)throw new TypeError("given task is not a function");if(!e.name&&t)try{Object.defineProperty(e,"name",{value:t})}catch(e){}return new Promise(((r,n)=>{const o={task:e,name:t,resolve:r,reject:n,stopped:!1,enqueuedAt:new Date,executedAt:void 0};this.pendingTasks.push(o),1===this.pendingTasks.length&&this.next()}))}))}stop(){if(!this.closed){for(const e of this.pendingTasks)e.stopped=!0,e.reject(new this.StoppedErrorClass("AwaitQueue stopped"));this.pendingTasks.length=0}}dump(){const e=new Date;return this.pendingTasks.map((t=>({task:t.task,name:t.name,enqueuedTime:t.executedAt?t.executedAt.getTime()-t.enqueuedAt.getTime():e.getTime()-t.enqueuedAt.getTime(),executingTime:t.executedAt?e.getTime()-t.executedAt.getTime():0})))}next(){return __awaiter(this,void 0,void 0,(function*(){const e=this.pendingTasks[0];e&&(yield this.executeTask(e),this.pendingTasks.shift(),this.next())}))}executeTask(e){return __awaiter(this,void 0,void 0,(function*(){if(!e.stopped){e.executedAt=new Date;try{const t=yield e.task();if(e.stopped)return;e.resolve(t)}catch(t){if(e.stopped)return;e.reject(t)}}}))}}lib$1.AwaitQueue=AwaitQueue;var Producer$1={};Object.defineProperty(Producer$1,"__esModule",{value:!0}),Producer$1.Producer=void 0;const Logger_1$f=Logger$1,EnhancedEventEmitter_1$6=EnhancedEventEmitter$1,errors_1$8=errors,logger$f=new Logger_1$f.Logger("Producer");class Producer extends EnhancedEventEmitter_1$6.EnhancedEventEmitter{constructor({id:e,localId:t,rtpSender:r,track:n,rtpParameters:o,stopTracks:i,disableTrackOnPause:s,zeroRtpOnPause:a,appData:c}){super(),this._closed=!1,this._observer=new EnhancedEventEmitter_1$6.EnhancedEventEmitter,logger$f.debug("constructor()"),this._id=e,this._localId=t,this._rtpSender=r,this._track=n,this._kind=n.kind,this._rtpParameters=o,this._paused=!!s&&!n.enabled,this._maxSpatialLayer=void 0,this._stopTracks=i,this._disableTrackOnPause=s,this._zeroRtpOnPause=a,this._appData=c,this._onTrackEnded=this._onTrackEnded.bind(this),this._handleTrack()}get id(){return this._id}get localId(){return this._localId}get closed(){return this._closed}get kind(){return this._kind}get rtpSender(){return this._rtpSender}get track(){return this._track}get rtpParameters(){return this._rtpParameters}get paused(){return this._paused}get maxSpatialLayer(){return this._maxSpatialLayer}get appData(){return this._appData}set appData(e){throw new Error("cannot override appData object")}get observer(){return this._observer}close(){this._closed||(logger$f.debug("close()"),this._closed=!0,this._destroyTrack(),this.emit("@close"),this._observer.safeEmit("close"))}transportClosed(){this._closed||(logger$f.debug("transportClosed()"),this._closed=!0,this._destroyTrack(),this.safeEmit("transportclose"),this._observer.safeEmit("close"))}async getStats(){if(this._closed)throw new errors_1$8.InvalidStateError("closed");return this.safeEmitAsPromise("@getstats")}pause(){logger$f.debug("pause()"),this._closed?logger$f.error("pause() | Producer closed"):(this._paused=!0,this._track&&this._disableTrackOnPause&&(this._track.enabled=!1),this._zeroRtpOnPause&&this.safeEmitAsPromise("@replacetrack",null).catch((()=>{})),this._observer.safeEmit("pause"))}resume(){logger$f.debug("resume()"),this._closed?logger$f.error("resume() | Producer closed"):(this._paused=!1,this._track&&this._disableTrackOnPause&&(this._track.enabled=!0),this._zeroRtpOnPause&&this.safeEmitAsPromise("@replacetrack",this._track).catch((()=>{})),this._observer.safeEmit("resume"))}async replaceTrack({track:e}){if(logger$f.debug("replaceTrack() [track:%o]",e),this._closed){if(e&&this._stopTracks)try{e.stop()}catch(e){}throw new errors_1$8.InvalidStateError("closed")}if(e&&"ended"===e.readyState)throw new errors_1$8.InvalidStateError("track ended");e!==this._track?(this._zeroRtpOnPause&&this._paused||await this.safeEmitAsPromise("@replacetrack",e),this._destroyTrack(),this._track=e,this._track&&this._disableTrackOnPause&&(this._paused?this._paused&&(this._track.enabled=!1):this._track.enabled=!0),this._handleTrack()):logger$f.debug("replaceTrack() | same track, ignored")}async setMaxSpatialLayer(e){if(this._closed)throw new errors_1$8.InvalidStateError("closed");if("video"!==this._kind)throw new errors_1$8.UnsupportedError("not a video Producer");if("number"!=typeof e)throw new TypeError("invalid spatialLayer");e!==this._maxSpatialLayer&&(await this.safeEmitAsPromise("@setmaxspatiallayer",e),this._maxSpatialLayer=e)}async setRtpEncodingParameters(e){if(this._closed)throw new errors_1$8.InvalidStateError("closed");if("object"!=typeof e)throw new TypeError("invalid params");await this.safeEmitAsPromise("@setrtpencodingparameters",e)}_onTrackEnded(){logger$f.debug('track "ended" event'),this.safeEmit("trackended"),this._observer.safeEmit("trackended")}_handleTrack(){this._track&&this._track.addEventListener("ended",this._onTrackEnded)}_destroyTrack(){if(this._track)try{this._track.removeEventListener("ended",this._onTrackEnded),this._stopTracks&&this._track.stop()}catch(e){}}}Producer$1.Producer=Producer;var Consumer$1={};Object.defineProperty(Consumer$1,"__esModule",{value:!0}),Consumer$1.Consumer=void 0;const Logger_1$e=Logger$1,EnhancedEventEmitter_1$5=EnhancedEventEmitter$1,errors_1$7=errors,logger$e=new Logger_1$e.Logger("Consumer");class Consumer extends EnhancedEventEmitter_1$5.EnhancedEventEmitter{constructor({id:e,localId:t,producerId:r,rtpReceiver:n,track:o,rtpParameters:i,appData:s}){super(),this._closed=!1,this._observer=new EnhancedEventEmitter_1$5.EnhancedEventEmitter,logger$e.debug("constructor()"),this._id=e,this._localId=t,this._producerId=r,this._rtpReceiver=n,this._track=o,this._rtpParameters=i,this._paused=!o.enabled,this._appData=s,this._onTrackEnded=this._onTrackEnded.bind(this),this._handleTrack()}get id(){return this._id}get localId(){return this._localId}get producerId(){return this._producerId}get closed(){return this._closed}get kind(){return this._track.kind}get rtpReceiver(){return this._rtpReceiver}get track(){return this._track}get rtpParameters(){return this._rtpParameters}get paused(){return this._paused}get appData(){return this._appData}set appData(e){throw new Error("cannot override appData object")}get observer(){return this._observer}close(){this._closed||(logger$e.debug("close()"),this._closed=!0,this._destroyTrack(),this.emit("@close"),this._observer.safeEmit("close"))}transportClosed(){this._closed||(logger$e.debug("transportClosed()"),this._closed=!0,this._destroyTrack(),this.safeEmit("transportclose"),this._observer.safeEmit("close"))}async getStats(){if(this._closed)throw new errors_1$7.InvalidStateError("closed");return this.safeEmitAsPromise("@getstats")}pause(){logger$e.debug("pause()"),this._closed?logger$e.error("pause() | Consumer closed"):(this._paused=!0,this._track.enabled=!1,this.emit("@pause"),this._observer.safeEmit("pause"))}resume(){logger$e.debug("resume()"),this._closed?logger$e.error("resume() | Consumer closed"):(this._paused=!1,this._track.enabled=!0,this.emit("@resume"),this._observer.safeEmit("resume"))}_onTrackEnded(){logger$e.debug('track "ended" event'),this.safeEmit("trackended"),this._observer.safeEmit("trackended")}_handleTrack(){this._track.addEventListener("ended",this._onTrackEnded)}_destroyTrack(){try{this._track.removeEventListener("ended",this._onTrackEnded),this._track.stop()}catch(e){}}}Consumer$1.Consumer=Consumer;var DataProducer$1={};Object.defineProperty(DataProducer$1,"__esModule",{value:!0}),DataProducer$1.DataProducer=void 0;const Logger_1$d=Logger$1,EnhancedEventEmitter_1$4=EnhancedEventEmitter$1,errors_1$6=errors,logger$d=new Logger_1$d.Logger("DataProducer");class DataProducer extends EnhancedEventEmitter_1$4.EnhancedEventEmitter{constructor({id:e,dataChannel:t,sctpStreamParameters:r,appData:n}){super(),this._closed=!1,this._observer=new EnhancedEventEmitter_1$4.EnhancedEventEmitter,logger$d.debug("constructor()"),this._id=e,this._dataChannel=t,this._sctpStreamParameters=r,this._appData=n,this._handleDataChannel()}get id(){return this._id}get closed(){return this._closed}get sctpStreamParameters(){return this._sctpStreamParameters}get readyState(){return this._dataChannel.readyState}get label(){return this._dataChannel.label}get protocol(){return this._dataChannel.protocol}get bufferedAmount(){return this._dataChannel.bufferedAmount}get bufferedAmountLowThreshold(){return this._dataChannel.bufferedAmountLowThreshold}set bufferedAmountLowThreshold(e){this._dataChannel.bufferedAmountLowThreshold=e}get appData(){return this._appData}set appData(e){throw new Error("cannot override appData object")}get observer(){return this._observer}close(){this._closed||(logger$d.debug("close()"),this._closed=!0,this._dataChannel.close(),this.emit("@close"),this._observer.safeEmit("close"))}transportClosed(){this._closed||(logger$d.debug("transportClosed()"),this._closed=!0,this._dataChannel.close(),this.safeEmit("transportclose"),this._observer.safeEmit("close"))}send(e){if(logger$d.debug("send()"),this._closed)throw new errors_1$6.InvalidStateError("closed");this._dataChannel.send(e)}_handleDataChannel(){this._dataChannel.addEventListener("open",(()=>{this._closed||(logger$d.debug('DataChannel "open" event'),this.safeEmit("open"))})),this._dataChannel.addEventListener("error",(e=>{if(this._closed)return;let{error:t}=e;t||(t=new Error("unknown DataChannel error")),"sctp-failure"===t.errorDetail?logger$d.error("DataChannel SCTP error [sctpCauseCode:%s]: %s",t.sctpCauseCode,t.message):logger$d.error('DataChannel "error" event: %o',t),this.safeEmit("error",t)})),this._dataChannel.addEventListener("close",(()=>{this._closed||(logger$d.warn('DataChannel "close" event'),this._closed=!0,this.emit("@close"),this.safeEmit("close"))})),this._dataChannel.addEventListener("message",(()=>{this._closed||logger$d.warn('DataChannel "message" event in a DataProducer, message discarded')})),this._dataChannel.addEventListener("bufferedamountlow",(()=>{this._closed||this.safeEmit("bufferedamountlow")}))}}DataProducer$1.DataProducer=DataProducer;var DataConsumer$1={};Object.defineProperty(DataConsumer$1,"__esModule",{value:!0}),DataConsumer$1.DataConsumer=void 0;const Logger_1$c=Logger$1,EnhancedEventEmitter_1$3=EnhancedEventEmitter$1,logger$c=new Logger_1$c.Logger("DataConsumer");class DataConsumer extends EnhancedEventEmitter_1$3.EnhancedEventEmitter{constructor({id:e,dataProducerId:t,dataChannel:r,sctpStreamParameters:n,appData:o}){super(),this._closed=!1,this._observer=new EnhancedEventEmitter_1$3.EnhancedEventEmitter,logger$c.debug("constructor()"),this._id=e,this._dataProducerId=t,this._dataChannel=r,this._sctpStreamParameters=n,this._appData=o,this._handleDataChannel()}get id(){return this._id}get dataProducerId(){return this._dataProducerId}get closed(){return this._closed}get sctpStreamParameters(){return this._sctpStreamParameters}get readyState(){return this._dataChannel.readyState}get label(){return this._dataChannel.label}get protocol(){return this._dataChannel.protocol}get binaryType(){return this._dataChannel.binaryType}set binaryType(e){this._dataChannel.binaryType=e}get appData(){return this._appData}set appData(e){throw new Error("cannot override appData object")}get observer(){return this._observer}close(){this._closed||(logger$c.debug("close()"),this._closed=!0,this._dataChannel.close(),this.emit("@close"),this._observer.safeEmit("close"))}transportClosed(){this._closed||(logger$c.debug("transportClosed()"),this._closed=!0,this._dataChannel.close(),this.safeEmit("transportclose"),this._observer.safeEmit("close"))}_handleDataChannel(){this._dataChannel.addEventListener("open",(()=>{this._closed||(logger$c.debug('DataChannel "open" event'),this.safeEmit("open"))})),this._dataChannel.addEventListener("error",(e=>{if(this._closed)return;let{error:t}=e;t||(t=new Error("unknown DataChannel error")),"sctp-failure"===t.errorDetail?logger$c.error("DataChannel SCTP error [sctpCauseCode:%s]: %s",t.sctpCauseCode,t.message):logger$c.error('DataChannel "error" event: %o',t),this.safeEmit("error",t)})),this._dataChannel.addEventListener("close",(()=>{this._closed||(logger$c.warn('DataChannel "close" event'),this._closed=!0,this.emit("@close"),this.safeEmit("close"))})),this._dataChannel.addEventListener("message",(e=>{this._closed||this.safeEmit("message",e.data)}))}}DataConsumer$1.DataConsumer=DataConsumer;var __createBinding$e=commonjsGlobal&&commonjsGlobal.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r),Object.defineProperty(e,n,{enumerable:!0,get:function(){return t[r]}})}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),__setModuleDefault$e=commonjsGlobal&&commonjsGlobal.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),__importStar$e=commonjsGlobal&&commonjsGlobal.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)"default"!==r&&Object.prototype.hasOwnProperty.call(e,r)&&__createBinding$e(t,e,r);return __setModuleDefault$e(t,e),t};Object.defineProperty(Transport$1,"__esModule",{value:!0}),Transport$1.Transport=void 0;const awaitqueue_1=lib$1,Logger_1$b=Logger$1,EnhancedEventEmitter_1$2=EnhancedEventEmitter$1,errors_1$5=errors,utils$c=__importStar$e(utils$e),ortc$a=__importStar$e(ortc$b),Producer_1=Producer$1,Consumer_1=Consumer$1,DataProducer_1=DataProducer$1,DataConsumer_1=DataConsumer$1,logger$b=new Logger_1$b.Logger("Transport");class Transport extends EnhancedEventEmitter_1$2.EnhancedEventEmitter{constructor({direction:e,id:t,iceParameters:r,iceCandidates:n,dtlsParameters:o,sctpParameters:i,iceServers:s,iceTransportPolicy:a,additionalSettings:c,proprietaryConstraints:d,appData:l,handlerFactory:p,extendedRtpCapabilities:u,canProduceByKind:f}){super(),this._closed=!1,this._connectionState="new",this._producers=new Map,this._consumers=new Map,this._dataProducers=new Map,this._dataConsumers=new Map,this._probatorConsumerCreated=!1,this._awaitQueue=new awaitqueue_1.AwaitQueue({ClosedErrorClass:errors_1$5.InvalidStateError}),this._observer=new EnhancedEventEmitter_1$2.EnhancedEventEmitter,logger$b.debug("constructor() [id:%s, direction:%s]",t,e),this._id=t,this._direction=e,this._extendedRtpCapabilities=u,this._canProduceByKind=f,this._maxSctpMessageSize=i?i.maxMessageSize:null,delete(c=utils$c.clone(c,{})).iceServers,delete c.iceTransportPolicy,delete c.bundlePolicy,delete c.rtcpMuxPolicy,delete c.sdpSemantics,this._handler=p(),this._handler.run({direction:e,iceParameters:r,iceCandidates:n,dtlsParameters:o,sctpParameters:i,iceServers:s,iceTransportPolicy:a,additionalSettings:c,proprietaryConstraints:d,extendedRtpCapabilities:u}),this._appData=l,this._handleHandler()}get id(){return this._id}get closed(){return this._closed}get direction(){return this._direction}get handler(){return this._handler}get connectionState(){return this._connectionState}get appData(){return this._appData}set appData(e){throw new Error("cannot override appData object")}get observer(){return this._observer}close(){if(!this._closed){logger$b.debug("close()"),this._closed=!0,this._awaitQueue.close(),this._handler.close();for(const e of this._producers.values())e.transportClosed();this._producers.clear();for(const e of this._consumers.values())e.transportClosed();this._consumers.clear();for(const e of this._dataProducers.values())e.transportClosed();this._dataProducers.clear();for(const e of this._dataConsumers.values())e.transportClosed();this._dataConsumers.clear(),this._observer.safeEmit("close")}}async getStats(){if(this._closed)throw new errors_1$5.InvalidStateError("closed");return this._handler.getTransportStats()}async restartIce({iceParameters:e}){if(logger$b.debug("restartIce()"),this._closed)throw new errors_1$5.InvalidStateError("closed");if(!e)throw new TypeError("missing iceParameters");return this._awaitQueue.push((async()=>this._handler.restartIce(e)),"transport.restartIce()")}async updateIceServers({iceServers:e}={}){if(logger$b.debug("updateIceServers()"),this._closed)throw new errors_1$5.InvalidStateError("closed");if(!Array.isArray(e))throw new TypeError("missing iceServers");return this._awaitQueue.push((async()=>this._handler.updateIceServers(e)),"transport.updateIceServers()")}async produce({track:e,encodings:t,codecOptions:r,codec:n,stopTracks:o=!0,disableTrackOnPause:i=!0,zeroRtpOnPause:s=!1,appData:a={}}={}){if(logger$b.debug("produce() [track:%o]",e),!e)throw new TypeError("missing track");if("send"!==this._direction)throw new errors_1$5.UnsupportedError("not a sending Transport");if(!this._canProduceByKind[e.kind])throw new errors_1$5.UnsupportedError(`cannot produce ${e.kind}`);if("ended"===e.readyState)throw new errors_1$5.InvalidStateError("track ended");if(0===this.listenerCount("connect")&&"new"===this._connectionState)throw new TypeError('no "connect" listener set into this transport');if(0===this.listenerCount("produce"))throw new TypeError('no "produce" listener set into this transport');if(a&&"object"!=typeof a)throw new TypeError("if given, appData must be an object");return this._awaitQueue.push((async()=>{let c;if(t&&!Array.isArray(t))throw TypeError("encodings must be an array");t&&0===t.length?c=void 0:t&&(c=t.map((e=>{const t={active:!0};return!1===e.active&&(t.active=!1),"boolean"==typeof e.dtx&&(t.dtx=e.dtx),"string"==typeof e.scalabilityMode&&(t.scalabilityMode=e.scalabilityMode),"number"==typeof e.scaleResolutionDownBy&&(t.scaleResolutionDownBy=e.scaleResolutionDownBy),"number"==typeof e.maxBitrate&&(t.maxBitrate=e.maxBitrate),"number"==typeof e.maxFramerate&&(t.maxFramerate=e.maxFramerate),"boolean"==typeof e.adaptivePtime&&(t.adaptivePtime=e.adaptivePtime),"string"==typeof e.priority&&(t.priority=e.priority),"string"==typeof e.networkPriority&&(t.networkPriority=e.networkPriority),t})));const{localId:d,rtpParameters:l,rtpSender:p}=await this._handler.send({track:e,encodings:c,codecOptions:r,codec:n});try{ortc$a.validateRtpParameters(l);const{id:t}=await this.safeEmitAsPromise("produce",{kind:e.kind,rtpParameters:l,appData:a}),r=new Producer_1.Producer({id:t,localId:d,rtpSender:p,track:e,rtpParameters:l,stopTracks:o,disableTrackOnPause:i,zeroRtpOnPause:s,appData:a});return this._producers.set(r.id,r),this._handleProducer(r),this._observer.safeEmit("newproducer",r),r}catch(e){throw this._handler.stopSending(d).catch((()=>{})),e}}),"transport.produce()").catch((t=>{if(o)try{e.stop()}catch(e){}throw t}))}async consume({id:e,producerId:t,kind:r,rtpParameters:n,appData:o={}}){if(logger$b.debug("consume()"),n=utils$c.clone(n,void 0),this._closed)throw new errors_1$5.InvalidStateError("closed");if("recv"!==this._direction)throw new errors_1$5.UnsupportedError("not a receiving Transport");if("string"!=typeof e)throw new TypeError("missing id");if("string"!=typeof t)throw new TypeError("missing producerId");if("audio"!==r&&"video"!==r)throw new TypeError(`invalid kind '${r}'`);if(0===this.listenerCount("connect")&&"new"===this._connectionState)throw new TypeError('no "connect" listener set into this transport');if(o&&"object"!=typeof o)throw new TypeError("if given, appData must be an object");return this._awaitQueue.push((async()=>{if(!ortc$a.canReceive(n,this._extendedRtpCapabilities))throw new errors_1$5.UnsupportedError("cannot consume this Producer");const{localId:i,rtpReceiver:s,track:a}=await this._handler.receive({trackId:e,kind:r,rtpParameters:n}),c=new Consumer_1.Consumer({id:e,localId:i,producerId:t,rtpReceiver:s,track:a,rtpParameters:n,appData:o});if(this._consumers.set(c.id,c),this._handleConsumer(c),!this._probatorConsumerCreated&&"video"===r)try{const e=ortc$a.generateProbatorRtpParameters(c.rtpParameters);await this._handler.receive({trackId:"probator",kind:"video",rtpParameters:e}),logger$b.debug("consume() | Consumer for RTP probation created"),this._probatorConsumerCreated=!0}catch(e){logger$b.error("consume() | failed to create Consumer for RTP probation:%o",e)}return this._observer.safeEmit("newconsumer",c),c}),"transport.consume()")}async produceData({ordered:e=!0,maxPacketLifeTime:t,maxRetransmits:r,label:n="",protocol:o="",appData:i={}}={}){if(logger$b.debug("produceData()"),"send"!==this._direction)throw new errors_1$5.UnsupportedError("not a sending Transport");if(!this._maxSctpMessageSize)throw new errors_1$5.UnsupportedError("SCTP not enabled by remote Transport");if(0===this.listenerCount("connect")&&"new"===this._connectionState)throw new TypeError('no "connect" listener set into this transport');if(0===this.listenerCount("producedata"))throw new TypeError('no "producedata" listener set into this transport');if(i&&"object"!=typeof i)throw new TypeError("if given, appData must be an object");return(t||r)&&(e=!1),this._awaitQueue.push((async()=>{const{dataChannel:s,sctpStreamParameters:a}=await this._handler.sendDataChannel({ordered:e,maxPacketLifeTime:t,maxRetransmits:r,label:n,protocol:o});ortc$a.validateSctpStreamParameters(a);const{id:c}=await this.safeEmitAsPromise("producedata",{sctpStreamParameters:a,label:n,protocol:o,appData:i}),d=new DataProducer_1.DataProducer({id:c,dataChannel:s,sctpStreamParameters:a,appData:i});return this._dataProducers.set(d.id,d),this._handleDataProducer(d),this._observer.safeEmit("newdataproducer",d),d}),"transport.produceData()")}async consumeData({id:e,dataProducerId:t,sctpStreamParameters:r,label:n="",protocol:o="",appData:i={}}){if(logger$b.debug("consumeData()"),r=utils$c.clone(r,void 0),this._closed)throw new errors_1$5.InvalidStateError("closed");if("recv"!==this._direction)throw new errors_1$5.UnsupportedError("not a receiving Transport");if(!this._maxSctpMessageSize)throw new errors_1$5.UnsupportedError("SCTP not enabled by remote Transport");if("string"!=typeof e)throw new TypeError("missing id");if("string"!=typeof t)throw new TypeError("missing dataProducerId");if(0===this.listenerCount("connect")&&"new"===this._connectionState)throw new TypeError('no "connect" listener set into this transport');if(i&&"object"!=typeof i)throw new TypeError("if given, appData must be an object");return ortc$a.validateSctpStreamParameters(r),this._awaitQueue.push((async()=>{const{dataChannel:s}=await this._handler.receiveDataChannel({sctpStreamParameters:r,label:n,protocol:o}),a=new DataConsumer_1.DataConsumer({id:e,dataProducerId:t,dataChannel:s,sctpStreamParameters:r,appData:i});return this._dataConsumers.set(a.id,a),this._handleDataConsumer(a),this._observer.safeEmit("newdataconsumer",a),a}),"transport.consumeData()")}_handleHandler(){const e=this._handler;e.on("@connect",(({dtlsParameters:e},t,r)=>{this._closed?r(new errors_1$5.InvalidStateError("closed")):this.safeEmit("connect",{dtlsParameters:e},t,r)})),e.on("@connectionstatechange",(e=>{e!==this._connectionState&&(logger$b.debug("connection state changed to %s",e),this._connectionState=e,this._closed||this.safeEmit("connectionstatechange",e))}))}_handleProducer(e){e.on("@close",(()=>{this._producers.delete(e.id),this._closed||this._awaitQueue.push((async()=>this._handler.stopSending(e.localId)),"producer @close event").catch((e=>logger$b.warn("producer.close() failed:%o",e)))})),e.on("@replacetrack",((t,r,n)=>{this._awaitQueue.push((async()=>this._handler.replaceTrack(e.localId,t)),"producer @replacetrack event").then(r).catch(n)})),e.on("@setmaxspatiallayer",((t,r,n)=>{this._awaitQueue.push((async()=>this._handler.setMaxSpatialLayer(e.localId,t)),"producer @setmaxspatiallayer event").then(r).catch(n)})),e.on("@setrtpencodingparameters",((t,r,n)=>{this._awaitQueue.push((async()=>this._handler.setRtpEncodingParameters(e.localId,t)),"producer @setrtpencodingparameters event").then(r).catch(n)})),e.on("@getstats",((t,r)=>{if(this._closed)return r(new errors_1$5.InvalidStateError("closed"));this._handler.getSenderStats(e.localId).then(t).catch(r)}))}_handleConsumer(e){e.on("@close",(()=>{this._consumers.delete(e.id),this._closed||this._awaitQueue.push((async()=>this._handler.stopReceiving(e.localId)),"consumer @close event").catch((()=>{}))})),e.on("@pause",(()=>{this._awaitQueue.push((async()=>this._handler.pauseReceiving(e.localId)),"consumer @pause event").catch((()=>{}))})),e.on("@resume",(()=>{this._awaitQueue.push((async()=>this._handler.resumeReceiving(e.localId)),"consumer @resume event").catch((()=>{}))})),e.on("@getstats",((t,r)=>{if(this._closed)return r(new errors_1$5.InvalidStateError("closed"));this._handler.getReceiverStats(e.localId).then(t).catch(r)}))}_handleDataProducer(e){e.on("@close",(()=>{this._dataProducers.delete(e.id)}))}_handleDataConsumer(e){e.on("@close",(()=>{this._dataConsumers.delete(e.id)}))}}Transport$1.Transport=Transport;var Chrome74$1={},lib={},parser$1={},grammar$2={exports:{}},grammar$1=grammar$2.exports={v:[{name:"version",reg:/^(\d*)$/}],o:[{name:"origin",reg:/^(\S*) (\d*) (\d*) (\S*) IP(\d) (\S*)/,names:["username","sessionId","sessionVersion","netType","ipVer","address"],format:"%s %s %d %s IP%d %s"}],s:[{name:"name"}],i:[{name:"description"}],u:[{name:"uri"}],e:[{name:"email"}],p:[{name:"phone"}],z:[{name:"timezones"}],r:[{name:"repeats"}],t:[{name:"timing",reg:/^(\d*) (\d*)/,names:["start","stop"],format:"%d %d"}],c:[{name:"connection",reg:/^IN IP(\d) (\S*)/,names:["version","ip"],format:"IN IP%d %s"}],b:[{push:"bandwidth",reg:/^(TIAS|AS|CT|RR|RS):(\d*)/,names:["type","limit"],format:"%s:%s"}],m:[{reg:/^(\w*) (\d*) ([\w/]*)(?: (.*))?/,names:["type","port","protocol","payloads"],format:"%s %d %s %s"}],a:[{push:"rtp",reg:/^rtpmap:(\d*) ([\w\-.]*)(?:\s*\/(\d*)(?:\s*\/(\S*))?)?/,names:["payload","codec","rate","encoding"],format:function(e){return e.encoding?"rtpmap:%d %s/%s/%s":e.rate?"rtpmap:%d %s/%s":"rtpmap:%d %s"}},{push:"fmtp",reg:/^fmtp:(\d*) ([\S| ]*)/,names:["payload","config"],format:"fmtp:%d %s"},{name:"control",reg:/^control:(.*)/,format:"control:%s"},{name:"rtcp",reg:/^rtcp:(\d*)(?: (\S*) IP(\d) (\S*))?/,names:["port","netType","ipVer","address"],format:function(e){return null!=e.address?"rtcp:%d %s IP%d %s":"rtcp:%d"}},{push:"rtcpFbTrrInt",reg:/^rtcp-fb:(\*|\d*) trr-int (\d*)/,names:["payload","value"],format:"rtcp-fb:%s trr-int %d"},{push:"rtcpFb",reg:/^rtcp-fb:(\*|\d*) ([\w-_]*)(?: ([\w-_]*))?/,names:["payload","type","subtype"],format:function(e){return null!=e.subtype?"rtcp-fb:%s %s %s":"rtcp-fb:%s %s"}},{push:"ext",reg:/^extmap:(\d+)(?:\/(\w+))?(?: (urn:ietf:params:rtp-hdrext:encrypt))? (\S*)(?: (\S*))?/,names:["value","direction","encrypt-uri","uri","config"],format:function(e){return"extmap:%d"+(e.direction?"/%s":"%v")+(e["encrypt-uri"]?" %s":"%v")+" %s"+(e.config?" %s":"")}},{name:"extmapAllowMixed",reg:/^(extmap-allow-mixed)/},{push:"crypto",reg:/^crypto:(\d*) ([\w_]*) (\S*)(?: (\S*))?/,names:["id","suite","config","sessionConfig"],format:function(e){return null!=e.sessionConfig?"crypto:%d %s %s %s":"crypto:%d %s %s"}},{name:"setup",reg:/^setup:(\w*)/,format:"setup:%s"},{name:"connectionType",reg:/^connection:(new|existing)/,format:"connection:%s"},{name:"mid",reg:/^mid:([^\s]*)/,format:"mid:%s"},{name:"msid",reg:/^msid:(.*)/,format:"msid:%s"},{name:"ptime",reg:/^ptime:(\d*(?:\.\d*)*)/,format:"ptime:%d"},{name:"maxptime",reg:/^maxptime:(\d*(?:\.\d*)*)/,format:"maxptime:%d"},{name:"direction",reg:/^(sendrecv|recvonly|sendonly|inactive)/},{name:"icelite",reg:/^(ice-lite)/},{name:"iceUfrag",reg:/^ice-ufrag:(\S*)/,format:"ice-ufrag:%s"},{name:"icePwd",reg:/^ice-pwd:(\S*)/,format:"ice-pwd:%s"},{name:"fingerprint",reg:/^fingerprint:(\S*) (\S*)/,names:["type","hash"],format:"fingerprint:%s %s"},{push:"candidates",reg:/^candidate:(\S*) (\d*) (\S*) (\d*) (\S*) (\d*) typ (\S*)(?: raddr (\S*) rport (\d*))?(?: tcptype (\S*))?(?: generation (\d*))?(?: network-id (\d*))?(?: network-cost (\d*))?/,names:["foundation","component","transport","priority","ip","port","type","raddr","rport","tcptype","generation","network-id","network-cost"],format:function(e){var t="candidate:%s %d %s %d %s %d typ %s";return t+=null!=e.raddr?" raddr %s rport %d":"%v%v",t+=null!=e.tcptype?" tcptype %s":"%v",null!=e.generation&&(t+=" generation %d"),t+=null!=e["network-id"]?" network-id %d":"%v",t+=null!=e["network-cost"]?" network-cost %d":"%v"}},{name:"endOfCandidates",reg:/^(end-of-candidates)/},{name:"remoteCandidates",reg:/^remote-candidates:(.*)/,format:"remote-candidates:%s"},{name:"iceOptions",reg:/^ice-options:(\S*)/,format:"ice-options:%s"},{push:"ssrcs",reg:/^ssrc:(\d*) ([\w_-]*)(?::(.*))?/,names:["id","attribute","value"],format:function(e){var t="ssrc:%d";return null!=e.attribute&&(t+=" %s",null!=e.value&&(t+=":%s")),t}},{push:"ssrcGroups",reg:/^ssrc-group:([\x21\x23\x24\x25\x26\x27\x2A\x2B\x2D\x2E\w]*) (.*)/,names:["semantics","ssrcs"],format:"ssrc-group:%s %s"},{name:"msidSemantic",reg:/^msid-semantic:\s?(\w*) (\S*)/,names:["semantic","token"],format:"msid-semantic: %s %s"},{push:"groups",reg:/^group:(\w*) (.*)/,names:["type","mids"],format:"group:%s %s"},{name:"rtcpMux",reg:/^(rtcp-mux)/},{name:"rtcpRsize",reg:/^(rtcp-rsize)/},{name:"sctpmap",reg:/^sctpmap:([\w_/]*) (\S*)(?: (\S*))?/,names:["sctpmapNumber","app","maxMessageSize"],format:function(e){return null!=e.maxMessageSize?"sctpmap:%s %s %s":"sctpmap:%s %s"}},{name:"xGoogleFlag",reg:/^x-google-flag:([^\s]*)/,format:"x-google-flag:%s"},{push:"rids",reg:/^rid:([\d\w]+) (\w+)(?: ([\S| ]*))?/,names:["id","direction","params"],format:function(e){return e.params?"rid:%s %s %s":"rid:%s %s"}},{push:"imageattrs",reg:new RegExp("^imageattr:(\\d+|\\*)[\\s\\t]+(send|recv)[\\s\\t]+(\\*|\\[\\S+\\](?:[\\s\\t]+\\[\\S+\\])*)(?:[\\s\\t]+(recv|send)[\\s\\t]+(\\*|\\[\\S+\\](?:[\\s\\t]+\\[\\S+\\])*))?"),names:["pt","dir1","attrs1","dir2","attrs2"],format:function(e){return"imageattr:%s %s %s"+(e.dir2?" %s %s":"")}},{name:"simulcast",reg:new RegExp("^simulcast:(send|recv) ([a-zA-Z0-9\\-_~;,]+)(?:\\s?(send|recv) ([a-zA-Z0-9\\-_~;,]+))?$"),names:["dir1","list1","dir2","list2"],format:function(e){return"simulcast:%s %s"+(e.dir2?" %s %s":"")}},{name:"simulcast_03",reg:/^simulcast:[\s\t]+([\S+\s\t]+)$/,names:["value"],format:"simulcast: %s"},{name:"framerate",reg:/^framerate:(\d+(?:$|\.\d+))/,format:"framerate:%s"},{name:"sourceFilter",reg:/^source-filter: *(excl|incl) (\S*) (IP4|IP6|\*) (\S*) (.*)/,names:["filterMode","netType","addressTypes","destAddress","srcList"],format:"source-filter: %s %s %s %s %s"},{name:"bundleOnly",reg:/^(bundle-only)/},{name:"label",reg:/^label:(.+)/,format:"label:%s"},{name:"sctpPort",reg:/^sctp-port:(\d+)$/,format:"sctp-port:%s"},{name:"maxMessageSize",reg:/^max-message-size:(\d+)$/,format:"max-message-size:%s"},{push:"tsRefClocks",reg:/^ts-refclk:([^\s=]*)(?:=(\S*))?/,names:["clksrc","clksrcExt"],format:function(e){return"ts-refclk:%s"+(null!=e.clksrcExt?"=%s":"")}},{name:"mediaClk",reg:/^mediaclk:(?:id=(\S*))? *([^\s=]*)(?:=(\S*))?(?: *rate=(\d+)\/(\d+))?/,names:["id","mediaClockName","mediaClockValue","rateNumerator","rateDenominator"],format:function(e){var t="mediaclk:";return t+=null!=e.id?"id=%s %s":"%v%s",t+=null!=e.mediaClockValue?"=%s":"",t+=null!=e.rateNumerator?" rate=%s":"",t+=null!=e.rateDenominator?"/%s":""}},{name:"keywords",reg:/^keywds:(.+)$/,format:"keywds:%s"},{name:"content",reg:/^content:(.+)/,format:"content:%s"},{name:"bfcpFloorCtrl",reg:/^floorctrl:(c-only|s-only|c-s)/,format:"floorctrl:%s"},{name:"bfcpConfId",reg:/^confid:(\d+)/,format:"confid:%s"},{name:"bfcpUserId",reg:/^userid:(\d+)/,format:"userid:%s"},{name:"bfcpFloorId",reg:/^floorid:(.+) (?:m-stream|mstrm):(.+)/,names:["id","mStream"],format:"floorid:%s mstrm:%s"},{push:"invalid",names:["value"]}]};Object.keys(grammar$1).forEach((function(e){grammar$1[e].forEach((function(e){e.reg||(e.reg=/(.*)/),e.format||(e.format="%s")}))})),function(e){var t=function(e){return String(Number(e))===e?Number(e):e},r=function(e,r,n){var o=e.name&&e.names;e.push&&!r[e.push]?r[e.push]=[]:o&&!r[e.name]&&(r[e.name]={});var i=e.push?{}:o?r[e.name]:r;!function(e,r,n,o){if(o&&!n)r[o]=t(e[1]);else for(var i=0;i<n.length;i+=1)null!=e[i+1]&&(r[n[i]]=t(e[i+1]))}(n.match(e.reg),i,e.names,e.name),e.push&&r[e.push].push(i)},n=grammar$2.exports,o=RegExp.prototype.test.bind(/^([a-z])=(.*)/);e.parse=function(e){var t={},i=[],s=t;return e.split(/(\r\n|\r|\n)/).filter(o).forEach((function(e){var t=e[0],o=e.slice(2);"m"===t&&(i.push({rtp:[],fmtp:[]}),s=i[i.length-1]);for(var a=0;a<(n[t]||[]).length;a+=1){var c=n[t][a];if(c.reg.test(o))return r(c,s,o)}})),t.media=i,t};var i=function(e,r){var n=r.split(/=(.+)/,2);return 2===n.length?e[n[0]]=t(n[1]):1===n.length&&r.length>1&&(e[n[0]]=void 0),e};e.parseParams=function(e){return e.split(/;\s?/).reduce(i,{})},e.parseFmtpConfig=e.parseParams,e.parsePayloads=function(e){return e.toString().split(" ").map(Number)},e.parseRemoteCandidates=function(e){for(var r=[],n=e.split(" ").map(t),o=0;o<n.length;o+=3)r.push({component:n[o],ip:n[o+1],port:n[o+2]});return r},e.parseImageAttributes=function(e){return e.split(" ").map((function(e){return e.substring(1,e.length-1).split(",").reduce(i,{})}))},e.parseSimulcastStreamList=function(e){return e.split(";").map((function(e){return e.split(",").map((function(e){var r,n=!1;return"~"!==e[0]?r=t(e):(r=t(e.substring(1,e.length)),n=!0),{scid:r,paused:n}}))}))}}(parser$1);var grammar=grammar$2.exports,formatRegExp=/%[sdv%]/g,format=function(e){var t=1,r=arguments,n=r.length;return e.replace(formatRegExp,(function(e){if(t>=n)return e;var o=r[t];switch(t+=1,e){case"%%":return"%";case"%s":return String(o);case"%d":return Number(o);case"%v":return""}}))},makeLine=function(e,t,r){var n=[e+"="+(t.format instanceof Function?t.format(t.push?r:r[t.name]):t.format)];if(t.names)for(var o=0;o<t.names.length;o+=1){var i=t.names[o];t.name?n.push(r[t.name][i]):n.push(r[t.names[o]])}else n.push(r[t.name]);return format.apply(null,n)},defaultOuterOrder=["v","o","s","i","u","e","p","c","b","t","r","z","a"],defaultInnerOrder=["i","c","b","a"],writer$2=function(e,t){t=t||{},null==e.version&&(e.version=0),null==e.name&&(e.name=" "),e.media.forEach((function(e){null==e.payloads&&(e.payloads="")}));var r=t.outerOrder||defaultOuterOrder,n=t.innerOrder||defaultInnerOrder,o=[];return r.forEach((function(t){grammar[t].forEach((function(r){r.name in e&&null!=e[r.name]?o.push(makeLine(t,r,e)):r.push in e&&null!=e[r.push]&&e[r.push].forEach((function(e){o.push(makeLine(t,r,e))}))}))})),e.media.forEach((function(e){o.push(makeLine("m",grammar.m[0],e)),n.forEach((function(t){grammar[t].forEach((function(r){r.name in e&&null!=e[r.name]?o.push(makeLine(t,r,e)):r.push in e&&null!=e[r.push]&&e[r.push].forEach((function(e){o.push(makeLine(t,r,e))}))}))}))})),o.join("\r\n")+"\r\n"},parser=parser$1,writer$1=writer$2;lib.write=writer$1,lib.parse=parser.parse,lib.parseParams=parser.parseParams,lib.parseFmtpConfig=parser.parseFmtpConfig,lib.parsePayloads=parser.parsePayloads,lib.parseRemoteCandidates=parser.parseRemoteCandidates,lib.parseImageAttributes=parser.parseImageAttributes,lib.parseSimulcastStreamList=parser.parseSimulcastStreamList;var commonUtils={},__createBinding$d=commonjsGlobal&&commonjsGlobal.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r),Object.defineProperty(e,n,{enumerable:!0,get:function(){return t[r]}})}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),__setModuleDefault$d=commonjsGlobal&&commonjsGlobal.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),__importStar$d=commonjsGlobal&&commonjsGlobal.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)"default"!==r&&Object.prototype.hasOwnProperty.call(e,r)&&__createBinding$d(t,e,r);return __setModuleDefault$d(t,e),t};Object.defineProperty(commonUtils,"__esModule",{value:!0}),commonUtils.applyCodecParameters=commonUtils.getCname=commonUtils.extractDtlsParameters=commonUtils.extractRtpCapabilities=void 0;const sdpTransform$9=__importStar$d(lib);function extractRtpCapabilities({sdpObject:e}){const t=new Map,r=[];let n=!1,o=!1;for(const i of e.media){const e=i.type;switch(e){case"audio":if(n)continue;n=!0;break;case"video":if(o)continue;o=!0;break;default:continue}for(const r of i.rtp){const n={kind:e,mimeType:`${e}/${r.codec}`,preferredPayloadType:r.payload,clockRate:r.rate,channels:r.encoding,parameters:{},rtcpFeedback:[]};t.set(n.preferredPayloadType,n)}for(const e of i.fmtp||[]){const r=sdpTransform$9.parseParams(e.config),n=t.get(e.payload);n&&(r&&r.hasOwnProperty("profile-level-id")&&(r["profile-level-id"]=String(r["profile-level-id"])),n.parameters=r)}for(const e of i.rtcpFb||[]){const r=t.get(e.payload);if(!r)continue;const n={type:e.type,parameter:e.subtype};n.parameter||delete n.parameter,r.rtcpFeedback.push(n)}for(const t of i.ext||[]){if(t["encrypt-uri"])continue;const n={kind:e,uri:t.uri,preferredId:t.value};r.push(n)}}return{codecs:Array.from(t.values()),headerExtensions:r}}function extractDtlsParameters({sdpObject:e}){const t=(e.media||[]).find((e=>e.iceUfrag&&0!==e.port));if(!t)throw new Error("no active media section found");const r=t.fingerprint||e.fingerprint;let n;switch(t.setup){case"active":n="client";break;case"passive":n="server";break;case"actpass":n="auto"}return{role:n,fingerprints:[{algorithm:r.type,value:r.hash}]}}function getCname({offerMediaObject:e}){const t=(e.ssrcs||[]).find((e=>"cname"===e.attribute));return t?t.value:""}function applyCodecParameters({offerRtpParameters:e,answerMediaObject:t}){for(const r of e.codecs){const e=r.mimeType.toLowerCase();if("audio/opus"!==e)continue;const n=(t.rtp||[]).find((e=>e.payload===r.payloadType));if(!n)continue;t.fmtp=t.fmtp||[];let o=t.fmtp.find((e=>e.payload===r.payloadType));o||(o={payload:r.payloadType,config:""},t.fmtp.push(o));const i=sdpTransform$9.parseParams(o.config);switch(e){case"audio/opus":{const e=r.parameters["sprop-stereo"];void 0!==e&&(i.stereo=e?1:0);break}}o.config="";for(const e of Object.keys(i))o.config&&(o.config+=";"),o.config+=`${e}=${i[e]}`}}commonUtils.extractRtpCapabilities=extractRtpCapabilities,commonUtils.extractDtlsParameters=extractDtlsParameters,commonUtils.getCname=getCname,commonUtils.applyCodecParameters=applyCodecParameters;var unifiedPlanUtils={};function getRtpEncodings$1({offerMediaObject:e}){const t=new Set;for(const r of e.ssrcs||[]){const e=r.id;t.add(e)}if(0===t.size)throw new Error("no a=ssrc lines found");const r=new Map;for(const n of e.ssrcGroups||[]){if("FID"!==n.semantics)continue;let[e,o]=n.ssrcs.split(/\s+/);e=Number(e),o=Number(o),t.has(e)&&(t.delete(e),t.delete(o),r.set(e,o))}for(const e of t)r.set(e,null);const n=[];for(const[e,t]of r){const r={ssrc:e};t&&(r.rtx={ssrc:t}),n.push(r)}return n}function addLegacySimulcast$1({offerMediaObject:e,numStreams:t}){if(t<=1)throw new TypeError("numStreams must be greater than 1");const r=(e.ssrcs||[]).find((e=>"msid"===e.attribute));if(!r)throw new Error("a=ssrc line with msid information not found");const[n,o]=r.value.split(" "),i=r.id;let s;(e.ssrcGroups||[]).some((e=>{if("FID"!==e.semantics)return!1;const t=e.ssrcs.split(/\s+/);return Number(t[0])===i&&(s=Number(t[1]),!0)}));const a=e.ssrcs.find((e=>"cname"===e.attribute));if(!a)throw new Error("a=ssrc line with cname information not found");const c=a.value,d=[],l=[];for(let e=0;e<t;++e)d.push(i+e),s&&l.push(s+e);e.ssrcGroups=[],e.ssrcs=[],e.ssrcGroups.push({semantics:"SIM",ssrcs:d.join(" ")});for(let t=0;t<d.length;++t){const r=d[t];e.ssrcs.push({id:r,attribute:"cname",value:c}),e.ssrcs.push({id:r,attribute:"msid",value:`${n} ${o}`})}for(let t=0;t<l.length;++t){const r=d[t],i=l[t];e.ssrcs.push({id:i,attribute:"cname",value:c}),e.ssrcs.push({id:i,attribute:"msid",value:`${n} ${o}`}),e.ssrcGroups.push({semantics:"FID",ssrcs:`${r} ${i}`})}}Object.defineProperty(unifiedPlanUtils,"__esModule",{value:!0}),unifiedPlanUtils.addLegacySimulcast=unifiedPlanUtils.getRtpEncodings=void 0,unifiedPlanUtils.getRtpEncodings=getRtpEncodings$1,unifiedPlanUtils.addLegacySimulcast=addLegacySimulcast$1;var HandlerInterface$1={};Object.defineProperty(HandlerInterface$1,"__esModule",{value:!0}),HandlerInterface$1.HandlerInterface=void 0;const EnhancedEventEmitter_1$1=EnhancedEventEmitter$1;class HandlerInterface extends EnhancedEventEmitter_1$1.EnhancedEventEmitter{constructor(){super()}}HandlerInterface$1.HandlerInterface=HandlerInterface;var RemoteSdp$1={},MediaSection$1={},__createBinding$c=commonjsGlobal&&commonjsGlobal.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r),Object.defineProperty(e,n,{enumerable:!0,get:function(){return t[r]}})}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),__setModuleDefault$c=commonjsGlobal&&commonjsGlobal.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),__importStar$c=commonjsGlobal&&commonjsGlobal.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)"default"!==r&&Object.prototype.hasOwnProperty.call(e,r)&&__createBinding$c(t,e,r);return __setModuleDefault$c(t,e),t};Object.defineProperty(MediaSection$1,"__esModule",{value:!0}),MediaSection$1.OfferMediaSection=MediaSection$1.AnswerMediaSection=MediaSection$1.MediaSection=void 0;const utils$b=__importStar$c(utils$e);class MediaSection{constructor({iceParameters:e,iceCandidates:t,dtlsParameters:r,planB:n=!1}){if(this._mediaObject={},this._planB=n,e&&this.setIceParameters(e),t){this._mediaObject.candidates=[];for(const e of t){const t={component:1};t.foundation=e.foundation,t.ip=e.ip,t.port=e.port,t.priority=e.priority,t.transport=e.protocol,t.type=e.type,e.tcpType&&(t.tcptype=e.tcpType),this._mediaObject.candidates.push(t)}this._mediaObject.endOfCandidates="end-of-candidates",this._mediaObject.iceOptions="renomination"}r&&this.setDtlsRole(r.role)}get mid(){return String(this._mediaObject.mid)}get closed(){return 0===this._mediaObject.port}getObject(){return this._mediaObject}setIceParameters(e){this._mediaObject.iceUfrag=e.usernameFragment,this._mediaObject.icePwd=e.password}disable(){this._mediaObject.direction="inactive",delete this._mediaObject.ext,delete this._mediaObject.ssrcs,delete this._mediaObject.ssrcGroups,delete this._mediaObject.simulcast,delete this._mediaObject.simulcast_03,delete this._mediaObject.rids}close(){this._mediaObject.direction="inactive",this._mediaObject.port=0,delete this._mediaObject.ext,delete this._mediaObject.ssrcs,delete this._mediaObject.ssrcGroups,delete this._mediaObject.simulcast,delete this._mediaObject.simulcast_03,delete this._mediaObject.rids,delete this._mediaObject.extmapAllowMixed}}MediaSection$1.MediaSection=MediaSection;class AnswerMediaSection extends MediaSection{constructor({iceParameters:e,iceCandidates:t,dtlsParameters:r,sctpParameters:n,plainRtpParameters:o,planB:i=!1,offerMediaObject:s,offerRtpParameters:a,answerRtpParameters:c,codecOptions:d,extmapAllowMixed:l=!1}){switch(super({iceParameters:e,iceCandidates:t,dtlsParameters:r,planB:i}),this._mediaObject.mid=String(s.mid),this._mediaObject.type=s.type,this._mediaObject.protocol=s.protocol,o?(this._mediaObject.connection={ip:o.ip,version:o.ipVersion},this._mediaObject.port=o.port):(this._mediaObject.connection={ip:"127.0.0.1",version:4},this._mediaObject.port=7),s.type){case"audio":case"video":this._mediaObject.direction="recvonly",this._mediaObject.rtp=[],this._mediaObject.rtcpFb=[],this._mediaObject.fmtp=[];for(const e of c.codecs){const t={payload:e.payloadType,codec:getCodecName(e),rate:e.clockRate};e.channels>1&&(t.encoding=e.channels),this._mediaObject.rtp.push(t);const r=utils$b.clone(e.parameters,{});if(d){const{opusStereo:t,opusFec:n,opusDtx:o,opusMaxPlaybackRate:i,opusMaxAverageBitrate:s,opusPtime:c,videoGoogleStartBitrate:l,videoGoogleMaxBitrate:p,videoGoogleMinBitrate:u}=d,f=a.codecs.find((t=>t.payloadType===e.payloadType));switch(e.mimeType.toLowerCase()){case"audio/opus":void 0!==t&&(f.parameters["sprop-stereo"]=t?1:0,r.stereo=t?1:0),void 0!==n&&(f.parameters.useinbandfec=n?1:0,r.useinbandfec=n?1:0),void 0!==o&&(f.parameters.usedtx=o?1:0,r.usedtx=o?1:0),void 0!==i&&(r.maxplaybackrate=i),void 0!==s&&(r.maxaveragebitrate=s),void 0!==c&&(f.parameters.ptime=c,r.ptime=c);break;case"video/vp8":case"video/vp9":case"video/h264":case"video/h265":void 0!==l&&(r["x-google-start-bitrate"]=l),void 0!==p&&(r["x-google-max-bitrate"]=p),void 0!==u&&(r["x-google-min-bitrate"]=u)}}const n={payload:e.payloadType,config:""};for(const e of Object.keys(r))n.config&&(n.config+=";"),n.config+=`${e}=${r[e]}`;n.config&&this._mediaObject.fmtp.push(n);for(const t of e.rtcpFeedback)this._mediaObject.rtcpFb.push({payload:e.payloadType,type:t.type,subtype:t.parameter})}this._mediaObject.payloads=c.codecs.map((e=>e.payloadType)).join(" "),this._mediaObject.ext=[];for(const e of c.headerExtensions){(s.ext||[]).some((t=>t.uri===e.uri))&&this._mediaObject.ext.push({uri:e.uri,value:e.id})}if(l&&"extmap-allow-mixed"===s.extmapAllowMixed&&(this._mediaObject.extmapAllowMixed="extmap-allow-mixed"),s.simulcast){this._mediaObject.simulcast={dir1:"recv",list1:s.simulcast.list1},this._mediaObject.rids=[];for(const e of s.rids||[])"send"===e.direction&&this._mediaObject.rids.push({id:e.id,direction:"recv"})}else if(s.simulcast_03){this._mediaObject.simulcast_03={value:s.simulcast_03.value.replace(/send/g,"recv")},this._mediaObject.rids=[];for(const e of s.rids||[])"send"===e.direction&&this._mediaObject.rids.push({id:e.id,direction:"recv"})}this._mediaObject.rtcpMux="rtcp-mux",this._mediaObject.rtcpRsize="rtcp-rsize",this._planB&&"video"===this._mediaObject.type&&(this._mediaObject.xGoogleFlag="conference");break;case"application":"number"==typeof s.sctpPort?(this._mediaObject.payloads="webrtc-datachannel",this._mediaObject.sctpPort=n.port,this._mediaObject.maxMessageSize=n.maxMessageSize):s.sctpmap&&(this._mediaObject.payloads=n.port,this._mediaObject.sctpmap={app:"webrtc-datachannel",sctpmapNumber:n.port,maxMessageSize:n.maxMessageSize})}}setDtlsRole(e){switch(e){case"client":this._mediaObject.setup="active";break;case"server":this._mediaObject.setup="passive";break;case"auto":this._mediaObject.setup="actpass"}}}MediaSection$1.AnswerMediaSection=AnswerMediaSection;class OfferMediaSection extends MediaSection{constructor({iceParameters:e,iceCandidates:t,dtlsParameters:r,sctpParameters:n,plainRtpParameters:o,planB:i=!1,mid:s,kind:a,offerRtpParameters:c,streamId:d,trackId:l,oldDataChannelSpec:p=!1}){switch(super({iceParameters:e,iceCandidates:t,dtlsParameters:r,planB:i}),this._mediaObject.mid=String(s),this._mediaObject.type=a,o?(this._mediaObject.connection={ip:o.ip,version:o.ipVersion},this._mediaObject.protocol="RTP/AVP",this._mediaObject.port=o.port):(this._mediaObject.connection={ip:"127.0.0.1",version:4},this._mediaObject.protocol=n?"UDP/DTLS/SCTP":"UDP/TLS/RTP/SAVPF",this._mediaObject.port=7),a){case"audio":case"video":{this._mediaObject.direction="sendonly",this._mediaObject.rtp=[],this._mediaObject.rtcpFb=[],this._mediaObject.fmtp=[],this._planB||(this._mediaObject.msid=`${d||"-"} ${l}`);for(const e of c.codecs){const t={payload:e.payloadType,codec:getCodecName(e),rate:e.clockRate};e.channels>1&&(t.encoding=e.channels),this._mediaObject.rtp.push(t);const r={payload:e.payloadType,config:""};for(const t of Object.keys(e.parameters))r.config&&(r.config+=";"),r.config+=`${t}=${e.parameters[t]}`;r.config&&this._mediaObject.fmtp.push(r);for(const t of e.rtcpFeedback)this._mediaObject.rtcpFb.push({payload:e.payloadType,type:t.type,subtype:t.parameter})}this._mediaObject.payloads=c.codecs.map((e=>e.payloadType)).join(" "),this._mediaObject.ext=[];for(const e of c.headerExtensions)this._mediaObject.ext.push({uri:e.uri,value:e.id});this._mediaObject.rtcpMux="rtcp-mux",this._mediaObject.rtcpRsize="rtcp-rsize";const e=c.encodings[0],t=e.ssrc,r=e.rtx&&e.rtx.ssrc?e.rtx.ssrc:void 0;this._mediaObject.ssrcs=[],this._mediaObject.ssrcGroups=[],c.rtcp.cname&&this._mediaObject.ssrcs.push({id:t,attribute:"cname",value:c.rtcp.cname}),this._planB&&this._mediaObject.ssrcs.push({id:t,attribute:"msid",value:`${d||"-"} ${l}`}),r&&(c.rtcp.cname&&this._mediaObject.ssrcs.push({id:r,attribute:"cname",value:c.rtcp.cname}),this._planB&&this._mediaObject.ssrcs.push({id:r,attribute:"msid",value:`${d||"-"} ${l}`}),this._mediaObject.ssrcGroups.push({semantics:"FID",ssrcs:`${t} ${r}`}));break}case"application":p?(this._mediaObject.payloads=n.port,this._mediaObject.sctpmap={app:"webrtc-datachannel",sctpmapNumber:n.port,maxMessageSize:n.maxMessageSize}):(this._mediaObject.payloads="webrtc-datachannel",this._mediaObject.sctpPort=n.port,this._mediaObject.maxMessageSize=n.maxMessageSize)}}setDtlsRole(e){this._mediaObject.setup="actpass"}planBReceive({offerRtpParameters:e,streamId:t,trackId:r}){const n=e.encodings[0],o=n.ssrc,i=n.rtx&&n.rtx.ssrc?n.rtx.ssrc:void 0,s=this._mediaObject.payloads.split(" ");for(const t of e.codecs){if(s.includes(String(t.payloadType)))continue;const e={payload:t.payloadType,codec:getCodecName(t),rate:t.clockRate};t.channels>1&&(e.encoding=t.channels),this._mediaObject.rtp.push(e);const r={payload:t.payloadType,config:""};for(const e of Object.keys(t.parameters))r.config&&(r.config+=";"),r.config+=`${e}=${t.parameters[e]}`;r.config&&this._mediaObject.fmtp.push(r);for(const e of t.rtcpFeedback)this._mediaObject.rtcpFb.push({payload:t.payloadType,type:e.type,subtype:e.parameter})}this._mediaObject.payloads+=` ${e.codecs.filter((e=>!this._mediaObject.payloads.includes(e.payloadType))).map((e=>e.payloadType)).join(" ")}`,this._mediaObject.payloads=this._mediaObject.payloads.trim(),e.rtcp.cname&&this._mediaObject.ssrcs.push({id:o,attribute:"cname",value:e.rtcp.cname}),this._mediaObject.ssrcs.push({id:o,attribute:"msid",value:`${t||"-"} ${r}`}),i&&(e.rtcp.cname&&this._mediaObject.ssrcs.push({id:i,attribute:"cname",value:e.rtcp.cname}),this._mediaObject.ssrcs.push({id:i,attribute:"msid",value:`${t||"-"} ${r}`}),this._mediaObject.ssrcGroups.push({semantics:"FID",ssrcs:`${o} ${i}`}))}planBStopReceiving({offerRtpParameters:e}){const t=e.encodings[0],r=t.ssrc,n=t.rtx&&t.rtx.ssrc?t.rtx.ssrc:void 0;this._mediaObject.ssrcs=this._mediaObject.ssrcs.filter((e=>e.id!==r&&e.id!==n)),n&&(this._mediaObject.ssrcGroups=this._mediaObject.ssrcGroups.filter((e=>e.ssrcs!==`${r} ${n}`)))}}function getCodecName(e){const t=new RegExp("^(audio|video)/(.+)","i").exec(e.mimeType);if(!t)throw new TypeError("invalid codec.mimeType");return t[2]}MediaSection$1.OfferMediaSection=OfferMediaSection;var __createBinding$b=commonjsGlobal&&commonjsGlobal.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r),Object.defineProperty(e,n,{enumerable:!0,get:function(){return t[r]}})}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),__setModuleDefault$b=commonjsGlobal&&commonjsGlobal.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),__importStar$b=commonjsGlobal&&commonjsGlobal.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)"default"!==r&&Object.prototype.hasOwnProperty.call(e,r)&&__createBinding$b(t,e,r);return __setModuleDefault$b(t,e),t};Object.defineProperty(RemoteSdp$1,"__esModule",{value:!0}),RemoteSdp$1.RemoteSdp=void 0;const sdpTransform$8=__importStar$b(lib),Logger_1$a=Logger$1,MediaSection_1=MediaSection$1,logger$a=new Logger_1$a.Logger("RemoteSdp");class RemoteSdp{constructor({iceParameters:e,iceCandidates:t,dtlsParameters:r,sctpParameters:n,plainRtpParameters:o,planB:i=!1}){if(this._mediaSections=[],this._midToIndex=new Map,this._iceParameters=e,this._iceCandidates=t,this._dtlsParameters=r,this._sctpParameters=n,this._plainRtpParameters=o,this._planB=i,this._sdpObject={version:0,origin:{address:"0.0.0.0",ipVer:4,netType:"IN",sessionId:1e4,sessionVersion:0,username:"mediasoup-client"},name:"-",timing:{start:0,stop:0},media:[]},e&&e.iceLite&&(this._sdpObject.icelite="ice-lite"),r){this._sdpObject.msidSemantic={semantic:"WMS",token:"*"};const e=this._dtlsParameters.fingerprints.length;this._sdpObject.fingerprint={type:r.fingerprints[e-1].algorithm,hash:r.fingerprints[e-1].value},this._sdpObject.groups=[{type:"BUNDLE",mids:""}]}o&&(this._sdpObject.origin.address=o.ip,this._sdpObject.origin.ipVer=o.ipVersion)}updateIceParameters(e){logger$a.debug("updateIceParameters() [iceParameters:%o]",e),this._iceParameters=e,this._sdpObject.icelite=e.iceLite?"ice-lite":void 0;for(const t of this._mediaSections)t.setIceParameters(e)}updateDtlsRole(e){logger$a.debug("updateDtlsRole() [role:%s]",e),this._dtlsParameters.role=e;for(const t of this._mediaSections)t.setDtlsRole(e)}getNextMediaSectionIdx(){for(let e=0;e<this._mediaSections.length;++e){const t=this._mediaSections[e];if(t.closed)return{idx:e,reuseMid:t.mid}}return{idx:this._mediaSections.length}}send({offerMediaObject:e,reuseMid:t,offerRtpParameters:r,answerRtpParameters:n,codecOptions:o,extmapAllowMixed:i=!1}){const s=new MediaSection_1.AnswerMediaSection({iceParameters:this._iceParameters,iceCandidates:this._iceCandidates,dtlsParameters:this._dtlsParameters,plainRtpParameters:this._plainRtpParameters,planB:this._planB,offerMediaObject:e,offerRtpParameters:r,answerRtpParameters:n,codecOptions:o,extmapAllowMixed:i});t?this._replaceMediaSection(s,t):this._midToIndex.has(s.mid)?this._replaceMediaSection(s):this._addMediaSection(s)}receive({mid:e,kind:t,offerRtpParameters:r,streamId:n,trackId:o}){const i=this._midToIndex.get(e);let s;if(void 0!==i&&(s=this._mediaSections[i]),s)s.planBReceive({offerRtpParameters:r,streamId:n,trackId:o}),this._replaceMediaSection(s);else{s=new MediaSection_1.OfferMediaSection({iceParameters:this._iceParameters,iceCandidates:this._iceCandidates,dtlsParameters:this._dtlsParameters,plainRtpParameters:this._plainRtpParameters,planB:this._planB,mid:e,kind:t,offerRtpParameters:r,streamId:n,trackId:o});const i=this._mediaSections.find((e=>e.closed));i?this._replaceMediaSection(s,i.mid):this._addMediaSection(s)}}disableMediaSection(e){const t=this._midToIndex.get(e);if(void 0===t)throw new Error(`no media section found with mid '${e}'`);this._mediaSections[t].disable()}closeMediaSection(e){const t=this._midToIndex.get(e);if(void 0===t)throw new Error(`no media section found with mid '${e}'`);const r=this._mediaSections[t];if(e===this._firstMid)return logger$a.debug("closeMediaSection() | cannot close first media section, disabling it instead [mid:%s]",e),void this.disableMediaSection(e);r.close(),this._regenerateBundleMids()}planBStopReceiving({mid:e,offerRtpParameters:t}){const r=this._midToIndex.get(e);if(void 0===r)throw new Error(`no media section found with mid '${e}'`);const n=this._mediaSections[r];n.planBStopReceiving({offerRtpParameters:t}),this._replaceMediaSection(n)}sendSctpAssociation({offerMediaObject:e}){const t=new MediaSection_1.AnswerMediaSection({iceParameters:this._iceParameters,iceCandidates:this._iceCandidates,dtlsParameters:this._dtlsParameters,sctpParameters:this._sctpParameters,plainRtpParameters:this._plainRtpParameters,offerMediaObject:e});this._addMediaSection(t)}receiveSctpAssociation({oldDataChannelSpec:e=!1}={}){const t=new MediaSection_1.OfferMediaSection({iceParameters:this._iceParameters,iceCandidates:this._iceCandidates,dtlsParameters:this._dtlsParameters,sctpParameters:this._sctpParameters,plainRtpParameters:this._plainRtpParameters,mid:"datachannel",kind:"application",oldDataChannelSpec:e});this._addMediaSection(t)}getSdp(){return this._sdpObject.origin.sessionVersion++,sdpTransform$8.write(this._sdpObject)}_addMediaSection(e){this._firstMid||(this._firstMid=e.mid),this._mediaSections.push(e),this._midToIndex.set(e.mid,this._mediaSections.length-1),this._sdpObject.media.push(e.getObject()),this._regenerateBundleMids()}_replaceMediaSection(e,t){if("string"==typeof t){const r=this._midToIndex.get(t);if(void 0===r)throw new Error(`no media section found for reuseMid '${t}'`);const n=this._mediaSections[r];this._mediaSections[r]=e,this._midToIndex.delete(n.mid),this._midToIndex.set(e.mid,r),this._sdpObject.media[r]=e.getObject(),this._regenerateBundleMids()}else{const t=this._midToIndex.get(e.mid);if(void 0===t)throw new Error(`no media section found with mid '${e.mid}'`);this._mediaSections[t]=e,this._sdpObject.media[t]=e.getObject()}}_regenerateBundleMids(){this._dtlsParameters&&(this._sdpObject.groups[0].mids=this._mediaSections.filter((e=>!e.closed)).map((e=>e.mid)).join(" "))}}RemoteSdp$1.RemoteSdp=RemoteSdp;var scalabilityModes={};Object.defineProperty(scalabilityModes,"__esModule",{value:!0}),scalabilityModes.parse=void 0;const ScalabilityModeRegex=new RegExp("^[LS]([1-9]\\d{0,1})T([1-9]\\d{0,1})");function parse(e){const t=ScalabilityModeRegex.exec(e||"");return t?{spatialLayers:Number(t[1]),temporalLayers:Number(t[2])}:{spatialLayers:1,temporalLayers:1}}scalabilityModes.parse=parse;var __createBinding$a=commonjsGlobal&&commonjsGlobal.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r),Object.defineProperty(e,n,{enumerable:!0,get:function(){return t[r]}})}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),__setModuleDefault$a=commonjsGlobal&&commonjsGlobal.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),__importStar$a=commonjsGlobal&&commonjsGlobal.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)"default"!==r&&Object.prototype.hasOwnProperty.call(e,r)&&__createBinding$a(t,e,r);return __setModuleDefault$a(t,e),t};Object.defineProperty(Chrome74$1,"__esModule",{value:!0}),Chrome74$1.Chrome74=void 0;const sdpTransform$7=__importStar$a(lib),Logger_1$9=Logger$1,utils$a=__importStar$a(utils$e),ortc$9=__importStar$a(ortc$b),sdpCommonUtils$7=__importStar$a(commonUtils),sdpUnifiedPlanUtils$3=__importStar$a(unifiedPlanUtils),HandlerInterface_1$8=HandlerInterface$1,RemoteSdp_1$7=RemoteSdp$1,scalabilityModes_1$1=scalabilityModes,logger$9=new Logger_1$9.Logger("Chrome74"),SCTP_NUM_STREAMS$7={OS:1024,MIS:1024};class Chrome74 extends HandlerInterface_1$8.HandlerInterface{constructor(){super(),this._mapMidTransceiver=new Map,this._sendStream=new MediaStream,this._hasDataChannelMediaSection=!1,this._nextSendSctpStreamId=0,this._transportReady=!1}static createFactory(){return()=>new Chrome74}get name(){return"Chrome74"}close(){if(logger$9.debug("close()"),this._pc)try{this._pc.close()}catch(e){}}async getNativeRtpCapabilities(){logger$9.debug("getNativeRtpCapabilities()");const e=new RTCPeerConnection({iceServers:[],iceTransportPolicy:"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require",sdpSemantics:"unified-plan"});try{e.addTransceiver("audio"),e.addTransceiver("video");const t=await e.createOffer();try{e.close()}catch(e){}const r=sdpTransform$7.parse(t.sdp);return sdpCommonUtils$7.extractRtpCapabilities({sdpObject:r})}catch(t){try{e.close()}catch(e){}throw t}}async getNativeSctpCapabilities(){return logger$9.debug("getNativeSctpCapabilities()"),{numStreams:SCTP_NUM_STREAMS$7}}run({direction:e,iceParameters:t,iceCandidates:r,dtlsParameters:n,sctpParameters:o,iceServers:i,iceTransportPolicy:s,additionalSettings:a,proprietaryConstraints:c,extendedRtpCapabilities:d}){logger$9.debug("run()"),this._direction=e,this._remoteSdp=new RemoteSdp_1$7.RemoteSdp({iceParameters:t,iceCandidates:r,dtlsParameters:n,sctpParameters:o}),this._sendingRtpParametersByKind={audio:ortc$9.getSendingRtpParameters("audio",d),video:ortc$9.getSendingRtpParameters("video",d)},this._sendingRemoteRtpParametersByKind={audio:ortc$9.getSendingRemoteRtpParameters("audio",d),video:ortc$9.getSendingRemoteRtpParameters("video",d)},n.role&&"auto"!==n.role&&(this._forcedLocalDtlsRole="server"===n.role?"client":"server"),this._pc=new RTCPeerConnection({iceServers:i||[],iceTransportPolicy:s||"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require",sdpSemantics:"unified-plan",...a},c),this._pc.addEventListener("iceconnectionstatechange",(()=>{switch(this._pc.iceConnectionState){case"checking":this.emit("@connectionstatechange","connecting");break;case"connected":case"completed":this.emit("@connectionstatechange","connected");break;case"failed":this.emit("@connectionstatechange","failed");break;case"disconnected":this.emit("@connectionstatechange","disconnected");break;case"closed":this.emit("@connectionstatechange","closed")}}))}async updateIceServers(e){logger$9.debug("updateIceServers()");const t=this._pc.getConfiguration();t.iceServers=e,this._pc.setConfiguration(t)}async restartIce(e){if(logger$9.debug("restartIce()"),this._remoteSdp.updateIceParameters(e),this._transportReady)if("send"===this._direction){const e=await this._pc.createOffer({iceRestart:!0});logger$9.debug("restartIce() | calling pc.setLocalDescription() [offer:%o]",e),await this._pc.setLocalDescription(e);const t={type:"answer",sdp:this._remoteSdp.getSdp()};logger$9.debug("restartIce() | calling pc.setRemoteDescription() [answer:%o]",t),await this._pc.setRemoteDescription(t)}else{const e={type:"offer",sdp:this._remoteSdp.getSdp()};logger$9.debug("restartIce() | calling pc.setRemoteDescription() [offer:%o]",e),await this._pc.setRemoteDescription(e);const t=await this._pc.createAnswer();logger$9.debug("restartIce() | calling pc.setLocalDescription() [answer:%o]",t),await this._pc.setLocalDescription(t)}}async getTransportStats(){return this._pc.getStats()}async send({track:e,encodings:t,codecOptions:r,codec:n}){var o;this._assertSendDirection(),logger$9.debug("send() [kind:%s, track.id:%s]",e.kind,e.id),t&&t.length>1&&t.forEach(((e,t)=>{e.rid=`r${t}`}));const i=utils$a.clone(this._sendingRtpParametersByKind[e.kind],{});i.codecs=ortc$9.reduceCodecs(i.codecs,n);const s=utils$a.clone(this._sendingRemoteRtpParametersByKind[e.kind],{});s.codecs=ortc$9.reduceCodecs(s.codecs,n);const a=this._remoteSdp.getNextMediaSectionIdx(),c=this._pc.addTransceiver(e,{direction:"sendonly",streams:[this._sendStream],sendEncodings:t});let d,l=await this._pc.createOffer(),p=sdpTransform$7.parse(l.sdp);this._transportReady||await this._setupTransport({localDtlsRole:null!==(o=this._forcedLocalDtlsRole)&&void 0!==o?o:"client",localSdpObject:p});let u=!1;const f=(0,scalabilityModes_1$1.parse)((t||[{}])[0].scalabilityMode);t&&1===t.length&&f.spatialLayers>1&&"video/vp9"===i.codecs[0].mimeType.toLowerCase()&&(logger$9.debug("send() | enabling legacy simulcast for VP9 SVC"),u=!0,p=sdpTransform$7.parse(l.sdp),d=p.media[a.idx],sdpUnifiedPlanUtils$3.addLegacySimulcast({offerMediaObject:d,numStreams:f.spatialLayers}),l={type:"offer",sdp:sdpTransform$7.write(p)}),logger$9.debug("send() | calling pc.setLocalDescription() [offer:%o]",l),await this._pc.setLocalDescription(l);const m=c.mid;if(i.mid=m,p=sdpTransform$7.parse(this._pc.localDescription.sdp),d=p.media[a.idx],i.rtcp.cname=sdpCommonUtils$7.getCname({offerMediaObject:d}),t)if(1===t.length){let e=sdpUnifiedPlanUtils$3.getRtpEncodings({offerMediaObject:d});Object.assign(e[0],t[0]),u&&(e=[e[0]]),i.encodings=e}else i.encodings=t;else i.encodings=sdpUnifiedPlanUtils$3.getRtpEncodings({offerMediaObject:d});if(i.encodings.length>1&&("video/vp8"===i.codecs[0].mimeType.toLowerCase()||"video/h264"===i.codecs[0].mimeType.toLowerCase()))for(const e of i.encodings)e.scalabilityMode="S1T3";this._remoteSdp.send({offerMediaObject:d,reuseMid:a.reuseMid,offerRtpParameters:i,answerRtpParameters:s,codecOptions:r,extmapAllowMixed:!0});const h={type:"answer",sdp:this._remoteSdp.getSdp()};return logger$9.debug("send() | calling pc.setRemoteDescription() [answer:%o]",h),await this._pc.setRemoteDescription(h),this._mapMidTransceiver.set(m,c),{localId:m,rtpParameters:i,rtpSender:c.sender}}async stopSending(e){this._assertSendDirection(),logger$9.debug("stopSending() [localId:%s]",e);const t=this._mapMidTransceiver.get(e);if(!t)throw new Error("associated RTCRtpTransceiver not found");t.sender.replaceTrack(null),this._pc.removeTrack(t.sender),this._remoteSdp.closeMediaSection(t.mid);const r=await this._pc.createOffer();logger$9.debug("stopSending() | calling pc.setLocalDescription() [offer:%o]",r),await this._pc.setLocalDescription(r);const n={type:"answer",sdp:this._remoteSdp.getSdp()};logger$9.debug("stopSending() | calling pc.setRemoteDescription() [answer:%o]",n),await this._pc.setRemoteDescription(n),this._mapMidTransceiver.delete(e)}async replaceTrack(e,t){this._assertSendDirection(),t?logger$9.debug("replaceTrack() [localId:%s, track.id:%s]",e,t.id):logger$9.debug("replaceTrack() [localId:%s, no track]",e);const r=this._mapMidTransceiver.get(e);if(!r)throw new Error("associated RTCRtpTransceiver not found");await r.sender.replaceTrack(t)}async setMaxSpatialLayer(e,t){this._assertSendDirection(),logger$9.debug("setMaxSpatialLayer() [localId:%s, spatialLayer:%s]",e,t);const r=this._mapMidTransceiver.get(e);if(!r)throw new Error("associated RTCRtpTransceiver not found");const n=r.sender.getParameters();n.encodings.forEach(((e,r)=>{e.active=r<=t})),await r.sender.setParameters(n)}async setRtpEncodingParameters(e,t){this._assertSendDirection(),logger$9.debug("setRtpEncodingParameters() [localId:%s, params:%o]",e,t);const r=this._mapMidTransceiver.get(e);if(!r)throw new Error("associated RTCRtpTransceiver not found");const n=r.sender.getParameters();n.encodings.forEach(((e,r)=>{n.encodings[r]={...e,...t}})),await r.sender.setParameters(n)}async getSenderStats(e){this._assertSendDirection();const t=this._mapMidTransceiver.get(e);if(!t)throw new Error("associated RTCRtpTransceiver not found");return t.sender.getStats()}async sendDataChannel({ordered:e,maxPacketLifeTime:t,maxRetransmits:r,label:n,protocol:o}){var i;this._assertSendDirection();const s={negotiated:!0,id:this._nextSendSctpStreamId,ordered:e,maxPacketLifeTime:t,maxRetransmits:r,protocol:o};logger$9.debug("sendDataChannel() [options:%o]",s);const a=this._pc.createDataChannel(n,s);if(this._nextSendSctpStreamId=++this._nextSendSctpStreamId%SCTP_NUM_STREAMS$7.MIS,!this._hasDataChannelMediaSection){const e=await this._pc.createOffer(),t=sdpTransform$7.parse(e.sdp),r=t.media.find((e=>"application"===e.type));this._transportReady||await this._setupTransport({localDtlsRole:null!==(i=this._forcedLocalDtlsRole)&&void 0!==i?i:"client",localSdpObject:t}),logger$9.debug("sendDataChannel() | calling pc.setLocalDescription() [offer:%o]",e),await this._pc.setLocalDescription(e),this._remoteSdp.sendSctpAssociation({offerMediaObject:r});const n={type:"answer",sdp:this._remoteSdp.getSdp()};logger$9.debug("sendDataChannel() | calling pc.setRemoteDescription() [answer:%o]",n),await this._pc.setRemoteDescription(n),this._hasDataChannelMediaSection=!0}return{dataChannel:a,sctpStreamParameters:{streamId:s.id,ordered:s.ordered,maxPacketLifeTime:s.maxPacketLifeTime,maxRetransmits:s.maxRetransmits}}}async receive({trackId:e,kind:t,rtpParameters:r}){var n;this._assertRecvDirection(),logger$9.debug("receive() [trackId:%s, kind:%s]",e,t);const o=r.mid||String(this._mapMidTransceiver.size);this._remoteSdp.receive({mid:o,kind:t,offerRtpParameters:r,streamId:r.rtcp.cname,trackId:e});const i={type:"offer",sdp:this._remoteSdp.getSdp()};logger$9.debug("receive() | calling pc.setRemoteDescription() [offer:%o]",i),await this._pc.setRemoteDescription(i);let s=await this._pc.createAnswer();const a=sdpTransform$7.parse(s.sdp),c=a.media.find((e=>String(e.mid)===o));sdpCommonUtils$7.applyCodecParameters({offerRtpParameters:r,answerMediaObject:c}),s={type:"answer",sdp:sdpTransform$7.write(a)},this._transportReady||await this._setupTransport({localDtlsRole:null!==(n=this._forcedLocalDtlsRole)&&void 0!==n?n:"client",localSdpObject:a}),logger$9.debug("receive() | calling pc.setLocalDescription() [answer:%o]",s),await this._pc.setLocalDescription(s);const d=this._pc.getTransceivers().find((e=>e.mid===o));if(!d)throw new Error("new RTCRtpTransceiver not found");return this._mapMidTransceiver.set(o,d),{localId:o,track:d.receiver.track,rtpReceiver:d.receiver}}async stopReceiving(e){this._assertRecvDirection(),logger$9.debug("stopReceiving() [localId:%s]",e);const t=this._mapMidTransceiver.get(e);if(!t)throw new Error("associated RTCRtpTransceiver not found");this._remoteSdp.closeMediaSection(t.mid);const r={type:"offer",sdp:this._remoteSdp.getSdp()};logger$9.debug("stopReceiving() | calling pc.setRemoteDescription() [offer:%o]",r),await this._pc.setRemoteDescription(r);const n=await this._pc.createAnswer();logger$9.debug("stopReceiving() | calling pc.setLocalDescription() [answer:%o]",n),await this._pc.setLocalDescription(n),this._mapMidTransceiver.delete(e)}async pauseReceiving(e){this._assertRecvDirection(),logger$9.debug("pauseReceiving() [localId:%s]",e);const t=this._mapMidTransceiver.get(e);if(!t)throw new Error("associated RTCRtpTransceiver not found");t.direction="inactive";const r={type:"offer",sdp:this._remoteSdp.getSdp()};logger$9.debug("pauseReceiving() | calling pc.setRemoteDescription() [offer:%o]",r),await this._pc.setRemoteDescription(r);const n=await this._pc.createAnswer();logger$9.debug("pauseReceiving() | calling pc.setLocalDescription() [answer:%o]",n),await this._pc.setLocalDescription(n)}async resumeReceiving(e){this._assertRecvDirection(),logger$9.debug("resumeReceiving() [localId:%s]",e);const t=this._mapMidTransceiver.get(e);if(!t)throw new Error("associated RTCRtpTransceiver not found");t.direction="recvonly";const r={type:"offer",sdp:this._remoteSdp.getSdp()};logger$9.debug("resumeReceiving() | calling pc.setRemoteDescription() [offer:%o]",r),await this._pc.setRemoteDescription(r);const n=await this._pc.createAnswer();logger$9.debug("resumeReceiving() | calling pc.setLocalDescription() [answer:%o]",n),await this._pc.setLocalDescription(n)}async getReceiverStats(e){this._assertRecvDirection();const t=this._mapMidTransceiver.get(e);if(!t)throw new Error("associated RTCRtpTransceiver not found");return t.receiver.getStats()}async receiveDataChannel({sctpStreamParameters:e,label:t,protocol:r}){var n;this._assertRecvDirection();const{streamId:o,ordered:i,maxPacketLifeTime:s,maxRetransmits:a}=e,c={negotiated:!0,id:o,ordered:i,maxPacketLifeTime:s,maxRetransmits:a,protocol:r};logger$9.debug("receiveDataChannel() [options:%o]",c);const d=this._pc.createDataChannel(t,c);if(!this._hasDataChannelMediaSection){this._remoteSdp.receiveSctpAssociation();const e={type:"offer",sdp:this._remoteSdp.getSdp()};logger$9.debug("receiveDataChannel() | calling pc.setRemoteDescription() [offer:%o]",e),await this._pc.setRemoteDescription(e);const t=await this._pc.createAnswer();if(!this._transportReady){const e=sdpTransform$7.parse(t.sdp);await this._setupTransport({localDtlsRole:null!==(n=this._forcedLocalDtlsRole)&&void 0!==n?n:"client",localSdpObject:e})}logger$9.debug("receiveDataChannel() | calling pc.setRemoteDescription() [answer:%o]",t),await this._pc.setLocalDescription(t),this._hasDataChannelMediaSection=!0}return{dataChannel:d}}async _setupTransport({localDtlsRole:e,localSdpObject:t}){t||(t=sdpTransform$7.parse(this._pc.localDescription.sdp));const r=sdpCommonUtils$7.extractDtlsParameters({sdpObject:t});r.role=e,this._remoteSdp.updateDtlsRole("client"===e?"server":"client"),await this.safeEmitAsPromise("@connect",{dtlsParameters:r}),this._transportReady=!0}_assertSendDirection(){if("send"!==this._direction)throw new Error('method can just be called for handlers with "send" direction')}_assertRecvDirection(){if("recv"!==this._direction)throw new Error('method can just be called for handlers with "recv" direction')}}Chrome74$1.Chrome74=Chrome74;var Chrome70$1={},__createBinding$9=commonjsGlobal&&commonjsGlobal.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r),Object.defineProperty(e,n,{enumerable:!0,get:function(){return t[r]}})}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),__setModuleDefault$9=commonjsGlobal&&commonjsGlobal.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),__importStar$9=commonjsGlobal&&commonjsGlobal.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)"default"!==r&&Object.prototype.hasOwnProperty.call(e,r)&&__createBinding$9(t,e,r);return __setModuleDefault$9(t,e),t};Object.defineProperty(Chrome70$1,"__esModule",{value:!0}),Chrome70$1.Chrome70=void 0;const sdpTransform$6=__importStar$9(lib),Logger_1$8=Logger$1,utils$9=__importStar$9(utils$e),ortc$8=__importStar$9(ortc$b),sdpCommonUtils$6=__importStar$9(commonUtils),sdpUnifiedPlanUtils$2=__importStar$9(unifiedPlanUtils),HandlerInterface_1$7=HandlerInterface$1,RemoteSdp_1$6=RemoteSdp$1,scalabilityModes_1=scalabilityModes,logger$8=new Logger_1$8.Logger("Chrome70"),SCTP_NUM_STREAMS$6={OS:1024,MIS:1024};class Chrome70 extends HandlerInterface_1$7.HandlerInterface{constructor(){super(),this._mapMidTransceiver=new Map,this._sendStream=new MediaStream,this._hasDataChannelMediaSection=!1,this._nextSendSctpStreamId=0,this._transportReady=!1}static createFactory(){return()=>new Chrome70}get name(){return"Chrome70"}close(){if(logger$8.debug("close()"),this._pc)try{this._pc.close()}catch(e){}}async getNativeRtpCapabilities(){logger$8.debug("getNativeRtpCapabilities()");const e=new RTCPeerConnection({iceServers:[],iceTransportPolicy:"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require",sdpSemantics:"unified-plan"});try{e.addTransceiver("audio"),e.addTransceiver("video");const t=await e.createOffer();try{e.close()}catch(e){}const r=sdpTransform$6.parse(t.sdp);return sdpCommonUtils$6.extractRtpCapabilities({sdpObject:r})}catch(t){try{e.close()}catch(e){}throw t}}async getNativeSctpCapabilities(){return logger$8.debug("getNativeSctpCapabilities()"),{numStreams:SCTP_NUM_STREAMS$6}}run({direction:e,iceParameters:t,iceCandidates:r,dtlsParameters:n,sctpParameters:o,iceServers:i,iceTransportPolicy:s,additionalSettings:a,proprietaryConstraints:c,extendedRtpCapabilities:d}){logger$8.debug("run()"),this._direction=e,this._remoteSdp=new RemoteSdp_1$6.RemoteSdp({iceParameters:t,iceCandidates:r,dtlsParameters:n,sctpParameters:o}),this._sendingRtpParametersByKind={audio:ortc$8.getSendingRtpParameters("audio",d),video:ortc$8.getSendingRtpParameters("video",d)},this._sendingRemoteRtpParametersByKind={audio:ortc$8.getSendingRemoteRtpParameters("audio",d),video:ortc$8.getSendingRemoteRtpParameters("video",d)},n.role&&"auto"!==n.role&&(this._forcedLocalDtlsRole="server"===n.role?"client":"server"),this._pc=new RTCPeerConnection({iceServers:i||[],iceTransportPolicy:s||"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require",sdpSemantics:"unified-plan",...a},c),this._pc.addEventListener("iceconnectionstatechange",(()=>{switch(this._pc.iceConnectionState){case"checking":this.emit("@connectionstatechange","connecting");break;case"connected":case"completed":this.emit("@connectionstatechange","connected");break;case"failed":this.emit("@connectionstatechange","failed");break;case"disconnected":this.emit("@connectionstatechange","disconnected");break;case"closed":this.emit("@connectionstatechange","closed")}}))}async updateIceServers(e){logger$8.debug("updateIceServers()");const t=this._pc.getConfiguration();t.iceServers=e,this._pc.setConfiguration(t)}async restartIce(e){if(logger$8.debug("restartIce()"),this._remoteSdp.updateIceParameters(e),this._transportReady)if("send"===this._direction){const e=await this._pc.createOffer({iceRestart:!0});logger$8.debug("restartIce() | calling pc.setLocalDescription() [offer:%o]",e),await this._pc.setLocalDescription(e);const t={type:"answer",sdp:this._remoteSdp.getSdp()};logger$8.debug("restartIce() | calling pc.setRemoteDescription() [answer:%o]",t),await this._pc.setRemoteDescription(t)}else{const e={type:"offer",sdp:this._remoteSdp.getSdp()};logger$8.debug("restartIce() | calling pc.setRemoteDescription() [offer:%o]",e),await this._pc.setRemoteDescription(e);const t=await this._pc.createAnswer();logger$8.debug("restartIce() | calling pc.setLocalDescription() [answer:%o]",t),await this._pc.setLocalDescription(t)}}async getTransportStats(){return this._pc.getStats()}async send({track:e,encodings:t,codecOptions:r,codec:n}){var o;this._assertSendDirection(),logger$8.debug("send() [kind:%s, track.id:%s]",e.kind,e.id);const i=utils$9.clone(this._sendingRtpParametersByKind[e.kind],{});i.codecs=ortc$8.reduceCodecs(i.codecs,n);const s=utils$9.clone(this._sendingRemoteRtpParametersByKind[e.kind],{});s.codecs=ortc$8.reduceCodecs(s.codecs,n);const a=this._remoteSdp.getNextMediaSectionIdx(),c=this._pc.addTransceiver(e,{direction:"sendonly",streams:[this._sendStream]});let d,l=await this._pc.createOffer(),p=sdpTransform$6.parse(l.sdp);this._transportReady||await this._setupTransport({localDtlsRole:null!==(o=this._forcedLocalDtlsRole)&&void 0!==o?o:"client",localSdpObject:p}),t&&t.length>1&&(logger$8.debug("send() | enabling legacy simulcast"),p=sdpTransform$6.parse(l.sdp),d=p.media[a.idx],sdpUnifiedPlanUtils$2.addLegacySimulcast({offerMediaObject:d,numStreams:t.length}),l={type:"offer",sdp:sdpTransform$6.write(p)});let u=!1;const f=(0,scalabilityModes_1.parse)((t||[{}])[0].scalabilityMode);if(t&&1===t.length&&f.spatialLayers>1&&"video/vp9"===i.codecs[0].mimeType.toLowerCase()&&(logger$8.debug("send() | enabling legacy simulcast for VP9 SVC"),u=!0,p=sdpTransform$6.parse(l.sdp),d=p.media[a.idx],sdpUnifiedPlanUtils$2.addLegacySimulcast({offerMediaObject:d,numStreams:f.spatialLayers}),l={type:"offer",sdp:sdpTransform$6.write(p)}),logger$8.debug("send() | calling pc.setLocalDescription() [offer:%o]",l),await this._pc.setLocalDescription(l),t){logger$8.debug("send() | applying given encodings");const e=c.sender.getParameters();for(let r=0;r<(e.encodings||[]).length;++r){const n=e.encodings[r],o=t[r];if(!o)break;e.encodings[r]=Object.assign(n,o)}await c.sender.setParameters(e)}const m=c.mid;if(i.mid=m,p=sdpTransform$6.parse(this._pc.localDescription.sdp),d=p.media[a.idx],i.rtcp.cname=sdpCommonUtils$6.getCname({offerMediaObject:d}),i.encodings=sdpUnifiedPlanUtils$2.getRtpEncodings({offerMediaObject:d}),t)for(let e=0;e<i.encodings.length;++e)t[e]&&Object.assign(i.encodings[e],t[e]);if(u&&(i.encodings=[i.encodings[0]]),i.encodings.length>1&&("video/vp8"===i.codecs[0].mimeType.toLowerCase()||"video/h264"===i.codecs[0].mimeType.toLowerCase()))for(const e of i.encodings)e.scalabilityMode="S1T3";this._remoteSdp.send({offerMediaObject:d,reuseMid:a.reuseMid,offerRtpParameters:i,answerRtpParameters:s,codecOptions:r});const h={type:"answer",sdp:this._remoteSdp.getSdp()};return logger$8.debug("send() | calling pc.setRemoteDescription() [answer:%o]",h),await this._pc.setRemoteDescription(h),this._mapMidTransceiver.set(m,c),{localId:m,rtpParameters:i,rtpSender:c.sender}}async stopSending(e){this._assertSendDirection(),logger$8.debug("stopSending() [localId:%s]",e);const t=this._mapMidTransceiver.get(e);if(!t)throw new Error("associated RTCRtpTransceiver not found");t.sender.replaceTrack(null),this._pc.removeTrack(t.sender),this._remoteSdp.closeMediaSection(t.mid);const r=await this._pc.createOffer();logger$8.debug("stopSending() | calling pc.setLocalDescription() [offer:%o]",r),await this._pc.setLocalDescription(r);const n={type:"answer",sdp:this._remoteSdp.getSdp()};logger$8.debug("stopSending() | calling pc.setRemoteDescription() [answer:%o]",n),await this._pc.setRemoteDescription(n),this._mapMidTransceiver.delete(e)}async replaceTrack(e,t){this._assertSendDirection(),t?logger$8.debug("replaceTrack() [localId:%s, track.id:%s]",e,t.id):logger$8.debug("replaceTrack() [localId:%s, no track]",e);const r=this._mapMidTransceiver.get(e);if(!r)throw new Error("associated RTCRtpTransceiver not found");await r.sender.replaceTrack(t)}async setMaxSpatialLayer(e,t){this._assertSendDirection(),logger$8.debug("setMaxSpatialLayer() [localId:%s, spatialLayer:%s]",e,t);const r=this._mapMidTransceiver.get(e);if(!r)throw new Error("associated RTCRtpTransceiver not found");const n=r.sender.getParameters();n.encodings.forEach(((e,r)=>{e.active=r<=t})),await r.sender.setParameters(n)}async setRtpEncodingParameters(e,t){this._assertSendDirection(),logger$8.debug("setRtpEncodingParameters() [localId:%s, params:%o]",e,t);const r=this._mapMidTransceiver.get(e);if(!r)throw new Error("associated RTCRtpTransceiver not found");const n=r.sender.getParameters();n.encodings.forEach(((e,r)=>{n.encodings[r]={...e,...t}})),await r.sender.setParameters(n)}async getSenderStats(e){this._assertSendDirection();const t=this._mapMidTransceiver.get(e);if(!t)throw new Error("associated RTCRtpTransceiver not found");return t.sender.getStats()}async sendDataChannel({ordered:e,maxPacketLifeTime:t,maxRetransmits:r,label:n,protocol:o}){var i;this._assertSendDirection();const s={negotiated:!0,id:this._nextSendSctpStreamId,ordered:e,maxPacketLifeTime:t,maxRetransmitTime:t,maxRetransmits:r,protocol:o};logger$8.debug("sendDataChannel() [options:%o]",s);const a=this._pc.createDataChannel(n,s);if(this._nextSendSctpStreamId=++this._nextSendSctpStreamId%SCTP_NUM_STREAMS$6.MIS,!this._hasDataChannelMediaSection){const e=await this._pc.createOffer(),t=sdpTransform$6.parse(e.sdp),r=t.media.find((e=>"application"===e.type));this._transportReady||await this._setupTransport({localDtlsRole:null!==(i=this._forcedLocalDtlsRole)&&void 0!==i?i:"client",localSdpObject:t}),logger$8.debug("sendDataChannel() | calling pc.setLocalDescription() [offer:%o]",e),await this._pc.setLocalDescription(e),this._remoteSdp.sendSctpAssociation({offerMediaObject:r});const n={type:"answer",sdp:this._remoteSdp.getSdp()};logger$8.debug("sendDataChannel() | calling pc.setRemoteDescription() [answer:%o]",n),await this._pc.setRemoteDescription(n),this._hasDataChannelMediaSection=!0}return{dataChannel:a,sctpStreamParameters:{streamId:s.id,ordered:s.ordered,maxPacketLifeTime:s.maxPacketLifeTime,maxRetransmits:s.maxRetransmits}}}async receive({trackId:e,kind:t,rtpParameters:r}){var n;this._assertRecvDirection(),logger$8.debug("receive() [trackId:%s, kind:%s]",e,t);const o=r.mid||String(this._mapMidTransceiver.size);this._remoteSdp.receive({mid:o,kind:t,offerRtpParameters:r,streamId:r.rtcp.cname,trackId:e});const i={type:"offer",sdp:this._remoteSdp.getSdp()};logger$8.debug("receive() | calling pc.setRemoteDescription() [offer:%o]",i),await this._pc.setRemoteDescription(i);let s=await this._pc.createAnswer();const a=sdpTransform$6.parse(s.sdp),c=a.media.find((e=>String(e.mid)===o));sdpCommonUtils$6.applyCodecParameters({offerRtpParameters:r,answerMediaObject:c}),s={type:"answer",sdp:sdpTransform$6.write(a)},this._transportReady||await this._setupTransport({localDtlsRole:null!==(n=this._forcedLocalDtlsRole)&&void 0!==n?n:"client",localSdpObject:a}),logger$8.debug("receive() | calling pc.setLocalDescription() [answer:%o]",s),await this._pc.setLocalDescription(s);const d=this._pc.getTransceivers().find((e=>e.mid===o));if(!d)throw new Error("new RTCRtpTransceiver not found");return this._mapMidTransceiver.set(o,d),{localId:o,track:d.receiver.track,rtpReceiver:d.receiver}}async stopReceiving(e){this._assertRecvDirection(),logger$8.debug("stopReceiving() [localId:%s]",e);const t=this._mapMidTransceiver.get(e);if(!t)throw new Error("associated RTCRtpTransceiver not found");this._remoteSdp.closeMediaSection(t.mid);const r={type:"offer",sdp:this._remoteSdp.getSdp()};logger$8.debug("stopReceiving() | calling pc.setRemoteDescription() [offer:%o]",r),await this._pc.setRemoteDescription(r);const n=await this._pc.createAnswer();logger$8.debug("stopReceiving() | calling pc.setLocalDescription() [answer:%o]",n),await this._pc.setLocalDescription(n),this._mapMidTransceiver.delete(e)}async pauseReceiving(e){}async resumeReceiving(e){}async getReceiverStats(e){this._assertRecvDirection();const t=this._mapMidTransceiver.get(e);if(!t)throw new Error("associated RTCRtpTransceiver not found");return t.receiver.getStats()}async receiveDataChannel({sctpStreamParameters:e,label:t,protocol:r}){var n;this._assertRecvDirection();const{streamId:o,ordered:i,maxPacketLifeTime:s,maxRetransmits:a}=e,c={negotiated:!0,id:o,ordered:i,maxPacketLifeTime:s,maxRetransmitTime:s,maxRetransmits:a,protocol:r};logger$8.debug("receiveDataChannel() [options:%o]",c);const d=this._pc.createDataChannel(t,c);if(!this._hasDataChannelMediaSection){this._remoteSdp.receiveSctpAssociation();const e={type:"offer",sdp:this._remoteSdp.getSdp()};logger$8.debug("receiveDataChannel() | calling pc.setRemoteDescription() [offer:%o]",e),await this._pc.setRemoteDescription(e);const t=await this._pc.createAnswer();if(!this._transportReady){const e=sdpTransform$6.parse(t.sdp);await this._setupTransport({localDtlsRole:null!==(n=this._forcedLocalDtlsRole)&&void 0!==n?n:"client",localSdpObject:e})}logger$8.debug("receiveDataChannel() | calling pc.setRemoteDescription() [answer:%o]",t),await this._pc.setLocalDescription(t),this._hasDataChannelMediaSection=!0}return{dataChannel:d}}async _setupTransport({localDtlsRole:e,localSdpObject:t}){t||(t=sdpTransform$6.parse(this._pc.localDescription.sdp));const r=sdpCommonUtils$6.extractDtlsParameters({sdpObject:t});r.role=e,this._remoteSdp.updateDtlsRole("client"===e?"server":"client"),await this.safeEmitAsPromise("@connect",{dtlsParameters:r}),this._transportReady=!0}_assertSendDirection(){if("send"!==this._direction)throw new Error('method can just be called for handlers with "send" direction')}_assertRecvDirection(){if("recv"!==this._direction)throw new Error('method can just be called for handlers with "recv" direction')}}Chrome70$1.Chrome70=Chrome70;var Chrome67$1={},planBUtils={};function getRtpEncodings({offerMediaObject:e,track:t}){const r=new Set;for(const n of e.ssrcs||[]){if("msid"!==n.attribute)continue;if(n.value.split(" ")[1]===t.id){const e=n.id;r.add(e)}}if(0===r.size)throw new Error(`a=ssrc line with msid information not found [track.id:${t.id}]`);const n=new Map;for(const t of e.ssrcGroups||[]){if("FID"!==t.semantics)continue;let[e,o]=t.ssrcs.split(/\s+/);e=Number(e),o=Number(o),r.has(e)&&(r.delete(e),r.delete(o),n.set(e,o))}for(const e of r)n.set(e,null);const o=[];for(const[e,t]of n){const r={ssrc:e};t&&(r.rtx={ssrc:t}),o.push(r)}return o}function addLegacySimulcast({offerMediaObject:e,track:t,numStreams:r}){if(r<=1)throw new TypeError("numStreams must be greater than 1");let n,o,i;if(!(e.ssrcs||[]).find((e=>{if("msid"!==e.attribute)return!1;return e.value.split(" ")[1]===t.id&&(n=e.id,i=e.value.split(" ")[0],!0)})))throw new Error(`a=ssrc line with msid information not found [track.id:${t.id}]`);(e.ssrcGroups||[]).some((e=>{if("FID"!==e.semantics)return!1;const t=e.ssrcs.split(/\s+/);return Number(t[0])===n&&(o=Number(t[1]),!0)}));const s=e.ssrcs.find((e=>"cname"===e.attribute&&e.id===n));if(!s)throw new Error(`a=ssrc line with cname information not found [track.id:${t.id}]`);const a=s.value,c=[],d=[];for(let e=0;e<r;++e)c.push(n+e),o&&d.push(o+e);e.ssrcGroups=e.ssrcGroups||[],e.ssrcs=e.ssrcs||[],e.ssrcGroups.push({semantics:"SIM",ssrcs:c.join(" ")});for(let r=0;r<c.length;++r){const n=c[r];e.ssrcs.push({id:n,attribute:"cname",value:a}),e.ssrcs.push({id:n,attribute:"msid",value:`${i} ${t.id}`})}for(let r=0;r<d.length;++r){const n=c[r],o=d[r];e.ssrcs.push({id:o,attribute:"cname",value:a}),e.ssrcs.push({id:o,attribute:"msid",value:`${i} ${t.id}`}),e.ssrcGroups.push({semantics:"FID",ssrcs:`${n} ${o}`})}}Object.defineProperty(planBUtils,"__esModule",{value:!0}),planBUtils.addLegacySimulcast=planBUtils.getRtpEncodings=void 0,planBUtils.getRtpEncodings=getRtpEncodings,planBUtils.addLegacySimulcast=addLegacySimulcast;var __createBinding$8=commonjsGlobal&&commonjsGlobal.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r),Object.defineProperty(e,n,{enumerable:!0,get:function(){return t[r]}})}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),__setModuleDefault$8=commonjsGlobal&&commonjsGlobal.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),__importStar$8=commonjsGlobal&&commonjsGlobal.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)"default"!==r&&Object.prototype.hasOwnProperty.call(e,r)&&__createBinding$8(t,e,r);return __setModuleDefault$8(t,e),t};Object.defineProperty(Chrome67$1,"__esModule",{value:!0}),Chrome67$1.Chrome67=void 0;const sdpTransform$5=__importStar$8(lib),Logger_1$7=Logger$1,utils$8=__importStar$8(utils$e),ortc$7=__importStar$8(ortc$b),sdpCommonUtils$5=__importStar$8(commonUtils),sdpPlanBUtils$3=__importStar$8(planBUtils),HandlerInterface_1$6=HandlerInterface$1,RemoteSdp_1$5=RemoteSdp$1,logger$7=new Logger_1$7.Logger("Chrome67"),SCTP_NUM_STREAMS$5={OS:1024,MIS:1024};class Chrome67 extends HandlerInterface_1$6.HandlerInterface{constructor(){super(),this._sendStream=new MediaStream,this._mapSendLocalIdRtpSender=new Map,this._nextSendLocalId=0,this._mapRecvLocalIdInfo=new Map,this._hasDataChannelMediaSection=!1,this._nextSendSctpStreamId=0,this._transportReady=!1}static createFactory(){return()=>new Chrome67}get name(){return"Chrome67"}close(){if(logger$7.debug("close()"),this._pc)try{this._pc.close()}catch(e){}}async getNativeRtpCapabilities(){logger$7.debug("getNativeRtpCapabilities()");const e=new RTCPeerConnection({iceServers:[],iceTransportPolicy:"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require",sdpSemantics:"plan-b"});try{const t=await e.createOffer({offerToReceiveAudio:!0,offerToReceiveVideo:!0});try{e.close()}catch(e){}const r=sdpTransform$5.parse(t.sdp);return sdpCommonUtils$5.extractRtpCapabilities({sdpObject:r})}catch(t){try{e.close()}catch(e){}throw t}}async getNativeSctpCapabilities(){return logger$7.debug("getNativeSctpCapabilities()"),{numStreams:SCTP_NUM_STREAMS$5}}run({direction:e,iceParameters:t,iceCandidates:r,dtlsParameters:n,sctpParameters:o,iceServers:i,iceTransportPolicy:s,additionalSettings:a,proprietaryConstraints:c,extendedRtpCapabilities:d}){logger$7.debug("run()"),this._direction=e,this._remoteSdp=new RemoteSdp_1$5.RemoteSdp({iceParameters:t,iceCandidates:r,dtlsParameters:n,sctpParameters:o,planB:!0}),this._sendingRtpParametersByKind={audio:ortc$7.getSendingRtpParameters("audio",d),video:ortc$7.getSendingRtpParameters("video",d)},this._sendingRemoteRtpParametersByKind={audio:ortc$7.getSendingRemoteRtpParameters("audio",d),video:ortc$7.getSendingRemoteRtpParameters("video",d)},n.role&&"auto"!==n.role&&(this._forcedLocalDtlsRole="server"===n.role?"client":"server"),this._pc=new RTCPeerConnection({iceServers:i||[],iceTransportPolicy:s||"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require",sdpSemantics:"plan-b",...a},c),this._pc.addEventListener("iceconnectionstatechange",(()=>{switch(this._pc.iceConnectionState){case"checking":this.emit("@connectionstatechange","connecting");break;case"connected":case"completed":this.emit("@connectionstatechange","connected");break;case"failed":this.emit("@connectionstatechange","failed");break;case"disconnected":this.emit("@connectionstatechange","disconnected");break;case"closed":this.emit("@connectionstatechange","closed")}}))}async updateIceServers(e){logger$7.debug("updateIceServers()");const t=this._pc.getConfiguration();t.iceServers=e,this._pc.setConfiguration(t)}async restartIce(e){if(logger$7.debug("restartIce()"),this._remoteSdp.updateIceParameters(e),this._transportReady)if("send"===this._direction){const e=await this._pc.createOffer({iceRestart:!0});logger$7.debug("restartIce() | calling pc.setLocalDescription() [offer:%o]",e),await this._pc.setLocalDescription(e);const t={type:"answer",sdp:this._remoteSdp.getSdp()};logger$7.debug("restartIce() | calling pc.setRemoteDescription() [answer:%o]",t),await this._pc.setRemoteDescription(t)}else{const e={type:"offer",sdp:this._remoteSdp.getSdp()};logger$7.debug("restartIce() | calling pc.setRemoteDescription() [offer:%o]",e),await this._pc.setRemoteDescription(e);const t=await this._pc.createAnswer();logger$7.debug("restartIce() | calling pc.setLocalDescription() [answer:%o]",t),await this._pc.setLocalDescription(t)}}async getTransportStats(){return this._pc.getStats()}async send({track:e,encodings:t,codecOptions:r,codec:n}){var o;this._assertSendDirection(),logger$7.debug("send() [kind:%s, track.id:%s]",e.kind,e.id),n&&logger$7.warn("send() | codec selection is not available in %s handler",this.name),this._sendStream.addTrack(e),this._pc.addTrack(e,this._sendStream);let i,s=await this._pc.createOffer(),a=sdpTransform$5.parse(s.sdp);const c=utils$8.clone(this._sendingRtpParametersByKind[e.kind],{});c.codecs=ortc$7.reduceCodecs(c.codecs);const d=utils$8.clone(this._sendingRemoteRtpParametersByKind[e.kind],{});if(d.codecs=ortc$7.reduceCodecs(d.codecs),this._transportReady||await this._setupTransport({localDtlsRole:null!==(o=this._forcedLocalDtlsRole)&&void 0!==o?o:"client",localSdpObject:a}),"video"===e.kind&&t&&t.length>1&&(logger$7.debug("send() | enabling simulcast"),a=sdpTransform$5.parse(s.sdp),i=a.media.find((e=>"video"===e.type)),sdpPlanBUtils$3.addLegacySimulcast({offerMediaObject:i,track:e,numStreams:t.length}),s={type:"offer",sdp:sdpTransform$5.write(a)}),logger$7.debug("send() | calling pc.setLocalDescription() [offer:%o]",s),await this._pc.setLocalDescription(s),a=sdpTransform$5.parse(this._pc.localDescription.sdp),i=a.media.find((t=>t.type===e.kind)),c.rtcp.cname=sdpCommonUtils$5.getCname({offerMediaObject:i}),c.encodings=sdpPlanBUtils$3.getRtpEncodings({offerMediaObject:i,track:e}),t)for(let e=0;e<c.encodings.length;++e)t[e]&&Object.assign(c.encodings[e],t[e]);if(c.encodings.length>1&&"video/vp8"===c.codecs[0].mimeType.toLowerCase())for(const e of c.encodings)e.scalabilityMode="S1T3";this._remoteSdp.send({offerMediaObject:i,offerRtpParameters:c,answerRtpParameters:d,codecOptions:r});const l={type:"answer",sdp:this._remoteSdp.getSdp()};logger$7.debug("send() | calling pc.setRemoteDescription() [answer:%o]",l),await this._pc.setRemoteDescription(l);const p=String(this._nextSendLocalId);this._nextSendLocalId++;const u=this._pc.getSenders().find((t=>t.track===e));return this._mapSendLocalIdRtpSender.set(p,u),{localId:p,rtpParameters:c,rtpSender:u}}async stopSending(e){this._assertSendDirection(),logger$7.debug("stopSending() [localId:%s]",e);const t=this._mapSendLocalIdRtpSender.get(e);if(!t)throw new Error("associated RTCRtpSender not found");this._pc.removeTrack(t),t.track&&this._sendStream.removeTrack(t.track),this._mapSendLocalIdRtpSender.delete(e);const r=await this._pc.createOffer();logger$7.debug("stopSending() | calling pc.setLocalDescription() [offer:%o]",r);try{await this._pc.setLocalDescription(r)}catch(e){if(0===this._sendStream.getTracks().length)return void logger$7.warn("stopSending() | ignoring expected error due no sending tracks: %s",e.toString());throw e}if("stable"===this._pc.signalingState)return;const n={type:"answer",sdp:this._remoteSdp.getSdp()};logger$7.debug("stopSending() | calling pc.setRemoteDescription() [answer:%o]",n),await this._pc.setRemoteDescription(n)}async replaceTrack(e,t){this._assertSendDirection(),t?logger$7.debug("replaceTrack() [localId:%s, track.id:%s]",e,t.id):logger$7.debug("replaceTrack() [localId:%s, no track]",e);const r=this._mapSendLocalIdRtpSender.get(e);if(!r)throw new Error("associated RTCRtpSender not found");const n=r.track;await r.replaceTrack(t),n&&this._sendStream.removeTrack(n),t&&this._sendStream.addTrack(t)}async setMaxSpatialLayer(e,t){this._assertSendDirection(),logger$7.debug("setMaxSpatialLayer() [localId:%s, spatialLayer:%s]",e,t);const r=this._mapSendLocalIdRtpSender.get(e);if(!r)throw new Error("associated RTCRtpSender not found");const n=r.getParameters();n.encodings.forEach(((e,r)=>{e.active=r<=t})),await r.setParameters(n)}async setRtpEncodingParameters(e,t){this._assertSendDirection(),logger$7.debug("setRtpEncodingParameters() [localId:%s, params:%o]",e,t);const r=this._mapSendLocalIdRtpSender.get(e);if(!r)throw new Error("associated RTCRtpSender not found");const n=r.getParameters();n.encodings.forEach(((e,r)=>{n.encodings[r]={...e,...t}})),await r.setParameters(n)}async getSenderStats(e){this._assertSendDirection();const t=this._mapSendLocalIdRtpSender.get(e);if(!t)throw new Error("associated RTCRtpSender not found");return t.getStats()}async sendDataChannel({ordered:e,maxPacketLifeTime:t,maxRetransmits:r,label:n,protocol:o}){var i;this._assertSendDirection();const s={negotiated:!0,id:this._nextSendSctpStreamId,ordered:e,maxPacketLifeTime:t,maxRetransmitTime:t,maxRetransmits:r,protocol:o};logger$7.debug("sendDataChannel() [options:%o]",s);const a=this._pc.createDataChannel(n,s);if(this._nextSendSctpStreamId=++this._nextSendSctpStreamId%SCTP_NUM_STREAMS$5.MIS,!this._hasDataChannelMediaSection){const e=await this._pc.createOffer(),t=sdpTransform$5.parse(e.sdp),r=t.media.find((e=>"application"===e.type));this._transportReady||await this._setupTransport({localDtlsRole:null!==(i=this._forcedLocalDtlsRole)&&void 0!==i?i:"client",localSdpObject:t}),logger$7.debug("sendDataChannel() | calling pc.setLocalDescription() [offer:%o]",e),await this._pc.setLocalDescription(e),this._remoteSdp.sendSctpAssociation({offerMediaObject:r});const n={type:"answer",sdp:this._remoteSdp.getSdp()};logger$7.debug("sendDataChannel() | calling pc.setRemoteDescription() [answer:%o]",n),await this._pc.setRemoteDescription(n),this._hasDataChannelMediaSection=!0}return{dataChannel:a,sctpStreamParameters:{streamId:s.id,ordered:s.ordered,maxPacketLifeTime:s.maxPacketLifeTime,maxRetransmits:s.maxRetransmits}}}async receive({trackId:e,kind:t,rtpParameters:r}){var n;this._assertRecvDirection(),logger$7.debug("receive() [trackId:%s, kind:%s]",e,t);const o=e,i=t;this._remoteSdp.receive({mid:i,kind:t,offerRtpParameters:r,streamId:r.rtcp.cname,trackId:e});const s={type:"offer",sdp:this._remoteSdp.getSdp()};logger$7.debug("receive() | calling pc.setRemoteDescription() [offer:%o]",s),await this._pc.setRemoteDescription(s);let a=await this._pc.createAnswer();const c=sdpTransform$5.parse(a.sdp),d=c.media.find((e=>String(e.mid)===i));sdpCommonUtils$5.applyCodecParameters({offerRtpParameters:r,answerMediaObject:d}),a={type:"answer",sdp:sdpTransform$5.write(c)},this._transportReady||await this._setupTransport({localDtlsRole:null!==(n=this._forcedLocalDtlsRole)&&void 0!==n?n:"client",localSdpObject:c}),logger$7.debug("receive() | calling pc.setLocalDescription() [answer:%o]",a),await this._pc.setLocalDescription(a);const l=this._pc.getReceivers().find((e=>e.track&&e.track.id===o));if(!l)throw new Error("new RTCRtpReceiver not");return this._mapRecvLocalIdInfo.set(o,{mid:i,rtpParameters:r,rtpReceiver:l}),{localId:o,track:l.track,rtpReceiver:l}}async stopReceiving(e){this._assertRecvDirection(),logger$7.debug("stopReceiving() [localId:%s]",e);const{mid:t,rtpParameters:r}=this._mapRecvLocalIdInfo.get(e)||{};this._mapRecvLocalIdInfo.delete(e),this._remoteSdp.planBStopReceiving({mid:t,offerRtpParameters:r});const n={type:"offer",sdp:this._remoteSdp.getSdp()};logger$7.debug("stopReceiving() | calling pc.setRemoteDescription() [offer:%o]",n),await this._pc.setRemoteDescription(n);const o=await this._pc.createAnswer();logger$7.debug("stopReceiving() | calling pc.setLocalDescription() [answer:%o]",o),await this._pc.setLocalDescription(o)}async pauseReceiving(e){}async resumeReceiving(e){}async getReceiverStats(e){this._assertRecvDirection();const{rtpReceiver:t}=this._mapRecvLocalIdInfo.get(e)||{};if(!t)throw new Error("associated RTCRtpReceiver not found");return t.getStats()}async receiveDataChannel({sctpStreamParameters:e,label:t,protocol:r}){var n;this._assertRecvDirection();const{streamId:o,ordered:i,maxPacketLifeTime:s,maxRetransmits:a}=e,c={negotiated:!0,id:o,ordered:i,maxPacketLifeTime:s,maxRetransmitTime:s,maxRetransmits:a,protocol:r};logger$7.debug("receiveDataChannel() [options:%o]",c);const d=this._pc.createDataChannel(t,c);if(!this._hasDataChannelMediaSection){this._remoteSdp.receiveSctpAssociation({oldDataChannelSpec:!0});const e={type:"offer",sdp:this._remoteSdp.getSdp()};logger$7.debug("receiveDataChannel() | calling pc.setRemoteDescription() [offer:%o]",e),await this._pc.setRemoteDescription(e);const t=await this._pc.createAnswer();if(!this._transportReady){const e=sdpTransform$5.parse(t.sdp);await this._setupTransport({localDtlsRole:null!==(n=this._forcedLocalDtlsRole)&&void 0!==n?n:"client",localSdpObject:e})}logger$7.debug("receiveDataChannel() | calling pc.setRemoteDescription() [answer:%o]",t),await this._pc.setLocalDescription(t),this._hasDataChannelMediaSection=!0}return{dataChannel:d}}async _setupTransport({localDtlsRole:e,localSdpObject:t}){t||(t=sdpTransform$5.parse(this._pc.localDescription.sdp));const r=sdpCommonUtils$5.extractDtlsParameters({sdpObject:t});r.role=e,this._remoteSdp.updateDtlsRole("client"===e?"server":"client"),await this.safeEmitAsPromise("@connect",{dtlsParameters:r}),this._transportReady=!0}_assertSendDirection(){if("send"!==this._direction)throw new Error('method can just be called for handlers with "send" direction')}_assertRecvDirection(){if("recv"!==this._direction)throw new Error('method can just be called for handlers with "recv" direction')}}Chrome67$1.Chrome67=Chrome67;var Chrome55$1={},__createBinding$7=commonjsGlobal&&commonjsGlobal.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r),Object.defineProperty(e,n,{enumerable:!0,get:function(){return t[r]}})}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),__setModuleDefault$7=commonjsGlobal&&commonjsGlobal.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),__importStar$7=commonjsGlobal&&commonjsGlobal.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)"default"!==r&&Object.prototype.hasOwnProperty.call(e,r)&&__createBinding$7(t,e,r);return __setModuleDefault$7(t,e),t};Object.defineProperty(Chrome55$1,"__esModule",{value:!0}),Chrome55$1.Chrome55=void 0;const sdpTransform$4=__importStar$7(lib),Logger_1$6=Logger$1,errors_1$4=errors,utils$7=__importStar$7(utils$e),ortc$6=__importStar$7(ortc$b),sdpCommonUtils$4=__importStar$7(commonUtils),sdpPlanBUtils$2=__importStar$7(planBUtils),HandlerInterface_1$5=HandlerInterface$1,RemoteSdp_1$4=RemoteSdp$1,logger$6=new Logger_1$6.Logger("Chrome55"),SCTP_NUM_STREAMS$4={OS:1024,MIS:1024};class Chrome55 extends HandlerInterface_1$5.HandlerInterface{constructor(){super(),this._sendStream=new MediaStream,this._mapSendLocalIdTrack=new Map,this._nextSendLocalId=0,this._mapRecvLocalIdInfo=new Map,this._hasDataChannelMediaSection=!1,this._nextSendSctpStreamId=0,this._transportReady=!1}static createFactory(){return()=>new Chrome55}get name(){return"Chrome55"}close(){if(logger$6.debug("close()"),this._pc)try{this._pc.close()}catch(e){}}async getNativeRtpCapabilities(){logger$6.debug("getNativeRtpCapabilities()");const e=new RTCPeerConnection({iceServers:[],iceTransportPolicy:"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require",sdpSemantics:"plan-b"});try{const t=await e.createOffer({offerToReceiveAudio:!0,offerToReceiveVideo:!0});try{e.close()}catch(e){}const r=sdpTransform$4.parse(t.sdp);return sdpCommonUtils$4.extractRtpCapabilities({sdpObject:r})}catch(t){try{e.close()}catch(e){}throw t}}async getNativeSctpCapabilities(){return logger$6.debug("getNativeSctpCapabilities()"),{numStreams:SCTP_NUM_STREAMS$4}}run({direction:e,iceParameters:t,iceCandidates:r,dtlsParameters:n,sctpParameters:o,iceServers:i,iceTransportPolicy:s,additionalSettings:a,proprietaryConstraints:c,extendedRtpCapabilities:d}){logger$6.debug("run()"),this._direction=e,this._remoteSdp=new RemoteSdp_1$4.RemoteSdp({iceParameters:t,iceCandidates:r,dtlsParameters:n,sctpParameters:o,planB:!0}),this._sendingRtpParametersByKind={audio:ortc$6.getSendingRtpParameters("audio",d),video:ortc$6.getSendingRtpParameters("video",d)},this._sendingRemoteRtpParametersByKind={audio:ortc$6.getSendingRemoteRtpParameters("audio",d),video:ortc$6.getSendingRemoteRtpParameters("video",d)},n.role&&"auto"!==n.role&&(this._forcedLocalDtlsRole="server"===n.role?"client":"server"),this._pc=new RTCPeerConnection({iceServers:i||[],iceTransportPolicy:s||"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require",sdpSemantics:"plan-b",...a},c),this._pc.addEventListener("iceconnectionstatechange",(()=>{switch(this._pc.iceConnectionState){case"checking":this.emit("@connectionstatechange","connecting");break;case"connected":case"completed":this.emit("@connectionstatechange","connected");break;case"failed":this.emit("@connectionstatechange","failed");break;case"disconnected":this.emit("@connectionstatechange","disconnected");break;case"closed":this.emit("@connectionstatechange","closed")}}))}async updateIceServers(e){logger$6.debug("updateIceServers()");const t=this._pc.getConfiguration();t.iceServers=e,this._pc.setConfiguration(t)}async restartIce(e){if(logger$6.debug("restartIce()"),this._remoteSdp.updateIceParameters(e),this._transportReady)if("send"===this._direction){const e=await this._pc.createOffer({iceRestart:!0});logger$6.debug("restartIce() | calling pc.setLocalDescription() [offer:%o]",e),await this._pc.setLocalDescription(e);const t={type:"answer",sdp:this._remoteSdp.getSdp()};logger$6.debug("restartIce() | calling pc.setRemoteDescription() [answer:%o]",t),await this._pc.setRemoteDescription(t)}else{const e={type:"offer",sdp:this._remoteSdp.getSdp()};logger$6.debug("restartIce() | calling pc.setRemoteDescription() [offer:%o]",e),await this._pc.setRemoteDescription(e);const t=await this._pc.createAnswer();logger$6.debug("restartIce() | calling pc.setLocalDescription() [answer:%o]",t),await this._pc.setLocalDescription(t)}}async getTransportStats(){return this._pc.getStats()}async send({track:e,encodings:t,codecOptions:r,codec:n}){var o;this._assertSendDirection(),logger$6.debug("send() [kind:%s, track.id:%s]",e.kind,e.id),n&&logger$6.warn("send() | codec selection is not available in %s handler",this.name),this._sendStream.addTrack(e),this._pc.addStream(this._sendStream);let i,s=await this._pc.createOffer(),a=sdpTransform$4.parse(s.sdp);const c=utils$7.clone(this._sendingRtpParametersByKind[e.kind],{});c.codecs=ortc$6.reduceCodecs(c.codecs);const d=utils$7.clone(this._sendingRemoteRtpParametersByKind[e.kind],{});if(d.codecs=ortc$6.reduceCodecs(d.codecs),this._transportReady||await this._setupTransport({localDtlsRole:null!==(o=this._forcedLocalDtlsRole)&&void 0!==o?o:"client",localSdpObject:a}),"video"===e.kind&&t&&t.length>1&&(logger$6.debug("send() | enabling simulcast"),a=sdpTransform$4.parse(s.sdp),i=a.media.find((e=>"video"===e.type)),sdpPlanBUtils$2.addLegacySimulcast({offerMediaObject:i,track:e,numStreams:t.length}),s={type:"offer",sdp:sdpTransform$4.write(a)}),logger$6.debug("send() | calling pc.setLocalDescription() [offer:%o]",s),await this._pc.setLocalDescription(s),a=sdpTransform$4.parse(this._pc.localDescription.sdp),i=a.media.find((t=>t.type===e.kind)),c.rtcp.cname=sdpCommonUtils$4.getCname({offerMediaObject:i}),c.encodings=sdpPlanBUtils$2.getRtpEncodings({offerMediaObject:i,track:e}),t)for(let e=0;e<c.encodings.length;++e)t[e]&&Object.assign(c.encodings[e],t[e]);if(c.encodings.length>1&&"video/vp8"===c.codecs[0].mimeType.toLowerCase())for(const e of c.encodings)e.scalabilityMode="S1T3";this._remoteSdp.send({offerMediaObject:i,offerRtpParameters:c,answerRtpParameters:d,codecOptions:r});const l={type:"answer",sdp:this._remoteSdp.getSdp()};logger$6.debug("send() | calling pc.setRemoteDescription() [answer:%o]",l),await this._pc.setRemoteDescription(l);const p=String(this._nextSendLocalId);return this._nextSendLocalId++,this._mapSendLocalIdTrack.set(p,e),{localId:p,rtpParameters:c}}async stopSending(e){this._assertSendDirection(),logger$6.debug("stopSending() [localId:%s]",e);const t=this._mapSendLocalIdTrack.get(e);if(!t)throw new Error("track not found");this._mapSendLocalIdTrack.delete(e),this._sendStream.removeTrack(t),this._pc.addStream(this._sendStream);const r=await this._pc.createOffer();logger$6.debug("stopSending() | calling pc.setLocalDescription() [offer:%o]",r);try{await this._pc.setLocalDescription(r)}catch(e){if(0===this._sendStream.getTracks().length)return void logger$6.warn("stopSending() | ignoring expected error due no sending tracks: %s",e.toString());throw e}if("stable"===this._pc.signalingState)return;const n={type:"answer",sdp:this._remoteSdp.getSdp()};logger$6.debug("stopSending() | calling pc.setRemoteDescription() [answer:%o]",n),await this._pc.setRemoteDescription(n)}async replaceTrack(e,t){throw new errors_1$4.UnsupportedError("not implemented")}async setMaxSpatialLayer(e,t){throw new errors_1$4.UnsupportedError(" not implemented")}async setRtpEncodingParameters(e,t){throw new errors_1$4.UnsupportedError("not supported")}async getSenderStats(e){throw new errors_1$4.UnsupportedError("not implemented")}async sendDataChannel({ordered:e,maxPacketLifeTime:t,maxRetransmits:r,label:n,protocol:o}){var i;this._assertSendDirection();const s={negotiated:!0,id:this._nextSendSctpStreamId,ordered:e,maxPacketLifeTime:t,maxRetransmitTime:t,maxRetransmits:r,protocol:o};logger$6.debug("sendDataChannel() [options:%o]",s);const a=this._pc.createDataChannel(n,s);if(this._nextSendSctpStreamId=++this._nextSendSctpStreamId%SCTP_NUM_STREAMS$4.MIS,!this._hasDataChannelMediaSection){const e=await this._pc.createOffer(),t=sdpTransform$4.parse(e.sdp),r=t.media.find((e=>"application"===e.type));this._transportReady||await this._setupTransport({localDtlsRole:null!==(i=this._forcedLocalDtlsRole)&&void 0!==i?i:"client",localSdpObject:t}),logger$6.debug("sendDataChannel() | calling pc.setLocalDescription() [offer:%o]",e),await this._pc.setLocalDescription(e),this._remoteSdp.sendSctpAssociation({offerMediaObject:r});const n={type:"answer",sdp:this._remoteSdp.getSdp()};logger$6.debug("sendDataChannel() | calling pc.setRemoteDescription() [answer:%o]",n),await this._pc.setRemoteDescription(n),this._hasDataChannelMediaSection=!0}return{dataChannel:a,sctpStreamParameters:{streamId:s.id,ordered:s.ordered,maxPacketLifeTime:s.maxPacketLifeTime,maxRetransmits:s.maxRetransmits}}}async receive({trackId:e,kind:t,rtpParameters:r}){var n;this._assertRecvDirection(),logger$6.debug("receive() [trackId:%s, kind:%s]",e,t);const o=e,i=t,s=r.rtcp.cname;this._remoteSdp.receive({mid:i,kind:t,offerRtpParameters:r,streamId:s,trackId:e});const a={type:"offer",sdp:this._remoteSdp.getSdp()};logger$6.debug("receive() | calling pc.setRemoteDescription() [offer:%o]",a),await this._pc.setRemoteDescription(a);let c=await this._pc.createAnswer();const d=sdpTransform$4.parse(c.sdp),l=d.media.find((e=>String(e.mid)===i));sdpCommonUtils$4.applyCodecParameters({offerRtpParameters:r,answerMediaObject:l}),c={type:"answer",sdp:sdpTransform$4.write(d)},this._transportReady||await this._setupTransport({localDtlsRole:null!==(n=this._forcedLocalDtlsRole)&&void 0!==n?n:"client",localSdpObject:d}),logger$6.debug("receive() | calling pc.setLocalDescription() [answer:%o]",c),await this._pc.setLocalDescription(c);const p=this._pc.getRemoteStreams().find((e=>e.id===s)),u=p.getTrackById(o);if(!u)throw new Error("remote track not found");return this._mapRecvLocalIdInfo.set(o,{mid:i,rtpParameters:r}),{localId:o,track:u}}async stopReceiving(e){this._assertRecvDirection(),logger$6.debug("stopReceiving() [localId:%s]",e);const{mid:t,rtpParameters:r}=this._mapRecvLocalIdInfo.get(e)||{};this._mapRecvLocalIdInfo.delete(e),this._remoteSdp.planBStopReceiving({mid:t,offerRtpParameters:r});const n={type:"offer",sdp:this._remoteSdp.getSdp()};logger$6.debug("stopReceiving() | calling pc.setRemoteDescription() [offer:%o]",n),await this._pc.setRemoteDescription(n);const o=await this._pc.createAnswer();logger$6.debug("stopReceiving() | calling pc.setLocalDescription() [answer:%o]",o),await this._pc.setLocalDescription(o)}async pauseReceiving(e){}async resumeReceiving(e){}async getReceiverStats(e){throw new errors_1$4.UnsupportedError("not implemented")}async receiveDataChannel({sctpStreamParameters:e,label:t,protocol:r}){var n;this._assertRecvDirection();const{streamId:o,ordered:i,maxPacketLifeTime:s,maxRetransmits:a}=e,c={negotiated:!0,id:o,ordered:i,maxPacketLifeTime:s,maxRetransmitTime:s,maxRetransmits:a,protocol:r};logger$6.debug("receiveDataChannel() [options:%o]",c);const d=this._pc.createDataChannel(t,c);if(!this._hasDataChannelMediaSection){this._remoteSdp.receiveSctpAssociation({oldDataChannelSpec:!0});const e={type:"offer",sdp:this._remoteSdp.getSdp()};logger$6.debug("receiveDataChannel() | calling pc.setRemoteDescription() [offer:%o]",e),await this._pc.setRemoteDescription(e);const t=await this._pc.createAnswer();if(!this._transportReady){const e=sdpTransform$4.parse(t.sdp);await this._setupTransport({localDtlsRole:null!==(n=this._forcedLocalDtlsRole)&&void 0!==n?n:"client",localSdpObject:e})}logger$6.debug("receiveDataChannel() | calling pc.setRemoteDescription() [answer:%o]",t),await this._pc.setLocalDescription(t),this._hasDataChannelMediaSection=!0}return{dataChannel:d}}async _setupTransport({localDtlsRole:e,localSdpObject:t}){t||(t=sdpTransform$4.parse(this._pc.localDescription.sdp));const r=sdpCommonUtils$4.extractDtlsParameters({sdpObject:t});r.role=e,this._remoteSdp.updateDtlsRole("client"===e?"server":"client"),await this.safeEmitAsPromise("@connect",{dtlsParameters:r}),this._transportReady=!0}_assertSendDirection(){if("send"!==this._direction)throw new Error('method can just be called for handlers with "send" direction')}_assertRecvDirection(){if("recv"!==this._direction)throw new Error('method can just be called for handlers with "recv" direction')}}Chrome55$1.Chrome55=Chrome55;var Firefox60$1={},__createBinding$6=commonjsGlobal&&commonjsGlobal.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r),Object.defineProperty(e,n,{enumerable:!0,get:function(){return t[r]}})}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),__setModuleDefault$6=commonjsGlobal&&commonjsGlobal.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),__importStar$6=commonjsGlobal&&commonjsGlobal.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)"default"!==r&&Object.prototype.hasOwnProperty.call(e,r)&&__createBinding$6(t,e,r);return __setModuleDefault$6(t,e),t};Object.defineProperty(Firefox60$1,"__esModule",{value:!0}),Firefox60$1.Firefox60=void 0;const sdpTransform$3=__importStar$6(lib),Logger_1$5=Logger$1,errors_1$3=errors,utils$6=__importStar$6(utils$e),ortc$5=__importStar$6(ortc$b),sdpCommonUtils$3=__importStar$6(commonUtils),sdpUnifiedPlanUtils$1=__importStar$6(unifiedPlanUtils),HandlerInterface_1$4=HandlerInterface$1,RemoteSdp_1$3=RemoteSdp$1,logger$5=new Logger_1$5.Logger("Firefox60"),SCTP_NUM_STREAMS$3={OS:16,MIS:2048};class Firefox60 extends HandlerInterface_1$4.HandlerInterface{constructor(){super(),this._mapMidTransceiver=new Map,this._sendStream=new MediaStream,this._hasDataChannelMediaSection=!1,this._nextSendSctpStreamId=0,this._transportReady=!1}static createFactory(){return()=>new Firefox60}get name(){return"Firefox60"}close(){if(logger$5.debug("close()"),this._pc)try{this._pc.close()}catch(e){}}async getNativeRtpCapabilities(){logger$5.debug("getNativeRtpCapabilities()");const e=new RTCPeerConnection({iceServers:[],iceTransportPolicy:"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require"}),t=document.createElement("canvas");t.getContext("2d");const r=t.captureStream().getVideoTracks()[0];try{e.addTransceiver("audio",{direction:"sendrecv"});const n=e.addTransceiver(r,{direction:"sendrecv"}),o=n.sender.getParameters(),i=[{rid:"r0",maxBitrate:1e5},{rid:"r1",maxBitrate:5e5}];o.encodings=i,await n.sender.setParameters(o);const s=await e.createOffer();try{t.remove()}catch(e){}try{r.stop()}catch(e){}try{e.close()}catch(e){}const a=sdpTransform$3.parse(s.sdp);return sdpCommonUtils$3.extractRtpCapabilities({sdpObject:a})}catch(n){try{t.remove()}catch(e){}try{r.stop()}catch(e){}try{e.close()}catch(e){}throw n}}async getNativeSctpCapabilities(){return logger$5.debug("getNativeSctpCapabilities()"),{numStreams:SCTP_NUM_STREAMS$3}}run({direction:e,iceParameters:t,iceCandidates:r,dtlsParameters:n,sctpParameters:o,iceServers:i,iceTransportPolicy:s,additionalSettings:a,proprietaryConstraints:c,extendedRtpCapabilities:d}){logger$5.debug("run()"),this._direction=e,this._remoteSdp=new RemoteSdp_1$3.RemoteSdp({iceParameters:t,iceCandidates:r,dtlsParameters:n,sctpParameters:o}),this._sendingRtpParametersByKind={audio:ortc$5.getSendingRtpParameters("audio",d),video:ortc$5.getSendingRtpParameters("video",d)},this._sendingRemoteRtpParametersByKind={audio:ortc$5.getSendingRemoteRtpParameters("audio",d),video:ortc$5.getSendingRemoteRtpParameters("video",d)},this._pc=new RTCPeerConnection({iceServers:i||[],iceTransportPolicy:s||"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require",...a},c),this._pc.addEventListener("iceconnectionstatechange",(()=>{switch(this._pc.iceConnectionState){case"checking":this.emit("@connectionstatechange","connecting");break;case"connected":case"completed":this.emit("@connectionstatechange","connected");break;case"failed":this.emit("@connectionstatechange","failed");break;case"disconnected":this.emit("@connectionstatechange","disconnected");break;case"closed":this.emit("@connectionstatechange","closed")}}))}async updateIceServers(e){throw new errors_1$3.UnsupportedError("not supported")}async restartIce(e){if(logger$5.debug("restartIce()"),this._remoteSdp.updateIceParameters(e),this._transportReady)if("send"===this._direction){const e=await this._pc.createOffer({iceRestart:!0});logger$5.debug("restartIce() | calling pc.setLocalDescription() [offer:%o]",e),await this._pc.setLocalDescription(e);const t={type:"answer",sdp:this._remoteSdp.getSdp()};logger$5.debug("restartIce() | calling pc.setRemoteDescription() [answer:%o]",t),await this._pc.setRemoteDescription(t)}else{const e={type:"offer",sdp:this._remoteSdp.getSdp()};logger$5.debug("restartIce() | calling pc.setRemoteDescription() [offer:%o]",e),await this._pc.setRemoteDescription(e);const t=await this._pc.createAnswer();logger$5.debug("restartIce() | calling pc.setLocalDescription() [answer:%o]",t),await this._pc.setLocalDescription(t)}}async getTransportStats(){return this._pc.getStats()}async send({track:e,encodings:t,codecOptions:r,codec:n}){this._assertSendDirection(),logger$5.debug("send() [kind:%s, track.id:%s]",e.kind,e.id),t&&(t=utils$6.clone(t,[])).length>1&&(t.forEach(((e,t)=>{e.rid=`r${t}`})),t.reverse());const o=utils$6.clone(this._sendingRtpParametersByKind[e.kind],{});o.codecs=ortc$5.reduceCodecs(o.codecs,n);const i=utils$6.clone(this._sendingRemoteRtpParametersByKind[e.kind],{});i.codecs=ortc$5.reduceCodecs(i.codecs,n);const s=this._pc.addTransceiver(e,{direction:"sendonly",streams:[this._sendStream]});if(t){const e=s.sender.getParameters();e.encodings=t,await s.sender.setParameters(e)}const a=await this._pc.createOffer();let c=sdpTransform$3.parse(a.sdp);this._transportReady||await this._setupTransport({localDtlsRole:"client",localSdpObject:c}),logger$5.debug("send() | calling pc.setLocalDescription() [offer:%o]",a),await this._pc.setLocalDescription(a);const d=s.mid;o.mid=d,c=sdpTransform$3.parse(this._pc.localDescription.sdp);const l=c.media[c.media.length-1];if(o.rtcp.cname=sdpCommonUtils$3.getCname({offerMediaObject:l}),t)if(1===t.length){const e=sdpUnifiedPlanUtils$1.getRtpEncodings({offerMediaObject:l});Object.assign(e[0],t[0]),o.encodings=e}else o.encodings=t.reverse();else o.encodings=sdpUnifiedPlanUtils$1.getRtpEncodings({offerMediaObject:l});if(o.encodings.length>1&&("video/vp8"===o.codecs[0].mimeType.toLowerCase()||"video/h264"===o.codecs[0].mimeType.toLowerCase()))for(const e of o.encodings)e.scalabilityMode="S1T3";this._remoteSdp.send({offerMediaObject:l,offerRtpParameters:o,answerRtpParameters:i,codecOptions:r,extmapAllowMixed:!0});const p={type:"answer",sdp:this._remoteSdp.getSdp()};return logger$5.debug("send() | calling pc.setRemoteDescription() [answer:%o]",p),await this._pc.setRemoteDescription(p),this._mapMidTransceiver.set(d,s),{localId:d,rtpParameters:o,rtpSender:s.sender}}async stopSending(e){logger$5.debug("stopSending() [localId:%s]",e);const t=this._mapMidTransceiver.get(e);if(!t)throw new Error("associated transceiver not found");t.sender.replaceTrack(null),this._pc.removeTrack(t.sender),this._remoteSdp.disableMediaSection(t.mid);const r=await this._pc.createOffer();logger$5.debug("stopSending() | calling pc.setLocalDescription() [offer:%o]",r),await this._pc.setLocalDescription(r);const n={type:"answer",sdp:this._remoteSdp.getSdp()};logger$5.debug("stopSending() | calling pc.setRemoteDescription() [answer:%o]",n),await this._pc.setRemoteDescription(n),this._mapMidTransceiver.delete(e)}async replaceTrack(e,t){this._assertSendDirection(),t?logger$5.debug("replaceTrack() [localId:%s, track.id:%s]",e,t.id):logger$5.debug("replaceTrack() [localId:%s, no track]",e);const r=this._mapMidTransceiver.get(e);if(!r)throw new Error("associated RTCRtpTransceiver not found");await r.sender.replaceTrack(t)}async setMaxSpatialLayer(e,t){this._assertSendDirection(),logger$5.debug("setMaxSpatialLayer() [localId:%s, spatialLayer:%s]",e,t);const r=this._mapMidTransceiver.get(e);if(!r)throw new Error("associated transceiver not found");const n=r.sender.getParameters();t=n.encodings.length-1-t,n.encodings.forEach(((e,r)=>{e.active=r>=t})),await r.sender.setParameters(n)}async setRtpEncodingParameters(e,t){this._assertSendDirection(),logger$5.debug("setRtpEncodingParameters() [localId:%s, params:%o]",e,t);const r=this._mapMidTransceiver.get(e);if(!r)throw new Error("associated RTCRtpTransceiver not found");const n=r.sender.getParameters();n.encodings.forEach(((e,r)=>{n.encodings[r]={...e,...t}})),await r.sender.setParameters(n)}async getSenderStats(e){this._assertSendDirection();const t=this._mapMidTransceiver.get(e);if(!t)throw new Error("associated RTCRtpTransceiver not found");return t.sender.getStats()}async sendDataChannel({ordered:e,maxPacketLifeTime:t,maxRetransmits:r,label:n,protocol:o}){this._assertSendDirection();const i={negotiated:!0,id:this._nextSendSctpStreamId,ordered:e,maxPacketLifeTime:t,maxRetransmits:r,protocol:o};logger$5.debug("sendDataChannel() [options:%o]",i);const s=this._pc.createDataChannel(n,i);if(this._nextSendSctpStreamId=++this._nextSendSctpStreamId%SCTP_NUM_STREAMS$3.MIS,!this._hasDataChannelMediaSection){const e=await this._pc.createOffer(),t=sdpTransform$3.parse(e.sdp),r=t.media.find((e=>"application"===e.type));this._transportReady||await this._setupTransport({localDtlsRole:"client",localSdpObject:t}),logger$5.debug("sendDataChannel() | calling pc.setLocalDescription() [offer:%o]",e),await this._pc.setLocalDescription(e),this._remoteSdp.sendSctpAssociation({offerMediaObject:r});const n={type:"answer",sdp:this._remoteSdp.getSdp()};logger$5.debug("sendDataChannel() | calling pc.setRemoteDescription() [answer:%o]",n),await this._pc.setRemoteDescription(n),this._hasDataChannelMediaSection=!0}return{dataChannel:s,sctpStreamParameters:{streamId:i.id,ordered:i.ordered,maxPacketLifeTime:i.maxPacketLifeTime,maxRetransmits:i.maxRetransmits}}}async receive({trackId:e,kind:t,rtpParameters:r}){this._assertRecvDirection(),logger$5.debug("receive() [trackId:%s, kind:%s]",e,t);const n=r.mid||String(this._mapMidTransceiver.size);this._remoteSdp.receive({mid:n,kind:t,offerRtpParameters:r,streamId:r.rtcp.cname,trackId:e});const o={type:"offer",sdp:this._remoteSdp.getSdp()};logger$5.debug("receive() | calling pc.setRemoteDescription() [offer:%o]",o),await this._pc.setRemoteDescription(o);let i=await this._pc.createAnswer();const s=sdpTransform$3.parse(i.sdp),a=s.media.find((e=>String(e.mid)===n));sdpCommonUtils$3.applyCodecParameters({offerRtpParameters:r,answerMediaObject:a}),i={type:"answer",sdp:sdpTransform$3.write(s)},this._transportReady||await this._setupTransport({localDtlsRole:"client",localSdpObject:s}),logger$5.debug("receive() | calling pc.setLocalDescription() [answer:%o]",i),await this._pc.setLocalDescription(i);const c=this._pc.getTransceivers().find((e=>e.mid===n));if(!c)throw new Error("new RTCRtpTransceiver not found");return this._mapMidTransceiver.set(n,c),{localId:n,track:c.receiver.track,rtpReceiver:c.receiver}}async stopReceiving(e){this._assertRecvDirection(),logger$5.debug("stopReceiving() [localId:%s]",e);const t=this._mapMidTransceiver.get(e);if(!t)throw new Error("associated RTCRtpTransceiver not found");this._remoteSdp.closeMediaSection(t.mid);const r={type:"offer",sdp:this._remoteSdp.getSdp()};logger$5.debug("stopReceiving() | calling pc.setRemoteDescription() [offer:%o]",r),await this._pc.setRemoteDescription(r);const n=await this._pc.createAnswer();logger$5.debug("stopReceiving() | calling pc.setLocalDescription() [answer:%o]",n),await this._pc.setLocalDescription(n),this._mapMidTransceiver.delete(e)}async pauseReceiving(e){this._assertRecvDirection(),logger$5.debug("pauseReceiving() [localId:%s]",e);const t=this._mapMidTransceiver.get(e);if(!t)throw new Error("associated RTCRtpTransceiver not found");t.direction="inactive";const r={type:"offer",sdp:this._remoteSdp.getSdp()};logger$5.debug("pauseReceiving() | calling pc.setRemoteDescription() [offer:%o]",r),await this._pc.setRemoteDescription(r);const n=await this._pc.createAnswer();logger$5.debug("pauseReceiving() | calling pc.setLocalDescription() [answer:%o]",n),await this._pc.setLocalDescription(n)}async resumeReceiving(e){this._assertRecvDirection(),logger$5.debug("resumeReceiving() [localId:%s]",e);const t=this._mapMidTransceiver.get(e);if(!t)throw new Error("associated RTCRtpTransceiver not found");t.direction="recvonly";const r={type:"offer",sdp:this._remoteSdp.getSdp()};logger$5.debug("resumeReceiving() | calling pc.setRemoteDescription() [offer:%o]",r),await this._pc.setRemoteDescription(r);const n=await this._pc.createAnswer();logger$5.debug("resumeReceiving() | calling pc.setLocalDescription() [answer:%o]",n),await this._pc.setLocalDescription(n)}async getReceiverStats(e){this._assertRecvDirection();const t=this._mapMidTransceiver.get(e);if(!t)throw new Error("associated RTCRtpTransceiver not found");return t.receiver.getStats()}async receiveDataChannel({sctpStreamParameters:e,label:t,protocol:r}){this._assertRecvDirection();const{streamId:n,ordered:o,maxPacketLifeTime:i,maxRetransmits:s}=e,a={negotiated:!0,id:n,ordered:o,maxPacketLifeTime:i,maxRetransmits:s,protocol:r};logger$5.debug("receiveDataChannel() [options:%o]",a);const c=this._pc.createDataChannel(t,a);if(!this._hasDataChannelMediaSection){this._remoteSdp.receiveSctpAssociation();const e={type:"offer",sdp:this._remoteSdp.getSdp()};logger$5.debug("receiveDataChannel() | calling pc.setRemoteDescription() [offer:%o]",e),await this._pc.setRemoteDescription(e);const t=await this._pc.createAnswer();if(!this._transportReady){const e=sdpTransform$3.parse(t.sdp);await this._setupTransport({localDtlsRole:"client",localSdpObject:e})}logger$5.debug("receiveDataChannel() | calling pc.setRemoteDescription() [answer:%o]",t),await this._pc.setLocalDescription(t),this._hasDataChannelMediaSection=!0}return{dataChannel:c}}async _setupTransport({localDtlsRole:e,localSdpObject:t}){t||(t=sdpTransform$3.parse(this._pc.localDescription.sdp));const r=sdpCommonUtils$3.extractDtlsParameters({sdpObject:t});r.role=e,this._remoteSdp.updateDtlsRole("client"===e?"server":"client"),await this.safeEmitAsPromise("@connect",{dtlsParameters:r}),this._transportReady=!0}_assertSendDirection(){if("send"!==this._direction)throw new Error('method can just be called for handlers with "send" direction')}_assertRecvDirection(){if("recv"!==this._direction)throw new Error('method can just be called for handlers with "recv" direction')}}Firefox60$1.Firefox60=Firefox60;var Safari12$1={},__createBinding$5=commonjsGlobal&&commonjsGlobal.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r),Object.defineProperty(e,n,{enumerable:!0,get:function(){return t[r]}})}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),__setModuleDefault$5=commonjsGlobal&&commonjsGlobal.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),__importStar$5=commonjsGlobal&&commonjsGlobal.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)"default"!==r&&Object.prototype.hasOwnProperty.call(e,r)&&__createBinding$5(t,e,r);return __setModuleDefault$5(t,e),t};Object.defineProperty(Safari12$1,"__esModule",{value:!0}),Safari12$1.Safari12=void 0;const sdpTransform$2=__importStar$5(lib),Logger_1$4=Logger$1,utils$5=__importStar$5(utils$e),ortc$4=__importStar$5(ortc$b),sdpCommonUtils$2=__importStar$5(commonUtils),sdpUnifiedPlanUtils=__importStar$5(unifiedPlanUtils),HandlerInterface_1$3=HandlerInterface$1,RemoteSdp_1$2=RemoteSdp$1,logger$4=new Logger_1$4.Logger("Safari12"),SCTP_NUM_STREAMS$2={OS:1024,MIS:1024};class Safari12 extends HandlerInterface_1$3.HandlerInterface{constructor(){super(),this._mapMidTransceiver=new Map,this._sendStream=new MediaStream,this._hasDataChannelMediaSection=!1,this._nextSendSctpStreamId=0,this._transportReady=!1}static createFactory(){return()=>new Safari12}get name(){return"Safari12"}close(){if(logger$4.debug("close()"),this._pc)try{this._pc.close()}catch(e){}}async getNativeRtpCapabilities(){logger$4.debug("getNativeRtpCapabilities()");const e=new RTCPeerConnection({iceServers:[],iceTransportPolicy:"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require"});try{e.addTransceiver("audio"),e.addTransceiver("video");const t=await e.createOffer();try{e.close()}catch(e){}const r=sdpTransform$2.parse(t.sdp);return sdpCommonUtils$2.extractRtpCapabilities({sdpObject:r})}catch(t){try{e.close()}catch(e){}throw t}}async getNativeSctpCapabilities(){return logger$4.debug("getNativeSctpCapabilities()"),{numStreams:SCTP_NUM_STREAMS$2}}run({direction:e,iceParameters:t,iceCandidates:r,dtlsParameters:n,sctpParameters:o,iceServers:i,iceTransportPolicy:s,additionalSettings:a,proprietaryConstraints:c,extendedRtpCapabilities:d}){logger$4.debug("run()"),this._direction=e,this._remoteSdp=new RemoteSdp_1$2.RemoteSdp({iceParameters:t,iceCandidates:r,dtlsParameters:n,sctpParameters:o}),this._sendingRtpParametersByKind={audio:ortc$4.getSendingRtpParameters("audio",d),video:ortc$4.getSendingRtpParameters("video",d)},this._sendingRemoteRtpParametersByKind={audio:ortc$4.getSendingRemoteRtpParameters("audio",d),video:ortc$4.getSendingRemoteRtpParameters("video",d)},n.role&&"auto"!==n.role&&(this._forcedLocalDtlsRole="server"===n.role?"client":"server"),this._pc=new RTCPeerConnection({iceServers:i||[],iceTransportPolicy:s||"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require",...a},c),this._pc.addEventListener("iceconnectionstatechange",(()=>{switch(this._pc.iceConnectionState){case"checking":this.emit("@connectionstatechange","connecting");break;case"connected":case"completed":this.emit("@connectionstatechange","connected");break;case"failed":this.emit("@connectionstatechange","failed");break;case"disconnected":this.emit("@connectionstatechange","disconnected");break;case"closed":this.emit("@connectionstatechange","closed")}}))}async updateIceServers(e){logger$4.debug("updateIceServers()");const t=this._pc.getConfiguration();t.iceServers=e,this._pc.setConfiguration(t)}async restartIce(e){if(logger$4.debug("restartIce()"),this._remoteSdp.updateIceParameters(e),this._transportReady)if("send"===this._direction){const e=await this._pc.createOffer({iceRestart:!0});logger$4.debug("restartIce() | calling pc.setLocalDescription() [offer:%o]",e),await this._pc.setLocalDescription(e);const t={type:"answer",sdp:this._remoteSdp.getSdp()};logger$4.debug("restartIce() | calling pc.setRemoteDescription() [answer:%o]",t),await this._pc.setRemoteDescription(t)}else{const e={type:"offer",sdp:this._remoteSdp.getSdp()};logger$4.debug("restartIce() | calling pc.setRemoteDescription() [offer:%o]",e),await this._pc.setRemoteDescription(e);const t=await this._pc.createAnswer();logger$4.debug("restartIce() | calling pc.setLocalDescription() [answer:%o]",t),await this._pc.setLocalDescription(t)}}async getTransportStats(){return this._pc.getStats()}async send({track:e,encodings:t,codecOptions:r,codec:n}){var o;this._assertSendDirection(),logger$4.debug("send() [kind:%s, track.id:%s]",e.kind,e.id);const i=utils$5.clone(this._sendingRtpParametersByKind[e.kind],{});i.codecs=ortc$4.reduceCodecs(i.codecs,n);const s=utils$5.clone(this._sendingRemoteRtpParametersByKind[e.kind],{});s.codecs=ortc$4.reduceCodecs(s.codecs,n);const a=this._remoteSdp.getNextMediaSectionIdx(),c=this._pc.addTransceiver(e,{direction:"sendonly",streams:[this._sendStream]});let d,l=await this._pc.createOffer(),p=sdpTransform$2.parse(l.sdp);this._transportReady||await this._setupTransport({localDtlsRole:null!==(o=this._forcedLocalDtlsRole)&&void 0!==o?o:"client",localSdpObject:p}),t&&t.length>1&&(logger$4.debug("send() | enabling legacy simulcast"),p=sdpTransform$2.parse(l.sdp),d=p.media[a.idx],sdpUnifiedPlanUtils.addLegacySimulcast({offerMediaObject:d,numStreams:t.length}),l={type:"offer",sdp:sdpTransform$2.write(p)}),logger$4.debug("send() | calling pc.setLocalDescription() [offer:%o]",l),await this._pc.setLocalDescription(l);const u=c.mid;if(i.mid=u,p=sdpTransform$2.parse(this._pc.localDescription.sdp),d=p.media[a.idx],i.rtcp.cname=sdpCommonUtils$2.getCname({offerMediaObject:d}),i.encodings=sdpUnifiedPlanUtils.getRtpEncodings({offerMediaObject:d}),t)for(let e=0;e<i.encodings.length;++e)t[e]&&Object.assign(i.encodings[e],t[e]);if(i.encodings.length>1&&("video/vp8"===i.codecs[0].mimeType.toLowerCase()||"video/h264"===i.codecs[0].mimeType.toLowerCase()))for(const e of i.encodings)e.scalabilityMode="S1T3";this._remoteSdp.send({offerMediaObject:d,reuseMid:a.reuseMid,offerRtpParameters:i,answerRtpParameters:s,codecOptions:r});const f={type:"answer",sdp:this._remoteSdp.getSdp()};return logger$4.debug("send() | calling pc.setRemoteDescription() [answer:%o]",f),await this._pc.setRemoteDescription(f),this._mapMidTransceiver.set(u,c),{localId:u,rtpParameters:i,rtpSender:c.sender}}async stopSending(e){this._assertSendDirection(),logger$4.debug("stopSending() [localId:%s]",e);const t=this._mapMidTransceiver.get(e);if(!t)throw new Error("associated RTCRtpTransceiver not found");t.sender.replaceTrack(null),this._pc.removeTrack(t.sender),this._remoteSdp.closeMediaSection(t.mid);const r=await this._pc.createOffer();logger$4.debug("stopSending() | calling pc.setLocalDescription() [offer:%o]",r),await this._pc.setLocalDescription(r);const n={type:"answer",sdp:this._remoteSdp.getSdp()};logger$4.debug("stopSending() | calling pc.setRemoteDescription() [answer:%o]",n),await this._pc.setRemoteDescription(n),this._mapMidTransceiver.delete(e)}async replaceTrack(e,t){this._assertSendDirection(),t?logger$4.debug("replaceTrack() [localId:%s, track.id:%s]",e,t.id):logger$4.debug("replaceTrack() [localId:%s, no track]",e);const r=this._mapMidTransceiver.get(e);if(!r)throw new Error("associated RTCRtpTransceiver not found");await r.sender.replaceTrack(t)}async setMaxSpatialLayer(e,t){this._assertSendDirection(),logger$4.debug("setMaxSpatialLayer() [localId:%s, spatialLayer:%s]",e,t);const r=this._mapMidTransceiver.get(e);if(!r)throw new Error("associated RTCRtpTransceiver not found");const n=r.sender.getParameters();n.encodings.forEach(((e,r)=>{e.active=r<=t})),await r.sender.setParameters(n)}async setRtpEncodingParameters(e,t){this._assertSendDirection(),logger$4.debug("setRtpEncodingParameters() [localId:%s, params:%o]",e,t);const r=this._mapMidTransceiver.get(e);if(!r)throw new Error("associated RTCRtpTransceiver not found");const n=r.sender.getParameters();n.encodings.forEach(((e,r)=>{n.encodings[r]={...e,...t}})),await r.sender.setParameters(n)}async getSenderStats(e){this._assertSendDirection();const t=this._mapMidTransceiver.get(e);if(!t)throw new Error("associated RTCRtpTransceiver not found");return t.sender.getStats()}async sendDataChannel({ordered:e,maxPacketLifeTime:t,maxRetransmits:r,label:n,protocol:o}){var i;this._assertSendDirection();const s={negotiated:!0,id:this._nextSendSctpStreamId,ordered:e,maxPacketLifeTime:t,maxRetransmits:r,protocol:o};logger$4.debug("sendDataChannel() [options:%o]",s);const a=this._pc.createDataChannel(n,s);if(this._nextSendSctpStreamId=++this._nextSendSctpStreamId%SCTP_NUM_STREAMS$2.MIS,!this._hasDataChannelMediaSection){const e=await this._pc.createOffer(),t=sdpTransform$2.parse(e.sdp),r=t.media.find((e=>"application"===e.type));this._transportReady||await this._setupTransport({localDtlsRole:null!==(i=this._forcedLocalDtlsRole)&&void 0!==i?i:"client",localSdpObject:t}),logger$4.debug("sendDataChannel() | calling pc.setLocalDescription() [offer:%o]",e),await this._pc.setLocalDescription(e),this._remoteSdp.sendSctpAssociation({offerMediaObject:r});const n={type:"answer",sdp:this._remoteSdp.getSdp()};logger$4.debug("sendDataChannel() | calling pc.setRemoteDescription() [answer:%o]",n),await this._pc.setRemoteDescription(n),this._hasDataChannelMediaSection=!0}return{dataChannel:a,sctpStreamParameters:{streamId:s.id,ordered:s.ordered,maxPacketLifeTime:s.maxPacketLifeTime,maxRetransmits:s.maxRetransmits}}}async receive({trackId:e,kind:t,rtpParameters:r}){var n;this._assertRecvDirection(),logger$4.debug("receive() [trackId:%s, kind:%s]",e,t);const o=r.mid||String(this._mapMidTransceiver.size);this._remoteSdp.receive({mid:o,kind:t,offerRtpParameters:r,streamId:r.rtcp.cname,trackId:e});const i={type:"offer",sdp:this._remoteSdp.getSdp()};logger$4.debug("receive() | calling pc.setRemoteDescription() [offer:%o]",i),await this._pc.setRemoteDescription(i);let s=await this._pc.createAnswer();const a=sdpTransform$2.parse(s.sdp),c=a.media.find((e=>String(e.mid)===o));sdpCommonUtils$2.applyCodecParameters({offerRtpParameters:r,answerMediaObject:c}),s={type:"answer",sdp:sdpTransform$2.write(a)},this._transportReady||await this._setupTransport({localDtlsRole:null!==(n=this._forcedLocalDtlsRole)&&void 0!==n?n:"client",localSdpObject:a}),logger$4.debug("receive() | calling pc.setLocalDescription() [answer:%o]",s),await this._pc.setLocalDescription(s);const d=this._pc.getTransceivers().find((e=>e.mid===o));if(!d)throw new Error("new RTCRtpTransceiver not found");return this._mapMidTransceiver.set(o,d),{localId:o,track:d.receiver.track,rtpReceiver:d.receiver}}async stopReceiving(e){this._assertRecvDirection(),logger$4.debug("stopReceiving() [localId:%s]",e);const t=this._mapMidTransceiver.get(e);if(!t)throw new Error("associated RTCRtpTransceiver not found");this._remoteSdp.closeMediaSection(t.mid);const r={type:"offer",sdp:this._remoteSdp.getSdp()};logger$4.debug("stopReceiving() | calling pc.setRemoteDescription() [offer:%o]",r),await this._pc.setRemoteDescription(r);const n=await this._pc.createAnswer();logger$4.debug("stopReceiving() | calling pc.setLocalDescription() [answer:%o]",n),await this._pc.setLocalDescription(n),this._mapMidTransceiver.delete(e)}async pauseReceiving(e){this._assertRecvDirection(),logger$4.debug("pauseReceiving() [localId:%s]",e);const t=this._mapMidTransceiver.get(e);if(!t)throw new Error("associated RTCRtpTransceiver not found");t.direction="inactive";const r={type:"offer",sdp:this._remoteSdp.getSdp()};logger$4.debug("pauseReceiving() | calling pc.setRemoteDescription() [offer:%o]",r),await this._pc.setRemoteDescription(r);const n=await this._pc.createAnswer();logger$4.debug("pauseReceiving() | calling pc.setLocalDescription() [answer:%o]",n),await this._pc.setLocalDescription(n)}async resumeReceiving(e){this._assertRecvDirection(),logger$4.debug("resumeReceiving() [localId:%s]",e);const t=this._mapMidTransceiver.get(e);if(!t)throw new Error("associated RTCRtpTransceiver not found");t.direction="recvonly";const r={type:"offer",sdp:this._remoteSdp.getSdp()};logger$4.debug("resumeReceiving() | calling pc.setRemoteDescription() [offer:%o]",r),await this._pc.setRemoteDescription(r);const n=await this._pc.createAnswer();logger$4.debug("resumeReceiving() | calling pc.setLocalDescription() [answer:%o]",n),await this._pc.setLocalDescription(n)}async getReceiverStats(e){this._assertRecvDirection();const t=this._mapMidTransceiver.get(e);if(!t)throw new Error("associated RTCRtpTransceiver not found");return t.receiver.getStats()}async receiveDataChannel({sctpStreamParameters:e,label:t,protocol:r}){var n;this._assertRecvDirection();const{streamId:o,ordered:i,maxPacketLifeTime:s,maxRetransmits:a}=e,c={negotiated:!0,id:o,ordered:i,maxPacketLifeTime:s,maxRetransmits:a,protocol:r};logger$4.debug("receiveDataChannel() [options:%o]",c);const d=this._pc.createDataChannel(t,c);if(!this._hasDataChannelMediaSection){this._remoteSdp.receiveSctpAssociation();const e={type:"offer",sdp:this._remoteSdp.getSdp()};logger$4.debug("receiveDataChannel() | calling pc.setRemoteDescription() [offer:%o]",e),await this._pc.setRemoteDescription(e);const t=await this._pc.createAnswer();if(!this._transportReady){const e=sdpTransform$2.parse(t.sdp);await this._setupTransport({localDtlsRole:null!==(n=this._forcedLocalDtlsRole)&&void 0!==n?n:"client",localSdpObject:e})}logger$4.debug("receiveDataChannel() | calling pc.setRemoteDescription() [answer:%o]",t),await this._pc.setLocalDescription(t),this._hasDataChannelMediaSection=!0}return{dataChannel:d}}async _setupTransport({localDtlsRole:e,localSdpObject:t}){t||(t=sdpTransform$2.parse(this._pc.localDescription.sdp));const r=sdpCommonUtils$2.extractDtlsParameters({sdpObject:t});r.role=e,this._remoteSdp.updateDtlsRole("client"===e?"server":"client"),await this.safeEmitAsPromise("@connect",{dtlsParameters:r}),this._transportReady=!0}_assertSendDirection(){if("send"!==this._direction)throw new Error('method can just be called for handlers with "send" direction')}_assertRecvDirection(){if("recv"!==this._direction)throw new Error('method can just be called for handlers with "recv" direction')}}Safari12$1.Safari12=Safari12;var Safari11$1={},__createBinding$4=commonjsGlobal&&commonjsGlobal.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r),Object.defineProperty(e,n,{enumerable:!0,get:function(){return t[r]}})}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),__setModuleDefault$4=commonjsGlobal&&commonjsGlobal.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),__importStar$4=commonjsGlobal&&commonjsGlobal.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)"default"!==r&&Object.prototype.hasOwnProperty.call(e,r)&&__createBinding$4(t,e,r);return __setModuleDefault$4(t,e),t};Object.defineProperty(Safari11$1,"__esModule",{value:!0}),Safari11$1.Safari11=void 0;const sdpTransform$1=__importStar$4(lib),Logger_1$3=Logger$1,utils$4=__importStar$4(utils$e),ortc$3=__importStar$4(ortc$b),sdpCommonUtils$1=__importStar$4(commonUtils),sdpPlanBUtils$1=__importStar$4(planBUtils),HandlerInterface_1$2=HandlerInterface$1,RemoteSdp_1$1=RemoteSdp$1,logger$3=new Logger_1$3.Logger("Safari11"),SCTP_NUM_STREAMS$1={OS:1024,MIS:1024};class Safari11 extends HandlerInterface_1$2.HandlerInterface{constructor(){super(),this._sendStream=new MediaStream,this._mapSendLocalIdRtpSender=new Map,this._nextSendLocalId=0,this._mapRecvLocalIdInfo=new Map,this._hasDataChannelMediaSection=!1,this._nextSendSctpStreamId=0,this._transportReady=!1}static createFactory(){return()=>new Safari11}get name(){return"Safari11"}close(){if(logger$3.debug("close()"),this._pc)try{this._pc.close()}catch(e){}}async getNativeRtpCapabilities(){logger$3.debug("getNativeRtpCapabilities()");const e=new RTCPeerConnection({iceServers:[],iceTransportPolicy:"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require",sdpSemantics:"plan-b"});try{const t=await e.createOffer({offerToReceiveAudio:!0,offerToReceiveVideo:!0});try{e.close()}catch(e){}const r=sdpTransform$1.parse(t.sdp);return sdpCommonUtils$1.extractRtpCapabilities({sdpObject:r})}catch(t){try{e.close()}catch(e){}throw t}}async getNativeSctpCapabilities(){return logger$3.debug("getNativeSctpCapabilities()"),{numStreams:SCTP_NUM_STREAMS$1}}run({direction:e,iceParameters:t,iceCandidates:r,dtlsParameters:n,sctpParameters:o,iceServers:i,iceTransportPolicy:s,additionalSettings:a,proprietaryConstraints:c,extendedRtpCapabilities:d}){logger$3.debug("run()"),this._direction=e,this._remoteSdp=new RemoteSdp_1$1.RemoteSdp({iceParameters:t,iceCandidates:r,dtlsParameters:n,sctpParameters:o,planB:!0}),this._sendingRtpParametersByKind={audio:ortc$3.getSendingRtpParameters("audio",d),video:ortc$3.getSendingRtpParameters("video",d)},this._sendingRemoteRtpParametersByKind={audio:ortc$3.getSendingRemoteRtpParameters("audio",d),video:ortc$3.getSendingRemoteRtpParameters("video",d)},n.role&&"auto"!==n.role&&(this._forcedLocalDtlsRole="server"===n.role?"client":"server"),this._pc=new RTCPeerConnection({iceServers:i||[],iceTransportPolicy:s||"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require",...a},c),this._pc.addEventListener("iceconnectionstatechange",(()=>{switch(this._pc.iceConnectionState){case"checking":this.emit("@connectionstatechange","connecting");break;case"connected":case"completed":this.emit("@connectionstatechange","connected");break;case"failed":this.emit("@connectionstatechange","failed");break;case"disconnected":this.emit("@connectionstatechange","disconnected");break;case"closed":this.emit("@connectionstatechange","closed")}}))}async updateIceServers(e){logger$3.debug("updateIceServers()");const t=this._pc.getConfiguration();t.iceServers=e,this._pc.setConfiguration(t)}async restartIce(e){if(logger$3.debug("restartIce()"),this._remoteSdp.updateIceParameters(e),this._transportReady)if("send"===this._direction){const e=await this._pc.createOffer({iceRestart:!0});logger$3.debug("restartIce() | calling pc.setLocalDescription() [offer:%o]",e),await this._pc.setLocalDescription(e);const t={type:"answer",sdp:this._remoteSdp.getSdp()};logger$3.debug("restartIce() | calling pc.setRemoteDescription() [answer:%o]",t),await this._pc.setRemoteDescription(t)}else{const e={type:"offer",sdp:this._remoteSdp.getSdp()};logger$3.debug("restartIce() | calling pc.setRemoteDescription() [offer:%o]",e),await this._pc.setRemoteDescription(e);const t=await this._pc.createAnswer();logger$3.debug("restartIce() | calling pc.setLocalDescription() [answer:%o]",t),await this._pc.setLocalDescription(t)}}async getTransportStats(){return this._pc.getStats()}async send({track:e,encodings:t,codecOptions:r,codec:n}){var o;this._assertSendDirection(),logger$3.debug("send() [kind:%s, track.id:%s]",e.kind,e.id),n&&logger$3.warn("send() | codec selection is not available in %s handler",this.name),this._sendStream.addTrack(e),this._pc.addTrack(e,this._sendStream);let i,s=await this._pc.createOffer(),a=sdpTransform$1.parse(s.sdp);const c=utils$4.clone(this._sendingRtpParametersByKind[e.kind],{});c.codecs=ortc$3.reduceCodecs(c.codecs);const d=utils$4.clone(this._sendingRemoteRtpParametersByKind[e.kind],{});if(d.codecs=ortc$3.reduceCodecs(d.codecs),this._transportReady||await this._setupTransport({localDtlsRole:null!==(o=this._forcedLocalDtlsRole)&&void 0!==o?o:"client",localSdpObject:a}),"video"===e.kind&&t&&t.length>1&&(logger$3.debug("send() | enabling simulcast"),a=sdpTransform$1.parse(s.sdp),i=a.media.find((e=>"video"===e.type)),sdpPlanBUtils$1.addLegacySimulcast({offerMediaObject:i,track:e,numStreams:t.length}),s={type:"offer",sdp:sdpTransform$1.write(a)}),logger$3.debug("send() | calling pc.setLocalDescription() [offer:%o]",s),await this._pc.setLocalDescription(s),a=sdpTransform$1.parse(this._pc.localDescription.sdp),i=a.media.find((t=>t.type===e.kind)),c.rtcp.cname=sdpCommonUtils$1.getCname({offerMediaObject:i}),c.encodings=sdpPlanBUtils$1.getRtpEncodings({offerMediaObject:i,track:e}),t)for(let e=0;e<c.encodings.length;++e)t[e]&&Object.assign(c.encodings[e],t[e]);if(c.encodings.length>1&&"video/vp8"===c.codecs[0].mimeType.toLowerCase())for(const e of c.encodings)e.scalabilityMode="S1T3";this._remoteSdp.send({offerMediaObject:i,offerRtpParameters:c,answerRtpParameters:d,codecOptions:r});const l={type:"answer",sdp:this._remoteSdp.getSdp()};logger$3.debug("send() | calling pc.setRemoteDescription() [answer:%o]",l),await this._pc.setRemoteDescription(l);const p=String(this._nextSendLocalId);this._nextSendLocalId++;const u=this._pc.getSenders().find((t=>t.track===e));return this._mapSendLocalIdRtpSender.set(p,u),{localId:p,rtpParameters:c,rtpSender:u}}async stopSending(e){this._assertSendDirection();const t=this._mapSendLocalIdRtpSender.get(e);if(!t)throw new Error("associated RTCRtpSender not found");t.track&&this._sendStream.removeTrack(t.track),this._mapSendLocalIdRtpSender.delete(e);const r=await this._pc.createOffer();logger$3.debug("stopSending() | calling pc.setLocalDescription() [offer:%o]",r);try{await this._pc.setLocalDescription(r)}catch(e){if(0===this._sendStream.getTracks().length)return void logger$3.warn("stopSending() | ignoring expected error due no sending tracks: %s",e.toString());throw e}if("stable"===this._pc.signalingState)return;const n={type:"answer",sdp:this._remoteSdp.getSdp()};logger$3.debug("stopSending() | calling pc.setRemoteDescription() [answer:%o]",n),await this._pc.setRemoteDescription(n)}async replaceTrack(e,t){this._assertSendDirection(),t?logger$3.debug("replaceTrack() [localId:%s, track.id:%s]",e,t.id):logger$3.debug("replaceTrack() [localId:%s, no track]",e);const r=this._mapSendLocalIdRtpSender.get(e);if(!r)throw new Error("associated RTCRtpSender not found");const n=r.track;await r.replaceTrack(t),n&&this._sendStream.removeTrack(n),t&&this._sendStream.addTrack(t)}async setMaxSpatialLayer(e,t){this._assertSendDirection(),logger$3.debug("setMaxSpatialLayer() [localId:%s, spatialLayer:%s]",e,t);const r=this._mapSendLocalIdRtpSender.get(e);if(!r)throw new Error("associated RTCRtpSender not found");const n=r.getParameters();n.encodings.forEach(((e,r)=>{e.active=r<=t})),await r.setParameters(n)}async setRtpEncodingParameters(e,t){this._assertSendDirection(),logger$3.debug("setRtpEncodingParameters() [localId:%s, params:%o]",e,t);const r=this._mapSendLocalIdRtpSender.get(e);if(!r)throw new Error("associated RTCRtpSender not found");const n=r.getParameters();n.encodings.forEach(((e,r)=>{n.encodings[r]={...e,...t}})),await r.setParameters(n)}async getSenderStats(e){this._assertSendDirection();const t=this._mapSendLocalIdRtpSender.get(e);if(!t)throw new Error("associated RTCRtpSender not found");return t.getStats()}async sendDataChannel({ordered:e,maxPacketLifeTime:t,maxRetransmits:r,label:n,protocol:o}){var i;this._assertSendDirection();const s={negotiated:!0,id:this._nextSendSctpStreamId,ordered:e,maxPacketLifeTime:t,maxRetransmits:r,protocol:o};logger$3.debug("sendDataChannel() [options:%o]",s);const a=this._pc.createDataChannel(n,s);if(this._nextSendSctpStreamId=++this._nextSendSctpStreamId%SCTP_NUM_STREAMS$1.MIS,!this._hasDataChannelMediaSection){const e=await this._pc.createOffer(),t=sdpTransform$1.parse(e.sdp),r=t.media.find((e=>"application"===e.type));this._transportReady||await this._setupTransport({localDtlsRole:null!==(i=this._forcedLocalDtlsRole)&&void 0!==i?i:"client",localSdpObject:t}),logger$3.debug("sendDataChannel() | calling pc.setLocalDescription() [offer:%o]",e),await this._pc.setLocalDescription(e),this._remoteSdp.sendSctpAssociation({offerMediaObject:r});const n={type:"answer",sdp:this._remoteSdp.getSdp()};logger$3.debug("sendDataChannel() | calling pc.setRemoteDescription() [answer:%o]",n),await this._pc.setRemoteDescription(n),this._hasDataChannelMediaSection=!0}return{dataChannel:a,sctpStreamParameters:{streamId:s.id,ordered:s.ordered,maxPacketLifeTime:s.maxPacketLifeTime,maxRetransmits:s.maxRetransmits}}}async receive({trackId:e,kind:t,rtpParameters:r}){var n;this._assertRecvDirection(),logger$3.debug("receive() [trackId:%s, kind:%s]",e,t);const o=e,i=t;this._remoteSdp.receive({mid:i,kind:t,offerRtpParameters:r,streamId:r.rtcp.cname,trackId:e});const s={type:"offer",sdp:this._remoteSdp.getSdp()};logger$3.debug("receive() | calling pc.setRemoteDescription() [offer:%o]",s),await this._pc.setRemoteDescription(s);let a=await this._pc.createAnswer();const c=sdpTransform$1.parse(a.sdp),d=c.media.find((e=>String(e.mid)===i));sdpCommonUtils$1.applyCodecParameters({offerRtpParameters:r,answerMediaObject:d}),a={type:"answer",sdp:sdpTransform$1.write(c)},this._transportReady||await this._setupTransport({localDtlsRole:null!==(n=this._forcedLocalDtlsRole)&&void 0!==n?n:"client",localSdpObject:c}),logger$3.debug("receive() | calling pc.setLocalDescription() [answer:%o]",a),await this._pc.setLocalDescription(a);const l=this._pc.getReceivers().find((e=>e.track&&e.track.id===o));if(!l)throw new Error("new RTCRtpReceiver not");return this._mapRecvLocalIdInfo.set(o,{mid:i,rtpParameters:r,rtpReceiver:l}),{localId:o,track:l.track,rtpReceiver:l}}async stopReceiving(e){this._assertRecvDirection(),logger$3.debug("stopReceiving() [localId:%s]",e);const{mid:t,rtpParameters:r}=this._mapRecvLocalIdInfo.get(e)||{};this._mapRecvLocalIdInfo.delete(e),this._remoteSdp.planBStopReceiving({mid:t,offerRtpParameters:r});const n={type:"offer",sdp:this._remoteSdp.getSdp()};logger$3.debug("stopReceiving() | calling pc.setRemoteDescription() [offer:%o]",n),await this._pc.setRemoteDescription(n);const o=await this._pc.createAnswer();logger$3.debug("stopReceiving() | calling pc.setLocalDescription() [answer:%o]",o),await this._pc.setLocalDescription(o)}async getReceiverStats(e){this._assertRecvDirection();const{rtpReceiver:t}=this._mapRecvLocalIdInfo.get(e)||{};if(!t)throw new Error("associated RTCRtpReceiver not found");return t.getStats()}async pauseReceiving(e){}async resumeReceiving(e){}async receiveDataChannel({sctpStreamParameters:e,label:t,protocol:r}){var n;this._assertRecvDirection();const{streamId:o,ordered:i,maxPacketLifeTime:s,maxRetransmits:a}=e,c={negotiated:!0,id:o,ordered:i,maxPacketLifeTime:s,maxRetransmits:a,protocol:r};logger$3.debug("receiveDataChannel() [options:%o]",c);const d=this._pc.createDataChannel(t,c);if(!this._hasDataChannelMediaSection){this._remoteSdp.receiveSctpAssociation({oldDataChannelSpec:!0});const e={type:"offer",sdp:this._remoteSdp.getSdp()};logger$3.debug("receiveDataChannel() | calling pc.setRemoteDescription() [offer:%o]",e),await this._pc.setRemoteDescription(e);const t=await this._pc.createAnswer();if(!this._transportReady){const e=sdpTransform$1.parse(t.sdp);await this._setupTransport({localDtlsRole:null!==(n=this._forcedLocalDtlsRole)&&void 0!==n?n:"client",localSdpObject:e})}logger$3.debug("receiveDataChannel() | calling pc.setRemoteDescription() [answer:%o]",t),await this._pc.setLocalDescription(t),this._hasDataChannelMediaSection=!0}return{dataChannel:d}}async _setupTransport({localDtlsRole:e,localSdpObject:t}){t||(t=sdpTransform$1.parse(this._pc.localDescription.sdp));const r=sdpCommonUtils$1.extractDtlsParameters({sdpObject:t});r.role=e,this._remoteSdp.updateDtlsRole("client"===e?"server":"client"),await this.safeEmitAsPromise("@connect",{dtlsParameters:r}),this._transportReady=!0}_assertSendDirection(){if("send"!==this._direction)throw new Error('method can just be called for handlers with "send" direction')}_assertRecvDirection(){if("recv"!==this._direction)throw new Error('method can just be called for handlers with "recv" direction')}}Safari11$1.Safari11=Safari11;var Edge11$1={},edgeUtils$1={},__createBinding$3=commonjsGlobal&&commonjsGlobal.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r),Object.defineProperty(e,n,{enumerable:!0,get:function(){return t[r]}})}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),__setModuleDefault$3=commonjsGlobal&&commonjsGlobal.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),__importStar$3=commonjsGlobal&&commonjsGlobal.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)"default"!==r&&Object.prototype.hasOwnProperty.call(e,r)&&__createBinding$3(t,e,r);return __setModuleDefault$3(t,e),t};Object.defineProperty(edgeUtils$1,"__esModule",{value:!0}),edgeUtils$1.mangleRtpParameters=edgeUtils$1.getCapabilities=void 0;const utils$3=__importStar$3(utils$e);function getCapabilities(){const e=RTCRtpReceiver.getCapabilities(),t=utils$3.clone(e,{});for(const e of t.codecs){if(e.channels=e.numChannels,delete e.numChannels,e.mimeType=e.mimeType||`${e.kind}/${e.name}`,e.parameters){const t=e.parameters;t.apt&&(t.apt=Number(t.apt)),t["packetization-mode"]&&(t["packetization-mode"]=Number(t["packetization-mode"]))}for(const t of e.rtcpFeedback||[])t.parameter||(t.parameter="")}return t}function mangleRtpParameters(e){const t=utils$3.clone(e,{});t.mid&&(t.muxId=t.mid,delete t.mid);for(const e of t.codecs)e.channels&&(e.numChannels=e.channels,delete e.channels),e.mimeType&&!e.name&&(e.name=e.mimeType.split("/")[1]),delete e.mimeType;return t}edgeUtils$1.getCapabilities=getCapabilities,edgeUtils$1.mangleRtpParameters=mangleRtpParameters;var __createBinding$2=commonjsGlobal&&commonjsGlobal.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r),Object.defineProperty(e,n,{enumerable:!0,get:function(){return t[r]}})}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),__setModuleDefault$2=commonjsGlobal&&commonjsGlobal.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),__importStar$2=commonjsGlobal&&commonjsGlobal.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)"default"!==r&&Object.prototype.hasOwnProperty.call(e,r)&&__createBinding$2(t,e,r);return __setModuleDefault$2(t,e),t};Object.defineProperty(Edge11$1,"__esModule",{value:!0}),Edge11$1.Edge11=void 0;const Logger_1$2=Logger$1,errors_1$2=errors,utils$2=__importStar$2(utils$e),ortc$2=__importStar$2(ortc$b),edgeUtils=__importStar$2(edgeUtils$1),HandlerInterface_1$1=HandlerInterface$1,logger$2=new Logger_1$2.Logger("Edge11");class Edge11 extends HandlerInterface_1$1.HandlerInterface{constructor(){super(),this._rtpSenders=new Map,this._rtpReceivers=new Map,this._nextSendLocalId=0,this._transportReady=!1}static createFactory(){return()=>new Edge11}get name(){return"Edge11"}close(){logger$2.debug("close()");try{this._iceGatherer.close()}catch(e){}try{this._iceTransport.stop()}catch(e){}try{this._dtlsTransport.stop()}catch(e){}for(const e of this._rtpSenders.values())try{e.stop()}catch(e){}for(const e of this._rtpReceivers.values())try{e.stop()}catch(e){}}async getNativeRtpCapabilities(){return logger$2.debug("getNativeRtpCapabilities()"),edgeUtils.getCapabilities()}async getNativeSctpCapabilities(){return logger$2.debug("getNativeSctpCapabilities()"),{numStreams:{OS:0,MIS:0}}}run({direction:e,iceParameters:t,iceCandidates:r,dtlsParameters:n,sctpParameters:o,iceServers:i,iceTransportPolicy:s,additionalSettings:a,proprietaryConstraints:c,extendedRtpCapabilities:d}){logger$2.debug("run()"),this._sendingRtpParametersByKind={audio:ortc$2.getSendingRtpParameters("audio",d),video:ortc$2.getSendingRtpParameters("video",d)},this._remoteIceParameters=t,this._remoteIceCandidates=r,this._remoteDtlsParameters=n,this._cname=`CNAME-${utils$2.generateRandomNumber()}`,this._setIceGatherer({iceServers:i,iceTransportPolicy:s}),this._setIceTransport(),this._setDtlsTransport()}async updateIceServers(e){throw new errors_1$2.UnsupportedError("not supported")}async restartIce(e){if(logger$2.debug("restartIce()"),this._remoteIceParameters=e,this._transportReady){logger$2.debug("restartIce() | calling iceTransport.start()"),this._iceTransport.start(this._iceGatherer,e,"controlling");for(const e of this._remoteIceCandidates)this._iceTransport.addRemoteCandidate(e);this._iceTransport.addRemoteCandidate({})}}async getTransportStats(){return this._iceTransport.getStats()}async send({track:e,encodings:t,codecOptions:r,codec:n}){logger$2.debug("send() [kind:%s, track.id:%s]",e.kind,e.id),this._transportReady||await this._setupTransport({localDtlsRole:"server"}),logger$2.debug("send() | calling new RTCRtpSender()");const o=new RTCRtpSender(e,this._dtlsTransport),i=utils$2.clone(this._sendingRtpParametersByKind[e.kind],{});i.codecs=ortc$2.reduceCodecs(i.codecs,n);const s=i.codecs.some((e=>/.+\/rtx$/i.test(e.mimeType)));t||(t=[{}]);for(const e of t)e.ssrc=utils$2.generateRandomNumber(),s&&(e.rtx={ssrc:utils$2.generateRandomNumber()});i.encodings=t,i.rtcp={cname:this._cname,reducedSize:!0,mux:!0};const a=edgeUtils.mangleRtpParameters(i);logger$2.debug("send() | calling rtpSender.send() [params:%o]",a),await o.send(a);const c=String(this._nextSendLocalId);return this._nextSendLocalId++,this._rtpSenders.set(c,o),{localId:c,rtpParameters:i,rtpSender:o}}async stopSending(e){logger$2.debug("stopSending() [localId:%s]",e);const t=this._rtpSenders.get(e);if(!t)throw new Error("RTCRtpSender not found");this._rtpSenders.delete(e);try{logger$2.debug("stopSending() | calling rtpSender.stop()"),t.stop()}catch(e){throw logger$2.warn("stopSending() | rtpSender.stop() failed:%o",e),e}}async replaceTrack(e,t){t?logger$2.debug("replaceTrack() [localId:%s, track.id:%s]",e,t.id):logger$2.debug("replaceTrack() [localId:%s, no track]",e);const r=this._rtpSenders.get(e);if(!r)throw new Error("RTCRtpSender not found");r.setTrack(t)}async setMaxSpatialLayer(e,t){logger$2.debug("setMaxSpatialLayer() [localId:%s, spatialLayer:%s]",e,t);const r=this._rtpSenders.get(e);if(!r)throw new Error("RTCRtpSender not found");const n=r.getParameters();n.encodings.forEach(((e,r)=>{e.active=r<=t})),await r.setParameters(n)}async setRtpEncodingParameters(e,t){logger$2.debug("setRtpEncodingParameters() [localId:%s, params:%o]",e,t);const r=this._rtpSenders.get(e);if(!r)throw new Error("RTCRtpSender not found");const n=r.getParameters();n.encodings.forEach(((e,r)=>{n.encodings[r]={...e,...t}})),await r.setParameters(n)}async getSenderStats(e){const t=this._rtpSenders.get(e);if(!t)throw new Error("RTCRtpSender not found");return t.getStats()}async sendDataChannel(e){throw new errors_1$2.UnsupportedError("not implemented")}async receive({trackId:e,kind:t,rtpParameters:r}){logger$2.debug("receive() [trackId:%s, kind:%s]",e,t),this._transportReady||await this._setupTransport({localDtlsRole:"server"}),logger$2.debug("receive() | calling new RTCRtpReceiver()");const n=new RTCRtpReceiver(this._dtlsTransport,t);n.addEventListener("error",(e=>{logger$2.error('rtpReceiver "error" event [event:%o]',e)}));const o=edgeUtils.mangleRtpParameters(r);logger$2.debug("receive() | calling rtpReceiver.receive() [params:%o]",o),await n.receive(o);const i=e;return this._rtpReceivers.set(i,n),{localId:i,track:n.track,rtpReceiver:n}}async stopReceiving(e){logger$2.debug("stopReceiving() [localId:%s]",e);const t=this._rtpReceivers.get(e);if(!t)throw new Error("RTCRtpReceiver not found");this._rtpReceivers.delete(e);try{logger$2.debug("stopReceiving() | calling rtpReceiver.stop()"),t.stop()}catch(e){logger$2.warn("stopReceiving() | rtpReceiver.stop() failed:%o",e)}}async pauseReceiving(e){}async resumeReceiving(e){}async getReceiverStats(e){const t=this._rtpReceivers.get(e);if(!t)throw new Error("RTCRtpReceiver not found");return t.getStats()}async receiveDataChannel(e){throw new errors_1$2.UnsupportedError("not implemented")}_setIceGatherer({iceServers:e,iceTransportPolicy:t}){const r=new RTCIceGatherer({iceServers:e||[],gatherPolicy:t||"all"});r.addEventListener("error",(e=>{logger$2.error('iceGatherer "error" event [event:%o]',e)}));try{r.gather()}catch(e){logger$2.debug("_setIceGatherer() | iceGatherer.gather() failed: %s",e.toString())}this._iceGatherer=r}_setIceTransport(){const e=new RTCIceTransport(this._iceGatherer);e.addEventListener("statechange",(()=>{switch(e.state){case"checking":this.emit("@connectionstatechange","connecting");break;case"connected":case"completed":this.emit("@connectionstatechange","connected");break;case"failed":this.emit("@connectionstatechange","failed");break;case"disconnected":this.emit("@connectionstatechange","disconnected");break;case"closed":this.emit("@connectionstatechange","closed")}})),e.addEventListener("icestatechange",(()=>{switch(e.state){case"checking":this.emit("@connectionstatechange","connecting");break;case"connected":case"completed":this.emit("@connectionstatechange","connected");break;case"failed":this.emit("@connectionstatechange","failed");break;case"disconnected":this.emit("@connectionstatechange","disconnected");break;case"closed":this.emit("@connectionstatechange","closed")}})),e.addEventListener("candidatepairchange",(e=>{logger$2.debug('iceTransport "candidatepairchange" event [pair:%o]',e.pair)})),this._iceTransport=e}_setDtlsTransport(){const e=new RTCDtlsTransport(this._iceTransport);e.addEventListener("statechange",(()=>{logger$2.debug('dtlsTransport "statechange" event [state:%s]',e.state)})),e.addEventListener("dtlsstatechange",(()=>{logger$2.debug('dtlsTransport "dtlsstatechange" event [state:%s]',e.state),"closed"===e.state&&this.emit("@connectionstatechange","closed")})),e.addEventListener("error",(e=>{logger$2.error('dtlsTransport "error" event [event:%o]',e)})),this._dtlsTransport=e}async _setupTransport({localDtlsRole:e}){logger$2.debug("_setupTransport()");const t=this._dtlsTransport.getLocalParameters();t.role=e,await this.safeEmitAsPromise("@connect",{dtlsParameters:t}),this._iceTransport.start(this._iceGatherer,this._remoteIceParameters,"controlling");for(const e of this._remoteIceCandidates)this._iceTransport.addRemoteCandidate(e);this._iceTransport.addRemoteCandidate({}),this._remoteDtlsParameters.fingerprints=this._remoteDtlsParameters.fingerprints.filter((e=>"sha-256"===e.algorithm||"sha-384"===e.algorithm||"sha-512"===e.algorithm)),this._dtlsTransport.start(this._remoteDtlsParameters),this._transportReady=!0}}Edge11$1.Edge11=Edge11;var ReactNative$1={},__createBinding$1=commonjsGlobal&&commonjsGlobal.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r),Object.defineProperty(e,n,{enumerable:!0,get:function(){return t[r]}})}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),__setModuleDefault$1=commonjsGlobal&&commonjsGlobal.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),__importStar$1=commonjsGlobal&&commonjsGlobal.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)"default"!==r&&Object.prototype.hasOwnProperty.call(e,r)&&__createBinding$1(t,e,r);return __setModuleDefault$1(t,e),t};Object.defineProperty(ReactNative$1,"__esModule",{value:!0}),ReactNative$1.ReactNative=void 0;const sdpTransform=__importStar$1(lib),Logger_1$1=Logger$1,errors_1$1=errors,utils$1=__importStar$1(utils$e),ortc$1=__importStar$1(ortc$b),sdpCommonUtils=__importStar$1(commonUtils),sdpPlanBUtils=__importStar$1(planBUtils),HandlerInterface_1=HandlerInterface$1,RemoteSdp_1=RemoteSdp$1,logger$1=new Logger_1$1.Logger("ReactNative"),SCTP_NUM_STREAMS={OS:1024,MIS:1024};class ReactNative extends HandlerInterface_1.HandlerInterface{constructor(){super(),this._sendStream=new MediaStream,this._mapSendLocalIdTrack=new Map,this._nextSendLocalId=0,this._mapRecvLocalIdInfo=new Map,this._hasDataChannelMediaSection=!1,this._nextSendSctpStreamId=0,this._transportReady=!1}static createFactory(){return()=>new ReactNative}get name(){return"ReactNative"}close(){if(logger$1.debug("close()"),this._sendStream.release(!1),this._pc)try{this._pc.close()}catch(e){}}async getNativeRtpCapabilities(){logger$1.debug("getNativeRtpCapabilities()");const e=new RTCPeerConnection({iceServers:[],iceTransportPolicy:"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require",sdpSemantics:"plan-b"});try{const t=await e.createOffer({offerToReceiveAudio:!0,offerToReceiveVideo:!0});try{e.close()}catch(e){}const r=sdpTransform.parse(t.sdp);return sdpCommonUtils.extractRtpCapabilities({sdpObject:r})}catch(t){try{e.close()}catch(e){}throw t}}async getNativeSctpCapabilities(){return logger$1.debug("getNativeSctpCapabilities()"),{numStreams:SCTP_NUM_STREAMS}}run({direction:e,iceParameters:t,iceCandidates:r,dtlsParameters:n,sctpParameters:o,iceServers:i,iceTransportPolicy:s,additionalSettings:a,proprietaryConstraints:c,extendedRtpCapabilities:d}){logger$1.debug("run()"),this._direction=e,this._remoteSdp=new RemoteSdp_1.RemoteSdp({iceParameters:t,iceCandidates:r,dtlsParameters:n,sctpParameters:o,planB:!0}),this._sendingRtpParametersByKind={audio:ortc$1.getSendingRtpParameters("audio",d),video:ortc$1.getSendingRtpParameters("video",d)},this._sendingRemoteRtpParametersByKind={audio:ortc$1.getSendingRemoteRtpParameters("audio",d),video:ortc$1.getSendingRemoteRtpParameters("video",d)},n.role&&"auto"!==n.role&&(this._forcedLocalDtlsRole="server"===n.role?"client":"server"),this._pc=new RTCPeerConnection({iceServers:i||[],iceTransportPolicy:s||"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require",sdpSemantics:"plan-b",...a},c),this._pc.addEventListener("iceconnectionstatechange",(()=>{switch(this._pc.iceConnectionState){case"checking":this.emit("@connectionstatechange","connecting");break;case"connected":case"completed":this.emit("@connectionstatechange","connected");break;case"failed":this.emit("@connectionstatechange","failed");break;case"disconnected":this.emit("@connectionstatechange","disconnected");break;case"closed":this.emit("@connectionstatechange","closed")}}))}async updateIceServers(e){logger$1.debug("updateIceServers()");const t=this._pc.getConfiguration();t.iceServers=e,this._pc.setConfiguration(t)}async restartIce(e){if(logger$1.debug("restartIce()"),this._remoteSdp.updateIceParameters(e),this._transportReady)if("send"===this._direction){const e=await this._pc.createOffer({iceRestart:!0});logger$1.debug("restartIce() | calling pc.setLocalDescription() [offer:%o]",e),await this._pc.setLocalDescription(e);const t={type:"answer",sdp:this._remoteSdp.getSdp()};logger$1.debug("restartIce() | calling pc.setRemoteDescription() [answer:%o]",t),await this._pc.setRemoteDescription(t)}else{const e={type:"offer",sdp:this._remoteSdp.getSdp()};logger$1.debug("restartIce() | calling pc.setRemoteDescription() [offer:%o]",e),await this._pc.setRemoteDescription(e);const t=await this._pc.createAnswer();logger$1.debug("restartIce() | calling pc.setLocalDescription() [answer:%o]",t),await this._pc.setLocalDescription(t)}}async getTransportStats(){return this._pc.getStats()}async send({track:e,encodings:t,codecOptions:r,codec:n}){var o;this._assertSendDirection(),logger$1.debug("send() [kind:%s, track.id:%s]",e.kind,e.id),n&&logger$1.warn("send() | codec selection is not available in %s handler",this.name),this._sendStream.addTrack(e),this._pc.addStream(this._sendStream);let i,s=await this._pc.createOffer(),a=sdpTransform.parse(s.sdp);const c=utils$1.clone(this._sendingRtpParametersByKind[e.kind],{});c.codecs=ortc$1.reduceCodecs(c.codecs);const d=utils$1.clone(this._sendingRemoteRtpParametersByKind[e.kind],{});if(d.codecs=ortc$1.reduceCodecs(d.codecs),this._transportReady||await this._setupTransport({localDtlsRole:null!==(o=this._forcedLocalDtlsRole)&&void 0!==o?o:"client",localSdpObject:a}),"video"===e.kind&&t&&t.length>1&&(logger$1.debug("send() | enabling simulcast"),a=sdpTransform.parse(s.sdp),i=a.media.find((e=>"video"===e.type)),sdpPlanBUtils.addLegacySimulcast({offerMediaObject:i,track:e,numStreams:t.length}),s={type:"offer",sdp:sdpTransform.write(a)}),logger$1.debug("send() | calling pc.setLocalDescription() [offer:%o]",s),await this._pc.setLocalDescription(s),a=sdpTransform.parse(this._pc.localDescription.sdp),i=a.media.find((t=>t.type===e.kind)),c.rtcp.cname=sdpCommonUtils.getCname({offerMediaObject:i}),c.encodings=sdpPlanBUtils.getRtpEncodings({offerMediaObject:i,track:e}),t)for(let e=0;e<c.encodings.length;++e)t[e]&&Object.assign(c.encodings[e],t[e]);if(c.encodings.length>1&&("video/vp8"===c.codecs[0].mimeType.toLowerCase()||"video/h264"===c.codecs[0].mimeType.toLowerCase()))for(const e of c.encodings)e.scalabilityMode="S1T3";this._remoteSdp.send({offerMediaObject:i,offerRtpParameters:c,answerRtpParameters:d,codecOptions:r});const l={type:"answer",sdp:this._remoteSdp.getSdp()};logger$1.debug("send() | calling pc.setRemoteDescription() [answer:%o]",l),await this._pc.setRemoteDescription(l);const p=String(this._nextSendLocalId);return this._nextSendLocalId++,this._mapSendLocalIdTrack.set(p,e),{localId:p,rtpParameters:c}}async stopSending(e){this._assertSendDirection(),logger$1.debug("stopSending() [localId:%s]",e);const t=this._mapSendLocalIdTrack.get(e);if(!t)throw new Error("track not found");this._mapSendLocalIdTrack.delete(e),this._sendStream.removeTrack(t),this._pc.addStream(this._sendStream);const r=await this._pc.createOffer();logger$1.debug("stopSending() | calling pc.setLocalDescription() [offer:%o]",r);try{await this._pc.setLocalDescription(r)}catch(e){if(0===this._sendStream.getTracks().length)return void logger$1.warn("stopSending() | ignoring expected error due no sending tracks: %s",e.toString());throw e}if("stable"===this._pc.signalingState)return;const n={type:"answer",sdp:this._remoteSdp.getSdp()};logger$1.debug("stopSending() | calling pc.setRemoteDescription() [answer:%o]",n),await this._pc.setRemoteDescription(n)}async replaceTrack(e,t){throw new errors_1$1.UnsupportedError("not implemented")}async setMaxSpatialLayer(e,t){throw new errors_1$1.UnsupportedError("not implemented")}async setRtpEncodingParameters(e,t){throw new errors_1$1.UnsupportedError("not implemented")}async getSenderStats(e){throw new errors_1$1.UnsupportedError("not implemented")}async sendDataChannel({ordered:e,maxPacketLifeTime:t,maxRetransmits:r,label:n,protocol:o}){var i;this._assertSendDirection();const s={negotiated:!0,id:this._nextSendSctpStreamId,ordered:e,maxPacketLifeTime:t,maxRetransmitTime:t,maxRetransmits:r,protocol:o};logger$1.debug("sendDataChannel() [options:%o]",s);const a=this._pc.createDataChannel(n,s);if(this._nextSendSctpStreamId=++this._nextSendSctpStreamId%SCTP_NUM_STREAMS.MIS,!this._hasDataChannelMediaSection){const e=await this._pc.createOffer(),t=sdpTransform.parse(e.sdp),r=t.media.find((e=>"application"===e.type));this._transportReady||await this._setupTransport({localDtlsRole:null!==(i=this._forcedLocalDtlsRole)&&void 0!==i?i:"client",localSdpObject:t}),logger$1.debug("sendDataChannel() | calling pc.setLocalDescription() [offer:%o]",e),await this._pc.setLocalDescription(e),this._remoteSdp.sendSctpAssociation({offerMediaObject:r});const n={type:"answer",sdp:this._remoteSdp.getSdp()};logger$1.debug("sendDataChannel() | calling pc.setRemoteDescription() [answer:%o]",n),await this._pc.setRemoteDescription(n),this._hasDataChannelMediaSection=!0}return{dataChannel:a,sctpStreamParameters:{streamId:s.id,ordered:s.ordered,maxPacketLifeTime:s.maxPacketLifeTime,maxRetransmits:s.maxRetransmits}}}async receive({trackId:e,kind:t,rtpParameters:r}){var n;this._assertRecvDirection(),logger$1.debug("receive() [trackId:%s, kind:%s]",e,t);const o=e,i=t;let s=r.rtcp.cname;logger$1.debug("receive() | forcing a random remote streamId to avoid well known bug in react-native-webrtc"),s+=`-hack-${utils$1.generateRandomNumber()}`,this._remoteSdp.receive({mid:i,kind:t,offerRtpParameters:r,streamId:s,trackId:e});const a={type:"offer",sdp:this._remoteSdp.getSdp()};logger$1.debug("receive() | calling pc.setRemoteDescription() [offer:%o]",a),await this._pc.setRemoteDescription(a);let c=await this._pc.createAnswer();const d=sdpTransform.parse(c.sdp),l=d.media.find((e=>String(e.mid)===i));sdpCommonUtils.applyCodecParameters({offerRtpParameters:r,answerMediaObject:l}),c={type:"answer",sdp:sdpTransform.write(d)},this._transportReady||await this._setupTransport({localDtlsRole:null!==(n=this._forcedLocalDtlsRole)&&void 0!==n?n:"client",localSdpObject:d}),logger$1.debug("receive() | calling pc.setLocalDescription() [answer:%o]",c),await this._pc.setLocalDescription(c);const p=this._pc.getRemoteStreams().find((e=>e.id===s)),u=p.getTrackById(o);if(!u)throw new Error("remote track not found");return this._mapRecvLocalIdInfo.set(o,{mid:i,rtpParameters:r}),{localId:o,track:u}}async stopReceiving(e){this._assertRecvDirection(),logger$1.debug("stopReceiving() [localId:%s]",e);const{mid:t,rtpParameters:r}=this._mapRecvLocalIdInfo.get(e)||{};this._mapRecvLocalIdInfo.delete(e),this._remoteSdp.planBStopReceiving({mid:t,offerRtpParameters:r});const n={type:"offer",sdp:this._remoteSdp.getSdp()};logger$1.debug("stopReceiving() | calling pc.setRemoteDescription() [offer:%o]",n),await this._pc.setRemoteDescription(n);const o=await this._pc.createAnswer();logger$1.debug("stopReceiving() | calling pc.setLocalDescription() [answer:%o]",o),await this._pc.setLocalDescription(o)}async pauseReceiving(e){}async resumeReceiving(e){}async getReceiverStats(e){throw new errors_1$1.UnsupportedError("not implemented")}async receiveDataChannel({sctpStreamParameters:e,label:t,protocol:r}){var n;this._assertRecvDirection();const{streamId:o,ordered:i,maxPacketLifeTime:s,maxRetransmits:a}=e,c={negotiated:!0,id:o,ordered:i,maxPacketLifeTime:s,maxRetransmitTime:s,maxRetransmits:a,protocol:r};logger$1.debug("receiveDataChannel() [options:%o]",c);const d=this._pc.createDataChannel(t,c);if(!this._hasDataChannelMediaSection){this._remoteSdp.receiveSctpAssociation({oldDataChannelSpec:!0});const e={type:"offer",sdp:this._remoteSdp.getSdp()};logger$1.debug("receiveDataChannel() | calling pc.setRemoteDescription() [offer:%o]",e),await this._pc.setRemoteDescription(e);const t=await this._pc.createAnswer();if(!this._transportReady){const e=sdpTransform.parse(t.sdp);await this._setupTransport({localDtlsRole:null!==(n=this._forcedLocalDtlsRole)&&void 0!==n?n:"client",localSdpObject:e})}logger$1.debug("receiveDataChannel() | calling pc.setRemoteDescription() [answer:%o]",t),await this._pc.setLocalDescription(t),this._hasDataChannelMediaSection=!0}return{dataChannel:d}}async _setupTransport({localDtlsRole:e,localSdpObject:t}){t||(t=sdpTransform.parse(this._pc.localDescription.sdp));const r=sdpCommonUtils.extractDtlsParameters({sdpObject:t});r.role=e,this._remoteSdp.updateDtlsRole("client"===e?"server":"client"),await this.safeEmitAsPromise("@connect",{dtlsParameters:r}),this._transportReady=!0}_assertSendDirection(){if("send"!==this._direction)throw new Error('method can just be called for handlers with "send" direction')}_assertRecvDirection(){if("recv"!==this._direction)throw new Error('method can just be called for handlers with "recv" direction')}}ReactNative$1.ReactNative=ReactNative;var __createBinding=commonjsGlobal&&commonjsGlobal.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r),Object.defineProperty(e,n,{enumerable:!0,get:function(){return t[r]}})}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),__setModuleDefault=commonjsGlobal&&commonjsGlobal.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),__importStar=commonjsGlobal&&commonjsGlobal.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)"default"!==r&&Object.prototype.hasOwnProperty.call(e,r)&&__createBinding(t,e,r);return __setModuleDefault(t,e),t},__importDefault=commonjsGlobal&&commonjsGlobal.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(Device$1,"__esModule",{value:!0}),Device$1.Device=Device$1.detectDevice=void 0;const bowser_1=__importDefault(es5.exports),Logger_1=Logger$1,EnhancedEventEmitter_1=EnhancedEventEmitter$1,errors_1=errors,utils=__importStar(utils$e),ortc=__importStar(ortc$b),Transport_1=Transport$1,Chrome74_1=Chrome74$1,Chrome70_1=Chrome70$1,Chrome67_1=Chrome67$1,Chrome55_1=Chrome55$1,Firefox60_1=Firefox60$1,Safari12_1=Safari12$1,Safari11_1=Safari11$1,Edge11_1=Edge11$1,ReactNative_1=ReactNative$1,logger=new Logger_1.Logger("Device");function detectDevice(){if("object"==typeof navigator&&"ReactNative"===navigator.product)return"undefined"==typeof RTCPeerConnection?void logger.warn("this._detectDevice() | unsupported ReactNative without RTCPeerConnection"):(logger.debug("this._detectDevice() | ReactNative handler chosen"),"ReactNative");if("object"!=typeof navigator||"string"!=typeof navigator.userAgent)logger.warn("this._detectDevice() | unknown device");else{const e=navigator.userAgent,t=bowser_1.default.getParser(e),r=t.getEngine();if(t.satisfies({chrome:">=74",chromium:">=74","microsoft edge":">=88"}))return"Chrome74";if(t.satisfies({chrome:">=70",chromium:">=70"}))return"Chrome70";if(t.satisfies({chrome:">=67",chromium:">=67"}))return"Chrome67";if(t.satisfies({chrome:">=55",chromium:">=55"}))return"Chrome55";if(t.satisfies({firefox:">=60"}))return"Firefox60";if(t.satisfies({ios:{OS:">=14.3",firefox:">=30.0"}}))return"Safari12";if(t.satisfies({safari:">=12.0"})&&"undefined"!=typeof RTCRtpTransceiver&&RTCRtpTransceiver.prototype.hasOwnProperty("currentDirection"))return"Safari12";if(t.satisfies({safari:">=11"}))return"Safari11";if(t.satisfies({"microsoft edge":">=11"})&&t.satisfies({"microsoft edge":"<=18"}))return"Edge11";if(r.name&&"blink"===r.name.toLowerCase()){const t=e.match(/(?:(?:Chrome|Chromium))[ /](\w+)/i);if(t){const e=Number(t[1]);return e>=74?"Chrome74":e>=70?"Chrome70":e>=67?"Chrome67":"Chrome55"}return"Chrome74"}logger.warn("this._detectDevice() | browser not supported [name:%s, version:%s]",t.getBrowserName(),t.getBrowserVersion())}}Device$1.detectDevice=detectDevice;class Device{constructor({handlerName:e,handlerFactory:t,Handler:r}={}){if(this._loaded=!1,this._observer=new EnhancedEventEmitter_1.EnhancedEventEmitter,logger.debug("constructor()"),r){if(logger.warn("constructor() | Handler option is DEPRECATED, use handlerName or handlerFactory instead"),"string"!=typeof r)throw new TypeError("non string Handler option no longer supported, use handlerFactory instead");e=r}if(e&&t)throw new TypeError("just one of handlerName or handlerInterface can be given");if(t)this._handlerFactory=t;else{if(e)logger.debug("constructor() | handler given: %s",e);else{if(!(e=detectDevice()))throw new errors_1.UnsupportedError("device not supported");logger.debug("constructor() | detected handler: %s",e)}switch(e){case"Chrome74":this._handlerFactory=Chrome74_1.Chrome74.createFactory();break;case"Chrome70":this._handlerFactory=Chrome70_1.Chrome70.createFactory();break;case"Chrome67":this._handlerFactory=Chrome67_1.Chrome67.createFactory();break;case"Chrome55":this._handlerFactory=Chrome55_1.Chrome55.createFactory();break;case"Firefox60":this._handlerFactory=Firefox60_1.Firefox60.createFactory();break;case"Safari12":this._handlerFactory=Safari12_1.Safari12.createFactory();break;case"Safari11":this._handlerFactory=Safari11_1.Safari11.createFactory();break;case"Edge11":this._handlerFactory=Edge11_1.Edge11.createFactory();break;case"ReactNative":this._handlerFactory=ReactNative_1.ReactNative.createFactory();break;default:throw new TypeError(`unknown handlerName "${e}"`)}}const n=this._handlerFactory();this._handlerName=n.name,n.close(),this._extendedRtpCapabilities=void 0,this._recvRtpCapabilities=void 0,this._canProduceByKind={audio:!1,video:!1},this._sctpCapabilities=void 0}get handlerName(){return this._handlerName}get loaded(){return this._loaded}get rtpCapabilities(){if(!this._loaded)throw new errors_1.InvalidStateError("not loaded");return this._recvRtpCapabilities}get sctpCapabilities(){if(!this._loaded)throw new errors_1.InvalidStateError("not loaded");return this._sctpCapabilities}get observer(){return this._observer}async load({routerRtpCapabilities:e}){let t;logger.debug("load() [routerRtpCapabilities:%o]",e),e=utils.clone(e,void 0);try{if(this._loaded)throw new errors_1.InvalidStateError("already loaded");ortc.validateRtpCapabilities(e),t=this._handlerFactory();const r=await t.getNativeRtpCapabilities();logger.debug("load() | got native RTP capabilities:%o",r),ortc.validateRtpCapabilities(r),this._extendedRtpCapabilities=ortc.getExtendedRtpCapabilities(r,e),logger.debug("load() | got extended RTP capabilities:%o",this._extendedRtpCapabilities),this._canProduceByKind.audio=ortc.canSend("audio",this._extendedRtpCapabilities),this._canProduceByKind.video=ortc.canSend("video",this._extendedRtpCapabilities),this._recvRtpCapabilities=ortc.getRecvRtpCapabilities(this._extendedRtpCapabilities),ortc.validateRtpCapabilities(this._recvRtpCapabilities),logger.debug("load() | got receiving RTP capabilities:%o",this._recvRtpCapabilities),this._sctpCapabilities=await t.getNativeSctpCapabilities(),logger.debug("load() | got native SCTP capabilities:%o",this._sctpCapabilities),ortc.validateSctpCapabilities(this._sctpCapabilities),logger.debug("load() succeeded"),this._loaded=!0,t.close()}catch(e){throw t&&t.close(),e}}canProduce(e){if(!this._loaded)throw new errors_1.InvalidStateError("not loaded");if("audio"!==e&&"video"!==e)throw new TypeError(`invalid kind "${e}"`);return this._canProduceByKind[e]}createSendTransport({id:e,iceParameters:t,iceCandidates:r,dtlsParameters:n,sctpParameters:o,iceServers:i,iceTransportPolicy:s,additionalSettings:a,proprietaryConstraints:c,appData:d={}}){return logger.debug("createSendTransport()"),this._createTransport({direction:"send",id:e,iceParameters:t,iceCandidates:r,dtlsParameters:n,sctpParameters:o,iceServers:i,iceTransportPolicy:s,additionalSettings:a,proprietaryConstraints:c,appData:d})}createRecvTransport({id:e,iceParameters:t,iceCandidates:r,dtlsParameters:n,sctpParameters:o,iceServers:i,iceTransportPolicy:s,additionalSettings:a,proprietaryConstraints:c,appData:d={}}){return logger.debug("createRecvTransport()"),this._createTransport({direction:"recv",id:e,iceParameters:t,iceCandidates:r,dtlsParameters:n,sctpParameters:o,iceServers:i,iceTransportPolicy:s,additionalSettings:a,proprietaryConstraints:c,appData:d})}_createTransport({direction:e,id:t,iceParameters:r,iceCandidates:n,dtlsParameters:o,sctpParameters:i,iceServers:s,iceTransportPolicy:a,additionalSettings:c,proprietaryConstraints:d,appData:l={}}){if(!this._loaded)throw new errors_1.InvalidStateError("not loaded");if("string"!=typeof t)throw new TypeError("missing id");if("object"!=typeof r)throw new TypeError("missing iceParameters");if(!Array.isArray(n))throw new TypeError("missing iceCandidates");if("object"!=typeof o)throw new TypeError("missing dtlsParameters");if(i&&"object"!=typeof i)throw new TypeError("wrong sctpParameters");if(l&&"object"!=typeof l)throw new TypeError("if given, appData must be an object");const p=new Transport_1.Transport({direction:e,id:t,iceParameters:r,iceCandidates:n,dtlsParameters:o,sctpParameters:i,iceServers:s,iceTransportPolicy:a,additionalSettings:c,proprietaryConstraints:d,appData:l,handlerFactory:this._handlerFactory,extendedRtpCapabilities:this._extendedRtpCapabilities,canProduceByKind:this._canProduceByKind});return this._observer.safeEmit("newtransport",p),p}}Device$1.Device=Device;var types={},RtpParameters={};Object.defineProperty(RtpParameters,"__esModule",{value:!0});var SctpParameters={};Object.defineProperty(SctpParameters,"__esModule",{value:!0}),function(e){var t=commonjsGlobal&&commonjsGlobal.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r),Object.defineProperty(e,n,{enumerable:!0,get:function(){return t[r]}})}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),r=commonjsGlobal&&commonjsGlobal.__exportStar||function(e,r){for(var n in e)"default"===n||Object.prototype.hasOwnProperty.call(r,n)||t(r,e,n)};Object.defineProperty(e,"__esModule",{value:!0}),r(Device$1,e),r(Transport$1,e),r(Producer$1,e),r(Consumer$1,e),r(DataProducer$1,e),r(DataConsumer$1,e),r(RtpParameters,e),r(SctpParameters,e),r(HandlerInterface$1,e),r(errors,e)}(types),function(e){var t=commonjsGlobal&&commonjsGlobal.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r),Object.defineProperty(e,n,{enumerable:!0,get:function(){return t[r]}})}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),r=commonjsGlobal&&commonjsGlobal.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),n=commonjsGlobal&&commonjsGlobal.__importStar||function(e){if(e&&e.__esModule)return e;var n={};if(null!=e)for(var o in e)"default"!==o&&Object.prototype.hasOwnProperty.call(e,o)&&t(n,e,o);return r(n,e),n},o=commonjsGlobal&&commonjsGlobal.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(e,"__esModule",{value:!0}),e.debug=e.parseScalabilityMode=e.detectDevice=e.Device=e.version=e.types=void 0;const i=o(browser.exports);e.debug=i.default;const s=Device$1;Object.defineProperty(e,"Device",{enumerable:!0,get:function(){return s.Device}}),Object.defineProperty(e,"detectDevice",{enumerable:!0,get:function(){return s.detectDevice}});const a=n(types);e.types=a,e.version="3.6.47";var c=scalabilityModes;Object.defineProperty(e,"parseScalabilityMode",{enumerable:!0,get:function(){return c.parse}})}(lib$2);class WSTransport{constructor(e,t,r,n,o=!0,i=5e3,s=1e3){this.url=e,this.onMessageCallback=t,this.onStateChange=r,this.protocols=n,this.autoconnect=o,this.recieveMessageTimeoutTime=i,this.sendKeepAliveMessageInterval=s}async connect(){return this._connect().then((()=>!0),(()=>!1))}disconnect(e,t){this.ws?.close(e,t),this.recieveTimeoutReference&&clearTimeout(this.recieveTimeoutReference),this.sendTimeoutReference&&clearTimeout(this.sendTimeoutReference)}async send(e){let t=this.ws;if(!t){if(!this.autoconnect)throw new Error("Not connected");t=await this._connect()}t.send(e),this.resetNetworkSendTimeout()}async _connect(){return this._wsPromise&&this.ws?.readyState!==WebSocket.CLOSED||(this._wsPromise=new Promise(((e,t)=>{const r=this.ws=new WebSocket(this.url,this.protocols);r.binaryType="arraybuffer",this.onStateChange?.("connecting"),r.addEventListener("open",(()=>{this.onOpen(),e(r)})),r.addEventListener("error",(e=>{this.onError(),t(e)})),r.addEventListener("close",(()=>this.onClose())),r.addEventListener("message",(e=>this.onMessage(e.data)))}))),this._wsPromise}onMessage(e){this.resetNetworkRecieveTimeout(),this.onMessageCallback(this,e)}onOpen(){this.resetNetworkSendTimeout(),this.resetNetworkRecieveTimeout(),this.onStateChange?.("connected")}onClose(){this.ws=void 0,this._wsPromise=void 0,this.onStateChange?.("not-connected")}onError(){this.onStateChange?.("error")}resetNetworkRecieveTimeout(){this.recieveTimeoutReference&&clearTimeout(this.recieveTimeoutReference),this.recieveTimeoutReference=setTimeout((()=>this.disconnect(4400,"timeout")),this.recieveMessageTimeoutTime)}resetNetworkSendTimeout(){this.sendTimeoutReference&&clearTimeout(this.sendTimeoutReference),this.sendTimeoutReference=setTimeout((()=>this.send(new Uint8Array(0))),this.sendKeepAliveMessageInterval)}}class PromiseCompleter{constructor(e=new Map){this.callbacks=e}createPromise(e){if(this.callbacks.has(e))throw new Error(`PromiseId(${e}) is already in-use`);return new Promise(((t,r)=>{this.callbacks.set(e,{resolve:t,reject:r})}))}resolve(e,t){this.useCallbacks(e).resolve(t)}reject(e,t){this.useCallbacks(e).reject(t)}useCallbacks(e){const t=this.callbacks.get(e);if(!t)throw new Error(`Recieved response for unknown requestID(${e})`);return this.callbacks.delete(e),t}}const initialState={sfus:{}},closeTrack=(e,{payload:{id:t,producerId:r}})=>{const n=e.sfus[t];n&&delete n.tracks[r]},setTrack=(e,{payload:{id:t,producerId:r,status:n}})=>{const o=e.sfus[t];o?o.tracks[r]=n:e.sfus[t]={tracks:{[r]:n}}},setConsumerConnectionStatus=(e,{payload:{id:t,connectionState:r}})=>{const n=e.sfus[t];n?n.consumerConnectionState=r:e.sfus[t]={consumerConnectionState:r,tracks:{}}},setProducerConnectionStatus=(e,{payload:{id:t,connectionState:r}})=>{const n=e.sfus[t];n?n.producerConnectionState=r:e.sfus[t]={producerConnectionState:r,tracks:{}}},webRtcSliceActionPrefix="webrtc",webrtcSlice=createSlice({name:webRtcSliceActionPrefix,initialState:initialState,reducers:{closeTrack:closeTrack,setTrack:setTrack,setConsumerConnectionStatus:setConsumerConnectionStatus,setProducerConnectionStatus:setProducerConnectionStatus}});class SFU{constructor(e,t,r,n=getUrl(e)){this.id=e,this.store=t,this.selector=r,this.url=n,this.device=new lib$2.Device,this.tracks=new Map,this.promiseCompleter=new PromiseCompleter,this.sentRtpCapabilities=!1,this._requestId=0,this.ws=new WSTransport(n,((e,t)=>this.onTransportMessage(t)),(e=>this.onTransportStateChange(e)),["live-sfu"],!0),this.ws.connect()}async getTrack(e){const t=this.tracks.get(e),r=t?.producer?.track||t?.consumer?.track;if(r)return r;return(await this.consumeTrack(e)).track}async produceTrack(e){const t=await this.producerTransport(),r=await t.produce({track:e,zeroRtpOnPause:!0,disableTrackOnPause:!0,stopTracks:!0});return r.on("transportclose",(()=>console.log(`Producer(${r.id})'s Transport(${t.id}) closed`))),r.on("trackended",(()=>console.log(`Producer(${r.id}) ended`))),this.setTrack(r.id,{producer:r,localPause:r.paused,globalPause:!1}),r}async consumeTrack(e){const t=await this.consumerTransport();await this.sendRtpCapabilities();const r=await this.request({createConsumer:{producerId:e}});if(!r)throw new Error(`Recieved empty response from SFU when trying to consume producerId(${e})`);if(!r.consumerCreated)throw new Error(`Recieved response without consumer parameters from SFU when trying to consume producerId(${e})`);const n=await t.consume(r.consumerCreated);return n.on("transportclose",(()=>console.log(`Consumer(${n.id})'s Transport(${t.id}) closed`))),n.on("trackended",(()=>console.log(`Consumer(${n.id}) ended`))),this.setTrack(n.id,{consumer:n,localPause:n.paused,globalPause:!1}),n}async consumerTransport(){return this._consumerTransport?this._consumerTransport:(this._consumerTransportPromise||(this._consumerTransportPromise=new Promise((async(e,t)=>{try{const e=await this.request({consumerTransport:{}});if(!e)return t("Empty response from SFU");const{consumerTransport:r}=e;return r?(this._consumerTransport=this.device.createRecvTransport(r),this._consumerTransport.on("connect",(({dtlsParameters:e})=>this.request({consumerTransportConnect:{dtlsParameters:e}}))),this._consumerTransport.on("connectionstatechange",(e=>{const t=webrtcSlice.actions.setConsumerConnectionStatus({id:this.id,connectionState:e});this.store.dispatch(t)})),this._consumerTransport):t("Response from SFU does not contain consumer transport")}catch(e){t(e)}}))),this._consumerTransportPromise)}async producerTransport(){return this._producerTransport?this._producerTransport:(this._producerTransportPromise||(this._producerTransportPromise=new Promise((async(e,t)=>{try{const r=await this.request({producerTransport:{}});if(!r)return t("Empty response from SFU");const{producerTransport:n}=r;if(!n)return t("Response from SFU does not contain producer transport");this._producerTransport=this.device.createSendTransport(n),this._producerTransport.on("connect",(({dtlsParameters:e})=>this.request({producerTransportConnect:{dtlsParameters:e}}))),this._producerTransport.on("produce",(e=>this.request({createTrack:e}))),this._producerTransport.on("connectionstatechange",(e=>{const t=webrtcSlice.actions.setProducerConnectionStatus({id:this.id,connectionState:e});this.store.dispatch(t)})),e(this._producerTransport)}catch(e){t(e)}}))),this._producerTransportPromise)}async sendRtpCapabilities(){if(this.sentRtpCapabilities)return;const{rtpCapabilities:e}=this.device;await this.request({rtpCapabilities:e}),this.sentRtpCapabilities=!0}async request(e){const t=this.generateRequestId(),r={id:t,request:e};return await this.ws.send(JSON.stringify(r)),this.promiseCompleter.createPromise(t)}generateRequestId(){return""+this._requestId++}onTransportStateChange(e){}onTransportMessage(e){const t=this.parse(e);if(t)try{this.handleMessage(t)}catch(e){console.error(e)}else this.ws.disconnect(4400)}parse(e){if("string"!=typeof e)return;const t=JSON.parse(e.toString());return"object"==typeof t&&t?t:void 0}async handleMessage(e){e.response&&this.response(e.response),e.consumerPaused&&this.handlePauseMessage(e.consumerPaused),e.producerPaused&&this.handlePauseMessage(e.producerPaused),e.consumerClosed&&this.closeTrack(e.consumerClosed),e.producerClosed&&this.closeTrack(e.producerClosed)}response(e){const{id:t}=e;"error"in e?this.promiseCompleter.reject(t,e.error):this.promiseCompleter.resolve(t,e.result)}closeTrack(e){this.tracks.delete(e);const t=webrtcSlice.actions.closeTrack({id:this.id,producerId:e});this.store.dispatch(t)}setTrack(e,t){this.tracks.set(e,t);const r=webrtcSlice.actions.setTrack({id:this.id,producerId:e,status:{localPause:t.localPause,globalPause:t.globalPause}});this.store.dispatch(r)}handlePauseMessage({id:e,localPause:t,globalPause:r}){const n=this.tracks.get(e);if(!n)return console.error(`Could not find Track(${e}) to pause/resume producer`);n.localPause=t,n.globalPause=r;const o=webrtcSlice.actions.setTrack({id:this.id,producerId:e,status:{localPause:t,globalPause:r}});this.store.dispatch(o)}}function getUrl(e){const t=new URL(window.location.toString());return t.protocol="wss",t.pathname=`/sfu/${e}`,t.toString()}class WebRtcManager{constructor(e,t){this.store=e,this.selector=t,this.sfus=new Map}async globalPause(e,t,r){throw new Error("Not implemented")}async localPause(e,t,r){throw new Error("Not implemented")}getTracks(e,t){const r=this.sfu(e);return t.map((e=>r.getTrack(e)))}async recieveTrack(e,t){const r=this.sfu(e);return await Promise.allSettled(t.map((e=>r.consumeTrack(e))))}async sendTracks(e,t){const r=this.sfu(e);if(r)return await Promise.allSettled(t.map((e=>r.produceTrack(e))))}sfu(e){let t=this.sfus.get(e);return t||(t=new SFU(e,this.store,this.selector),this.sfus.set(e,t)),t}}const WebRtcContext=React.createContext(null);function getUserMedia(e){if(console.log("getUserMedia",e),navigator?.mediaDevices?.getUserMedia)return navigator?.mediaDevices?.getUserMedia(e);throw new Error("Could not get user media")}function useCamera(e){return e||(e={video:!0,audio:!0}),useAsync(getUserMedia,[e],{executeOnUpdate:!1})}function useWebRtcState(e,t){const r=useContext(WebRtcContext);return useSelector((t=>e(r.selector(t))),t)}function useMediaStream(e,t){useWebRtcState((r=>t.map((t=>r.webrtc.sfus[e]?.tracks[t]))));const r=useContext(WebRtcContext),n=useMemo((()=>new MediaStream),[]);return useEffect((()=>{r.getTracks(e,t).forEach((e=>e.then((e=>{n.getTrackById(e.id)||n.addTrack(e)}))))}),[t,e,n]),n}function useSendMediaStream(){const e=useContext(WebRtcContext);return useAsyncCallback((async(t,r)=>{const n=r.getTracks();await e.sendTracks(t,n)}))}function useLocallyPauseMediaStream(){const e=useContext(WebRtcContext);return useAsyncCallback(((t,r)=>e.localPause(t,r,!1)))}function useLocallyResumeMediaStream(){const e=useContext(WebRtcContext);return useAsyncCallback(((t,r)=>e.localPause(t,r,!0)))}function useGloballyPauseMediaStream(){const e=useContext(WebRtcContext);return useAsyncCallback(((t,r)=>e.globalPause(t,r,!0)))}function useGloballyResumeMediaStream(){const e=useContext(WebRtcContext);return useAsyncCallback(((t,r)=>e.globalPause(t,r,!1)))}WebRtcContext.displayName="KidsloopLiveWebRTC";let nanoid=(e=21)=>{let t="",r=crypto.getRandomValues(new Uint8Array(e));for(;e--;){let n=63&r[e];t+=n<36?n.toString(36):n<62?(n-26).toString(36).toUpperCase():n<63?"_":"-"}return t};var indexMinimal={},minimal$1={},aspromise=asPromise;function asPromise(e,t){for(var r=new Array(arguments.length-1),n=0,o=2,i=!0;o<arguments.length;)r[n++]=arguments[o++];return new Promise((function(o,s){r[n]=function(e){if(i)if(i=!1,e)s(e);else{for(var t=new Array(arguments.length-1),r=0;r<t.length;)t[r++]=arguments[r];o.apply(null,t)}};try{e.apply(t||null,r)}catch(e){i&&(i=!1,s(e))}}))}var base64$1={};!function(e){var t=base64$1;t.length=function(e){var t=e.length;if(!t)return 0;for(var r=0;--t%4>1&&"="===e.charAt(t);)++r;return Math.ceil(3*e.length)/4-r};for(var r=new Array(64),n=new Array(123),o=0;o<64;)n[r[o]=o<26?o+65:o<52?o+71:o<62?o-4:o-59|43]=o++;t.encode=function(e,t,n){for(var o,i=null,s=[],a=0,c=0;t<n;){var d=e[t++];switch(c){case 0:s[a++]=r[d>>2],o=(3&d)<<4,c=1;break;case 1:s[a++]=r[o|d>>4],o=(15&d)<<2,c=2;break;case 2:s[a++]=r[o|d>>6],s[a++]=r[63&d],c=0}a>8191&&((i||(i=[])).push(String.fromCharCode.apply(String,s)),a=0)}return c&&(s[a++]=r[o],s[a++]=61,1===c&&(s[a++]=61)),i?(a&&i.push(String.fromCharCode.apply(String,s.slice(0,a))),i.join("")):String.fromCharCode.apply(String,s.slice(0,a))};var i="invalid encoding";t.decode=function(e,t,r){for(var o,s=r,a=0,c=0;c<e.length;){var d=e.charCodeAt(c++);if(61===d&&a>1)break;if(void 0===(d=n[d]))throw Error(i);switch(a){case 0:o=d,a=1;break;case 1:t[r++]=o<<2|(48&d)>>4,o=d,a=2;break;case 2:t[r++]=(15&o)<<4|(60&d)>>2,o=d,a=3;break;case 3:t[r++]=(3&o)<<6|d,a=0}}if(1===a)throw Error(i);return r-s},t.test=function(e){return/^(?:[A-Za-z0-9+/]{4})*(?:[A-Za-z0-9+/]{2}==|[A-Za-z0-9+/]{3}=)?$/.test(e)}}();var eventemitter=EventEmitter;function EventEmitter(){this._listeners={}}EventEmitter.prototype.on=function(e,t,r){return(this._listeners[e]||(this._listeners[e]=[])).push({fn:t,ctx:r||this}),this},EventEmitter.prototype.off=function(e,t){if(void 0===e)this._listeners={};else if(void 0===t)this._listeners[e]=[];else for(var r=this._listeners[e],n=0;n<r.length;)r[n].fn===t?r.splice(n,1):++n;return this},EventEmitter.prototype.emit=function(e){var t=this._listeners[e];if(t){for(var r=[],n=1;n<arguments.length;)r.push(arguments[n++]);for(n=0;n<t.length;)t[n].fn.apply(t[n++].ctx,r)}return this};var float=factory(factory);function factory(e){return"undefined"!=typeof Float32Array?function(){var t=new Float32Array([-0]),r=new Uint8Array(t.buffer),n=128===r[3];function o(e,n,o){t[0]=e,n[o]=r[0],n[o+1]=r[1],n[o+2]=r[2],n[o+3]=r[3]}function i(e,n,o){t[0]=e,n[o]=r[3],n[o+1]=r[2],n[o+2]=r[1],n[o+3]=r[0]}function s(e,n){return r[0]=e[n],r[1]=e[n+1],r[2]=e[n+2],r[3]=e[n+3],t[0]}function a(e,n){return r[3]=e[n],r[2]=e[n+1],r[1]=e[n+2],r[0]=e[n+3],t[0]}e.writeFloatLE=n?o:i,e.writeFloatBE=n?i:o,e.readFloatLE=n?s:a,e.readFloatBE=n?a:s}():function(){function t(e,t,r,n){var o=t<0?1:0;if(o&&(t=-t),0===t)e(1/t>0?0:2147483648,r,n);else if(isNaN(t))e(2143289344,r,n);else if(t>34028234663852886e22)e((o<<31|2139095040)>>>0,r,n);else if(t<11754943508222875e-54)e((o<<31|Math.round(t/1401298464324817e-60))>>>0,r,n);else{var i=Math.floor(Math.log(t)/Math.LN2);e((o<<31|i+127<<23|8388607&Math.round(t*Math.pow(2,-i)*8388608))>>>0,r,n)}}function r(e,t,r){var n=e(t,r),o=2*(n>>31)+1,i=n>>>23&255,s=8388607&n;return 255===i?s?NaN:o*(1/0):0===i?1401298464324817e-60*o*s:o*Math.pow(2,i-150)*(s+8388608)}e.writeFloatLE=t.bind(null,writeUintLE),e.writeFloatBE=t.bind(null,writeUintBE),e.readFloatLE=r.bind(null,readUintLE),e.readFloatBE=r.bind(null,readUintBE)}(),"undefined"!=typeof Float64Array?function(){var t=new Float64Array([-0]),r=new Uint8Array(t.buffer),n=128===r[7];function o(e,n,o){t[0]=e,n[o]=r[0],n[o+1]=r[1],n[o+2]=r[2],n[o+3]=r[3],n[o+4]=r[4],n[o+5]=r[5],n[o+6]=r[6],n[o+7]=r[7]}function i(e,n,o){t[0]=e,n[o]=r[7],n[o+1]=r[6],n[o+2]=r[5],n[o+3]=r[4],n[o+4]=r[3],n[o+5]=r[2],n[o+6]=r[1],n[o+7]=r[0]}function s(e,n){return r[0]=e[n],r[1]=e[n+1],r[2]=e[n+2],r[3]=e[n+3],r[4]=e[n+4],r[5]=e[n+5],r[6]=e[n+6],r[7]=e[n+7],t[0]}function a(e,n){return r[7]=e[n],r[6]=e[n+1],r[5]=e[n+2],r[4]=e[n+3],r[3]=e[n+4],r[2]=e[n+5],r[1]=e[n+6],r[0]=e[n+7],t[0]}e.writeDoubleLE=n?o:i,e.writeDoubleBE=n?i:o,e.readDoubleLE=n?s:a,e.readDoubleBE=n?a:s}():function(){function t(e,t,r,n,o,i){var s=n<0?1:0;if(s&&(n=-n),0===n)e(0,o,i+t),e(1/n>0?0:2147483648,o,i+r);else if(isNaN(n))e(0,o,i+t),e(2146959360,o,i+r);else if(n>17976931348623157e292)e(0,o,i+t),e((s<<31|2146435072)>>>0,o,i+r);else{var a;if(n<22250738585072014e-324)e((a=n/5e-324)>>>0,o,i+t),e((s<<31|a/4294967296)>>>0,o,i+r);else{var c=Math.floor(Math.log(n)/Math.LN2);1024===c&&(c=1023),e(4503599627370496*(a=n*Math.pow(2,-c))>>>0,o,i+t),e((s<<31|c+1023<<20|1048576*a&1048575)>>>0,o,i+r)}}}function r(e,t,r,n,o){var i=e(n,o+t),s=e(n,o+r),a=2*(s>>31)+1,c=s>>>20&2047,d=4294967296*(1048575&s)+i;return 2047===c?d?NaN:a*(1/0):0===c?5e-324*a*d:a*Math.pow(2,c-1075)*(d+4503599627370496)}e.writeDoubleLE=t.bind(null,writeUintLE,0,4),e.writeDoubleBE=t.bind(null,writeUintBE,4,0),e.readDoubleLE=r.bind(null,readUintLE,0,4),e.readDoubleBE=r.bind(null,readUintBE,4,0)}(),e}function writeUintLE(e,t,r){t[r]=255&e,t[r+1]=e>>>8&255,t[r+2]=e>>>16&255,t[r+3]=e>>>24}function writeUintBE(e,t,r){t[r]=e>>>24,t[r+1]=e>>>16&255,t[r+2]=e>>>8&255,t[r+3]=255&e}function readUintLE(e,t){return(e[t]|e[t+1]<<8|e[t+2]<<16|e[t+3]<<24)>>>0}function readUintBE(e,t){return(e[t]<<24|e[t+1]<<16|e[t+2]<<8|e[t+3])>>>0}var inquire_1=inquire;function inquire(moduleName){try{var mod=eval("quire".replace(/^/,"re"))(moduleName);if(mod&&(mod.length||Object.keys(mod).length))return mod}catch(e){}return null}var utf8$2={};!function(e){var t=utf8$2;t.length=function(e){for(var t=0,r=0,n=0;n<e.length;++n)(r=e.charCodeAt(n))<128?t+=1:r<2048?t+=2:55296==(64512&r)&&56320==(64512&e.charCodeAt(n+1))?(++n,t+=4):t+=3;return t},t.read=function(e,t,r){if(r-t<1)return"";for(var n,o=null,i=[],s=0;t<r;)(n=e[t++])<128?i[s++]=n:n>191&&n<224?i[s++]=(31&n)<<6|63&e[t++]:n>239&&n<365?(n=((7&n)<<18|(63&e[t++])<<12|(63&e[t++])<<6|63&e[t++])-65536,i[s++]=55296+(n>>10),i[s++]=56320+(1023&n)):i[s++]=(15&n)<<12|(63&e[t++])<<6|63&e[t++],s>8191&&((o||(o=[])).push(String.fromCharCode.apply(String,i)),s=0);return o?(s&&o.push(String.fromCharCode.apply(String,i.slice(0,s))),o.join("")):String.fromCharCode.apply(String,i.slice(0,s))},t.write=function(e,t,r){for(var n,o,i=r,s=0;s<e.length;++s)(n=e.charCodeAt(s))<128?t[r++]=n:n<2048?(t[r++]=n>>6|192,t[r++]=63&n|128):55296==(64512&n)&&56320==(64512&(o=e.charCodeAt(s+1)))?(n=65536+((1023&n)<<10)+(1023&o),++s,t[r++]=n>>18|240,t[r++]=n>>12&63|128,t[r++]=n>>6&63|128,t[r++]=63&n|128):(t[r++]=n>>12|224,t[r++]=n>>6&63|128,t[r++]=63&n|128);return r-i}}();var pool_1=pool;function pool(e,t,r){var n=r||8192,o=n>>>1,i=null,s=n;return function(r){if(r<1||r>o)return e(r);s+r>n&&(i=e(n),s=0);var a=t.call(i,s,s+=r);return 7&s&&(s=1+(7|s)),a}}var longbits=LongBits$2,util$5=minimal$1;function LongBits$2(e,t){this.lo=e>>>0,this.hi=t>>>0}var zero=LongBits$2.zero=new LongBits$2(0,0);zero.toNumber=function(){return 0},zero.zzEncode=zero.zzDecode=function(){return this},zero.length=function(){return 1};var zeroHash=LongBits$2.zeroHash="\0\0\0\0\0\0\0\0";LongBits$2.fromNumber=function(e){if(0===e)return zero;var t=e<0;t&&(e=-e);var r=e>>>0,n=(e-r)/4294967296>>>0;return t&&(n=~n>>>0,r=~r>>>0,++r>4294967295&&(r=0,++n>4294967295&&(n=0))),new LongBits$2(r,n)},LongBits$2.from=function(e){if("number"==typeof e)return LongBits$2.fromNumber(e);if(util$5.isString(e)){if(!util$5.Long)return LongBits$2.fromNumber(parseInt(e,10));e=util$5.Long.fromString(e)}return e.low||e.high?new LongBits$2(e.low>>>0,e.high>>>0):zero},LongBits$2.prototype.toNumber=function(e){if(!e&&this.hi>>>31){var t=1+~this.lo>>>0,r=~this.hi>>>0;return t||(r=r+1>>>0),-(t+4294967296*r)}return this.lo+4294967296*this.hi},LongBits$2.prototype.toLong=function(e){return util$5.Long?new util$5.Long(0|this.lo,0|this.hi,Boolean(e)):{low:0|this.lo,high:0|this.hi,unsigned:Boolean(e)}};var charCodeAt=String.prototype.charCodeAt;LongBits$2.fromHash=function(e){return e===zeroHash?zero:new LongBits$2((charCodeAt.call(e,0)|charCodeAt.call(e,1)<<8|charCodeAt.call(e,2)<<16|charCodeAt.call(e,3)<<24)>>>0,(charCodeAt.call(e,4)|charCodeAt.call(e,5)<<8|charCodeAt.call(e,6)<<16|charCodeAt.call(e,7)<<24)>>>0)},LongBits$2.prototype.toHash=function(){return String.fromCharCode(255&this.lo,this.lo>>>8&255,this.lo>>>16&255,this.lo>>>24,255&this.hi,this.hi>>>8&255,this.hi>>>16&255,this.hi>>>24)},LongBits$2.prototype.zzEncode=function(){var e=this.hi>>31;return this.hi=((this.hi<<1|this.lo>>>31)^e)>>>0,this.lo=(this.lo<<1^e)>>>0,this},LongBits$2.prototype.zzDecode=function(){var e=-(1&this.lo);return this.lo=((this.lo>>>1|this.hi<<31)^e)>>>0,this.hi=(this.hi>>>1^e)>>>0,this},LongBits$2.prototype.length=function(){var e=this.lo,t=(this.lo>>>28|this.hi<<4)>>>0,r=this.hi>>>24;return 0===r?0===t?e<16384?e<128?1:2:e<2097152?3:4:t<16384?t<128?5:6:t<2097152?7:8:r<128?9:10},function(e){var t=minimal$1;function r(e,t,r){for(var n=Object.keys(t),o=0;o<n.length;++o)void 0!==e[n[o]]&&r||(e[n[o]]=t[n[o]]);return e}function n(e){function t(e,n){if(!(this instanceof t))return new t(e,n);Object.defineProperty(this,"message",{get:function(){return e}}),Error.captureStackTrace?Error.captureStackTrace(this,t):Object.defineProperty(this,"stack",{value:(new Error).stack||""}),n&&r(this,n)}return(t.prototype=Object.create(Error.prototype)).constructor=t,Object.defineProperty(t.prototype,"name",{get:function(){return e}}),t.prototype.toString=function(){return this.name+": "+this.message},t}t.asPromise=aspromise,t.base64=base64$1,t.EventEmitter=eventemitter,t.float=float,t.inquire=inquire_1,t.utf8=utf8$2,t.pool=pool_1,t.LongBits=longbits,t.isNode=Boolean(void 0!==commonjsGlobal&&commonjsGlobal&&commonjsGlobal.process&&commonjsGlobal.process.versions&&commonjsGlobal.process.versions.node),t.global=t.isNode&&commonjsGlobal||"undefined"!=typeof window&&window||"undefined"!=typeof self&&self||commonjsGlobal,t.emptyArray=Object.freeze?Object.freeze([]):[],t.emptyObject=Object.freeze?Object.freeze({}):{},t.isInteger=Number.isInteger||function(e){return"number"==typeof e&&isFinite(e)&&Math.floor(e)===e},t.isString=function(e){return"string"==typeof e||e instanceof String},t.isObject=function(e){return e&&"object"==typeof e},t.isset=t.isSet=function(e,t){var r=e[t];return!(null==r||!e.hasOwnProperty(t))&&("object"!=typeof r||(Array.isArray(r)?r.length:Object.keys(r).length)>0)},t.Buffer=function(){try{var e=t.inquire("buffer").Buffer;return e.prototype.utf8Write?e:null}catch(e){return null}}(),t._Buffer_from=null,t._Buffer_allocUnsafe=null,t.newBuffer=function(e){return"number"==typeof e?t.Buffer?t._Buffer_allocUnsafe(e):new t.Array(e):t.Buffer?t._Buffer_from(e):"undefined"==typeof Uint8Array?e:new Uint8Array(e)},t.Array="undefined"!=typeof Uint8Array?Uint8Array:Array,t.Long=t.global.dcodeIO&&t.global.dcodeIO.Long||t.global.Long||t.inquire("long"),t.key2Re=/^true|false|0|1$/,t.key32Re=/^-?(?:0|[1-9][0-9]*)$/,t.key64Re=/^(?:[\\x00-\\xff]{8}|-?(?:0|[1-9][0-9]*))$/,t.longToHash=function(e){return e?t.LongBits.from(e).toHash():t.LongBits.zeroHash},t.longFromHash=function(e,r){var n=t.LongBits.fromHash(e);return t.Long?t.Long.fromBits(n.lo,n.hi,r):n.toNumber(Boolean(r))},t.merge=r,t.lcFirst=function(e){return e.charAt(0).toLowerCase()+e.substring(1)},t.newError=n,t.ProtocolError=n("ProtocolError"),t.oneOfGetter=function(e){for(var t={},r=0;r<e.length;++r)t[e[r]]=1;return function(){for(var e=Object.keys(this),r=e.length-1;r>-1;--r)if(1===t[e[r]]&&void 0!==this[e[r]]&&null!==this[e[r]])return e[r]}},t.oneOfSetter=function(e){return function(t){for(var r=0;r<e.length;++r)e[r]!==t&&delete this[e[r]]}},t.toJSONOptions={longs:String,enums:String,bytes:String,json:!0},t._configure=function(){var e=t.Buffer;e?(t._Buffer_from=e.from!==Uint8Array.from&&e.from||function(t,r){return new e(t,r)},t._Buffer_allocUnsafe=e.allocUnsafe||function(t){return new e(t)}):t._Buffer_from=t._Buffer_allocUnsafe=null}}();var writer=Writer$1,util$4=minimal$1,BufferWriter$1,LongBits$1=util$4.LongBits,base64=util$4.base64,utf8$1=util$4.utf8;function Op(e,t,r){this.fn=e,this.len=t,this.next=void 0,this.val=r}function noop(){}function State(e){this.head=e.head,this.tail=e.tail,this.len=e.len,this.next=e.states}function Writer$1(){this.len=0,this.head=new Op(noop,0,0),this.tail=this.head,this.states=null}var create$1=function(){return util$4.Buffer?function(){return(Writer$1.create=function(){return new BufferWriter$1})()}:function(){return new Writer$1}};function writeByte(e,t,r){t[r]=255&e}function writeVarint32(e,t,r){for(;e>127;)t[r++]=127&e|128,e>>>=7;t[r]=e}function VarintOp(e,t){this.len=e,this.next=void 0,this.val=t}function writeVarint64(e,t,r){for(;e.hi;)t[r++]=127&e.lo|128,e.lo=(e.lo>>>7|e.hi<<25)>>>0,e.hi>>>=7;for(;e.lo>127;)t[r++]=127&e.lo|128,e.lo=e.lo>>>7;t[r++]=e.lo}function writeFixed32(e,t,r){t[r]=255&e,t[r+1]=e>>>8&255,t[r+2]=e>>>16&255,t[r+3]=e>>>24}Writer$1.create=create$1(),Writer$1.alloc=function(e){return new util$4.Array(e)},util$4.Array!==Array&&(Writer$1.alloc=util$4.pool(Writer$1.alloc,util$4.Array.prototype.subarray)),Writer$1.prototype._push=function(e,t,r){return this.tail=this.tail.next=new Op(e,t,r),this.len+=t,this},VarintOp.prototype=Object.create(Op.prototype),VarintOp.prototype.fn=writeVarint32,Writer$1.prototype.uint32=function(e){return this.len+=(this.tail=this.tail.next=new VarintOp((e>>>=0)<128?1:e<16384?2:e<2097152?3:e<268435456?4:5,e)).len,this},Writer$1.prototype.int32=function(e){return e<0?this._push(writeVarint64,10,LongBits$1.fromNumber(e)):this.uint32(e)},Writer$1.prototype.sint32=function(e){return this.uint32((e<<1^e>>31)>>>0)},Writer$1.prototype.uint64=function(e){var t=LongBits$1.from(e);return this._push(writeVarint64,t.length(),t)},Writer$1.prototype.int64=Writer$1.prototype.uint64,Writer$1.prototype.sint64=function(e){var t=LongBits$1.from(e).zzEncode();return this._push(writeVarint64,t.length(),t)},Writer$1.prototype.bool=function(e){return this._push(writeByte,1,e?1:0)},Writer$1.prototype.fixed32=function(e){return this._push(writeFixed32,4,e>>>0)},Writer$1.prototype.sfixed32=Writer$1.prototype.fixed32,Writer$1.prototype.fixed64=function(e){var t=LongBits$1.from(e);return this._push(writeFixed32,4,t.lo)._push(writeFixed32,4,t.hi)},Writer$1.prototype.sfixed64=Writer$1.prototype.fixed64,Writer$1.prototype.float=function(e){return this._push(util$4.float.writeFloatLE,4,e)},Writer$1.prototype.double=function(e){return this._push(util$4.float.writeDoubleLE,8,e)};var writeBytes=util$4.Array.prototype.set?function(e,t,r){t.set(e,r)}:function(e,t,r){for(var n=0;n<e.length;++n)t[r+n]=e[n]};Writer$1.prototype.bytes=function(e){var t=e.length>>>0;if(!t)return this._push(writeByte,1,0);if(util$4.isString(e)){var r=Writer$1.alloc(t=base64.length(e));base64.decode(e,r,0),e=r}return this.uint32(t)._push(writeBytes,t,e)},Writer$1.prototype.string=function(e){var t=utf8$1.length(e);return t?this.uint32(t)._push(utf8$1.write,t,e):this._push(writeByte,1,0)},Writer$1.prototype.fork=function(){return this.states=new State(this),this.head=this.tail=new Op(noop,0,0),this.len=0,this},Writer$1.prototype.reset=function(){return this.states?(this.head=this.states.head,this.tail=this.states.tail,this.len=this.states.len,this.states=this.states.next):(this.head=this.tail=new Op(noop,0,0),this.len=0),this},Writer$1.prototype.ldelim=function(){var e=this.head,t=this.tail,r=this.len;return this.reset().uint32(r),r&&(this.tail.next=e.next,this.tail=t,this.len+=r),this},Writer$1.prototype.finish=function(){for(var e=this.head.next,t=this.constructor.alloc(this.len),r=0;e;)e.fn(e.val,t,r),r+=e.len,e=e.next;return t},Writer$1._configure=function(e){BufferWriter$1=e,Writer$1.create=create$1(),BufferWriter$1._configure()};var writer_buffer=BufferWriter,Writer=writer;(BufferWriter.prototype=Object.create(Writer.prototype)).constructor=BufferWriter;var util$3=minimal$1;function BufferWriter(){Writer.call(this)}function writeStringBuffer(e,t,r){e.length<40?util$3.utf8.write(e,t,r):t.utf8Write?t.utf8Write(e,r):t.write(e,r)}BufferWriter._configure=function(){BufferWriter.alloc=util$3._Buffer_allocUnsafe,BufferWriter.writeBytesBuffer=util$3.Buffer&&util$3.Buffer.prototype instanceof Uint8Array&&"set"===util$3.Buffer.prototype.set.name?function(e,t,r){t.set(e,r)}:function(e,t,r){if(e.copy)e.copy(t,r,0,e.length);else for(var n=0;n<e.length;)t[r++]=e[n++]}},BufferWriter.prototype.bytes=function(e){util$3.isString(e)&&(e=util$3._Buffer_from(e,"base64"));var t=e.length>>>0;return this.uint32(t),t&&this._push(BufferWriter.writeBytesBuffer,t,e),this},BufferWriter.prototype.string=function(e){var t=util$3.Buffer.byteLength(e);return this.uint32(t),t&&this._push(writeStringBuffer,t,e),this},BufferWriter._configure();var reader=Reader$1,util$2=minimal$1,BufferReader$1,LongBits=util$2.LongBits,utf8=util$2.utf8;function indexOutOfRange(e,t){return RangeError("index out of range: "+e.pos+" + "+(t||1)+" > "+e.len)}function Reader$1(e){this.buf=e,this.pos=0,this.len=e.length}var create_array="undefined"!=typeof Uint8Array?function(e){if(e instanceof Uint8Array||Array.isArray(e))return new Reader$1(e);throw Error("illegal buffer")}:function(e){if(Array.isArray(e))return new Reader$1(e);throw Error("illegal buffer")},create=function(){return util$2.Buffer?function(e){return(Reader$1.create=function(e){return util$2.Buffer.isBuffer(e)?new BufferReader$1(e):create_array(e)})(e)}:create_array},value;function readLongVarint(){var e=new LongBits(0,0),t=0;if(!(this.len-this.pos>4)){for(;t<3;++t){if(this.pos>=this.len)throw indexOutOfRange(this);if(e.lo=(e.lo|(127&this.buf[this.pos])<<7*t)>>>0,this.buf[this.pos++]<128)return e}return e.lo=(e.lo|(127&this.buf[this.pos++])<<7*t)>>>0,e}for(;t<4;++t)if(e.lo=(e.lo|(127&this.buf[this.pos])<<7*t)>>>0,this.buf[this.pos++]<128)return e;if(e.lo=(e.lo|(127&this.buf[this.pos])<<28)>>>0,e.hi=(e.hi|(127&this.buf[this.pos])>>4)>>>0,this.buf[this.pos++]<128)return e;if(t=0,this.len-this.pos>4){for(;t<5;++t)if(e.hi=(e.hi|(127&this.buf[this.pos])<<7*t+3)>>>0,this.buf[this.pos++]<128)return e}else for(;t<5;++t){if(this.pos>=this.len)throw indexOutOfRange(this);if(e.hi=(e.hi|(127&this.buf[this.pos])<<7*t+3)>>>0,this.buf[this.pos++]<128)return e}throw Error("invalid varint encoding")}function readFixed32_end(e,t){return(e[t-4]|e[t-3]<<8|e[t-2]<<16|e[t-1]<<24)>>>0}function readFixed64(){if(this.pos+8>this.len)throw indexOutOfRange(this,8);return new LongBits(readFixed32_end(this.buf,this.pos+=4),readFixed32_end(this.buf,this.pos+=4))}Reader$1.create=create(),Reader$1.prototype._slice=util$2.Array.prototype.subarray||util$2.Array.prototype.slice,Reader$1.prototype.uint32=(value=4294967295,function(){if(value=(127&this.buf[this.pos])>>>0,this.buf[this.pos++]<128)return value;if(value=(value|(127&this.buf[this.pos])<<7)>>>0,this.buf[this.pos++]<128)return value;if(value=(value|(127&this.buf[this.pos])<<14)>>>0,this.buf[this.pos++]<128)return value;if(value=(value|(127&this.buf[this.pos])<<21)>>>0,this.buf[this.pos++]<128)return value;if(value=(value|(15&this.buf[this.pos])<<28)>>>0,this.buf[this.pos++]<128)return value;if((this.pos+=5)>this.len)throw this.pos=this.len,indexOutOfRange(this,10);return value}),Reader$1.prototype.int32=function(){return 0|this.uint32()},Reader$1.prototype.sint32=function(){var e=this.uint32();return e>>>1^-(1&e)|0},Reader$1.prototype.bool=function(){return 0!==this.uint32()},Reader$1.prototype.fixed32=function(){if(this.pos+4>this.len)throw indexOutOfRange(this,4);return readFixed32_end(this.buf,this.pos+=4)},Reader$1.prototype.sfixed32=function(){if(this.pos+4>this.len)throw indexOutOfRange(this,4);return 0|readFixed32_end(this.buf,this.pos+=4)},Reader$1.prototype.float=function(){if(this.pos+4>this.len)throw indexOutOfRange(this,4);var e=util$2.float.readFloatLE(this.buf,this.pos);return this.pos+=4,e},Reader$1.prototype.double=function(){if(this.pos+8>this.len)throw indexOutOfRange(this,4);var e=util$2.float.readDoubleLE(this.buf,this.pos);return this.pos+=8,e},Reader$1.prototype.bytes=function(){var e=this.uint32(),t=this.pos,r=this.pos+e;if(r>this.len)throw indexOutOfRange(this,e);return this.pos+=e,Array.isArray(this.buf)?this.buf.slice(t,r):t===r?new this.buf.constructor(0):this._slice.call(this.buf,t,r)},Reader$1.prototype.string=function(){var e=this.bytes();return utf8.read(e,0,e.length)},Reader$1.prototype.skip=function(e){if("number"==typeof e){if(this.pos+e>this.len)throw indexOutOfRange(this,e);this.pos+=e}else do{if(this.pos>=this.len)throw indexOutOfRange(this)}while(128&this.buf[this.pos++]);return this},Reader$1.prototype.skipType=function(e){switch(e){case 0:this.skip();break;case 1:this.skip(8);break;case 2:this.skip(this.uint32());break;case 3:for(;4!=(e=7&this.uint32());)this.skipType(e);break;case 5:this.skip(4);break;default:throw Error("invalid wire type "+e+" at offset "+this.pos)}return this},Reader$1._configure=function(e){BufferReader$1=e,Reader$1.create=create(),BufferReader$1._configure();var t=util$2.Long?"toLong":"toNumber";util$2.merge(Reader$1.prototype,{int64:function(){return readLongVarint.call(this)[t](!1)},uint64:function(){return readLongVarint.call(this)[t](!0)},sint64:function(){return readLongVarint.call(this).zzDecode()[t](!1)},fixed64:function(){return readFixed64.call(this)[t](!0)},sfixed64:function(){return readFixed64.call(this)[t](!1)}})};var reader_buffer=BufferReader,Reader=reader;(BufferReader.prototype=Object.create(Reader.prototype)).constructor=BufferReader;var util$1=minimal$1;function BufferReader(e){Reader.call(this,e)}BufferReader._configure=function(){util$1.Buffer&&(BufferReader.prototype._slice=util$1.Buffer.prototype.slice)},BufferReader.prototype.string=function(){var e=this.uint32();return this.buf.utf8Slice?this.buf.utf8Slice(this.pos,this.pos=Math.min(this.pos+e,this.len)):this.buf.toString("utf-8",this.pos,this.pos=Math.min(this.pos+e,this.len))},BufferReader._configure();var rpc={},service=Service,util=minimal$1,exports;function Service(e,t,r){if("function"!=typeof e)throw TypeError("rpcImpl must be a function");util.EventEmitter.call(this),this.rpcImpl=e,this.requestDelimited=Boolean(t),this.responseDelimited=Boolean(r)}(Service.prototype=Object.create(util.EventEmitter.prototype)).constructor=Service,Service.prototype.rpcCall=function e(t,r,n,o,i){if(!o)throw TypeError("request must be specified");var s=this;if(!i)return util.asPromise(e,s,t,r,n,o);if(s.rpcImpl)try{return s.rpcImpl(t,r[s.requestDelimited?"encodeDelimited":"encode"](o).finish(),(function(e,r){if(e)return s.emit("error",e,t),i(e);if(null!==r){if(!(r instanceof n))try{r=n[s.responseDelimited?"decodeDelimited":"decode"](r)}catch(e){return s.emit("error",e,t),i(e)}return s.emit("data",r,t),i(null,r)}s.end(!0)}))}catch(e){return s.emit("error",e,t),void setTimeout((function(){i(e)}),0)}else setTimeout((function(){i(Error("already ended"))}),0)},Service.prototype.end=function(e){return this.rpcImpl&&(e||this.rpcImpl(null,null,null),this.rpcImpl=null,this.emit("end").off()),this},exports=rpc,exports.Service=service;var roots={};!function(e){var t=indexMinimal;function r(){t.util._configure(),t.Writer._configure(t.BufferWriter),t.Reader._configure(t.BufferReader)}t.build="minimal",t.Writer=writer,t.BufferWriter=writer_buffer,t.Reader=reader,t.BufferReader=reader_buffer,t.util=minimal$1,t.rpc=rpc,t.roots=roots,t.configure=r,r()}();var minimal=indexMinimal,$protobuf=minimal,$Reader=$protobuf.Reader,$Writer=$protobuf.Writer,$util=$protobuf.util,$root=$protobuf.roots.default||($protobuf.roots.default={});$root.ClassRequest=function(){function e(e){if(e)for(var t=Object.keys(e),r=0;r<t.length;++r)null!=e[t[r]]&&(this[t[r]]=e[t[r]])}var t;return e.prototype.requestId="",e.prototype.endClass=null,e.prototype.setHost=null,e.prototype.setContent=null,e.prototype.setActivityStreamId=null,e.prototype.rewardTrophyToUser=null,e.prototype.rewardTrophyToAll=null,e.prototype.sendChatMessage=null,Object.defineProperty(e.prototype,"command",{get:$util.oneOfGetter(t=["endClass","setHost","setContent","setActivityStreamId","rewardTrophyToUser","rewardTrophyToAll","sendChatMessage"]),set:$util.oneOfSetter(t)}),e.create=function(t){return new e(t)},e.encode=function(e,t){return t||(t=$Writer.create()),null!=e.requestId&&Object.hasOwnProperty.call(e,"requestId")&&t.uint32(10).string(e.requestId),null!=e.endClass&&Object.hasOwnProperty.call(e,"endClass")&&$root.EndClassCommand.encode(e.endClass,t.uint32(50).fork()).ldelim(),null!=e.setHost&&Object.hasOwnProperty.call(e,"setHost")&&$root.SetHostCommand.encode(e.setHost,t.uint32(58).fork()).ldelim(),null!=e.setContent&&Object.hasOwnProperty.call(e,"setContent")&&$root.SetContentCommand.encode(e.setContent,t.uint32(66).fork()).ldelim(),null!=e.setActivityStreamId&&Object.hasOwnProperty.call(e,"setActivityStreamId")&&$root.SetActivityStreamIdCommand.encode(e.setActivityStreamId,t.uint32(74).fork()).ldelim(),null!=e.rewardTrophyToUser&&Object.hasOwnProperty.call(e,"rewardTrophyToUser")&&$root.RewardTrophyToUserCommand.encode(e.rewardTrophyToUser,t.uint32(82).fork()).ldelim(),null!=e.rewardTrophyToAll&&Object.hasOwnProperty.call(e,"rewardTrophyToAll")&&$root.RewardTrophyToAllCommand.encode(e.rewardTrophyToAll,t.uint32(90).fork()).ldelim(),null!=e.sendChatMessage&&Object.hasOwnProperty.call(e,"sendChatMessage")&&$root.SendChatMessageCommand.encode(e.sendChatMessage,t.uint32(98).fork()).ldelim(),t},e.encodeDelimited=function(e,t){return this.encode(e,t).ldelim()},e.decode=function(e,t){e instanceof $Reader||(e=$Reader.create(e));for(var r=void 0===t?e.len:e.pos+t,n=new $root.ClassRequest;e.pos<r;){var o=e.uint32();switch(o>>>3){case 1:n.requestId=e.string();break;case 6:n.endClass=$root.EndClassCommand.decode(e,e.uint32());break;case 7:n.setHost=$root.SetHostCommand.decode(e,e.uint32());break;case 8:n.setContent=$root.SetContentCommand.decode(e,e.uint32());break;case 9:n.setActivityStreamId=$root.SetActivityStreamIdCommand.decode(e,e.uint32());break;case 10:n.rewardTrophyToUser=$root.RewardTrophyToUserCommand.decode(e,e.uint32());break;case 11:n.rewardTrophyToAll=$root.RewardTrophyToAllCommand.decode(e,e.uint32());break;case 12:n.sendChatMessage=$root.SendChatMessageCommand.decode(e,e.uint32());break;default:e.skipType(7&o)}}return n},e.decodeDelimited=function(e){return e instanceof $Reader||(e=new $Reader(e)),this.decode(e,e.uint32())},e.verify=function(e){if("object"!=typeof e||null===e)return"object expected";var t={};if(null!=e.requestId&&e.hasOwnProperty("requestId")&&!$util.isString(e.requestId))return"requestId: string expected";if(null!=e.endClass&&e.hasOwnProperty("endClass")&&(t.command=1,r=$root.EndClassCommand.verify(e.endClass)))return"endClass."+r;if(null!=e.setHost&&e.hasOwnProperty("setHost")){if(1===t.command)return"command: multiple values";if(t.command=1,r=$root.SetHostCommand.verify(e.setHost))return"setHost."+r}if(null!=e.setContent&&e.hasOwnProperty("setContent")){if(1===t.command)return"command: multiple values";if(t.command=1,r=$root.SetContentCommand.verify(e.setContent))return"setContent."+r}if(null!=e.setActivityStreamId&&e.hasOwnProperty("setActivityStreamId")){if(1===t.command)return"command: multiple values";if(t.command=1,r=$root.SetActivityStreamIdCommand.verify(e.setActivityStreamId))return"setActivityStreamId."+r}if(null!=e.rewardTrophyToUser&&e.hasOwnProperty("rewardTrophyToUser")){if(1===t.command)return"command: multiple values";if(t.command=1,r=$root.RewardTrophyToUserCommand.verify(e.rewardTrophyToUser))return"rewardTrophyToUser."+r}if(null!=e.rewardTrophyToAll&&e.hasOwnProperty("rewardTrophyToAll")){if(1===t.command)return"command: multiple values";if(t.command=1,r=$root.RewardTrophyToAllCommand.verify(e.rewardTrophyToAll))return"rewardTrophyToAll."+r}if(null!=e.sendChatMessage&&e.hasOwnProperty("sendChatMessage")){if(1===t.command)return"command: multiple values";var r;if(t.command=1,r=$root.SendChatMessageCommand.verify(e.sendChatMessage))return"sendChatMessage."+r}return null},e.fromObject=function(e){if(e instanceof $root.ClassRequest)return e;var t=new $root.ClassRequest;if(null!=e.requestId&&(t.requestId=String(e.requestId)),null!=e.endClass){if("object"!=typeof e.endClass)throw TypeError(".ClassRequest.endClass: object expected");t.endClass=$root.EndClassCommand.fromObject(e.endClass)}if(null!=e.setHost){if("object"!=typeof e.setHost)throw TypeError(".ClassRequest.setHost: object expected");t.setHost=$root.SetHostCommand.fromObject(e.setHost)}if(null!=e.setContent){if("object"!=typeof e.setContent)throw TypeError(".ClassRequest.setContent: object expected");t.setContent=$root.SetContentCommand.fromObject(e.setContent)}if(null!=e.setActivityStreamId){if("object"!=typeof e.setActivityStreamId)throw TypeError(".ClassRequest.setActivityStreamId: object expected");t.setActivityStreamId=$root.SetActivityStreamIdCommand.fromObject(e.setActivityStreamId)}if(null!=e.rewardTrophyToUser){if("object"!=typeof e.rewardTrophyToUser)throw TypeError(".ClassRequest.rewardTrophyToUser: object expected");t.rewardTrophyToUser=$root.RewardTrophyToUserCommand.fromObject(e.rewardTrophyToUser)}if(null!=e.rewardTrophyToAll){if("object"!=typeof e.rewardTrophyToAll)throw TypeError(".ClassRequest.rewardTrophyToAll: object expected");t.rewardTrophyToAll=$root.RewardTrophyToAllCommand.fromObject(e.rewardTrophyToAll)}if(null!=e.sendChatMessage){if("object"!=typeof e.sendChatMessage)throw TypeError(".ClassRequest.sendChatMessage: object expected");t.sendChatMessage=$root.SendChatMessageCommand.fromObject(e.sendChatMessage)}return t},e.toObject=function(e,t){t||(t={});var r={};return t.defaults&&(r.requestId=""),null!=e.requestId&&e.hasOwnProperty("requestId")&&(r.requestId=e.requestId),null!=e.endClass&&e.hasOwnProperty("endClass")&&(r.endClass=$root.EndClassCommand.toObject(e.endClass,t),t.oneofs&&(r.command="endClass")),null!=e.setHost&&e.hasOwnProperty("setHost")&&(r.setHost=$root.SetHostCommand.toObject(e.setHost,t),t.oneofs&&(r.command="setHost")),null!=e.setContent&&e.hasOwnProperty("setContent")&&(r.setContent=$root.SetContentCommand.toObject(e.setContent,t),t.oneofs&&(r.command="setContent")),null!=e.setActivityStreamId&&e.hasOwnProperty("setActivityStreamId")&&(r.setActivityStreamId=$root.SetActivityStreamIdCommand.toObject(e.setActivityStreamId,t),t.oneofs&&(r.command="setActivityStreamId")),null!=e.rewardTrophyToUser&&e.hasOwnProperty("rewardTrophyToUser")&&(r.rewardTrophyToUser=$root.RewardTrophyToUserCommand.toObject(e.rewardTrophyToUser,t),t.oneofs&&(r.command="rewardTrophyToUser")),null!=e.rewardTrophyToAll&&e.hasOwnProperty("rewardTrophyToAll")&&(r.rewardTrophyToAll=$root.RewardTrophyToAllCommand.toObject(e.rewardTrophyToAll,t),t.oneofs&&(r.command="rewardTrophyToAll")),null!=e.sendChatMessage&&e.hasOwnProperty("sendChatMessage")&&(r.sendChatMessage=$root.SendChatMessageCommand.toObject(e.sendChatMessage,t),t.oneofs&&(r.command="sendChatMessage")),r},e.prototype.toJSON=function(){return this.constructor.toObject(this,$protobuf.util.toJSONOptions)},e}(),$root.ClassResponse=function(){function e(e){if(e)for(var t=Object.keys(e),r=0;r<t.length;++r)null!=e[t[r]]&&(this[t[r]]=e[t[r]])}return e.prototype.id="",e.prototype.error="",e.create=function(t){return new e(t)},e.encode=function(e,t){return t||(t=$Writer.create()),null!=e.id&&Object.hasOwnProperty.call(e,"id")&&t.uint32(10).string(e.id),null!=e.error&&Object.hasOwnProperty.call(e,"error")&&t.uint32(18).string(e.error),t},e.encodeDelimited=function(e,t){return this.encode(e,t).ldelim()},e.decode=function(e,t){e instanceof $Reader||(e=$Reader.create(e));for(var r=void 0===t?e.len:e.pos+t,n=new $root.ClassResponse;e.pos<r;){var o=e.uint32();switch(o>>>3){case 1:n.id=e.string();break;case 2:n.error=e.string();break;default:e.skipType(7&o)}}return n},e.decodeDelimited=function(e){return e instanceof $Reader||(e=new $Reader(e)),this.decode(e,e.uint32())},e.verify=function(e){return"object"!=typeof e||null===e?"object expected":null!=e.id&&e.hasOwnProperty("id")&&!$util.isString(e.id)?"id: string expected":null!=e.error&&e.hasOwnProperty("error")&&!$util.isString(e.error)?"error: string expected":null},e.fromObject=function(e){if(e instanceof $root.ClassResponse)return e;var t=new $root.ClassResponse;return null!=e.id&&(t.id=String(e.id)),null!=e.error&&(t.error=String(e.error)),t},e.toObject=function(e,t){t||(t={});var r={};return t.defaults&&(r.id="",r.error=""),null!=e.id&&e.hasOwnProperty("id")&&(r.id=e.id),null!=e.error&&e.hasOwnProperty("error")&&(r.error=e.error),r},e.prototype.toJSON=function(){return this.constructor.toObject(this,$protobuf.util.toJSONOptions)},e}(),$root.ClassMessage=function(){function e(e){if(e)for(var t=Object.keys(e),r=0;r<t.length;++r)null!=e[t[r]]&&(this[t[r]]=e[t[r]])}var t;return e.prototype.response=null,e.prototype.joinEvent=null,e.prototype.deviceConnected=null,e.prototype.deviceDisconnected=null,e.prototype.classEnded=null,e.prototype.hostChanged=null,e.prototype.contentChanged=null,e.prototype.activityStreamIdChanged=null,e.prototype.trophyRewardedToUser=null,e.prototype.trophyRewardedToAll=null,e.prototype.newChatMessage=null,Object.defineProperty(e.prototype,"event",{get:$util.oneOfGetter(t=["joinEvent","deviceConnected","deviceDisconnected","classEnded","hostChanged","contentChanged","activityStreamIdChanged","trophyRewardedToUser","trophyRewardedToAll","newChatMessage"]),set:$util.oneOfSetter(t)}),e.create=function(t){return new e(t)},e.encode=function(e,t){return t||(t=$Writer.create()),null!=e.response&&Object.hasOwnProperty.call(e,"response")&&$root.ClassResponse.encode(e.response,t.uint32(10).fork()).ldelim(),null!=e.joinEvent&&Object.hasOwnProperty.call(e,"joinEvent")&&$root.JoinEvent.encode(e.joinEvent,t.uint32(26).fork()).ldelim(),null!=e.deviceConnected&&Object.hasOwnProperty.call(e,"deviceConnected")&&$root.DeviceConnectedEvent.encode(e.deviceConnected,t.uint32(34).fork()).ldelim(),null!=e.deviceDisconnected&&Object.hasOwnProperty.call(e,"deviceDisconnected")&&$root.DeviceDisconnectedEvent.encode(e.deviceDisconnected,t.uint32(42).fork()).ldelim(),null!=e.classEnded&&Object.hasOwnProperty.call(e,"classEnded")&&$root.ClassEndedEvent.encode(e.classEnded,t.uint32(50).fork()).ldelim(),null!=e.hostChanged&&Object.hasOwnProperty.call(e,"hostChanged")&&$root.HostChangedEvent.encode(e.hostChanged,t.uint32(58).fork()).ldelim(),null!=e.contentChanged&&Object.hasOwnProperty.call(e,"contentChanged")&&$root.ContentChangedEvent.encode(e.contentChanged,t.uint32(66).fork()).ldelim(),null!=e.activityStreamIdChanged&&Object.hasOwnProperty.call(e,"activityStreamIdChanged")&&$root.ActivityStreamIdChangedEvent.encode(e.activityStreamIdChanged,t.uint32(74).fork()).ldelim(),null!=e.trophyRewardedToUser&&Object.hasOwnProperty.call(e,"trophyRewardedToUser")&&$root.TrophyRewardedToUserEvent.encode(e.trophyRewardedToUser,t.uint32(82).fork()).ldelim(),null!=e.trophyRewardedToAll&&Object.hasOwnProperty.call(e,"trophyRewardedToAll")&&$root.TrophyRewardedToAllEvent.encode(e.trophyRewardedToAll,t.uint32(90).fork()).ldelim(),null!=e.newChatMessage&&Object.hasOwnProperty.call(e,"newChatMessage")&&$root.NewChatMessageEvent.encode(e.newChatMessage,t.uint32(98).fork()).ldelim(),t},e.encodeDelimited=function(e,t){return this.encode(e,t).ldelim()},e.decode=function(e,t){e instanceof $Reader||(e=$Reader.create(e));for(var r=void 0===t?e.len:e.pos+t,n=new $root.ClassMessage;e.pos<r;){var o=e.uint32();switch(o>>>3){case 1:n.response=$root.ClassResponse.decode(e,e.uint32());break;case 3:n.joinEvent=$root.JoinEvent.decode(e,e.uint32());break;case 4:n.deviceConnected=$root.DeviceConnectedEvent.decode(e,e.uint32());break;case 5:n.deviceDisconnected=$root.DeviceDisconnectedEvent.decode(e,e.uint32());break;case 6:n.classEnded=$root.ClassEndedEvent.decode(e,e.uint32());break;case 7:n.hostChanged=$root.HostChangedEvent.decode(e,e.uint32());break;case 8:n.contentChanged=$root.ContentChangedEvent.decode(e,e.uint32());break;case 9:n.activityStreamIdChanged=$root.ActivityStreamIdChangedEvent.decode(e,e.uint32());break;case 10:n.trophyRewardedToUser=$root.TrophyRewardedToUserEvent.decode(e,e.uint32());break;case 11:n.trophyRewardedToAll=$root.TrophyRewardedToAllEvent.decode(e,e.uint32());break;case 12:n.newChatMessage=$root.NewChatMessageEvent.decode(e,e.uint32());break;default:e.skipType(7&o)}}return n},e.decodeDelimited=function(e){return e instanceof $Reader||(e=new $Reader(e)),this.decode(e,e.uint32())},e.verify=function(e){if("object"!=typeof e||null===e)return"object expected";var t={};if(null!=e.response&&e.hasOwnProperty("response")&&(r=$root.ClassResponse.verify(e.response)))return"response."+r;if(null!=e.joinEvent&&e.hasOwnProperty("joinEvent")&&(t.event=1,r=$root.JoinEvent.verify(e.joinEvent)))return"joinEvent."+r;if(null!=e.deviceConnected&&e.hasOwnProperty("deviceConnected")){if(1===t.event)return"event: multiple values";if(t.event=1,r=$root.DeviceConnectedEvent.verify(e.deviceConnected))return"deviceConnected."+r}if(null!=e.deviceDisconnected&&e.hasOwnProperty("deviceDisconnected")){if(1===t.event)return"event: multiple values";if(t.event=1,r=$root.DeviceDisconnectedEvent.verify(e.deviceDisconnected))return"deviceDisconnected."+r}if(null!=e.classEnded&&e.hasOwnProperty("classEnded")){if(1===t.event)return"event: multiple values";if(t.event=1,r=$root.ClassEndedEvent.verify(e.classEnded))return"classEnded."+r}if(null!=e.hostChanged&&e.hasOwnProperty("hostChanged")){if(1===t.event)return"event: multiple values";if(t.event=1,r=$root.HostChangedEvent.verify(e.hostChanged))return"hostChanged."+r}if(null!=e.contentChanged&&e.hasOwnProperty("contentChanged")){if(1===t.event)return"event: multiple values";if(t.event=1,r=$root.ContentChangedEvent.verify(e.contentChanged))return"contentChanged."+r}if(null!=e.activityStreamIdChanged&&e.hasOwnProperty("activityStreamIdChanged")){if(1===t.event)return"event: multiple values";if(t.event=1,r=$root.ActivityStreamIdChangedEvent.verify(e.activityStreamIdChanged))return"activityStreamIdChanged."+r}if(null!=e.trophyRewardedToUser&&e.hasOwnProperty("trophyRewardedToUser")){if(1===t.event)return"event: multiple values";if(t.event=1,r=$root.TrophyRewardedToUserEvent.verify(e.trophyRewardedToUser))return"trophyRewardedToUser."+r}if(null!=e.trophyRewardedToAll&&e.hasOwnProperty("trophyRewardedToAll")){if(1===t.event)return"event: multiple values";if(t.event=1,r=$root.TrophyRewardedToAllEvent.verify(e.trophyRewardedToAll))return"trophyRewardedToAll."+r}if(null!=e.newChatMessage&&e.hasOwnProperty("newChatMessage")){if(1===t.event)return"event: multiple values";var r;if(t.event=1,r=$root.NewChatMessageEvent.verify(e.newChatMessage))return"newChatMessage."+r}return null},e.fromObject=function(e){if(e instanceof $root.ClassMessage)return e;var t=new $root.ClassMessage;if(null!=e.response){if("object"!=typeof e.response)throw TypeError(".ClassMessage.response: object expected");t.response=$root.ClassResponse.fromObject(e.response)}if(null!=e.joinEvent){if("object"!=typeof e.joinEvent)throw TypeError(".ClassMessage.joinEvent: object expected");t.joinEvent=$root.JoinEvent.fromObject(e.joinEvent)}if(null!=e.deviceConnected){if("object"!=typeof e.deviceConnected)throw TypeError(".ClassMessage.deviceConnected: object expected");t.deviceConnected=$root.DeviceConnectedEvent.fromObject(e.deviceConnected)}if(null!=e.deviceDisconnected){if("object"!=typeof e.deviceDisconnected)throw TypeError(".ClassMessage.deviceDisconnected: object expected");t.deviceDisconnected=$root.DeviceDisconnectedEvent.fromObject(e.deviceDisconnected)}if(null!=e.classEnded){if("object"!=typeof e.classEnded)throw TypeError(".ClassMessage.classEnded: object expected");t.classEnded=$root.ClassEndedEvent.fromObject(e.classEnded)}if(null!=e.hostChanged){if("object"!=typeof e.hostChanged)throw TypeError(".ClassMessage.hostChanged: object expected");t.hostChanged=$root.HostChangedEvent.fromObject(e.hostChanged)}if(null!=e.contentChanged){if("object"!=typeof e.contentChanged)throw TypeError(".ClassMessage.contentChanged: object expected");t.contentChanged=$root.ContentChangedEvent.fromObject(e.contentChanged)}if(null!=e.activityStreamIdChanged){if("object"!=typeof e.activityStreamIdChanged)throw TypeError(".ClassMessage.activityStreamIdChanged: object expected");t.activityStreamIdChanged=$root.ActivityStreamIdChangedEvent.fromObject(e.activityStreamIdChanged)}if(null!=e.trophyRewardedToUser){if("object"!=typeof e.trophyRewardedToUser)throw TypeError(".ClassMessage.trophyRewardedToUser: object expected");t.trophyRewardedToUser=$root.TrophyRewardedToUserEvent.fromObject(e.trophyRewardedToUser)}if(null!=e.trophyRewardedToAll){if("object"!=typeof e.trophyRewardedToAll)throw TypeError(".ClassMessage.trophyRewardedToAll: object expected");t.trophyRewardedToAll=$root.TrophyRewardedToAllEvent.fromObject(e.trophyRewardedToAll)}if(null!=e.newChatMessage){if("object"!=typeof e.newChatMessage)throw TypeError(".ClassMessage.newChatMessage: object expected");t.newChatMessage=$root.NewChatMessageEvent.fromObject(e.newChatMessage)}return t},e.toObject=function(e,t){t||(t={});var r={};return t.defaults&&(r.response=null),null!=e.response&&e.hasOwnProperty("response")&&(r.response=$root.ClassResponse.toObject(e.response,t)),null!=e.joinEvent&&e.hasOwnProperty("joinEvent")&&(r.joinEvent=$root.JoinEvent.toObject(e.joinEvent,t),t.oneofs&&(r.event="joinEvent")),null!=e.deviceConnected&&e.hasOwnProperty("deviceConnected")&&(r.deviceConnected=$root.DeviceConnectedEvent.toObject(e.deviceConnected,t),t.oneofs&&(r.event="deviceConnected")),null!=e.deviceDisconnected&&e.hasOwnProperty("deviceDisconnected")&&(r.deviceDisconnected=$root.DeviceDisconnectedEvent.toObject(e.deviceDisconnected,t),t.oneofs&&(r.event="deviceDisconnected")),null!=e.classEnded&&e.hasOwnProperty("classEnded")&&(r.classEnded=$root.ClassEndedEvent.toObject(e.classEnded,t),t.oneofs&&(r.event="classEnded")),null!=e.hostChanged&&e.hasOwnProperty("hostChanged")&&(r.hostChanged=$root.HostChangedEvent.toObject(e.hostChanged,t),t.oneofs&&(r.event="hostChanged")),null!=e.contentChanged&&e.hasOwnProperty("contentChanged")&&(r.contentChanged=$root.ContentChangedEvent.toObject(e.contentChanged,t),t.oneofs&&(r.event="contentChanged")),null!=e.activityStreamIdChanged&&e.hasOwnProperty("activityStreamIdChanged")&&(r.activityStreamIdChanged=$root.ActivityStreamIdChangedEvent.toObject(e.activityStreamIdChanged,t),t.oneofs&&(r.event="activityStreamIdChanged")),null!=e.trophyRewardedToUser&&e.hasOwnProperty("trophyRewardedToUser")&&(r.trophyRewardedToUser=$root.TrophyRewardedToUserEvent.toObject(e.trophyRewardedToUser,t),t.oneofs&&(r.event="trophyRewardedToUser")),null!=e.trophyRewardedToAll&&e.hasOwnProperty("trophyRewardedToAll")&&(r.trophyRewardedToAll=$root.TrophyRewardedToAllEvent.toObject(e.trophyRewardedToAll,t),t.oneofs&&(r.event="trophyRewardedToAll")),null!=e.newChatMessage&&e.hasOwnProperty("newChatMessage")&&(r.newChatMessage=$root.NewChatMessageEvent.toObject(e.newChatMessage,t),t.oneofs&&(r.event="newChatMessage")),r},e.prototype.toJSON=function(){return this.constructor.toObject(this,$protobuf.util.toJSONOptions)},e}(),$root.EndClassCommand=function(){function e(e){if(e)for(var t=Object.keys(e),r=0;r<t.length;++r)null!=e[t[r]]&&(this[t[r]]=e[t[r]])}return e.create=function(t){return new e(t)},e.encode=function(e,t){return t||(t=$Writer.create()),t},e.encodeDelimited=function(e,t){return this.encode(e,t).ldelim()},e.decode=function(e,t){e instanceof $Reader||(e=$Reader.create(e));for(var r=void 0===t?e.len:e.pos+t,n=new $root.EndClassCommand;e.pos<r;){var o=e.uint32();e.skipType(7&o)}return n},e.decodeDelimited=function(e){return e instanceof $Reader||(e=new $Reader(e)),this.decode(e,e.uint32())},e.verify=function(e){return"object"!=typeof e||null===e?"object expected":null},e.fromObject=function(e){return e instanceof $root.EndClassCommand?e:new $root.EndClassCommand},e.toObject=function(){return{}},e.prototype.toJSON=function(){return this.constructor.toObject(this,$protobuf.util.toJSONOptions)},e}(),$root.SetHostCommand=function(){function e(e){if(e)for(var t=Object.keys(e),r=0;r<t.length;++r)null!=e[t[r]]&&(this[t[r]]=e[t[r]])}return e.prototype.hostDeviceId="",e.create=function(t){return new e(t)},e.encode=function(e,t){return t||(t=$Writer.create()),null!=e.hostDeviceId&&Object.hasOwnProperty.call(e,"hostDeviceId")&&t.uint32(10).string(e.hostDeviceId),t},e.encodeDelimited=function(e,t){return this.encode(e,t).ldelim()},e.decode=function(e,t){e instanceof $Reader||(e=$Reader.create(e));for(var r=void 0===t?e.len:e.pos+t,n=new $root.SetHostCommand;e.pos<r;){var o=e.uint32();if(o>>>3==1)n.hostDeviceId=e.string();else e.skipType(7&o)}return n},e.decodeDelimited=function(e){return e instanceof $Reader||(e=new $Reader(e)),this.decode(e,e.uint32())},e.verify=function(e){return"object"!=typeof e||null===e?"object expected":null!=e.hostDeviceId&&e.hasOwnProperty("hostDeviceId")&&!$util.isString(e.hostDeviceId)?"hostDeviceId: string expected":null},e.fromObject=function(e){if(e instanceof $root.SetHostCommand)return e;var t=new $root.SetHostCommand;return null!=e.hostDeviceId&&(t.hostDeviceId=String(e.hostDeviceId)),t},e.toObject=function(e,t){t||(t={});var r={};return t.defaults&&(r.hostDeviceId=""),null!=e.hostDeviceId&&e.hasOwnProperty("hostDeviceId")&&(r.hostDeviceId=e.hostDeviceId),r},e.prototype.toJSON=function(){return this.constructor.toObject(this,$protobuf.util.toJSONOptions)},e}(),$root.SetContentCommand=function(){function e(e){if(e)for(var t=Object.keys(e),r=0;r<t.length;++r)null!=e[t[r]]&&(this[t[r]]=e[t[r]])}return e.prototype.content=null,e.create=function(t){return new e(t)},e.encode=function(e,t){return t||(t=$Writer.create()),null!=e.content&&Object.hasOwnProperty.call(e,"content")&&$root.Content.encode(e.content,t.uint32(10).fork()).ldelim(),t},e.encodeDelimited=function(e,t){return this.encode(e,t).ldelim()},e.decode=function(e,t){e instanceof $Reader||(e=$Reader.create(e));for(var r=void 0===t?e.len:e.pos+t,n=new $root.SetContentCommand;e.pos<r;){var o=e.uint32();if(o>>>3==1)n.content=$root.Content.decode(e,e.uint32());else e.skipType(7&o)}return n},e.decodeDelimited=function(e){return e instanceof $Reader||(e=new $Reader(e)),this.decode(e,e.uint32())},e.verify=function(e){if("object"!=typeof e||null===e)return"object expected";if(null!=e.content&&e.hasOwnProperty("content")){var t=$root.Content.verify(e.content);if(t)return"content."+t}return null},e.fromObject=function(e){if(e instanceof $root.SetContentCommand)return e;var t=new $root.SetContentCommand;if(null!=e.content){if("object"!=typeof e.content)throw TypeError(".SetContentCommand.content: object expected");t.content=$root.Content.fromObject(e.content)}return t},e.toObject=function(e,t){t||(t={});var r={};return t.defaults&&(r.content=null),null!=e.content&&e.hasOwnProperty("content")&&(r.content=$root.Content.toObject(e.content,t)),r},e.prototype.toJSON=function(){return this.constructor.toObject(this,$protobuf.util.toJSONOptions)},e}(),$root.SetActivityStreamIdCommand=function(){function e(e){if(e)for(var t=Object.keys(e),r=0;r<t.length;++r)null!=e[t[r]]&&(this[t[r]]=e[t[r]])}return e.prototype.activityStreamId="",e.create=function(t){return new e(t)},e.encode=function(e,t){return t||(t=$Writer.create()),null!=e.activityStreamId&&Object.hasOwnProperty.call(e,"activityStreamId")&&t.uint32(10).string(e.activityStreamId),t},e.encodeDelimited=function(e,t){return this.encode(e,t).ldelim()},e.decode=function(e,t){e instanceof $Reader||(e=$Reader.create(e));for(var r=void 0===t?e.len:e.pos+t,n=new $root.SetActivityStreamIdCommand;e.pos<r;){var o=e.uint32();if(o>>>3==1)n.activityStreamId=e.string();else e.skipType(7&o)}return n},e.decodeDelimited=function(e){return e instanceof $Reader||(e=new $Reader(e)),this.decode(e,e.uint32())},e.verify=function(e){return"object"!=typeof e||null===e?"object expected":null!=e.activityStreamId&&e.hasOwnProperty("activityStreamId")&&!$util.isString(e.activityStreamId)?"activityStreamId: string expected":null},e.fromObject=function(e){if(e instanceof $root.SetActivityStreamIdCommand)return e;var t=new $root.SetActivityStreamIdCommand;return null!=e.activityStreamId&&(t.activityStreamId=String(e.activityStreamId)),t},e.toObject=function(e,t){t||(t={});var r={};return t.defaults&&(r.activityStreamId=""),null!=e.activityStreamId&&e.hasOwnProperty("activityStreamId")&&(r.activityStreamId=e.activityStreamId),r},e.prototype.toJSON=function(){return this.constructor.toObject(this,$protobuf.util.toJSONOptions)},e}(),$root.RewardTrophyToUserCommand=function(){function e(e){if(e)for(var t=Object.keys(e),r=0;r<t.length;++r)null!=e[t[r]]&&(this[t[r]]=e[t[r]])}return e.prototype.trophyType="",e.prototype.toUserId="",e.create=function(t){return new e(t)},e.encode=function(e,t){return t||(t=$Writer.create()),null!=e.trophyType&&Object.hasOwnProperty.call(e,"trophyType")&&t.uint32(10).string(e.trophyType),null!=e.toUserId&&Object.hasOwnProperty.call(e,"toUserId")&&t.uint32(18).string(e.toUserId),t},e.encodeDelimited=function(e,t){return this.encode(e,t).ldelim()},e.decode=function(e,t){e instanceof $Reader||(e=$Reader.create(e));for(var r=void 0===t?e.len:e.pos+t,n=new $root.RewardTrophyToUserCommand;e.pos<r;){var o=e.uint32();switch(o>>>3){case 1:n.trophyType=e.string();break;case 2:n.toUserId=e.string();break;default:e.skipType(7&o)}}return n},e.decodeDelimited=function(e){return e instanceof $Reader||(e=new $Reader(e)),this.decode(e,e.uint32())},e.verify=function(e){return"object"!=typeof e||null===e?"object expected":null!=e.trophyType&&e.hasOwnProperty("trophyType")&&!$util.isString(e.trophyType)?"trophyType: string expected":null!=e.toUserId&&e.hasOwnProperty("toUserId")&&!$util.isString(e.toUserId)?"toUserId: string expected":null},e.fromObject=function(e){if(e instanceof $root.RewardTrophyToUserCommand)return e;var t=new $root.RewardTrophyToUserCommand;return null!=e.trophyType&&(t.trophyType=String(e.trophyType)),null!=e.toUserId&&(t.toUserId=String(e.toUserId)),t},e.toObject=function(e,t){t||(t={});var r={};return t.defaults&&(r.trophyType="",r.toUserId=""),null!=e.trophyType&&e.hasOwnProperty("trophyType")&&(r.trophyType=e.trophyType),null!=e.toUserId&&e.hasOwnProperty("toUserId")&&(r.toUserId=e.toUserId),r},e.prototype.toJSON=function(){return this.constructor.toObject(this,$protobuf.util.toJSONOptions)},e}(),$root.RewardTrophyToAllCommand=function(){function e(e){if(e)for(var t=Object.keys(e),r=0;r<t.length;++r)null!=e[t[r]]&&(this[t[r]]=e[t[r]])}return e.prototype.trophyType="",e.create=function(t){return new e(t)},e.encode=function(e,t){return t||(t=$Writer.create()),null!=e.trophyType&&Object.hasOwnProperty.call(e,"trophyType")&&t.uint32(10).string(e.trophyType),t},e.encodeDelimited=function(e,t){return this.encode(e,t).ldelim()},e.decode=function(e,t){e instanceof $Reader||(e=$Reader.create(e));for(var r=void 0===t?e.len:e.pos+t,n=new $root.RewardTrophyToAllCommand;e.pos<r;){var o=e.uint32();if(o>>>3==1)n.trophyType=e.string();else e.skipType(7&o)}return n},e.decodeDelimited=function(e){return e instanceof $Reader||(e=new $Reader(e)),this.decode(e,e.uint32())},e.verify=function(e){return"object"!=typeof e||null===e?"object expected":null!=e.trophyType&&e.hasOwnProperty("trophyType")&&!$util.isString(e.trophyType)?"trophyType: string expected":null},e.fromObject=function(e){if(e instanceof $root.RewardTrophyToAllCommand)return e;var t=new $root.RewardTrophyToAllCommand;return null!=e.trophyType&&(t.trophyType=String(e.trophyType)),t},e.toObject=function(e,t){t||(t={});var r={};return t.defaults&&(r.trophyType=""),null!=e.trophyType&&e.hasOwnProperty("trophyType")&&(r.trophyType=e.trophyType),r},e.prototype.toJSON=function(){return this.constructor.toObject(this,$protobuf.util.toJSONOptions)},e}(),$root.SendChatMessageCommand=function(){function e(e){if(e)for(var t=Object.keys(e),r=0;r<t.length;++r)null!=e[t[r]]&&(this[t[r]]=e[t[r]])}return e.prototype.text="",e.create=function(t){return new e(t)},e.encode=function(e,t){return t||(t=$Writer.create()),null!=e.text&&Object.hasOwnProperty.call(e,"text")&&t.uint32(10).string(e.text),t},e.encodeDelimited=function(e,t){return this.encode(e,t).ldelim()},e.decode=function(e,t){e instanceof $Reader||(e=$Reader.create(e));for(var r=void 0===t?e.len:e.pos+t,n=new $root.SendChatMessageCommand;e.pos<r;){var o=e.uint32();if(o>>>3==1)n.text=e.string();else e.skipType(7&o)}return n},e.decodeDelimited=function(e){return e instanceof $Reader||(e=new $Reader(e)),this.decode(e,e.uint32())},e.verify=function(e){return"object"!=typeof e||null===e?"object expected":null!=e.text&&e.hasOwnProperty("text")&&!$util.isString(e.text)?"text: string expected":null},e.fromObject=function(e){if(e instanceof $root.SendChatMessageCommand)return e;var t=new $root.SendChatMessageCommand;return null!=e.text&&(t.text=String(e.text)),t},e.toObject=function(e,t){t||(t={});var r={};return t.defaults&&(r.text=""),null!=e.text&&e.hasOwnProperty("text")&&(r.text=e.text),r},e.prototype.toJSON=function(){return this.constructor.toObject(this,$protobuf.util.toJSONOptions)},e}(),$root.JoinEvent=function(){function e(e){if(e)for(var t=Object.keys(e),r=0;r<t.length;++r)null!=e[t[r]]&&(this[t[r]]=e[t[r]])}return e.prototype.state=null,e.prototype.deviceId="",e.create=function(t){return new e(t)},e.encode=function(e,t){return t||(t=$Writer.create()),null!=e.state&&Object.hasOwnProperty.call(e,"state")&&$root.ClassState.encode(e.state,t.uint32(10).fork()).ldelim(),null!=e.deviceId&&Object.hasOwnProperty.call(e,"deviceId")&&t.uint32(18).string(e.deviceId),t},e.encodeDelimited=function(e,t){return this.encode(e,t).ldelim()},e.decode=function(e,t){e instanceof $Reader||(e=$Reader.create(e));for(var r=void 0===t?e.len:e.pos+t,n=new $root.JoinEvent;e.pos<r;){var o=e.uint32();switch(o>>>3){case 1:n.state=$root.ClassState.decode(e,e.uint32());break;case 2:n.deviceId=e.string();break;default:e.skipType(7&o)}}return n},e.decodeDelimited=function(e){return e instanceof $Reader||(e=new $Reader(e)),this.decode(e,e.uint32())},e.verify=function(e){if("object"!=typeof e||null===e)return"object expected";if(null!=e.state&&e.hasOwnProperty("state")){var t=$root.ClassState.verify(e.state);if(t)return"state."+t}return null!=e.deviceId&&e.hasOwnProperty("deviceId")&&!$util.isString(e.deviceId)?"deviceId: string expected":null},e.fromObject=function(e){if(e instanceof $root.JoinEvent)return e;var t=new $root.JoinEvent;if(null!=e.state){if("object"!=typeof e.state)throw TypeError(".JoinEvent.state: object expected");t.state=$root.ClassState.fromObject(e.state)}return null!=e.deviceId&&(t.deviceId=String(e.deviceId)),t},e.toObject=function(e,t){t||(t={});var r={};return t.defaults&&(r.state=null,r.deviceId=""),null!=e.state&&e.hasOwnProperty("state")&&(r.state=$root.ClassState.toObject(e.state,t)),null!=e.deviceId&&e.hasOwnProperty("deviceId")&&(r.deviceId=e.deviceId),r},e.prototype.toJSON=function(){return this.constructor.toObject(this,$protobuf.util.toJSONOptions)},e}(),$root.ClassEndedEvent=function(){function e(e){if(e)for(var t=Object.keys(e),r=0;r<t.length;++r)null!=e[t[r]]&&(this[t[r]]=e[t[r]])}return e.prototype.timestamp=$util.Long?$util.Long.fromBits(0,0,!0):0,e.create=function(t){return new e(t)},e.encode=function(e,t){return t||(t=$Writer.create()),null!=e.timestamp&&Object.hasOwnProperty.call(e,"timestamp")&&t.uint32(8).uint64(e.timestamp),t},e.encodeDelimited=function(e,t){return this.encode(e,t).ldelim()},e.decode=function(e,t){e instanceof $Reader||(e=$Reader.create(e));for(var r=void 0===t?e.len:e.pos+t,n=new $root.ClassEndedEvent;e.pos<r;){var o=e.uint32();if(o>>>3==1)n.timestamp=e.uint64();else e.skipType(7&o)}return n},e.decodeDelimited=function(e){return e instanceof $Reader||(e=new $Reader(e)),this.decode(e,e.uint32())},e.verify=function(e){return"object"!=typeof e||null===e?"object expected":null!=e.timestamp&&e.hasOwnProperty("timestamp")&&!($util.isInteger(e.timestamp)||e.timestamp&&$util.isInteger(e.timestamp.low)&&$util.isInteger(e.timestamp.high))?"timestamp: integer|Long expected":null},e.fromObject=function(e){if(e instanceof $root.ClassEndedEvent)return e;var t=new $root.ClassEndedEvent;return null!=e.timestamp&&($util.Long?(t.timestamp=$util.Long.fromValue(e.timestamp)).unsigned=!0:"string"==typeof e.timestamp?t.timestamp=parseInt(e.timestamp,10):"number"==typeof e.timestamp?t.timestamp=e.timestamp:"object"==typeof e.timestamp&&(t.timestamp=new $util.LongBits(e.timestamp.low>>>0,e.timestamp.high>>>0).toNumber(!0))),t},e.toObject=function(e,t){t||(t={});var r={};if(t.defaults)if($util.Long){var n=new $util.Long(0,0,!0);r.timestamp=t.longs===String?n.toString():t.longs===Number?n.toNumber():n}else r.timestamp=t.longs===String?"0":0;return null!=e.timestamp&&e.hasOwnProperty("timestamp")&&("number"==typeof e.timestamp?r.timestamp=t.longs===String?String(e.timestamp):e.timestamp:r.timestamp=t.longs===String?$util.Long.prototype.toString.call(e.timestamp):t.longs===Number?new $util.LongBits(e.timestamp.low>>>0,e.timestamp.high>>>0).toNumber(!0):e.timestamp),r},e.prototype.toJSON=function(){return this.constructor.toObject(this,$protobuf.util.toJSONOptions)},e}(),$root.DeviceConnectedEvent=function(){function e(e){if(e)for(var t=Object.keys(e),r=0;r<t.length;++r)null!=e[t[r]]&&(this[t[r]]=e[t[r]])}return e.prototype.name="",e.prototype.role="",e.prototype.device=null,e.create=function(t){return new e(t)},e.encode=function(e,t){return t||(t=$Writer.create()),null!=e.name&&Object.hasOwnProperty.call(e,"name")&&t.uint32(10).string(e.name),null!=e.role&&Object.hasOwnProperty.call(e,"role")&&t.uint32(18).string(e.role),null!=e.device&&Object.hasOwnProperty.call(e,"device")&&$root.Device.encode(e.device,t.uint32(26).fork()).ldelim(),t},e.encodeDelimited=function(e,t){return this.encode(e,t).ldelim()},e.decode=function(e,t){e instanceof $Reader||(e=$Reader.create(e));for(var r=void 0===t?e.len:e.pos+t,n=new $root.DeviceConnectedEvent;e.pos<r;){var o=e.uint32();switch(o>>>3){case 1:n.name=e.string();break;case 2:n.role=e.string();break;case 3:n.device=$root.Device.decode(e,e.uint32());break;default:e.skipType(7&o)}}return n},e.decodeDelimited=function(e){return e instanceof $Reader||(e=new $Reader(e)),this.decode(e,e.uint32())},e.verify=function(e){if("object"!=typeof e||null===e)return"object expected";if(null!=e.name&&e.hasOwnProperty("name")&&!$util.isString(e.name))return"name: string expected";if(null!=e.role&&e.hasOwnProperty("role")&&!$util.isString(e.role))return"role: string expected";if(null!=e.device&&e.hasOwnProperty("device")){var t=$root.Device.verify(e.device);if(t)return"device."+t}return null},e.fromObject=function(e){if(e instanceof $root.DeviceConnectedEvent)return e;var t=new $root.DeviceConnectedEvent;if(null!=e.name&&(t.name=String(e.name)),null!=e.role&&(t.role=String(e.role)),null!=e.device){if("object"!=typeof e.device)throw TypeError(".DeviceConnectedEvent.device: object expected");t.device=$root.Device.fromObject(e.device)}return t},e.toObject=function(e,t){t||(t={});var r={};return t.defaults&&(r.name="",r.role="",r.device=null),null!=e.name&&e.hasOwnProperty("name")&&(r.name=e.name),null!=e.role&&e.hasOwnProperty("role")&&(r.role=e.role),null!=e.device&&e.hasOwnProperty("device")&&(r.device=$root.Device.toObject(e.device,t)),r},e.prototype.toJSON=function(){return this.constructor.toObject(this,$protobuf.util.toJSONOptions)},e}(),$root.DeviceDisconnectedEvent=function(){function e(e){if(e)for(var t=Object.keys(e),r=0;r<t.length;++r)null!=e[t[r]]&&(this[t[r]]=e[t[r]])}return e.prototype.deviceId="",e.create=function(t){return new e(t)},e.encode=function(e,t){return t||(t=$Writer.create()),null!=e.deviceId&&Object.hasOwnProperty.call(e,"deviceId")&&t.uint32(10).string(e.deviceId),t},e.encodeDelimited=function(e,t){return this.encode(e,t).ldelim()},e.decode=function(e,t){e instanceof $Reader||(e=$Reader.create(e));for(var r=void 0===t?e.len:e.pos+t,n=new $root.DeviceDisconnectedEvent;e.pos<r;){var o=e.uint32();if(o>>>3==1)n.deviceId=e.string();else e.skipType(7&o)}return n},e.decodeDelimited=function(e){return e instanceof $Reader||(e=new $Reader(e)),this.decode(e,e.uint32())},e.verify=function(e){return"object"!=typeof e||null===e?"object expected":null!=e.deviceId&&e.hasOwnProperty("deviceId")&&!$util.isString(e.deviceId)?"deviceId: string expected":null},e.fromObject=function(e){if(e instanceof $root.DeviceDisconnectedEvent)return e;var t=new $root.DeviceDisconnectedEvent;return null!=e.deviceId&&(t.deviceId=String(e.deviceId)),t},e.toObject=function(e,t){t||(t={});var r={};return t.defaults&&(r.deviceId=""),null!=e.deviceId&&e.hasOwnProperty("deviceId")&&(r.deviceId=e.deviceId),r},e.prototype.toJSON=function(){return this.constructor.toObject(this,$protobuf.util.toJSONOptions)},e}(),$root.HostChangedEvent=function(){function e(e){if(e)for(var t=Object.keys(e),r=0;r<t.length;++r)null!=e[t[r]]&&(this[t[r]]=e[t[r]])}return e.prototype.hostDeviceId="",e.create=function(t){return new e(t)},e.encode=function(e,t){return t||(t=$Writer.create()),null!=e.hostDeviceId&&Object.hasOwnProperty.call(e,"hostDeviceId")&&t.uint32(10).string(e.hostDeviceId),t},e.encodeDelimited=function(e,t){return this.encode(e,t).ldelim()},e.decode=function(e,t){e instanceof $Reader||(e=$Reader.create(e));for(var r=void 0===t?e.len:e.pos+t,n=new $root.HostChangedEvent;e.pos<r;){var o=e.uint32();if(o>>>3==1)n.hostDeviceId=e.string();else e.skipType(7&o)}return n},e.decodeDelimited=function(e){return e instanceof $Reader||(e=new $Reader(e)),this.decode(e,e.uint32())},e.verify=function(e){return"object"!=typeof e||null===e?"object expected":null!=e.hostDeviceId&&e.hasOwnProperty("hostDeviceId")&&!$util.isString(e.hostDeviceId)?"hostDeviceId: string expected":null},e.fromObject=function(e){if(e instanceof $root.HostChangedEvent)return e;var t=new $root.HostChangedEvent;return null!=e.hostDeviceId&&(t.hostDeviceId=String(e.hostDeviceId)),t},e.toObject=function(e,t){t||(t={});var r={};return t.defaults&&(r.hostDeviceId=""),null!=e.hostDeviceId&&e.hasOwnProperty("hostDeviceId")&&(r.hostDeviceId=e.hostDeviceId),r},e.prototype.toJSON=function(){return this.constructor.toObject(this,$protobuf.util.toJSONOptions)},e}(),$root.ContentChangedEvent=function(){function e(e){if(e)for(var t=Object.keys(e),r=0;r<t.length;++r)null!=e[t[r]]&&(this[t[r]]=e[t[r]])}return e.prototype.content=null,e.create=function(t){return new e(t)},e.encode=function(e,t){return t||(t=$Writer.create()),null!=e.content&&Object.hasOwnProperty.call(e,"content")&&$root.Content.encode(e.content,t.uint32(10).fork()).ldelim(),t},e.encodeDelimited=function(e,t){return this.encode(e,t).ldelim()},e.decode=function(e,t){e instanceof $Reader||(e=$Reader.create(e));for(var r=void 0===t?e.len:e.pos+t,n=new $root.ContentChangedEvent;e.pos<r;){var o=e.uint32();if(o>>>3==1)n.content=$root.Content.decode(e,e.uint32());else e.skipType(7&o)}return n},e.decodeDelimited=function(e){return e instanceof $Reader||(e=new $Reader(e)),this.decode(e,e.uint32())},e.verify=function(e){if("object"!=typeof e||null===e)return"object expected";if(null!=e.content&&e.hasOwnProperty("content")){var t=$root.Content.verify(e.content);if(t)return"content."+t}return null},e.fromObject=function(e){if(e instanceof $root.ContentChangedEvent)return e;var t=new $root.ContentChangedEvent;if(null!=e.content){if("object"!=typeof e.content)throw TypeError(".ContentChangedEvent.content: object expected");t.content=$root.Content.fromObject(e.content)}return t},e.toObject=function(e,t){t||(t={});var r={};return t.defaults&&(r.content=null),null!=e.content&&e.hasOwnProperty("content")&&(r.content=$root.Content.toObject(e.content,t)),r},e.prototype.toJSON=function(){return this.constructor.toObject(this,$protobuf.util.toJSONOptions)},e}(),$root.ActivityStreamIdChangedEvent=function(){function e(e){if(e)for(var t=Object.keys(e),r=0;r<t.length;++r)null!=e[t[r]]&&(this[t[r]]=e[t[r]])}return e.prototype.deviceId="",e.prototype.activityStreamId="",e.create=function(t){return new e(t)},e.encode=function(e,t){return t||(t=$Writer.create()),null!=e.deviceId&&Object.hasOwnProperty.call(e,"deviceId")&&t.uint32(10).string(e.deviceId),null!=e.activityStreamId&&Object.hasOwnProperty.call(e,"activityStreamId")&&t.uint32(18).string(e.activityStreamId),t},e.encodeDelimited=function(e,t){return this.encode(e,t).ldelim()},e.decode=function(e,t){e instanceof $Reader||(e=$Reader.create(e));for(var r=void 0===t?e.len:e.pos+t,n=new $root.ActivityStreamIdChangedEvent;e.pos<r;){var o=e.uint32();switch(o>>>3){case 1:n.deviceId=e.string();break;case 2:n.activityStreamId=e.string();break;default:e.skipType(7&o)}}return n},e.decodeDelimited=function(e){return e instanceof $Reader||(e=new $Reader(e)),this.decode(e,e.uint32())},e.verify=function(e){return"object"!=typeof e||null===e?"object expected":null!=e.deviceId&&e.hasOwnProperty("deviceId")&&!$util.isString(e.deviceId)?"deviceId: string expected":null!=e.activityStreamId&&e.hasOwnProperty("activityStreamId")&&!$util.isString(e.activityStreamId)?"activityStreamId: string expected":null},e.fromObject=function(e){if(e instanceof $root.ActivityStreamIdChangedEvent)return e;var t=new $root.ActivityStreamIdChangedEvent;return null!=e.deviceId&&(t.deviceId=String(e.deviceId)),null!=e.activityStreamId&&(t.activityStreamId=String(e.activityStreamId)),t},e.toObject=function(e,t){t||(t={});var r={};return t.defaults&&(r.deviceId="",r.activityStreamId=""),null!=e.deviceId&&e.hasOwnProperty("deviceId")&&(r.deviceId=e.deviceId),null!=e.activityStreamId&&e.hasOwnProperty("activityStreamId")&&(r.activityStreamId=e.activityStreamId),r},e.prototype.toJSON=function(){return this.constructor.toObject(this,$protobuf.util.toJSONOptions)},e}(),$root.TrophyRewardedToUserEvent=function(){function e(e){if(e)for(var t=Object.keys(e),r=0;r<t.length;++r)null!=e[t[r]]&&(this[t[r]]=e[t[r]])}return e.prototype.trophy=null,e.prototype.toUserId="",e.create=function(t){return new e(t)},e.encode=function(e,t){return t||(t=$Writer.create()),null!=e.trophy&&Object.hasOwnProperty.call(e,"trophy")&&$root.Trophy.encode(e.trophy,t.uint32(10).fork()).ldelim(),null!=e.toUserId&&Object.hasOwnProperty.call(e,"toUserId")&&t.uint32(18).string(e.toUserId),t},e.encodeDelimited=function(e,t){return this.encode(e,t).ldelim()},e.decode=function(e,t){e instanceof $Reader||(e=$Reader.create(e));for(var r=void 0===t?e.len:e.pos+t,n=new $root.TrophyRewardedToUserEvent;e.pos<r;){var o=e.uint32();switch(o>>>3){case 1:n.trophy=$root.Trophy.decode(e,e.uint32());break;case 2:n.toUserId=e.string();break;default:e.skipType(7&o)}}return n},e.decodeDelimited=function(e){return e instanceof $Reader||(e=new $Reader(e)),this.decode(e,e.uint32())},e.verify=function(e){if("object"!=typeof e||null===e)return"object expected";if(null!=e.trophy&&e.hasOwnProperty("trophy")){var t=$root.Trophy.verify(e.trophy);if(t)return"trophy."+t}return null!=e.toUserId&&e.hasOwnProperty("toUserId")&&!$util.isString(e.toUserId)?"toUserId: string expected":null},e.fromObject=function(e){if(e instanceof $root.TrophyRewardedToUserEvent)return e;var t=new $root.TrophyRewardedToUserEvent;if(null!=e.trophy){if("object"!=typeof e.trophy)throw TypeError(".TrophyRewardedToUserEvent.trophy: object expected");t.trophy=$root.Trophy.fromObject(e.trophy)}return null!=e.toUserId&&(t.toUserId=String(e.toUserId)),t},e.toObject=function(e,t){t||(t={});var r={};return t.defaults&&(r.trophy=null,r.toUserId=""),null!=e.trophy&&e.hasOwnProperty("trophy")&&(r.trophy=$root.Trophy.toObject(e.trophy,t)),null!=e.toUserId&&e.hasOwnProperty("toUserId")&&(r.toUserId=e.toUserId),r},e.prototype.toJSON=function(){return this.constructor.toObject(this,$protobuf.util.toJSONOptions)},e}(),$root.TrophyRewardedToAllEvent=function(){function e(e){if(e)for(var t=Object.keys(e),r=0;r<t.length;++r)null!=e[t[r]]&&(this[t[r]]=e[t[r]])}return e.prototype.trophy=null,e.create=function(t){return new e(t)},e.encode=function(e,t){return t||(t=$Writer.create()),null!=e.trophy&&Object.hasOwnProperty.call(e,"trophy")&&$root.Trophy.encode(e.trophy,t.uint32(10).fork()).ldelim(),t},e.encodeDelimited=function(e,t){return this.encode(e,t).ldelim()},e.decode=function(e,t){e instanceof $Reader||(e=$Reader.create(e));for(var r=void 0===t?e.len:e.pos+t,n=new $root.TrophyRewardedToAllEvent;e.pos<r;){var o=e.uint32();if(o>>>3==1)n.trophy=$root.Trophy.decode(e,e.uint32());else e.skipType(7&o)}return n},e.decodeDelimited=function(e){return e instanceof $Reader||(e=new $Reader(e)),this.decode(e,e.uint32())},e.verify=function(e){if("object"!=typeof e||null===e)return"object expected";if(null!=e.trophy&&e.hasOwnProperty("trophy")){var t=$root.Trophy.verify(e.trophy);if(t)return"trophy."+t}return null},e.fromObject=function(e){if(e instanceof $root.TrophyRewardedToAllEvent)return e;var t=new $root.TrophyRewardedToAllEvent;if(null!=e.trophy){if("object"!=typeof e.trophy)throw TypeError(".TrophyRewardedToAllEvent.trophy: object expected");t.trophy=$root.Trophy.fromObject(e.trophy)}return t},e.toObject=function(e,t){t||(t={});var r={};return t.defaults&&(r.trophy=null),null!=e.trophy&&e.hasOwnProperty("trophy")&&(r.trophy=$root.Trophy.toObject(e.trophy,t)),r},e.prototype.toJSON=function(){return this.constructor.toObject(this,$protobuf.util.toJSONOptions)},e}(),$root.NewChatMessageEvent=function(){function e(e){if(e)for(var t=Object.keys(e),r=0;r<t.length;++r)null!=e[t[r]]&&(this[t[r]]=e[t[r]])}return e.prototype.chatMessage=null,e.create=function(t){return new e(t)},e.encode=function(e,t){return t||(t=$Writer.create()),null!=e.chatMessage&&Object.hasOwnProperty.call(e,"chatMessage")&&$root.ChatMessage.encode(e.chatMessage,t.uint32(10).fork()).ldelim(),t},e.encodeDelimited=function(e,t){return this.encode(e,t).ldelim()},e.decode=function(e,t){e instanceof $Reader||(e=$Reader.create(e));for(var r=void 0===t?e.len:e.pos+t,n=new $root.NewChatMessageEvent;e.pos<r;){var o=e.uint32();if(o>>>3==1)n.chatMessage=$root.ChatMessage.decode(e,e.uint32());else e.skipType(7&o)}return n},e.decodeDelimited=function(e){return e instanceof $Reader||(e=new $Reader(e)),this.decode(e,e.uint32())},e.verify=function(e){if("object"!=typeof e||null===e)return"object expected";if(null!=e.chatMessage&&e.hasOwnProperty("chatMessage")){var t=$root.ChatMessage.verify(e.chatMessage);if(t)return"chatMessage."+t}return null},e.fromObject=function(e){if(e instanceof $root.NewChatMessageEvent)return e;var t=new $root.NewChatMessageEvent;if(null!=e.chatMessage){if("object"!=typeof e.chatMessage)throw TypeError(".NewChatMessageEvent.chatMessage: object expected");t.chatMessage=$root.ChatMessage.fromObject(e.chatMessage)}return t},e.toObject=function(e,t){t||(t={});var r={};return t.defaults&&(r.chatMessage=null),null!=e.chatMessage&&e.hasOwnProperty("chatMessage")&&(r.chatMessage=$root.ChatMessage.toObject(e.chatMessage,t)),r},e.prototype.toJSON=function(){return this.constructor.toObject(this,$protobuf.util.toJSONOptions)},e}(),$root.ClassState=function(){function e(e){if(this.users={},this.devices={},this.chatMessages=[],e)for(var t=Object.keys(e),r=0;r<t.length;++r)null!=e[t[r]]&&(this[t[r]]=e[t[r]])}return e.prototype.users=$util.emptyObject,e.prototype.devices=$util.emptyObject,e.prototype.chatMessages=$util.emptyArray,e.prototype.content=null,e.prototype.hostDeviceId="",e.prototype.classEndedTime=$util.Long?$util.Long.fromBits(0,0,!0):0,e.create=function(t){return new e(t)},e.encode=function(e,t){if(t||(t=$Writer.create()),null!=e.users&&Object.hasOwnProperty.call(e,"users"))for(var r=Object.keys(e.users),n=0;n<r.length;++n)t.uint32(10).fork().uint32(10).string(r[n]),$root.User.encode(e.users[r[n]],t.uint32(18).fork()).ldelim().ldelim();if(null!=e.devices&&Object.hasOwnProperty.call(e,"devices"))for(r=Object.keys(e.devices),n=0;n<r.length;++n)t.uint32(18).fork().uint32(10).string(r[n]),$root.Device.encode(e.devices[r[n]],t.uint32(18).fork()).ldelim().ldelim();if(null!=e.chatMessages&&e.chatMessages.length)for(n=0;n<e.chatMessages.length;++n)$root.ChatMessage.encode(e.chatMessages[n],t.uint32(26).fork()).ldelim();return null!=e.content&&Object.hasOwnProperty.call(e,"content")&&$root.Content.encode(e.content,t.uint32(34).fork()).ldelim(),null!=e.hostDeviceId&&Object.hasOwnProperty.call(e,"hostDeviceId")&&t.uint32(42).string(e.hostDeviceId),null!=e.classEndedTime&&Object.hasOwnProperty.call(e,"classEndedTime")&&t.uint32(48).uint64(e.classEndedTime),t},e.encodeDelimited=function(e,t){return this.encode(e,t).ldelim()},e.decode=function(e,t){e instanceof $Reader||(e=$Reader.create(e));for(var r,n,o=void 0===t?e.len:e.pos+t,i=new $root.ClassState;e.pos<o;){var s=e.uint32();switch(s>>>3){case 1:i.users===$util.emptyObject&&(i.users={});var a=e.uint32()+e.pos;for(r="",n=null;e.pos<a;){switch((c=e.uint32())>>>3){case 1:r=e.string();break;case 2:n=$root.User.decode(e,e.uint32());break;default:e.skipType(7&c)}}i.users[r]=n;break;case 2:i.devices===$util.emptyObject&&(i.devices={});a=e.uint32()+e.pos;for(r="",n=null;e.pos<a;){var c;switch((c=e.uint32())>>>3){case 1:r=e.string();break;case 2:n=$root.Device.decode(e,e.uint32());break;default:e.skipType(7&c)}}i.devices[r]=n;break;case 3:i.chatMessages&&i.chatMessages.length||(i.chatMessages=[]),i.chatMessages.push($root.ChatMessage.decode(e,e.uint32()));break;case 4:i.content=$root.Content.decode(e,e.uint32());break;case 5:i.hostDeviceId=e.string();break;case 6:i.classEndedTime=e.uint64();break;default:e.skipType(7&s)}}return i},e.decodeDelimited=function(e){return e instanceof $Reader||(e=new $Reader(e)),this.decode(e,e.uint32())},e.verify=function(e){if("object"!=typeof e||null===e)return"object expected";if(null!=e.users&&e.hasOwnProperty("users")){if(!$util.isObject(e.users))return"users: object expected";for(var t=Object.keys(e.users),r=0;r<t.length;++r){if(n=$root.User.verify(e.users[t[r]]))return"users."+n}}if(null!=e.devices&&e.hasOwnProperty("devices")){if(!$util.isObject(e.devices))return"devices: object expected";for(t=Object.keys(e.devices),r=0;r<t.length;++r){if(n=$root.Device.verify(e.devices[t[r]]))return"devices."+n}}if(null!=e.chatMessages&&e.hasOwnProperty("chatMessages")){if(!Array.isArray(e.chatMessages))return"chatMessages: array expected";for(r=0;r<e.chatMessages.length;++r){if(n=$root.ChatMessage.verify(e.chatMessages[r]))return"chatMessages."+n}}var n;if(null!=e.content&&e.hasOwnProperty("content")&&(n=$root.Content.verify(e.content)))return"content."+n;return null!=e.hostDeviceId&&e.hasOwnProperty("hostDeviceId")&&!$util.isString(e.hostDeviceId)?"hostDeviceId: string expected":null!=e.classEndedTime&&e.hasOwnProperty("classEndedTime")&&!($util.isInteger(e.classEndedTime)||e.classEndedTime&&$util.isInteger(e.classEndedTime.low)&&$util.isInteger(e.classEndedTime.high))?"classEndedTime: integer|Long expected":null},e.fromObject=function(e){if(e instanceof $root.ClassState)return e;var t=new $root.ClassState;if(e.users){if("object"!=typeof e.users)throw TypeError(".ClassState.users: object expected");t.users={};for(var r=Object.keys(e.users),n=0;n<r.length;++n){if("object"!=typeof e.users[r[n]])throw TypeError(".ClassState.users: object expected");t.users[r[n]]=$root.User.fromObject(e.users[r[n]])}}if(e.devices){if("object"!=typeof e.devices)throw TypeError(".ClassState.devices: object expected");t.devices={};for(r=Object.keys(e.devices),n=0;n<r.length;++n){if("object"!=typeof e.devices[r[n]])throw TypeError(".ClassState.devices: object expected");t.devices[r[n]]=$root.Device.fromObject(e.devices[r[n]])}}if(e.chatMessages){if(!Array.isArray(e.chatMessages))throw TypeError(".ClassState.chatMessages: array expected");t.chatMessages=[];for(n=0;n<e.chatMessages.length;++n){if("object"!=typeof e.chatMessages[n])throw TypeError(".ClassState.chatMessages: object expected");t.chatMessages[n]=$root.ChatMessage.fromObject(e.chatMessages[n])}}if(null!=e.content){if("object"!=typeof e.content)throw TypeError(".ClassState.content: object expected");t.content=$root.Content.fromObject(e.content)}return null!=e.hostDeviceId&&(t.hostDeviceId=String(e.hostDeviceId)),null!=e.classEndedTime&&($util.Long?(t.classEndedTime=$util.Long.fromValue(e.classEndedTime)).unsigned=!0:"string"==typeof e.classEndedTime?t.classEndedTime=parseInt(e.classEndedTime,10):"number"==typeof e.classEndedTime?t.classEndedTime=e.classEndedTime:"object"==typeof e.classEndedTime&&(t.classEndedTime=new $util.LongBits(e.classEndedTime.low>>>0,e.classEndedTime.high>>>0).toNumber(!0))),t},e.toObject=function(e,t){t||(t={});var r,n={};if((t.arrays||t.defaults)&&(n.chatMessages=[]),(t.objects||t.defaults)&&(n.users={},n.devices={}),t.defaults)if(n.content=null,n.hostDeviceId="",$util.Long){var o=new $util.Long(0,0,!0);n.classEndedTime=t.longs===String?o.toString():t.longs===Number?o.toNumber():o}else n.classEndedTime=t.longs===String?"0":0;if(e.users&&(r=Object.keys(e.users)).length){n.users={};for(var i=0;i<r.length;++i)n.users[r[i]]=$root.User.toObject(e.users[r[i]],t)}if(e.devices&&(r=Object.keys(e.devices)).length){n.devices={};for(i=0;i<r.length;++i)n.devices[r[i]]=$root.Device.toObject(e.devices[r[i]],t)}if(e.chatMessages&&e.chatMessages.length){n.chatMessages=[];for(i=0;i<e.chatMessages.length;++i)n.chatMessages[i]=$root.ChatMessage.toObject(e.chatMessages[i],t)}return null!=e.content&&e.hasOwnProperty("content")&&(n.content=$root.Content.toObject(e.content,t)),null!=e.hostDeviceId&&e.hasOwnProperty("hostDeviceId")&&(n.hostDeviceId=e.hostDeviceId),null!=e.classEndedTime&&e.hasOwnProperty("classEndedTime")&&("number"==typeof e.classEndedTime?n.classEndedTime=t.longs===String?String(e.classEndedTime):e.classEndedTime:n.classEndedTime=t.longs===String?$util.Long.prototype.toString.call(e.classEndedTime):t.longs===Number?new $util.LongBits(e.classEndedTime.low>>>0,e.classEndedTime.high>>>0).toNumber(!0):e.classEndedTime),n},e.prototype.toJSON=function(){return this.constructor.toObject(this,$protobuf.util.toJSONOptions)},e}(),$root.User=function(){function e(e){if(this.deviceIds=[],this.trophies=[],e)for(var t=Object.keys(e),r=0;r<t.length;++r)null!=e[t[r]]&&(this[t[r]]=e[t[r]])}return e.prototype.id="",e.prototype.name="",e.prototype.role="",e.prototype.deviceIds=$util.emptyArray,e.prototype.trophies=$util.emptyArray,e.create=function(t){return new e(t)},e.encode=function(e,t){if(t||(t=$Writer.create()),null!=e.id&&Object.hasOwnProperty.call(e,"id")&&t.uint32(10).string(e.id),null!=e.name&&Object.hasOwnProperty.call(e,"name")&&t.uint32(18).string(e.name),null!=e.role&&Object.hasOwnProperty.call(e,"role")&&t.uint32(26).string(e.role),null!=e.deviceIds&&e.deviceIds.length)for(var r=0;r<e.deviceIds.length;++r)t.uint32(34).string(e.deviceIds[r]);if(null!=e.trophies&&e.trophies.length)for(r=0;r<e.trophies.length;++r)$root.Trophy.encode(e.trophies[r],t.uint32(42).fork()).ldelim();return t},e.encodeDelimited=function(e,t){return this.encode(e,t).ldelim()},e.decode=function(e,t){e instanceof $Reader||(e=$Reader.create(e));for(var r=void 0===t?e.len:e.pos+t,n=new $root.User;e.pos<r;){var o=e.uint32();switch(o>>>3){case 1:n.id=e.string();break;case 2:n.name=e.string();break;case 3:n.role=e.string();break;case 4:n.deviceIds&&n.deviceIds.length||(n.deviceIds=[]),n.deviceIds.push(e.string());break;case 5:n.trophies&&n.trophies.length||(n.trophies=[]),n.trophies.push($root.Trophy.decode(e,e.uint32()));break;default:e.skipType(7&o)}}return n},e.decodeDelimited=function(e){return e instanceof $Reader||(e=new $Reader(e)),this.decode(e,e.uint32())},e.verify=function(e){if("object"!=typeof e||null===e)return"object expected";if(null!=e.id&&e.hasOwnProperty("id")&&!$util.isString(e.id))return"id: string expected";if(null!=e.name&&e.hasOwnProperty("name")&&!$util.isString(e.name))return"name: string expected";if(null!=e.role&&e.hasOwnProperty("role")&&!$util.isString(e.role))return"role: string expected";if(null!=e.deviceIds&&e.hasOwnProperty("deviceIds")){if(!Array.isArray(e.deviceIds))return"deviceIds: array expected";for(var t=0;t<e.deviceIds.length;++t)if(!$util.isString(e.deviceIds[t]))return"deviceIds: string[] expected"}if(null!=e.trophies&&e.hasOwnProperty("trophies")){if(!Array.isArray(e.trophies))return"trophies: array expected";for(t=0;t<e.trophies.length;++t){var r=$root.Trophy.verify(e.trophies[t]);if(r)return"trophies."+r}}return null},e.fromObject=function(e){if(e instanceof $root.User)return e;var t=new $root.User;if(null!=e.id&&(t.id=String(e.id)),null!=e.name&&(t.name=String(e.name)),null!=e.role&&(t.role=String(e.role)),e.deviceIds){if(!Array.isArray(e.deviceIds))throw TypeError(".User.deviceIds: array expected");t.deviceIds=[];for(var r=0;r<e.deviceIds.length;++r)t.deviceIds[r]=String(e.deviceIds[r])}if(e.trophies){if(!Array.isArray(e.trophies))throw TypeError(".User.trophies: array expected");t.trophies=[];for(r=0;r<e.trophies.length;++r){if("object"!=typeof e.trophies[r])throw TypeError(".User.trophies: object expected");t.trophies[r]=$root.Trophy.fromObject(e.trophies[r])}}return t},e.toObject=function(e,t){t||(t={});var r={};if((t.arrays||t.defaults)&&(r.deviceIds=[],r.trophies=[]),t.defaults&&(r.id="",r.name="",r.role=""),null!=e.id&&e.hasOwnProperty("id")&&(r.id=e.id),null!=e.name&&e.hasOwnProperty("name")&&(r.name=e.name),null!=e.role&&e.hasOwnProperty("role")&&(r.role=e.role),e.deviceIds&&e.deviceIds.length){r.deviceIds=[];for(var n=0;n<e.deviceIds.length;++n)r.deviceIds[n]=e.deviceIds[n]}if(e.trophies&&e.trophies.length){r.trophies=[];for(n=0;n<e.trophies.length;++n)r.trophies[n]=$root.Trophy.toObject(e.trophies[n],t)}return r},e.prototype.toJSON=function(){return this.constructor.toObject(this,$protobuf.util.toJSONOptions)},e}(),$root.Trophy=function(){function e(e){if(e)for(var t=Object.keys(e),r=0;r<t.length;++r)null!=e[t[r]]&&(this[t[r]]=e[t[r]])}return e.prototype.timestamp=$util.Long?$util.Long.fromBits(0,0,!0):0,e.prototype.type="",e.prototype.fromUserId="",e.create=function(t){return new e(t)},e.encode=function(e,t){return t||(t=$Writer.create()),null!=e.timestamp&&Object.hasOwnProperty.call(e,"timestamp")&&t.uint32(8).uint64(e.timestamp),null!=e.type&&Object.hasOwnProperty.call(e,"type")&&t.uint32(18).string(e.type),null!=e.fromUserId&&Object.hasOwnProperty.call(e,"fromUserId")&&t.uint32(26).string(e.fromUserId),t},e.encodeDelimited=function(e,t){return this.encode(e,t).ldelim()},e.decode=function(e,t){e instanceof $Reader||(e=$Reader.create(e));for(var r=void 0===t?e.len:e.pos+t,n=new $root.Trophy;e.pos<r;){var o=e.uint32();switch(o>>>3){case 1:n.timestamp=e.uint64();break;case 2:n.type=e.string();break;case 3:n.fromUserId=e.string();break;default:e.skipType(7&o)}}return n},e.decodeDelimited=function(e){return e instanceof $Reader||(e=new $Reader(e)),this.decode(e,e.uint32())},e.verify=function(e){return"object"!=typeof e||null===e?"object expected":null!=e.timestamp&&e.hasOwnProperty("timestamp")&&!($util.isInteger(e.timestamp)||e.timestamp&&$util.isInteger(e.timestamp.low)&&$util.isInteger(e.timestamp.high))?"timestamp: integer|Long expected":null!=e.type&&e.hasOwnProperty("type")&&!$util.isString(e.type)?"type: string expected":null!=e.fromUserId&&e.hasOwnProperty("fromUserId")&&!$util.isString(e.fromUserId)?"fromUserId: string expected":null},e.fromObject=function(e){if(e instanceof $root.Trophy)return e;var t=new $root.Trophy;return null!=e.timestamp&&($util.Long?(t.timestamp=$util.Long.fromValue(e.timestamp)).unsigned=!0:"string"==typeof e.timestamp?t.timestamp=parseInt(e.timestamp,10):"number"==typeof e.timestamp?t.timestamp=e.timestamp:"object"==typeof e.timestamp&&(t.timestamp=new $util.LongBits(e.timestamp.low>>>0,e.timestamp.high>>>0).toNumber(!0))),null!=e.type&&(t.type=String(e.type)),null!=e.fromUserId&&(t.fromUserId=String(e.fromUserId)),t},e.toObject=function(e,t){t||(t={});var r={};if(t.defaults){if($util.Long){var n=new $util.Long(0,0,!0);r.timestamp=t.longs===String?n.toString():t.longs===Number?n.toNumber():n}else r.timestamp=t.longs===String?"0":0;r.type="",r.fromUserId=""}return null!=e.timestamp&&e.hasOwnProperty("timestamp")&&("number"==typeof e.timestamp?r.timestamp=t.longs===String?String(e.timestamp):e.timestamp:r.timestamp=t.longs===String?$util.Long.prototype.toString.call(e.timestamp):t.longs===Number?new $util.LongBits(e.timestamp.low>>>0,e.timestamp.high>>>0).toNumber(!0):e.timestamp),null!=e.type&&e.hasOwnProperty("type")&&(r.type=e.type),null!=e.fromUserId&&e.hasOwnProperty("fromUserId")&&(r.fromUserId=e.fromUserId),r},e.prototype.toJSON=function(){return this.constructor.toObject(this,$protobuf.util.toJSONOptions)},e}(),$root.Device=function(){function e(e){if(this.webRtcStreamIds=[],e)for(var t=Object.keys(e),r=0;r<t.length;++r)null!=e[t[r]]&&(this[t[r]]=e[t[r]])}return e.prototype.id="",e.prototype.userId="",e.prototype.activityStreamId="",e.prototype.webRtcStreamIds=$util.emptyArray,e.create=function(t){return new e(t)},e.encode=function(e,t){if(t||(t=$Writer.create()),null!=e.id&&Object.hasOwnProperty.call(e,"id")&&t.uint32(10).string(e.id),null!=e.userId&&Object.hasOwnProperty.call(e,"userId")&&t.uint32(18).string(e.userId),null!=e.activityStreamId&&Object.hasOwnProperty.call(e,"activityStreamId")&&t.uint32(26).string(e.activityStreamId),null!=e.webRtcStreamIds&&e.webRtcStreamIds.length)for(var r=0;r<e.webRtcStreamIds.length;++r)t.uint32(34).string(e.webRtcStreamIds[r]);return t},e.encodeDelimited=function(e,t){return this.encode(e,t).ldelim()},e.decode=function(e,t){e instanceof $Reader||(e=$Reader.create(e));for(var r=void 0===t?e.len:e.pos+t,n=new $root.Device;e.pos<r;){var o=e.uint32();switch(o>>>3){case 1:n.id=e.string();break;case 2:n.userId=e.string();break;case 3:n.activityStreamId=e.string();break;case 4:n.webRtcStreamIds&&n.webRtcStreamIds.length||(n.webRtcStreamIds=[]),n.webRtcStreamIds.push(e.string());break;default:e.skipType(7&o)}}return n},e.decodeDelimited=function(e){return e instanceof $Reader||(e=new $Reader(e)),this.decode(e,e.uint32())},e.verify=function(e){if("object"!=typeof e||null===e)return"object expected";if(null!=e.id&&e.hasOwnProperty("id")&&!$util.isString(e.id))return"id: string expected";if(null!=e.userId&&e.hasOwnProperty("userId")&&!$util.isString(e.userId))return"userId: string expected";if(null!=e.activityStreamId&&e.hasOwnProperty("activityStreamId")&&!$util.isString(e.activityStreamId))return"activityStreamId: string expected";if(null!=e.webRtcStreamIds&&e.hasOwnProperty("webRtcStreamIds")){if(!Array.isArray(e.webRtcStreamIds))return"webRtcStreamIds: array expected";for(var t=0;t<e.webRtcStreamIds.length;++t)if(!$util.isString(e.webRtcStreamIds[t]))return"webRtcStreamIds: string[] expected"}return null},e.fromObject=function(e){if(e instanceof $root.Device)return e;var t=new $root.Device;if(null!=e.id&&(t.id=String(e.id)),null!=e.userId&&(t.userId=String(e.userId)),null!=e.activityStreamId&&(t.activityStreamId=String(e.activityStreamId)),e.webRtcStreamIds){if(!Array.isArray(e.webRtcStreamIds))throw TypeError(".Device.webRtcStreamIds: array expected");t.webRtcStreamIds=[];for(var r=0;r<e.webRtcStreamIds.length;++r)t.webRtcStreamIds[r]=String(e.webRtcStreamIds[r])}return t},e.toObject=function(e,t){t||(t={});var r={};if((t.arrays||t.defaults)&&(r.webRtcStreamIds=[]),t.defaults&&(r.id="",r.userId="",r.activityStreamId=""),null!=e.id&&e.hasOwnProperty("id")&&(r.id=e.id),null!=e.userId&&e.hasOwnProperty("userId")&&(r.userId=e.userId),null!=e.activityStreamId&&e.hasOwnProperty("activityStreamId")&&(r.activityStreamId=e.activityStreamId),e.webRtcStreamIds&&e.webRtcStreamIds.length){r.webRtcStreamIds=[];for(var n=0;n<e.webRtcStreamIds.length;++n)r.webRtcStreamIds[n]=e.webRtcStreamIds[n]}return r},e.prototype.toJSON=function(){return this.constructor.toObject(this,$protobuf.util.toJSONOptions)},e}(),$root.ChatMessage=function(){function e(e){if(e)for(var t=Object.keys(e),r=0;r<t.length;++r)null!=e[t[r]]&&(this[t[r]]=e[t[r]])}return e.prototype.userId="",e.prototype.timestamp=$util.Long?$util.Long.fromBits(0,0,!0):0,e.prototype.text="",e.create=function(t){return new e(t)},e.encode=function(e,t){return t||(t=$Writer.create()),null!=e.userId&&Object.hasOwnProperty.call(e,"userId")&&t.uint32(10).string(e.userId),null!=e.timestamp&&Object.hasOwnProperty.call(e,"timestamp")&&t.uint32(16).uint64(e.timestamp),null!=e.text&&Object.hasOwnProperty.call(e,"text")&&t.uint32(26).string(e.text),t},e.encodeDelimited=function(e,t){return this.encode(e,t).ldelim()},e.decode=function(e,t){e instanceof $Reader||(e=$Reader.create(e));for(var r=void 0===t?e.len:e.pos+t,n=new $root.ChatMessage;e.pos<r;){var o=e.uint32();switch(o>>>3){case 1:n.userId=e.string();break;case 2:n.timestamp=e.uint64();break;case 3:n.text=e.string();break;default:e.skipType(7&o)}}return n},e.decodeDelimited=function(e){return e instanceof $Reader||(e=new $Reader(e)),this.decode(e,e.uint32())},e.verify=function(e){return"object"!=typeof e||null===e?"object expected":null!=e.userId&&e.hasOwnProperty("userId")&&!$util.isString(e.userId)?"userId: string expected":null!=e.timestamp&&e.hasOwnProperty("timestamp")&&!($util.isInteger(e.timestamp)||e.timestamp&&$util.isInteger(e.timestamp.low)&&$util.isInteger(e.timestamp.high))?"timestamp: integer|Long expected":null!=e.text&&e.hasOwnProperty("text")&&!$util.isString(e.text)?"text: string expected":null},e.fromObject=function(e){if(e instanceof $root.ChatMessage)return e;var t=new $root.ChatMessage;return null!=e.userId&&(t.userId=String(e.userId)),null!=e.timestamp&&($util.Long?(t.timestamp=$util.Long.fromValue(e.timestamp)).unsigned=!0:"string"==typeof e.timestamp?t.timestamp=parseInt(e.timestamp,10):"number"==typeof e.timestamp?t.timestamp=e.timestamp:"object"==typeof e.timestamp&&(t.timestamp=new $util.LongBits(e.timestamp.low>>>0,e.timestamp.high>>>0).toNumber(!0))),null!=e.text&&(t.text=String(e.text)),t},e.toObject=function(e,t){t||(t={});var r={};if(t.defaults){if(r.userId="",$util.Long){var n=new $util.Long(0,0,!0);r.timestamp=t.longs===String?n.toString():t.longs===Number?n.toNumber():n}else r.timestamp=t.longs===String?"0":0;r.text=""}return null!=e.userId&&e.hasOwnProperty("userId")&&(r.userId=e.userId),null!=e.timestamp&&e.hasOwnProperty("timestamp")&&("number"==typeof e.timestamp?r.timestamp=t.longs===String?String(e.timestamp):e.timestamp:r.timestamp=t.longs===String?$util.Long.prototype.toString.call(e.timestamp):t.longs===Number?new $util.LongBits(e.timestamp.low>>>0,e.timestamp.high>>>0).toNumber(!0):e.timestamp),null!=e.text&&e.hasOwnProperty("text")&&(r.text=e.text),r},e.prototype.toJSON=function(){return this.constructor.toObject(this,$protobuf.util.toJSONOptions)},e}(),$root.Content=function(){function e(e){if(e)for(var t=Object.keys(e),r=0;r<t.length;++r)null!=e[t[r]]&&(this[t[r]]=e[t[r]])}return e.prototype.type="",e.prototype.contentLocation="",e.create=function(t){return new e(t)},e.encode=function(e,t){return t||(t=$Writer.create()),null!=e.type&&Object.hasOwnProperty.call(e,"type")&&t.uint32(10).string(e.type),null!=e.contentLocation&&Object.hasOwnProperty.call(e,"contentLocation")&&t.uint32(18).string(e.contentLocation),t},e.encodeDelimited=function(e,t){return this.encode(e,t).ldelim()},e.decode=function(e,t){e instanceof $Reader||(e=$Reader.create(e));for(var r=void 0===t?e.len:e.pos+t,n=new $root.Content;e.pos<r;){var o=e.uint32();switch(o>>>3){case 1:n.type=e.string();break;case 2:n.contentLocation=e.string();break;default:e.skipType(7&o)}}return n},e.decodeDelimited=function(e){return e instanceof $Reader||(e=new $Reader(e)),this.decode(e,e.uint32())},e.verify=function(e){return"object"!=typeof e||null===e?"object expected":null!=e.type&&e.hasOwnProperty("type")&&!$util.isString(e.type)?"type: string expected":null!=e.contentLocation&&e.hasOwnProperty("contentLocation")&&!$util.isString(e.contentLocation)?"contentLocation: string expected":null},e.fromObject=function(e){if(e instanceof $root.Content)return e;var t=new $root.Content;return null!=e.type&&(t.type=String(e.type)),null!=e.contentLocation&&(t.contentLocation=String(e.contentLocation)),t},e.toObject=function(e,t){t||(t={});var r={};return t.defaults&&(r.type="",r.contentLocation=""),null!=e.type&&e.hasOwnProperty("type")&&(r.type=e.type),null!=e.contentLocation&&e.hasOwnProperty("contentLocation")&&(r.contentLocation=e.contentLocation),r},e.prototype.toJSON=function(){return this.constructor.toObject(this,$protobuf.util.toJSONOptions)},e}();var protobuf=$root,eventemitter3={exports:{}};!function(e){var t=Object.prototype.hasOwnProperty,r="~";function n(){}function o(e,t,r){this.fn=e,this.context=t,this.once=r||!1}function i(e,t,n,i,s){if("function"!=typeof n)throw new TypeError("The listener must be a function");var a=new o(n,i||e,s),c=r?r+t:t;return e._events[c]?e._events[c].fn?e._events[c]=[e._events[c],a]:e._events[c].push(a):(e._events[c]=a,e._eventsCount++),e}function s(e,t){0==--e._eventsCount?e._events=new n:delete e._events[t]}function a(){this._events=new n,this._eventsCount=0}Object.create&&(n.prototype=Object.create(null),(new n).__proto__||(r=!1)),a.prototype.eventNames=function(){var e,n,o=[];if(0===this._eventsCount)return o;for(n in e=this._events)t.call(e,n)&&o.push(r?n.slice(1):n);return Object.getOwnPropertySymbols?o.concat(Object.getOwnPropertySymbols(e)):o},a.prototype.listeners=function(e){var t=r?r+e:e,n=this._events[t];if(!n)return[];if(n.fn)return[n.fn];for(var o=0,i=n.length,s=new Array(i);o<i;o++)s[o]=n[o].fn;return s},a.prototype.listenerCount=function(e){var t=r?r+e:e,n=this._events[t];return n?n.fn?1:n.length:0},a.prototype.emit=function(e,t,n,o,i,s){var a=r?r+e:e;if(!this._events[a])return!1;var c,d,l=this._events[a],p=arguments.length;if(l.fn){switch(l.once&&this.removeListener(e,l.fn,void 0,!0),p){case 1:return l.fn.call(l.context),!0;case 2:return l.fn.call(l.context,t),!0;case 3:return l.fn.call(l.context,t,n),!0;case 4:return l.fn.call(l.context,t,n,o),!0;case 5:return l.fn.call(l.context,t,n,o,i),!0;case 6:return l.fn.call(l.context,t,n,o,i,s),!0}for(d=1,c=new Array(p-1);d<p;d++)c[d-1]=arguments[d];l.fn.apply(l.context,c)}else{var u,f=l.length;for(d=0;d<f;d++)switch(l[d].once&&this.removeListener(e,l[d].fn,void 0,!0),p){case 1:l[d].fn.call(l[d].context);break;case 2:l[d].fn.call(l[d].context,t);break;case 3:l[d].fn.call(l[d].context,t,n);break;case 4:l[d].fn.call(l[d].context,t,n,o);break;default:if(!c)for(u=1,c=new Array(p-1);u<p;u++)c[u-1]=arguments[u];l[d].fn.apply(l[d].context,c)}}return!0},a.prototype.on=function(e,t,r){return i(this,e,t,r,!1)},a.prototype.once=function(e,t,r){return i(this,e,t,r,!0)},a.prototype.removeListener=function(e,t,n,o){var i=r?r+e:e;if(!this._events[i])return this;if(!t)return s(this,i),this;var a=this._events[i];if(a.fn)a.fn!==t||o&&!a.once||n&&a.context!==n||s(this,i);else{for(var c=0,d=[],l=a.length;c<l;c++)(a[c].fn!==t||o&&!a[c].once||n&&a[c].context!==n)&&d.push(a[c]);d.length?this._events[i]=1===d.length?d[0]:d:s(this,i)}return this},a.prototype.removeAllListeners=function(e){var t;return e?(t=r?r+e:e,this._events[t]&&s(this,t)):(this._events=new n,this._eventsCount=0),this},a.prototype.off=a.prototype.removeListener,a.prototype.addListener=a.prototype.on,a.prefixed=r,a.EventEmitter=a,e.exports=a}(eventemitter3);const setConnectionState=createAction("setConnectionState"),connectionStatus=createReducer("not-connected",(e=>e.addCase(setConnectionState,((e,{payload:t})=>t)))),myDeviceId=createReducer(null,(e=>e.addCase(classActions.join,((e,{payload:t})=>t.deviceId)))),networkReducer=combineReducers({connectionStatus:connectionStatus,myDeviceId:myDeviceId}),newRequestId=e=>e;class Network{constructor(e,t){this.store=e,this.selector=t,this.rpc=new PromiseCompleter,this.actionEmitter=new eventemitter3.exports.EventEmitter}onClassAction(e,t){const r=`${classSliceActionPrefix}/${e}`;return this.actionEmitter.addListener(r,t),()=>{this.actionEmitter.removeListener(r,t)}}async connect(e){return this.transport&&this.transport.disconnect(),this.transport=new WSTransport(e,((e,t)=>this.onNetworkMessage(e,t)),(e=>this.onStateChange(e)),["live"],!0),await this.transport.connect()}disconnect(e,t){this.transport?.disconnect(e,t)}onStateChange(e){this.store.dispatch(setConnectionState(e))}onNetworkMessage(e,t){if(t instanceof ArrayBuffer)try{if(t.byteLength<=0)return;const e=protobuf.ClassMessage.decode(new Uint8Array(t));e.response&&this.handleResponse(e.response);const r=messageToClassAction(e);if(!r)return;this.store.dispatch(r);const n=this.selector(this.store.getState());this.actionEmitter.emit(r.type,r.payload,n)}catch(t){console.error(t),e.disconnect(4400,"Parse error")}else e.disconnect(4401,"Binary only protocol")}handleResponse(e){if(!e.id)return;const t=newRequestId(e.id);e.error?this.rpc.reject(t,e.error):this.rpc.resolve(t)}async send(e){if(!this.transport)throw Error("WebSocket has not been initialised");const t=nanoid(),r=protobuf.ClassRequest.encode({requestId:t,...e}).finish();return await this.transport.send(r),this.rpc.createPromise(t)}}function NetworkProvider({children:e,selector:t}){const r=useStore(),n=useMemo((()=>new Network(r,t)),[r,t]);return React.createElement(NetworkContext.Provider,{value:n},e)}function WebRtcProvider({children:e,selector:t}){const r=useStore(),n=useMemo((()=>new WebRtcManager(r,t)),[r,t]);return React.createElement(WebRtcContext.Provider,{value:n},e)}const reducer=combineReducers({class:classReducer,network:networkReducer,webrtc:webrtcSlice.reducer}),roles={Teacher:newUserRole("teacher"),Student:newUserRole("student")};function isTeacher({role:e}){return e===roles.Teacher}function isStudent({role:e}){return e===roles.Student}export{ContentType,FeedbackType,INITIAL_ROOM_STATE,NetworkContext,NetworkProvider,QuickFeedbackType,WebRtcContext,WebRtcManager,WebRtcProvider,activityStreamIdChangedAction,classActions,classEndedAction,classReducer,classSlice,classSliceActionPrefix,connectionStatus,contentChangedAction,deviceConnectedAction,deviceDisconnectedAction,hostChangedAction,initialState,isStudent,isTeacher,joinAction,messageToClassAction,myDeviceId,networkReducer,newActivityStreamId,newChatMessageAction,newDeviceId,newTimestamp,newTrophyType,newUserDeviceId,newUserId,newUserRole,newWebRtcStreamId,reducer,roles,setConnectionState,trophyRewardedToAllAction,trophyRewardedToUserAction,useCamera,useEndClass,useGloballyPauseMediaStream,useGloballyResumeMediaStream,useHostUserDevice,useJoinClass,useLeaveClass,useLocalUserDevice,useLocallyPauseMediaStream,useLocallyResumeMediaStream,useMediaStream,useNetworkHandler,useNetworkState,useRewardTrophyToAll,useRewardTrophyToUser,useSendChatMessage,useSendMediaStream,useSetActivityStreamId,useSetContent,useSetHost,useUserDevices,useWebRtcState,webRtcSliceActionPrefix,webrtcSlice};
//# sourceMappingURL=ui.js.map
